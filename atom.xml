<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zu3zz.github.io</id>
    <title>é£è¢–</title>
    <updated>2020-05-17T16:05:02.075Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zu3zz.github.io"/>
    <link rel="self" href="https://zu3zz.github.io/atom.xml"/>
    <subtitle>çƒŸè›¾æ•›ç•¥ä¸èƒœæ€ï¼Œé£è¢–ä½æ˜‚å¦‚æœ‰æƒ…</subtitle>
    <logo>https://zu3zz.github.io/images/avatar.png</logo>
    <icon>https://zu3zz.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, é£è¢–</rights>
    <entry>
        <title type="html"><![CDATA[SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³]]></title>
        <id>https://zu3zz.github.io/post/springcloud-discount-1/</id>
        <link href="https://zu3zz.github.io/post/springcloud-discount-1/">
        </link>
        <updated>2020-05-12T09:00:47.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ¥•SpringCloudå®æˆ˜åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²è§£SpringBootä¸­çš„ä¸€äº›é«˜çº§ç‰¹æ€§ğŸ¥•</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ¥•SpringCloudå®æˆ˜åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²è§£SpringBootä¸­çš„ä¸€äº›é«˜çº§ç‰¹æ€§ğŸ¥•</p>
<!-- more -->
<h2 id="springcloud-åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸1-springbootç›¸å…³">SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³</h2>
<h3 id="1-è‡ªåŠ¨è£…é…åŸç†">1. è‡ªåŠ¨è£…é…åŸç†</h3>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1589274133972.png" alt="" loading="lazy"></figure>
<h3 id="2-é…ç½®æ–‡ä»¶">2. é…ç½®æ–‡ä»¶</h3>
<ul>
<li>åŒä¸€ç›®å½•ä¸‹çš„applicationå’Œbootstrap
<ol>
<li>bootstrapä¼˜å…ˆçº§é«˜äºapplicationï¼Œä¼˜å…ˆè¢«åŠ è½½</li>
<li>bootstrapç”¨äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µï¼Œç”±çˆ¶ApplicationContextåŠ è½½</li>
<li>bootstrapæ˜¯ç³»ç»Ÿçº§åˆ«çš„é…ç½®ï¼ˆä¸å˜çš„å‚æ•°ï¼‰ï¼Œapplicationæ˜¯åº”ç”¨çº§åˆ«çš„é…ç½®</li>
</ol>
</li>
<li>ä¸åŒä½ç½®çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼ˆä¼˜å…ˆçº§ï¼‰
<ul>
<li><code>file: ./config/</code> - ä¼˜å…ˆçº§æœ€é«˜ï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹çš„configï¼‰</li>
<li><code>file: ./</code> - ä¼˜å…ˆçº§ç¬¬äºŒï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹ï¼‰</li>
<li><code>classpath: /config/</code> - ä¼˜å…ˆçº§ç¬¬ä¸‰ ï¼ˆé¡¹ç›®resources/configä¸‹ï¼‰</li>
<li><code>classpath: /</code> - ä¼˜å…ˆçº§ç¬¬å››ï¼ˆé¡¹ç›®resourcesç›®å½•ä¸‹ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="3-é…ç½®æ³¨å…¥">3. é…ç½®æ³¨å…¥</h3>
<ol>
<li>
<p>ç›´æ¥ä½¿ç”¨<code>@Value</code>çš„å½¢å¼</p>
<pre><code class="language-java">@Value(&quot;${zth.springboot.version}&quot;)
private String version
</code></pre>
</li>
<li>
<p>éœ€è¦åœ¨pom.xmlä¸­é¦–å…ˆé…ç½®ç”¨äºæ•°æ®ç»‘å®šçš„ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
  &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</code></pre>
<p>applicaiton.ymlé…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<pre><code class="language-yml"># application.yml
zth:
	springboot:
		version: 2.3.1
		name: study
</code></pre>
<p>æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é…ç½®ç±»ä¸­çš„å€¼éœ€è¦å’Œapplicaiton.ymlæ–‡ä»¶ä¸­ä¸€è‡´</p>
<pre><code class="language-java">@Data
@Component
@ConfigurationProperties(prefix = &quot;zth.springboot&quot;)
public class SpringBootConfig {
  private String version;
	private String name;
}
</code></pre>
<p>ä½¿ç”¨<code>@Autowired</code>å°±å¯ä»¥æ³¨å…¥<code>SpringBootConfig</code>äº†</p>
</li>
</ol>
<h3 id="4-å®šæ—¶åº”ç”¨">4. å®šæ—¶åº”ç”¨</h3>
<ol>
<li>
<p>éœ€è¦åœ¨ä¸»é…ç½®ä¸Šå¼€å¯å…è®¸å®šæ—¶ä»»åŠ¡çš„æ³¨è§£<code>@EnableScheduling</code></p>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç±»</p>
<pre><code class="language-java">@Slf4j
@Component
public class BootSchedule {
  private final DateTimeFormatter fmt = DateTimeFormatter.ofPattern(
  	&quot;HH:mm:ss&quot;
  );
  // ä¸Šä¸€æ¬¡å¼€å§‹æ‰§è¡Œæ—¶é—´ç‚¹ä¹‹å3ç§’å†æ‰§è¡Œ
  @Scheduled(fixedRate = 3000)
  public void schedule01(){
    log.info(&quot;schedule01 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
  // ç¬¬ä¸€æ¬¡å»¶è¿Ÿ2sä¹‹åæ‰§è¡Œ
  // ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œæ¯•æ—¶é—´ç‚¹ä¹‹å3ç§’å†æ‰§è¡Œ
  @Scheduled(initialDelay = 2000, fixedDelay = 3000)
  public void schedule02(){
    log.info(&quot;schedule02 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
  
  // æ¯3sæ‰§è¡Œä¸€æ¬¡
  // ä½¿ç”¨cronè¡¨è¾¾å¼çš„å½¢å¼
  @Scheduled(cron = &quot;*/3 * * * * ?&quot;)
  public void schedule04(){
    log.info(&quot;schedule02 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
}
</code></pre>
</li>
</ol>
<h3 id="5-å¼‚æ­¥ä»»åŠ¡">5. å¼‚æ­¥ä»»åŠ¡</h3>
<h4 id="1-å¼‚æ­¥æ–¹æ³•">1. å¼‚æ­¥æ–¹æ³•</h4>
<ol>
<li>
<p>é¦–å…ˆéœ€è¦åœ¨pom.xmlä¸­æ·»åŠ springbootçš„webä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>åœ¨å¯åŠ¨ç±»ä¸­å¼€å¯å¼‚æ­¥çš„æ³¨é‡Š<code>@EnableAsync</code></p>
<pre><code class="language-java">@EnableAsync
@EnableScheduling
@SpringBootApplication
public class SpringBootStudyApplication{
  public static void main(String[] args){
    // ...
  }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªå¼‚æ­¥å¤„ç†æœåŠ¡<code>asyncService</code></p>
<pre><code class="language-java">@Slf4j
@Service
public class AsyncService {
  @Async(&quot;getAsyncExecutor&quot;)
  public void asyncProcess() throws InterruptedException {
    log.info(&quot;async process task, current thread name -&gt; {}&quot;,
            Thread.currentThread().getName());
    TimeUnit.SECONDS.sleep(2);
  }
  @Async(&quot;getAsyncExecutor&quot;)
  public Future&lt;Integer&gt; asyncProcessHasReturn() throws InterruptedException {
    log.info(&quot;async process task(has return), current thread name -&gt; {}&quot;,
            Thread.currentThread().getName());
    TimeUnit.SECONDS.sleep(2);
    return new AsyncResult&lt;&gt;(100);
  }
}
</code></pre>
</li>
</ol>
<h4 id="2-è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± ">2. è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± </h4>
<ol>
<li>
<p><code>SpringBoot</code>ä¸­è‡ªå¸¦çš„å¼‚æ­¥çº¿ç¨‹æ± ä¸­æœ‰é—®é¢˜</p>
</li>
<li>
<p>åœ¨<code>config</code>ç›®å½•ä¸­å®šä¹‰ä¸€ä¸ª<code>AsyncPoolConfig</code></p>
<pre><code class="language-java">@Slf4j
@Configuration
public class AsyncPoolConfig implements AsyncConfigurer {
  @Bean
  @Override
  public Excutor getAsyncExecutor() {
    ThreadPoolTaskExcutor excutor = new ThreadPoolTaskExecutor();
    excutor.setCorePoolSize(10);
    excutor.setMaxPoolSize(20);
    excutor.setQueueCapacity(20);
    excutor.setKeepAliveSeconds(60);
    excutor.setThreadNamePrefix(&quot;ZthAsync_&quot;);
    excutor.setWaitForTasksToCompleteOnShutDown(true);
    excutor.setAwaitTerminationSeconds(60);
    // æ‹’ç»ç­–ç•¥
    excutor.setRejectedExecutionHandler(
    	new ThreadPoolExcutor.CallerRunsPolicy()
    );
    excutor.initialize();
    return excutor;
  }
  // å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„å¼‚å¸¸å¤„ç†ç±»
  @Override
  public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
    return new AsyncExceptionHandler();
  }
  class AsyncExceptionHandler implements AsyncUncaughtExceptionHandler {
    @Override
    public void handleUncaughtException(Throwable throwable,
                                       Method method, Object... objects){
      log.info(&quot;AsyncError: {}, Method: {}, Param: {}&quot;,
              throwable.getMessage(),
              method.getName(),
              JSON.toJSONString(objects));
      throwable.printStackTrace();
      // TODO å‘é€æç¤ºï¼ˆé‚®ä»¶orçŸ­ä¿¡ï¼‰
    }
  }
}
</code></pre>
</li>
</ol>
<h3 id="6-å•å…ƒæµ‹è¯•">6. å•å…ƒæµ‹è¯•</h3>
<ol>
<li>
<p>é¦–å…ˆå¼•å…¥å•å…ƒæµ‹è¯•çš„<code>pom.xml</code>é…ç½®</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>æ–°å»ºåŒåç±»è·¯å¾„ï¼Œæ–°å»ºåŸºç¡€æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@SpringBootTest
@RunWith(SpringRunner.class)
public class SpringBootStudyTests {
  @Test
  public void contextLoad(){
  }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºä¸Šè¿°å¼‚æ­¥ä»»åŠ¡æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@Slf4j
@SpringBootTest
@RunWith(SpringRunner.class)
public class AsyncServiceTest {
    @Autowired
    private AsyncService asyncService;
    @Test
    public void testAsyncProcess() throws InterruptedException {
        asyncService.asyncProcess();
        log.info(&quot;coming in testAsyncProcess...&quot;);
    }
    @Test
    public void testAsyncProcessHasReturn() throws Exception {
        long start = System.currentTimeMillis();
        Future&lt;Integer&gt; result = asyncService.asyncProcessHasReturn();
//        log.info(&quot;get async task value: {}&quot;, result.get());
        log.info(&quot;get async task value: {}&quot;,
                result.get(1, TimeUnit.SECONDS));
        log.info(&quot;time elapse for async task: {}ms&quot;,
                System.currentTimeMillis() - start);
    }
}
</code></pre>
</li>
</ol>
<h3 id="7-å¼€æœºå¯åŠ¨ä»»åŠ¡">7. å¼€æœºå¯åŠ¨ä»»åŠ¡</h3>
<ol>
<li>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š<code>ApplicationRunner</code></p>
<pre><code class="language-java">@Order(2)
@Slf4j
@Component
public class BootApplicationRunner implements ApplicationRunner {
    @Override
    public void run(ApplicationArguments args) throws Exception {
        log.info(&quot;This is BootApplicationRunner...&quot;);
    }
}
</code></pre>
</li>
<li>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š<code>CommandLineRunner</code></p>
<pre><code class="language-java">@Order(1)
@Slf4j
@Component
public class BootCommandLineRunner implements CommandLineRunner {
    @Override
    public void run(String... args) throws Exception {
        log.info(&quot;This is BootCommandLineRunner...&quot;);
    }
}
</code></pre>
</li>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹<code>ApplicationRunner</code>é«˜äº<code>CommandLIineRunner</code></p>
</li>
</ol>
<h3 id="8-jacksonçš„ä½¿ç”¨">8. Jacksonçš„ä½¿ç”¨</h3>
<ol>
<li>
<p>æ–°å»ºä¸€ä¸ªç®€å•VOç±»<code>Coder</code></p>
<pre><code class="language-java">// Coder.java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@JsonIgnoreProperties({ &quot;address&quot; })
public class Coder {
    private String name;
    private int age;
    // @JsonIgnore -&gt; ä½¿ç”¨æ‰“åœ¨ç±»ä¸Šé¢çš„JsonIgnore
    private String address;
    @JsonProperty(&quot;rt&quot;)
    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)
    private Date registerTime;
}
</code></pre>
</li>
<li>
<p>å¯ä»¥åœ¨<code>config</code>ç›®å½•ä¸‹å®šä¹‰ä¸€ä¸ª<code>JacksonConfig</code>ç±»ï¼Œç”¨äºå¯¹æ—¶é—´å­—æ®µçš„åºåˆ—åŒ–ä¿®é¥°</p>
<pre><code class="language-java">@Configuration
public class JacksonConfig {
    @Bean
    public ObjectMapper getObjectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        // ä¸åºåˆ—åŒ–åŒ…å«nullçš„å­—æ®µ
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        // formatå¯¹è±¡
        mapper.setDateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;));
        return mapper;
    }
}
</code></pre>
</li>
<li>
<p>åœ¨controllerä¸­æ–°å»ºä¸€ä¸ªæ–¹æ³•ç”¨æ¥æµ‹è¯•Jackson</p>
<pre><code class="language-java">// Controller.java
/**
* 127.0.0.1:8000/zth/springboot/jackson
**/
@GetMapping(&quot;/jackson&quot;)
public Imoocer jackson() throws Exception {
  Imoocer imoocer = Imoocer.builder()
    .name(&quot;zth&quot;)
    .age(19)
    .address(&quot;shanghai&quot;)
    .registerTime(new Date())
    .build();
  // åºåˆ—åŒ–
  String jsonImoocer = mapper.writeValueAsString(imoocer);
  log.info(&quot;imoocer jackson: {}&quot;, jsonImoocer);
  return mapper.readValue(jsonImoocer, Imoocer.class);
}
// è¿”å›ç»“æœ
{
  &quot;name&quot;: &quot;qinyi&quot;,
  &quot;age&quot;: 23,
  &quot;rt&quot;: &quot;2020-05-12&quot;
}
</code></pre>
</li>
</ol>
<h3 id="9-acutatorç›‘æ§">9. Acutatorç›‘æ§</h3>
<h4 id="1-åŸºæœ¬ä½¿ç”¨">1. åŸºæœ¬ä½¿ç”¨</h4>
<ol>
<li>
<p>Actuatoræ˜¯ä»€ä¹ˆï¼Œèƒ½åšä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æ˜¯ä»€ä¹ˆï¼šæ˜¯SpringBootæä¾›çš„å¯¹åº”ç”¨ç³»ç»Ÿçš„è‡ªçœå’Œç›‘æ§çš„é›†æˆåŠŸèƒ½</li>
<li>èƒ½åšä»€ä¹ˆï¼šæŸ¥çœ‹åº”ç”¨ï¼ˆé…ç½®ï¼‰ä¿¡æ¯ã€ç¯å¢ƒä¿¡æ¯ä»¥åŠå¯¹åº”ç”¨è¿›è¡Œç›‘æ§</li>
</ul>
</li>
<li>
<p>Actuatorç›‘æ§åˆ†ç±»ï¼š</p>
<ul>
<li>åŸç”Ÿç«¯ç‚¹
<ul>
<li>åº”ç”¨é…ç½®ç±»ï¼ˆè¿è¡Œæ—¶ä¿¡æ¯ï¼‰</li>
<li>åº¦é‡æŒ‡æ ‡ç±»ï¼ˆè¿è¡ŒæœŸçš„ä¿¡æ¯ï¼‰</li>
<li>æ“ä½œæ§åˆ¶ç±»ï¼ˆshutdown é»˜è®¤ä¸å¼€å¯ï¼‰</li>
</ul>
</li>
<li>è‡ªå®šä¹‰ç«¯ç‚¹</li>
</ul>
</li>
<li>
<p>æ·»åŠ pom.xmlä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>åœ¨application.ymlä¸­é…ç½®ç«¯ç‚¹å¼€å¯çŠ¶å†µ</p>
<pre><code class="language-yaml">management:
  endpoint:
    shutdown:
      enabled: true # æœ€ç‰¹æ®Šçš„ç›‘æ§ç«¯ç‚¹ ä¸€èˆ¬ä¸å¼€å¯
  endpoints:
    web:
      exposure:
        include: &quot;*&quot; # æ‰“å¼€æ‰€æœ‰çš„ç›‘æ§ç‚¹ []å¯ä»¥é€‰æ‹©è¦æ‰“å¼€å“ªäº›
</code></pre>
</li>
<li>
<p>è¯·æ±‚<code>localhost:8000/zth/acuator/health</code>ç«¯å£</p>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre>
</li>
<li>
<p>åœ¨application.ymlä¸­é…ç½®infoä¿¡æ¯</p>
<pre><code class="language-yaml">info:
  app:
    name: zth-springboot-study
    groupId: com.zth.springboot.study
    version: 1.0-SNAPSHOT
</code></pre>
<p>è¯·æ±‚<code>localhost:8000/zth/acuator/info</code>ç«¯å£ï¼Œæ­¤æ—¶è¿”å›ä¿¡æ¯å¦‚ä¸‹</p>
<pre><code class="language-json">{
  &quot;app&quot;: {
    &quot;name&quot;: &quot;zth-springboot-study&quot;,
    &quot;groupId&quot;: &quot;com.zth.springboot.study&quot;,
    &quot;version&quot;: &quot;1.0-SNAPSHOT&quot;
  }
}
</code></pre>
</li>
</ol>
<h4 id="2-å¸¸ç”¨é€‰é¡¹å’Œé…ç½®">2. å¸¸ç”¨é€‰é¡¹å’Œé…ç½®</h4>
<ol>
<li>
<p>åº”ç”¨é…ç½®ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>è‡ªå·±é…ç½®çš„infoä¿¡æ¯ï¼š/actuator/info</li>
<li>åº”ç”¨ä¸­beançš„ä¿¡æ¯ï¼š/actuator/beans</li>
<li>åº”ç”¨ä¸­URIè·¯å¾„ä¿¡æ¯ï¼š/actuator/mappings</li>
</ul>
</li>
<li>
<p>åº¦é‡æŒ‡æ ‡ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>æ£€æŸ¥åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼š/actuator/health</li>
<li>å½“å‰çº¿ç¨‹æ´»åŠ¨å¿«ç…§ï¼š/actuator/threaddump</li>
</ul>
</li>
<li>
<p>æ“ä½œæ§åˆ¶ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>
<p>å…³é—­åº”ç”¨ï¼ˆPOSTï¼‰ï¼š/actuator/shutdown</p>
<pre><code class="language-shell">curl -x post &quot;http://loccalhost:8000/actuator/shutdown&quot;
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="3-ç«¯ç‚¹ä½¿ç”¨">3. ç«¯ç‚¹ä½¿ç”¨</h4>
<ol>
<li>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹endpointï¼Œæ–°å»ºDateTimeEndPointç±»</p>
<pre><code class="language-java">// DateTimeEndPoint.java
/**
 * &lt;h1&gt;è‡ªå®šä¹‰äº‹ä»¶ç«¯ç‚¹&lt;/h1&gt;
 */
@Endpoint(id = &quot;datetime&quot;)
public class DateTimeEndPoint {
    private String format = &quot;yyyy-MM-dd HH:mm:ss&quot;;
    // ç”¨æ¥æ˜¾ç¤ºç›‘æ§æŒ‡æ ‡
    // zth/actuator/datetime
    @ReadOperation
    public Map&lt;String, Object&gt; info() {
        Map&lt;String, Object&gt; info = new HashMap&lt;&gt;();
        info.put(&quot;name&quot;, &quot;zth&quot;);
        info.put(&quot;age&quot;, &quot;23&quot;);
        info.put(&quot;datetime&quot;, new SimpleDateFormat(format).format(new Date()));
        return info;
    }

    // åŠ¨æ€æ›´æ”¹ç›‘æ§æŒ‡æ ‡
    @WriteOperation
    public void setFormat(String format) {
        this.format = format;
    }
}
</code></pre>
</li>
<li>
<p>åœ¨endpointæ–‡ä»¶å¤¹ä¸‹æ–°å»ºè‡ªå®šä¹‰ç«¯ç‚¹é…ç½®ç±»DateTimeEndpointConfig</p>
<pre><code class="language-java">// DateTimeEndpointConfig.java
// è‡ªå®šä¹‰ç«¯ç‚¹é…ç½®ç±»
@Configuration
public class DateTimeEndpointConfig {
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnEnabledEndpoint
    public DateTimeEndPoint dateTimeEndPoint() {
        return new DateTimeEndPoint();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨postmanä¸­ä½¿ç”¨GETè¯·æ±‚<code>localhost:8000/zth/actuator/datetime</code></p>
<pre><code class="language-json">{
  &quot;datetime&quot;: &quot;2020-05-12 08:08:08&quot;,
  &quot;name&quot;: &quot;zth&quot;,
  &quot;age&quot;: &quot;23&quot;
}
</code></pre>
<p>å½“ä½¿ç”¨POSTè¯·æ±‚<code>localhost:8000/zth/actuator/datetime</code>æ—¶å¸¦å¦‚ä¸‹è¯·æ±‚ä½“æ—¶</p>
<pre><code class="language-json">{
  &quot;format&quot;: &quot;yyyy-MM-dd&quot;
}
</code></pre>
<p>æ— è¿”å›ç»“æœï¼Œå†æ¬¡ä½¿ç”¨GETè¯·æ±‚è®¿é—®<code>localhost:8000/zth/actuator/datetime</code>ï¼Œè¿”å›ç»“æœå¦‚ä¸‹</p>
<pre><code class="language-json">{
  &quot;datetime&quot;: &quot;2020-05-12&quot;,
  &quot;name&quot;: &quot;zth&quot;,
  &quot;age&quot;: &quot;23&quot;
}
</code></pre>
</li>
</ol>
<h3 id="10-è‡ªå®šä¹‰starter">10. è‡ªå®šä¹‰starter</h3>
<h4 id="1-è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡">1. è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡</h4>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ª<code>springboot</code>é¡¹ç›®ï¼Œ<code>groupId</code>æŒ‰ç…§<code>xxxx-spring-boot-starter</code>çš„æ ¼å¼å‘½å</p>
</li>
<li>
<p>æ·»åŠ pom.xmlæ–‡ä»¶ä¾èµ–</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.zth.springboot&lt;/groupId&gt;
    &lt;artifactId&gt;split-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt;
        &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;
    &lt;/parent&gt;
    &lt;properties&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
</li>
<li>
<p>æ–°å»ºserviceç›®å½•ï¼Œserviceæ–¹æ³•è¿˜æœ‰å¯¹åº”çš„å®ç°ç±»</p>
<pre><code class="language-java">// ISplitService.java
// å­—ç¬¦ä¸²åˆ†å‰²æœåŠ¡æ¥å£å®šä¹‰
public interface ISplitService {
    List&lt;String&gt; split(String value);
}
</code></pre>
<p>å¯¹åº”çš„å®ç°ç±»</p>
<pre><code class="language-java">// SplitServiceImpl.java
public class SplitServiceImpl implements ISplitService {
    @SuppressWarnings(&quot;all&quot;)
    @Override
    public List&lt;String&gt; split(String value) {
        // jdk1.8ä¸­çš„streamæµ
        return Stream.of(StringUtils.split(value, &quot;,&quot;))
                .collect(Collectors.toList());
    }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºconfigureç›®å½•ï¼Œæ–°å»ºè‡ªåŠ¨é…ç½®ç±»</p>
<pre><code class="language-java">@Configuration
@ConditionalOnClass(value = { ISplitService.class, SplitServiceImpl.class})
public class SplitAutoConfigure {
    @Bean
    @ConditionalOnMissingBean
    ISplitService starterService() {
        return new SplitServiceImpl();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºMETA-INFæ–‡ä»¶å¤¹ï¼Œæ·»åŠ é…ç½®ç±»<code>spring.factories</code></p>
<pre><code class="language-shell"># ç±»ä¼¼key = valueçš„é”®å€¼å¯¹å½¢å¼
org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.imooc.springboot.configure.SplitAutoConfigure
</code></pre>
</li>
<li>
<p>åœ¨terminalä¸­ï¼Œè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤å®ç°ç¼–è¯‘æ‰“åŒ…</p>
<pre><code class="language-shell">$ mvn clean install -Dmaven.test.skip=true
</code></pre>
</li>
</ol>
<h3 id="11-ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®">11. ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®</h3>
<ol>
<li>
<p>åœ¨resourcesä¸‹æ–°å»ºstart.shæ–‡ä»¶</p>
<pre><code class="language-sh">#!/user/bin/env bash
nohup java -jar zth-spring-boot-study.jar &amp;
</code></pre>
</li>
<li>
<p>å…³é—­åº”ç”¨è„šæœ¬ stop.sh</p>
<pre><code class="language-sh">#!/user/bin/env bash
pid = `ps -ef | grep zth-spring-boot-study.jar | grep -v grep | awk '{print $2}'` 
if [[ -z &quot;${pid}&quot; ]]
then
	echo application is already stopped
else
	echo kill ${pid}
	kill -9 ${pid}
fi
</code></pre>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javaé¢è¯•æ€»ç»“(2) -- çº¿ç¨‹ç¯‡]]></title>
        <id>https://zu3zz.github.io/post/java-2/</id>
        <link href="https://zu3zz.github.io/post/java-2/">
        </link>
        <updated>2020-03-09T02:23:49.000Z</updated>
        <summary type="html"><![CDATA[<p>Javaé¢è¯•æ€»ç»“ç¬¬äºŒç¯‡~ ä¸»è¦æ˜¯çº¿ç¨‹ä¸çº¿ç¨‹æ± çš„ç›¸å…³çŸ¥è¯†ç‚¹</p>
]]></summary>
        <content type="html"><![CDATA[<p>Javaé¢è¯•æ€»ç»“ç¬¬äºŒç¯‡~ ä¸»è¦æ˜¯çº¿ç¨‹ä¸çº¿ç¨‹æ± çš„ç›¸å…³çŸ¥è¯†ç‚¹</p>
<!-- more -->
<h2 id="javaå¤šçº¿ç¨‹å’Œå¹¶å‘">Javaå¤šçº¿ç¨‹å’Œå¹¶å‘</h2>
<h2 id="1-è¿›ç¨‹ä¸çº¿ç¨‹">1. è¿›ç¨‹ä¸çº¿ç¨‹</h2>
<h4 id="1-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«">1. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«</h4>
<ol>
<li>
<p>è¿›ç¨‹å’Œçº¿ç¨‹çš„ç”±æ¥</p>
<ul>
<li>ä¸²è¡Œ</li>
<li>æ‰¹å¤„ç†</li>
<li>è¿›ç¨‹ï¼šç‹¬å å†…å­˜ç©ºé—´ï¼Œä¿å­˜å„è‡ªè¿è¡ŒçŠ¶æ€ï¼Œç›¸äº’é—´ä¸å¹²æ‰°ä¸”å¯ä»¥äº’ç›¸åˆ‡æ¢ï¼Œä¸ºå¹¶å‘å¤„ç†ä»»åŠ¡æä¾›äº†å¯èƒ½</li>
<li>çº¿ç¨‹ï¼šå…±äº«è¿›ç¨‹çš„å†…å­˜èµ„æºï¼Œç›¸äº’é—´åˆ‡æ¢æ›´å¿«é€Ÿï¼Œæ”¯æŒæ›´ç»†ç²’åº¦çš„ä»»åŠ¡æ§åˆ¶ï¼Œä½¿è¿›ç¨‹å†…çš„å­ä»»åŠ¡å¾—ä»¥å¹¶å‘æ‰§è¡Œ</li>
</ul>
</li>
<li>
<p>è¿›ç¨‹æ˜¯èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦çš„æœ€å°å•ä½</p>
<ul>
<li>
<p>æ‰€æœ‰ä¸è¿›ç¨‹ç›¸å…³çš„èµ„æºï¼Œéƒ½è¢«è®°å½•åœ¨PCBä¸­</p>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1588818996521.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>è¿›ç¨‹æ˜¯æŠ¢å å¤„ç†æœºçš„è°ƒåº¦å•ä½ï¼›çº¿ç¨‹å±äºæŸä¸ªè¿›ç¨‹ï¼Œå…±äº«å…¶èµ„æº</p>
</li>
<li>
<p>çº¿ç¨‹åªç”±å †æ ˆå¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨å’ŒTCBç»„æˆ</p>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1588819009068.png" alt="" loading="lazy"></figure>
</li>
</ul>
</li>
<li>
<p>æ€»ç»“</p>
<ul>
<li>çº¿ç¨‹ä¸èƒ½çœ‹åšç‹¬ç«‹åº”ç”¨ï¼Œè€Œè¿›ç¨‹å¯çœ‹åšç‹¬ç«‹åº”ç”¨</li>
<li>è¿›ç¨‹æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œç›¸äº’ä¸å½±å“ï¼Œçº¿ç¨‹åªæ˜¯è¿›ç¨‹çš„ä¸åŒæ‰§è¡Œè·¯å¾„</li>
<li>çº¿ç¨‹æ²¡æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå¤šè¿›ç¨‹çš„ç¨‹åºæ¯”å¤šçº¿ç¨‹ç¨‹åºè¦æ›´å¥å£®</li>
<li>è¿›ç¨‹çš„åˆ‡æ¢æ¯”çº¿ç¨‹çš„åˆ‡æ¢å¼€é”€å¤§</li>
</ul>
</li>
</ol>
<h4 id="2-javaè¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»">2. Javaè¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»</h4>
<ol>
<li>Javaå¯¹æ“ä½œç³»ç»Ÿæä¾›çš„åŠŸèƒ½è¿›è¡Œå°è£…ï¼ŒåŒ…æ‹¬è¿›ç¨‹å’Œçº¿ç¨‹</li>
<li>è¿è¡Œä¸€ä¸ªç¨‹åºä¼šäº§ç”Ÿä¸€ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹åŒ…å«è‡³å°‘ä¸€ä¸ªçº¿ç¨‹</li>
<li>æ¯ä¸ªè¿›ç¨‹å¯¹åº”ä¸€ä¸ªJVMå®ä¾‹ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«JVMé‡Œçš„å †</li>
<li>Javaé‡‡ç”¨å•çº¿ç¨‹ç¼–ç¨‹æ¨¡å‹ï¼Œç¨‹åºä¼šä¸»åŠ¨åˆ›å»ºä¸»çº¿ç¨‹</li>
<li>ä¸»çº¿ç¨‹å¯ä»¥åˆ›å»ºå­çº¿ç¨‹ï¼ŒåŸåˆ™ä¸Šè¦åäºå­çº¿ç¨‹å®Œæˆæ‰§è¡Œ</li>
</ol>
<h4 id="3-threadä¸­çš„startå’Œrunæ–¹æ³•çš„åŒºåˆ«">3. Threadä¸­çš„start()å’Œrun()æ–¹æ³•çš„åŒºåˆ«</h4>
<ol>
<li>
<p>start()æ–¹æ³•åº•å±‚æ˜¯c++ä»£ç ï¼šè°ƒç”¨äº†jvmä¸­çš„JVM_StartThreadæ–¹æ³•ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ–°çº¿ç¨‹</p>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1588819024584.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>è°ƒç”¨start()æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­çº¿ç¨‹å¹¶å¯åŠ¨</p>
</li>
<li>
<p>run()æ–¹æ³•åªæ˜¯Threadçš„ä¸€ä¸ªæ™®é€šæ–¹æ³•çš„è°ƒç”¨</p>
</li>
</ol>
<h4 id="4-threadå’Œrunnableæœ‰ä»€ä¹ˆå…³ç³»">4. Threadå’ŒRunnableæœ‰ä»€ä¹ˆå…³ç³»</h4>
<ol>
<li>Threadæ˜¯å®ç°äº†Runnableæ¥å£çš„ç±»ï¼Œä½¿å¾—runæ”¯æŒå¤šçº¿ç¨‹</li>
<li>å› ç±»çš„å•ä¸€ç»§æ‰¿åŸåˆ™ï¼Œæ¨èå¤šä½¿ç”¨Runnableæ¥å£</li>
</ol>
<h4 id="5-å¦‚ä½•ç»™runæ–¹æ³•ä¼ å‚">5. å¦‚ä½•ç»™run()æ–¹æ³•ä¼ å‚</h4>
<ul>
<li>
<p>å®ç°çš„æ–¹å¼ä¸»è¦æœ‰ä¸‰ç§</p>
<ul>
<li>æ„é€ å‡½æ•°ä¼ å‚</li>
<li>æˆå‘˜å˜é‡ä¼ å‚</li>
<li>å›è°ƒå‡½æ•°ä¼ å‚</li>
</ul>
</li>
<li>
<p>å¦‚ä½•å¤„ç†çº¿ç¨‹çš„è¿”å›å€¼ï¼šä¸‰ç§</p>
<ul>
<li>
<p>ä¸»çº¿ç¨‹ç­‰å¾…æ³•ï¼ˆThread.sleep()ï¼‰å¤–é¢å¾ªç¯ç­‰å¾…</p>
</li>
<li>
<p>ä½¿ç”¨Threadç±»çš„join()é˜»å¡å½“å‰çº¿ç¨‹ä»¥ç­‰å¾…å­çº¿ç¨‹å¤„ç†å®Œæ¯•ï¼šç”¨join()ä»£æ›¿å¾ªç¯ç­‰å¾…</p>
</li>
<li>
<p>é€šè¿‡Callableæ¥å£å®ç°ï¼šé€šè¿‡FutureTask Or çº¿ç¨‹æ± è·å–</p>
<pre><code class="language-java">// é¦–å…ˆå®ç°Callableæ¥å£ é‡å†™callæ–¹æ³•
public class MyCallable implements Callable&lt;String&gt; {
    @Override
    public String call() throws Exception{
        String value=&quot;test&quot;;
        System.out.println(&quot;Ready to work&quot;);
        Thread.currentThread().sleep(5000);
        System.out.println(&quot;task done&quot;);
        return value;
    }
}
</code></pre>
<p>åœ¨FutureTaskä¸­å®ç°è¯¥æ–¹æ³•</p>
<pre><code class="language-java">// æ–°å»ºä¸€ä¸ªFutureTask ç”¨isDoneæ–¹æ³•è·å–æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæ¯•çš„çŠ¶æ€
public class FutureTaskDemo {
    public static void main(String[] args) throws ExecutionException, InterruptedException {
        FutureTask&lt;String&gt; task = new FutureTask&lt;String&gt;(new MyCallable());
        new Thread(task).start();
        if(!task.isDone()){
            System.out.println(&quot;task has not finished, please wait!&quot;);
        }
        System.out.println(&quot;task return: &quot; + task.get());
    }
}
</code></pre>
<p>é€šè¿‡çº¿ç¨‹æ± </p>
<pre><code class="language-java">public class ThreadPoolDemo {
    public static void main(String[] args) {
        ExecutorService newCachedThreadPool = Executors.newCachedThreadPool();
        Future&lt;String&gt; future = newCachedThreadPool.submit(new MyCallable());
        if(!future.isDone()){
            System.out.println(&quot;task has not finished, please wait!&quot;);
        }
        try {
            System.out.println(future.get());
        } catch (InterruptedException e) {
            e.printStackTrace();
        } catch (ExecutionException e) {
            e.printStackTrace();
        } finally {
            newCachedThreadPool.shutdown();
        }
    }
}
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 id="6-çº¿ç¨‹çš„çŠ¶æ€">6. çº¿ç¨‹çš„çŠ¶æ€</h4>
<ul>
<li>
<p>æšä¸¾ç±»å‹ä¸­æœ‰å…­ä¸ªçŠ¶æ€</p>
<ol>
<li>
<p>æ–°å»ºNewï¼šåˆ›å»ºåå°šæœªå¯åŠ¨çš„çº¿ç¨‹çš„çŠ¶æ€</p>
</li>
<li>
<p>è¿è¡ŒRunnableï¼šåŒ…å«Runningå’ŒReady</p>
</li>
<li>
<p>æ— é™æœŸç­‰å¾… Waitingï¼šä¸ä¼šè¢«åˆ†é…CPUæ‰§è¡Œæ—¶é—´ï¼Œéœ€è¦æ˜¾å¼è¢«å”¤é†’</p>
<pre><code class="language-shell">æ²¡æœ‰è®¾ç½®Timeoutå‚æ•°çš„Object.wait()æ–¹æ³•
æ²¡æœ‰è®¾ç½®TImeoutå‚æ•°çš„Thread.join()æ–¹æ³•
LockSupport.park()æ–¹æ³•
</code></pre>
</li>
<li>
<p>é™æœŸç­‰å¾…Timed Waitingï¼šåœ¨ä¸€å®šæ—¶é—´åä¼šç”±ç³»ç»Ÿè‡ªåŠ¨å”¤é†’</p>
<pre><code class="language-shell">Thread.sleep()æ–¹æ³•
è®¾ç½®äº†Timeoutå‚æ•°çš„Object.wait()æ–¹æ³•
è®¾ç½®äº†Tiimeoutå‚æ•°çš„Thread.join()æ–¹æ³•
LockSupport.parkNanos()æ–¹æ³•
LockSupport.parkUntil()æ–¹æ³•
</code></pre>
</li>
<li>
<p>é˜»å¡ Blockedï¼šç­‰å¾…è·å–æ’å®ƒé”</p>
</li>
<li>
<p>ç»“æŸTerminatedï¼šå·²ç»ˆæ­¢çº¿ç¨‹çš„çŠ¶æ€ï¼Œçº¿ç¨‹å·²ç»ç»“æŸæ‰§è¡Œï¼ˆç»“æŸäº†åœ¨è°ƒç”¨ä¼šæŠ¥é”™ï¼‰</p>
</li>
</ol>
</li>
</ul>
<h4 id="7-sleepå’Œwaitçš„åŒºåˆ«">7. sleepå’Œwaitçš„åŒºåˆ«</h4>
<ul>
<li>sleepï¼ˆï¼‰æ˜¯Threadç±»ä¸­çš„æ–¹æ³• waitæ˜¯Objectç±»ä¸­å®šä¹‰çš„æ–¹æ³•</li>
<li>sleepï¼ˆï¼‰å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨</li>
<li>waitï¼ˆï¼‰æ–¹æ³•åªèƒ½åœ¨synchronizedæ–¹æ³•æˆ–synchronizedå—ä¸­ä½¿ç”¨</li>
<li>æœ€ä¸»è¦çš„åŒºåˆ«ï¼š
<ul>
<li>Thread.sleepåªä¼šè®©å‡ºcpuï¼Œä¸ä¼šå¯¼è‡´é”è¡Œä¸ºçš„æ”¹å˜</li>
<li>Object.waitä¸ä»…ä¼šè®©å‡ºcpuï¼Œè¿˜ä¼šé‡Šæ”¾å·²ç»å æœ‰çš„åŒæ­¥èµ„æºé”</li>
</ul>
</li>
</ul>
<h4 id="8-notifyä¸notifyallçš„åŒºåˆ«">8. notifyä¸notifyAllçš„åŒºåˆ«</h4>
<ul>
<li>ä¸¤ä¸ªæ¦‚å¿µ
<ul>
<li>é”æ±  EntryListï¼šå…¶ä»–çº¿ç¨‹ç­‰å¾…é”çš„é‡Šæ”¾çš„åœ°æ–¹</li>
<li>ç­‰å¾…æ±  WaitSetï¼šè°ƒç”¨äº†waitï¼ˆï¼‰ä¸­ï¼Œå°±è¿›å…¥äº†ç­‰å¾…æ± </li>
</ul>
</li>
<li>åŒºåˆ«ï¼š
<ul>
<li>notifyAllä¼šè®©æ‰€æœ‰å¤„äºç­‰å¾…æ± çš„çº¿ç¨‹å…¨éƒ¨è¿›å…¥é”æ± å»ç«äº‰è·å–é”çš„æœºä¼š</li>
<li>notifyåªä¼šéšæœºé€‰å–ä¸€ä¸ªå¤„äºç­‰åˆ°åƒçš„çº¿ç¨‹è¿›å…¥é”æ± å»ç«äº‰é”çš„æœºä¼š</li>
</ul>
</li>
</ul>
<h4 id="9-yield">9. yield</h4>
<ul>
<li>è¡¨ç¤ºå½“å‰çº¿ç¨‹æ„¿æ„è®©å‡ºCPUçš„ä½¿ç”¨æƒï¼Œä½†æ˜¯çº¿ç¨‹è°ƒåº¦å™¨å¯èƒ½ä¼šå¿½ç•¥è¿™ä¸ªæš—ç¤º</li>
<li>å–å†³äºè°ƒåº¦å™¨</li>
</ul>
<h4 id="10-ä¸­æ–­çº¿ç¨‹">10. ä¸­æ–­çº¿ç¨‹</h4>
<ul>
<li>é€šè¿‡è°ƒç”¨stopï¼ˆï¼‰æ–¹æ³•åœæ­¢çº¿ç¨‹ï¼šå·²æŠ›å¼ƒ</li>
<li>suspendï¼ˆï¼‰ã€ resumeï¼ˆï¼‰æ–¹æ³•ä¹Ÿéƒ½è¢«åºŸå¼ƒ</li>
<li>ç›®å‰ï¼šè°ƒç”¨interruptï¼ˆï¼‰ï¼Œé€šçŸ¥çº¿ç¨‹åº”è¯¥ä¸­æ–­äº†
<ul>
<li>å¦‚æœå¤„äºè¢«é˜»å¡çŠ¶æ€ï¼Œé‚£ä¹ˆé€€å‡ºé˜»å¡çŠ¶æ€ï¼ŒæŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸</li>
<li>å¦‚æœæ­£å¸¸æ´»åŠ¨çŠ¶æ€ï¼Œé‚£ä¹ˆä¼šå°†è¯¥çº¿ç¨‹çš„ä¸­æ–­æ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œè¯¥çº¿ç¨‹å°†ä¼šç»§ç»­æ‰§è¡Œ</li>
<li>æ£€æŸ¥ä¸­æ–­æ ‡è®°</li>
</ul>
</li>
</ul>
<h4 id="11-çº¿ç¨‹çŠ¶æ€">11. çº¿ç¨‹çŠ¶æ€</h4>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1588819136266.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="5"><img src="https://zu3zz.github.io/post-images/1588819144367.jpg" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="6"><img src="https://zu3zz.github.io/post-images/1588819150432.jpg" alt="" loading="lazy"></figure>
<h2 id="2-é”ç›¸å…³">2. é”ç›¸å…³</h2>
<h3 id="1-synchronized">1. Synchronized</h3>
<ul>
<li>äº’æ–¥é”ï¼šåŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æŒæœ‰</li>
<li>å¯è§æ€§ï¼šä¿®æ”¹æ“ä½œå¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„</li>
<li>é”çš„ä¸æ˜¯ä»£ç ï¼Œæ˜¯å¯¹è±¡</li>
<li>æ ¹æ®é”çš„åˆ†ç±»ï¼šè·å–å¯¹è±¡é”å’Œè·å–ç±»é”
<ul>
<li>åŒæ­¥ä»£ç å—ï¼ˆsynchronizedï¼ˆthisï¼‰ synchronizedï¼ˆç±»å®ä¾‹å¯¹è±¡ï¼‰ï¼‰é”çš„æ˜¯æ‹¬å·ä¸­çš„å®ä¾‹å¯¹è±¡</li>
<li>åŒæ­¥éé™æ€æ–¹æ³•ï¼ˆsynchronized methodï¼‰</li>
</ul>
</li>
<li>è·å–ç±»é”çš„ä¸¤ç§ç”¨æ³•
<ul>
<li>åŒæ­¥ä»£ç å—ï¼ˆsynchronizedï¼ˆç±».classï¼‰ï¼‰ï¼Œé”æ˜¯å°æ‹¬å·ï¼ˆï¼‰ä¸­çš„ç±»å¯¹è±¡ï¼ˆClasså¯¹è±¡ï¼‰</li>
<li>åŒæ­¥é™æ€æ–¹æ³•ï¼ˆsynchronized static methodï¼‰ï¼Œé”æ˜¯å½“å‰å¯¹è±¡çš„ç±»å¯¹è±¡ï¼ˆClasså¯¹è±¡ï¼‰</li>
</ul>
</li>
<li>å¯¹è±¡é”å’Œç±»é”çš„æ€»ç»“
<ol>
<li>æœ‰çº¿ç¨‹è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦å¤–çš„çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å¯¹è±¡çš„éåŒæ­¥ä»£ç å—</li>
<li>è‹¥é”ä½çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—çš„çº¿ç¨‹ä¼šè¢«é˜»å¡</li>
<li>è‹¥é”ä½çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡åŒæ­¥æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡</li>
<li>è‹¥é”ä½çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å¯¹è±¡çš„åŒæ­¥ä»£ç å—æ—¶ï¼Œå¦ä¸€ä¸ªè®¿é—®å¯¹è±¡åŒæ­¥æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œåä¹‹äº¦ç„¶</li>
<li>åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡çš„å¯¹è±¡é”äº’ä¸å¹²æ‰°</li>
<li>ç±»æ‰€ç”±äºä¹Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡é”ï¼Œå› æ­¤å’Œä¸Šè¿°1ï¼Œ2ï¼Œ3ï¼Œ4ä¸€ç›´ï¼Œè€Œç”±äºä¸€ä¸ªç±»åªæœ‰ä¸€æŠŠå¯¹è±¡é”ï¼Œæ‰€ä»¥åŒä¸€ä¸ªç±»çš„ä¸åŒå¯¹è±¡ä½¿ç”¨ç±»é”å°†ä¼šæ˜¯åŒæ­¥çš„</li>
<li>ç±»æ‰€å’Œå¯¹è±¡é”äº’ä¸å¹²æ‰°</li>
</ol>
</li>
</ul>
<h3 id="2-synchronizedåº•å±‚åŸç†">2. Synchronizedåº•å±‚åŸç†</h3>
<h4 id="1-å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€">1. å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€</h4>
<ul>
<li>å¯¹è±¡å¤´</li>
<li>å®ä¾‹æ•°æ®</li>
<li>å¯¹é½å¡«å……</li>
</ul>
<h4 id="2-å¯¹è±¡å¤´çš„ç»“æ„">2. å¯¹è±¡å¤´çš„ç»“æ„</h4>
<figure data-type="image" tabindex="7"><img src="https://zu3zz.github.io/post-images/1588819178301.png" alt="" loading="lazy"></figure>
<h4 id="3-mark-wordçš„ç»“æ„">3. Mark Wordçš„ç»“æ„</h4>
<figure data-type="image" tabindex="8"><img src="https://zu3zz.github.io/post-images/1588819188233.png" alt="" loading="lazy"></figure>
<h4 id="4-monitor">4. Monitor</h4>
<ol>
<li>
<p>æ¯ä¸ªJavaå¯¹è±¡å¤©ç”Ÿè‡ªå¸¦äº†ä¸€æŠŠçœ‹ä¸è§çš„é”</p>
</li>
<li>
<p>Monitoré”çš„ç«äº‰ã€é‡Šæ”¾ä¸è·å–</p>
</li>
</ol>
<figure data-type="image" tabindex="9"><img src="https://zu3zz.github.io/post-images/1588819197733.png" alt="" loading="lazy"></figure>
<h4 id="5-synchronizedå‘å±•">5. Synchronizedå‘å±•</h4>
<ul>
<li>
<p>ä»€ä¹ˆæ˜¯é‡å…¥ï¼šä¸€ä¸ªçº¿ç¨‹å†æ¬¡è¯·æ±‚è‡ªå·±æŒæœ‰å¯¹è±¡é”çš„ä¸´ç•Œèµ„æºï¼Œè¿™ç§æƒ…å†µå±äºé‡å…¥</p>
<ul>
<li>Synchronizedæ˜¯å¯é‡å…¥çš„</li>
</ul>
</li>
<li>
<p>æ—©æœŸç‰ˆæœ¬ä¸­ï¼ŒSynchronizedå±äºé‡é‡çº§é”ï¼Œä¾èµ–äºMutex Lockå®ç°</p>
</li>
<li>
<p>çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢è¦ä»ç”¨æˆ·æ€è½¬åˆ°æ ¸å¿ƒæ€ï¼Œå¼€é”€è¾ƒå¤§</p>
</li>
<li>
<p>Java6ä¹‹åï¼ŒSynchronizedæ€§èƒ½å¾—åˆ°äº†å¾ˆå¤§çš„æå‡</p>
<ul>
<li>Adaptive Spinning</li>
<li>Lightweight Locking</li>
<li>Lock Eliminate</li>
<li>Biased Locking</li>
<li>Lock Coarsening</li>
</ul>
</li>
</ul>
<h4 id="6-è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”é”ä¼˜åŒ–">6. è‡ªæ—‹é”ä¸è‡ªé€‚åº”è‡ªæ—‹é”ï¼ˆé”ä¼˜åŒ–ï¼‰</h4>
<ol>
<li>è‡ªæ—‹é”
<ul>
<li>ä¸€äº›å…±äº«æ•°æ®çš„é”å®šçŠ¶æ€æŒç»­æ—¶é—´è¾ƒçŸ­ï¼Œåˆ‡æ¢çº¿ç¨‹ä¸å€¼å¾—</li>
<li>é€šè¿‡è®©çº¿ç¨‹æ‰§è¡Œå¿™å¾ªç¯ç­‰å¾…é”çš„é‡Šæ”¾ï¼Œä¸è®©å‡ºCPU</li>
<li>ç¼ºç‚¹ï¼šè‹¥é”è¢«å…¶ä»–çº¿ç¨‹é•¿æ—¶é—´å ç”¨ï¼Œä¼šå¸¦æ¥è®¸å¤šæ€§èƒ½ä¸Šçš„å¼€é”€ï¼ˆPreBlockSpinï¼‰</li>
</ul>
</li>
<li>è‡ªé€‚åº”è‡ªæ—‹é”
<ul>
<li>è‡ªé€‰çš„æ¬¡æ•°ä¸å†å›ºå®š</li>
<li>ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªé€‰æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®š</li>
</ul>
</li>
<li>é”æ¶ˆé™¤
<ul>
<li>JITç¼–è¯‘æ—¶ï¼Œå¯¹è¿è¡Œä¸Šä¸‹æ–‡è¿›è¡Œæ‰«æï¼Œå»é™¤ä¸å¯èƒ½å­˜åœ¨ç«äº‰çš„é”</li>
</ul>
</li>
<li>é”ç²—åŒ–
<ul>
<li>å°†é”çš„èŒƒå›´åŠ å¤§ï¼Œé¿å…åå¤åŠ é”å’Œè§£é”</li>
</ul>
</li>
</ol>
<h4 id="7-synchronizedçš„å››ç§çŠ¶æ€">7. Synchronizedçš„å››ç§çŠ¶æ€</h4>
<blockquote>
<p>æ— é”ã€åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”</p>
</blockquote>
<ul>
<li>è†¨èƒ€æ–¹å‘ï¼šæ— é”-&gt;åå‘é”-&gt;è½»é‡çº§é”-&gt;é‡é‡çº§é”</li>
</ul>
<ol>
<li>
<p>åå‘é”</p>
<ul>
<li>é”ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ€»æ˜¯ç”±å®¹æ˜“çº¿ç¨‹å¤šæ¬¡è·å¾—
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹è·å¾—ä¸€ä¸ªé”ä¹‹åï¼Œè¿›å…¥åå‘æ¨¡å¼ï¼Œæ­¤æ—¶Mark Wordçš„ç»“æ„å˜æˆäº†å˜ç›¸æ‰€ç»“æ„</li>
<li>å†æ¬¡è¯·æ±‚é”æ—¶ï¼Œæ— éœ€å†åšä»»ä½•åŒæ­¥æ“ä½œï¼Œè·å–è¿‡ç¨‹åªè¦æ£€æŸ¥Mark Wordçš„é”æ ‡è®°ä½ä¸ºåå‘é”ä»¥åŠå½“å‰çº¿ç¨‹Idç­‰äºMarkWordä¸­çš„ThreadIDå³å¯ ï¼Œçœå»äº†å¤§é‡æœ‰å…³é”ç”³è¯·çš„æ“ä½œ</li>
<li>ä¸é€‚ç”¨äºé”ç«äº‰æ¯”è¾ƒæ¿€çƒˆçš„åœºæ™¯</li>
</ul>
</li>
</ul>
</li>
<li>
<p>è½»é‡çº§é”</p>
<ul>
<li>ç”±åå‘é”å‡çº§è€Œæ¥ï¼Œåå‘é”è¿è¡Œåœ¨ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥å¿«çš„æƒ…å†µä¸‹ï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹åŠ å…¥é”å¾ç”¨çš„æ—¶å€™ï¼Œåå‘é”å°±ä¼šå‡çº§æˆä¸ºè½»é‡çº§é”</li>
<li>é€‚ç”¨çš„åœºæ™¯ï¼šçº¿ç¨‹äº¤æ›¿æ‰§è¡ŒåŒæ­¥å—</li>
<li>åŒä¸€æ—¶é—´è®¿é—®åŒä¸€é”ï¼Œå°±ä¼šå¯¼è‡´è½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”</li>
</ul>
</li>
<li>
<p>é”çš„å†…å­˜è¯­ä¹‰</p>
<ul>
<li>å½“çº¿ç¨‹åˆ·æ–°æ—¶ï¼ŒJavaå†…å­˜æ¨¡å‹ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</li>
<li>è€Œå½“çº¿ç¨‹è·å–é”æ—¶ï¼ŒJavaå†…å­˜æ¨¡å‹ä¼šå§è¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆï¼Œä»è€Œä½¿å¾—è¢«ç›‘è§†å™¨ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡</li>
</ul>
</li>
</ol>
<h4 id="8-åå‘é”-è½»é‡çº§é”-é‡é‡çº§é”çš„æ±‡æ€»">8. åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”çš„æ±‡æ€»</h4>
<figure data-type="image" tabindex="10"><img src="https://zu3zz.github.io/post-images/1588819222315.png" alt="" loading="lazy"></figure>
<h3 id="3-synchronizedå’Œreentrantlockçš„åŒºåˆ«">3. Synchronizedå’ŒReentrantLockçš„åŒºåˆ«</h3>
<h4 id="1-reentrantlockå†å…¥é”">1. ReentrantLockï¼ˆå†å…¥é”ï¼‰</h4>
<ul>
<li>ä½äºJava.util.concurrent.locksåŒ…</li>
<li>å’ŒCountDownLatchã€FutureTaskã€Semaphoreä¸€æ ·åŸºäºAQS AbstractQueuedSynchronizerå®ç°</li>
<li>èƒ½å¤Ÿå®ç°æ¯”Synchronizedæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œæ¯”å¦‚fairness</li>
<li>è°ƒç”¨lockï¼ˆï¼‰ä¹‹åï¼Œå¿…é¡»è°ƒç”¨unlockï¼ˆï¼‰é‡Šæ”¾é”</li>
<li>æ€§èƒ½æœªå¿…æ¯”Synchronizedé«˜ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯å¯é‡å…¥çš„</li>
</ul>
<h4 id="2-å…¬å¹³æ€§çš„è®¾ç½®">2. å…¬å¹³æ€§çš„è®¾ç½®</h4>
<ul>
<li>
<p>å…¬å¹³æ€§</p>
<pre><code class="language-java">ReentrantLock fairLock = new ReentrantLock(true);
</code></pre>
</li>
<li>
<p>å‚æ•°ä¸ºtrueæ—¶ï¼Œå€¾å‘äºå°†é”èµ‹äºˆç­‰å¾…æ—¶é—´æœ€ä¹…çš„çº¿ç¨‹</p>
</li>
<li>
<p>å…¬å¹³é”ï¼šè·å–é”çš„é¡ºåºæŒ‰ç…§å…ˆåè°ƒç”¨lockæ–¹æ³•çš„é¡ºåºï¼ˆæ…ç”¨ï¼‰</p>
</li>
<li>
<p>éå…¬å¹³é”ï¼šæŠ¢å çš„é¡ºåºä¸ä¸€å®šï¼Œçœ‹è¿æ°”</p>
</li>
<li>
<p>Synchronizedæ˜¯éå…¬å¹³é”</p>
</li>
<li>
<p>ReentrantLockå°†é”å¯¹è±¡åŒ–</p>
<ul>
<li>åˆ¤æ–­æ˜¯å¦æœ‰çº¿ç¨‹ï¼Œæˆ–è€…æŸä¸ªç‰¹å®šçº¿ç¨‹ï¼Œåœ¨æ’é˜Ÿç­‰å¾…è·å–é”</li>
<li>å¸¦è¶…æ—¶çš„è·å–é”çš„å°è¯•</li>
<li>æ„ŸçŸ¥æœ‰æ²¡æœ‰æˆåŠŸçš„è·å–é”</li>
</ul>
</li>
<li>
<p>æ˜¯å¦èƒ½å°†wait/notify/notifyAllå¯¹è±¡åŒ–ï¼Ÿ</p>
<ul>
<li>JUCåŒ…ä¸‹çš„locks.Condition</li>
</ul>
</li>
</ul>
<h4 id="3-åŒºåˆ«">3. åŒºåˆ«</h4>
<ol>
<li>Synchronizedæ˜¯å…³é”®å­—</li>
<li>ReentrantLockæ˜¯ç±»ï¼Œæ¯”Synchronizedæ›´çµæ´»</li>
<li>ReentrantLockå¯ä»¥å¯¹è·å–é”çš„ç­‰å¾…æ—¶é—´è¿›è¡Œè®¾ç½®ï¼Œé¿å…æ­»é”</li>
<li>ReentrantLockå¯ä»¥è·å–å„ç§é”çš„ä¿¡æ¯</li>
<li>å¯ä»¥çµæ´»çš„å®ç°å¤šè·¯é€šçŸ¥</li>
<li>æœºåˆ¶ä¸åŒï¼šsyncæ“ä½œçš„æ˜¯MarkWordï¼Œlockè°ƒç”¨Unsafeç±»çš„parkï¼ˆï¼‰æ–¹æ³•</li>
</ol>
<h3 id="4-jmmæ¨¡å‹">4. JMMæ¨¡å‹</h3>
<ol>
<li>
<p>Javaå†…å­˜æ¨¡å‹ï¼šä¸€ç»„è§„èŒƒ</p>
<figure data-type="image" tabindex="11"><img src="https://zu3zz.github.io/post-images/1588819256199.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>JMMä¸­çš„ä¸»å†…å­˜</p>
<ul>
<li>å­˜å‚¨Javaå®ä¾‹å¯¹è±¡</li>
<li>åŒ…æ‹¬æˆå‘˜å˜é‡ã€ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰</li>
<li>å±äºæ•°æ®å…±äº«çš„åŒºåŸŸï¼Œå¤šçº¿ç¨‹å¹¶å‘æ“ä½œæ—¶ä¼šå¼•å‘çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ul>
</li>
<li>
<p>JMMä¸­çš„å·¥ä½œå†…å­˜</p>
<ul>
<li>å­˜å‚¨å½“å‰æ–¹æ³•çš„æ‰€æœ‰æœ¬åœ°å˜é‡ä¿¡æ¯ï¼Œæœ¬åœ°å˜é‡å¯¹å…¶ä»–çº¿ç¨‹ä¸å¯è§</li>
<li>å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ã€Nativeæ–¹æ³•ä¿¡æ¯</li>
<li>å±äºçº¿ç¨‹ç§æœ‰æ•°æ®åŒºåŸŸï¼Œä¸å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
</ul>
</li>
<li>
<p>JMMä¸Javaå†…å­˜åŒºåŸŸ</p>
<ol>
<li>æ¦‚å¿µä¸åŒ</li>
<li>JMMæè¿°çš„æ˜¯ä¸€ç»„è§„åˆ™ï¼Œå›´ç»•åŸå­æ€§ã€æœ‰åºæ€§ã€å¯è§æ€§å±•å¼€</li>
<li>ç›¸ä¼¼ç‚¹ï¼šå­˜åœ¨å…±äº«åŒºåŸŸå’Œç§æœ‰åŒºåŸŸ</li>
</ol>
</li>
<li>
<p>ä¸»å†…å­˜å’Œå·¥ä½œå†…å­˜</p>
<ol>
<li>æ–¹æ³•é‡Œçš„åŸºæœ¬æ•°æ®ç±»å‹ï¼Œæœ¬åœ°å˜é‡å°†ç›´æ¥å­˜å‚¨åœ¨å·¥ä½œå†…å­˜çš„æ ˆå¸§ç»“æ„ä¸­</li>
<li>å¼•ç”¨ç±»å‹çš„æœ¬åœ°å˜é‡ï¼šå¼•ç”¨å­˜å‚¨åœ¨å·¥ä½œå†…å­˜ä¸­ï¼Œå®ä¾‹å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</li>
<li>æˆå‘˜å˜é‡ã€staticå˜é‡ã€ç±»ä¿¡æ¯å‡ä¼šè¢«å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</li>
<li>ä¸»å†…å­˜å…±äº«çš„æ–¹å¼æ˜¯çº¿ç¨‹å„æ‹·è´ä¸€ä»½æ•°æ®åˆ°å·¥ä½œå†…å­˜ï¼Œæ“ä½œå®Œæˆä¹‹ååˆ·æ–°å›ä¸»å†…å­˜</li>
</ol>
<figure data-type="image" tabindex="12"><img src="https://zu3zz.github.io/post-images/1588819271332.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>æŒ‡ä»¤é‡æ’åºéœ€è¦æ»¡è¶³çš„æ¡ä»¶</p>
<ul>
<li>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœ</li>
<li>å­˜åœ¨æ•°æ®ä»¥æ¥å…³ç³»çš„ä¸å…è®¸é‡æ’åº</li>
</ul>
<blockquote>
<p>æ— æ³•é€šè¿‡happens-beforeåŸåˆ™æ¨å¯¼å‡ºæ¥çš„ï¼Œæ‰èƒ½è¿›è¡ŒæŒ‡ä»¤çš„é‡æ’åº</p>
</blockquote>
<ul>
<li>
<p>Aæ“ä½œçš„ç»“æœéœ€è¦å¯¹Bæ“ä½œè¯¾ä»¶ï¼Œåˆ™Aä¸Bå­˜åœ¨happens-beforeå…³ç³»</p>
</li>
<li>
<p>happens-beforeå…«å¤§åŸåˆ™</p>
<figure data-type="image" tabindex="13"><img src="https://zu3zz.github.io/post-images/1588819282966.png" alt="" loading="lazy"></figure>
</li>
</ul>
</li>
</ol>
<h3 id="5-volatile">5. Volatile</h3>
<ul>
<li>JVMæä¾›çš„è½»é‡çº§åŒæ­¥æœºåˆ¶</li>
<li>ä¿è¯è¢«volatileä¿®é¥°çš„å…±äº«å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹æ€»æ˜¯å¯è§çš„</li>
<li>ç¦æ­¢æŒ‡ä»¤çš„é‡æ’åºä¼˜åŒ–</li>
</ul>
<ol>
<li>volatileçš„å¯è§æ€§ï¼šåŸå­æ“ä½œ</li>
<li>volatileå˜é‡ä¸ºä½•ç«‹å³å¯è§
<ul>
<li>å½“å†™ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šå§è¯¥çº¿ç¨‹å¯¹åº”çš„å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­</li>
<li>å½“è¯»å–ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šå§è¯¥çº¿ç¨‹å¯¹åº”çš„å·¥ä½œå†…å­˜ç½®ä¸ºæ— æ•ˆ</li>
</ul>
</li>
<li>volatileå¦‚ä½•ç¦æ­¢é‡æ’ä¼˜åŒ–
<ul>
<li>å†…å­˜å±éšœï¼ˆMemory Barrierï¼‰
<ol>
<li>ä¿è¯ç‰¹å®šæ“ä½œçš„æ‰§è¡Œé¡ºåº</li>
<li>ä¿è¯æŸäº›å˜é‡çš„å†…å­˜å¯è§æ€§</li>
</ol>
</li>
<li>é€šè¿‡ä»æ’å…¥å†…å­˜å±éšœæŒ‡ä»¤ç¦æ­¢åœ¨å†…å­˜å±éšœå‰åçš„æŒ‡ä»¤æ‰§è¡Œé‡æ’åºä¼˜åŒ–</li>
<li>å¼ºåˆ¶åˆ·å‡ºCPUçš„ç¼“å­˜æ•°æ®ï¼Œå› æ­¤ä»»ä½•CPUä¸Šçš„çº¿ç¨‹éƒ½èƒ½è¯»å–åˆ°è¿™äº›æ•°æ®çš„æœ€æ–°ç‰ˆæœ¬</li>
</ul>
</li>
</ol>
<figure data-type="image" tabindex="14"><img src="https://zu3zz.github.io/post-images/1588819294199.png" alt="" loading="lazy"></figure>
<h3 id="6-volatileå’Œsynchronizedçš„åŒºåˆ«">6. Volatileå’Œsynchronizedçš„åŒºåˆ«</h3>
<figure data-type="image" tabindex="15"><img src="https://zu3zz.github.io/post-images/1588819308732.png" alt="" loading="lazy"></figure>
<h3 id="7-cascompare-and-swap">7. CAS(Compare and Swap)</h3>
<ol>
<li>æ”¯æŒåŸå­æ›´æ–°æ“ä½œï¼Œé€‚ç”¨äºè®¡æ•°å™¨ï¼Œåºåˆ—å‘ç”Ÿå™¨ç­‰åœºæ™¯</li>
<li>å±äºä¹è§‚é”æœºåˆ¶</li>
<li>CASæ“ä½œå¤±è´¥æ—¶ç”±å¼€å‘è€…å†³å®šæ˜¯ç»§ç»­å°è¯•ï¼Œè¿˜æ˜¯æ‰§è¡Œåˆ«çš„æ“ä½œ</li>
<li>CASæ€æƒ³
<ol>
<li>ä¸‰ä¸ªæ“ä½œæ•° å†…å­˜ä½ç½® V é¢„æœŸåŸå€¼ Aå’Œæ–°å€¼ B</li>
<li>ç¼ºç‚¹
<ul>
<li>è‹¥å¾ªç¯æ—¶é—´é•¿ï¼Œåˆ™å¼€é”€å¾ˆå¤§</li>
<li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</li>
<li>ABAé—®é¢˜ï¼šAtomicStampedReferenceï¼šæ§åˆ¶ç‰ˆæœ¬</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="8-javaçº¿ç¨‹æ± ">8. Javaçº¿ç¨‹æ± </h3>
<ol>
<li>
<p>åˆ©ç”¨Executorsåˆ›å»ºä¸åŒçš„çº¿ç¨‹æ± æ»¡è¶³ä¸åŒçš„åœºæ™¯</p>
<figure data-type="image" tabindex="16"><img src="https://zu3zz.github.io/post-images/1588819326547.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>Fork/Joinæ¡†æ¶</p>
<ul>
<li>å¤§ä»»åŠ¡åˆ†å‰²æˆè‹¥å¹²ä¸ªå°ä»»åŠ¡å¹¶æ‰§è¡Œï¼Œæ±‡æ€»å°ä»»åŠ¡ç»“æœ</li>
<li>Work-Stealingç®—æ³•ï¼šä»å…¶ä»–é˜Ÿåˆ—é‡Œçªƒå–ä»»åŠ¡æ¥æ‰§è¡Œï¼šåŒç«¯é˜Ÿåˆ—</li>
</ul>
</li>
<li>
<p>ä¸ºä»€ä¹ˆè¦ç”¨</p>
<ul>
<li>é™ä½èµ„æºæ¶ˆè€—</li>
<li>æé«˜çº¿ç¨‹çš„å¯ç®¡ç†æ€§</li>
</ul>
</li>
<li>
<p>ThreadPoolExecutor</p>
<figure data-type="image" tabindex="17"><img src="https://zu3zz.github.io/post-images/1588819339498.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>æ„é€ å‡½æ•°</p>
<pre><code class="language-shell">coolPoolSize: æ ¸å¿ƒçº¿ç¨‹çš„æœ€å¤§ä¸ªæ•°
maximumPoolSizeï¼šçº¿ç¨‹ä¸å¤Ÿç”¨æ—¶èƒ½å¤Ÿåˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°
workQUeueï¼šä»»åŠ¡ç­‰å¾…é˜Ÿåˆ—ï¼ˆæ’é˜Ÿæœºåˆ¶ä¸åŒï¼‰
keepAliceTimeï¼šæŠ¢å çš„é¡ºåºä¸ä¸€å®šï¼Œçœ‹è¿æ°”
threadFactoryï¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼ŒExecutors.defaultThreadFactory()
handlerï¼šçº¿ç¨‹æ± çš„é¥±å’Œç­–ç•¥
	1. AbortPolicyï¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤
	2. discardPolicyï¼šç›´æ¥ä¸¢å¼ƒä»»åŠ¡
	3. CallerRunnsPolicyï¼šç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡
	4. DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€é å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡
</code></pre>
</li>
</ul>
</li>
<li>
<p>æ–°ä»»åŠ¡æäº¤executeæ‰§è¡Œåçš„åˆ¤æ–­</p>
<figure data-type="image" tabindex="18"><img src="https://zu3zz.github.io/post-images/1588819361031.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>çº¿ç¨‹æ± çš„çŠ¶æ€</p>
<ol>
<li>Runningï¼šèƒ½æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œå¹¶ä¸”ä¹Ÿèƒ½å¤„ç†é˜»å¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡</li>
<li>ShutDownï¼šä¸èƒ½åœ¨æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä½†å¯ä»¥å¤„ç†å­˜é‡ä»»åŠ¡</li>
<li>Stopï¼ˆShutdown nowï¼‰ï¼šä¸åœ¨æ¥å—æ–°æäº¤çš„ä»»åŠ¡ï¼Œä¹Ÿä¸å¤„ç†å­˜é‡ä»»åŠ¡</li>
<li>Tidyingï¼šæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»ˆæ­¢</li>
<li>terminatedï¼šterminatedï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œå®Œåè¿›å…¥è¯¥çŠ¶æ€</li>
</ol>
</li>
<li>
<p>çº¿ç¨‹æ± çš„å¤§å°å¦‚ä½•è®¾å®š</p>
<ul>
<li>CPUå¯†é›†å‹ï¼šçº¿ç¨‹æ•°= CPUæ ¸æ•° + 1</li>
<li>I/Oå¯†é›†å‹ï¼šçº¿ç¨‹æ•°= CPUæ ¸æ•° * ï¼ˆ1 + å¹³å‡ç­‰å¾…æ—¶é—´/ å¹³å‡å·¥ä½œæ—¶é—´ï¼‰</li>
</ul>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javaé¢è¯•æ€»ç»“(1) -- JVM]]></title>
        <id>https://zu3zz.github.io/post/java-1/</id>
        <link href="https://zu3zz.github.io/post/java-1/">
        </link>
        <updated>2020-03-07T02:13:36.000Z</updated>
        <summary type="html"><![CDATA[<p>Javaé¢è¯•ç¬¬ä¸€ç¯‡ å…³äºJVMçš„é‚£äº›äº‹æƒ…</p>
]]></summary>
        <content type="html"><![CDATA[<p>Javaé¢è¯•ç¬¬ä¸€ç¯‡ å…³äºJVMçš„é‚£äº›äº‹æƒ…</p>
<!-- more -->
<h1 id="javaé¢è¯•ç‚¹">Javaé¢è¯•ç‚¹</h1>
<h2 id="1-jvm">1. JVM</h2>
<h3 id="11-è°ˆè°ˆjavaçš„ç‰¹æ€§">1.1 è°ˆè°ˆjavaçš„ç‰¹æ€§</h3>
<ol>
<li>å¹³å°æ— å…³æ€§ï¼šä½¿ç”¨<code>javap</code>å…ˆå°†<code>java</code>æ–‡ä»¶ç¼–è¯‘æˆ<code>class</code>æ–‡ä»¶</li>
<li>é¢å‘å¯¹è±¡</li>
<li>GC</li>
<li>è¯­è¨€ç‰¹æ€§</li>
<li>ç±»åº“</li>
<li>å¼‚å¸¸å¤„ç†</li>
</ol>
<h3 id="12-jvmå¦‚ä½•åŠ è½½classæ–‡ä»¶">1.2 JVMå¦‚ä½•åŠ è½½.classæ–‡ä»¶</h3>
<h4 id="javaè™šæ‹Ÿæœº">Javaè™šæ‹Ÿæœº</h4>
<ol>
<li>Class Loaderï¼šä¾æ®ç‰¹å®šæ ¼å¼ï¼ŒåŠ è½½classåˆ°å†…å­˜</li>
<li>Execution Engineï¼šå¯¹å‘½ä»¤è¿›è¡Œè§£æ</li>
<li>Native Interfaceï¼šèåˆä¸åŒè¯­è¨€çš„åŸç”Ÿåº“ä¸ºjavaæ‰€ç”¨</li>
<li>Runtiime Data Areaï¼šJVMå†…å­˜ç©ºé—´ç»“æ„æ¨¡å‹ï¼ˆé‡è¦ï¼‰</li>
</ol>
<h3 id="13-è°ˆè°ˆåå°„">1.3 è°ˆè°ˆåå°„</h3>
<pre><code class="language-java">// æœ‰ä¸€ä¸ªRobotç±»å¦‚ä¸‹
public class Robot {
    private String name;
    public void sayHi(String helloSentence){
        System.out.println(helloSentence + &quot; &quot; + name);
    }
    private String throwHello(String tag){
        return &quot;Hello &quot; + tag;
    }
    static {
        System.out.println(&quot;Hello Robot&quot;);
    }
}
// å¦‚ä½•ä½¿ç”¨åå°„è°ƒç”¨ç§æœ‰æ–¹æ³•ä»¥åŠå±æ€§
public class ReflectSample {
    public static void main(String[] args) throws Exception {
      // è·å¾—å½“å‰ç±»å¯¹è±¡
      Class rc = Class.forName(&quot;com.interview.javabasic.reflect.Robot&quot;);
      // æ–°åˆ›å»ºä¸€ä¸ªå½“å‰ç±»çš„å®ä¾‹
      Robot r = (Robot) rc.newInstance();
      // Class name is com.interview.javabasic.reflect.Robot
      System.out.println(&quot;Class name is &quot; + rc.getName());
      // å®šä¹‰ä¸€ä¸ªæ–¹æ³•ç±»
      Method getHello = rc.getDeclaredMethod(&quot;throwHello&quot;, String.class);
      // è®¾ç½®è°ƒç”¨ç§æœ‰æ–¹æ³•ä¸ºtrue
      getHello.setAccessible(true);
      Object str = getHello.invoke(r, &quot;Bob&quot;);
      // getHello result is Hello Bob
      System.out.println(&quot;getHello result is &quot; + str);
      // æ­£å¸¸è°ƒç”¨å…¬å…±æ–¹æ³•
      Method sayHi = rc.getMethod(&quot;sayHi&quot;, String.class);
      sayHi.invoke(r, &quot;Welcome&quot;);
      Field name = rc.getDeclaredField(&quot;name&quot;);
      name.setAccessible(true);
      name.set(r, &quot;Alice&quot;);
      sayHi.invoke(r, &quot;Welcome&quot;);
      System.out.println(System.getProperty(&quot;java.ext.dirs&quot;));
      System.out.println(System.getProperty(&quot;java.class.path&quot;));
    }
}
</code></pre>
<h3 id="14-ç±»ä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹">1.4 ç±»ä»ç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹</h3>
<ol>
<li>ç¼–è¯‘å™¨å°†Robot.javaæºæ–‡ä»¶ç¼–è¯‘ä¸ºRobot.classå­—èŠ‚ç æ–‡ä»¶</li>
<li>ClassLoaderå°†å­—èŠ‚ç è½¬æ¢ä¸ºJVMä¸­çš„<code>Class&lt;Robot&gt;</code>å¯¹è±¡</li>
<li>JVMåˆ©ç”¨<code>Class&lt;Robot&gt;</code>å¯¹è±¡å®ä¾‹åŒ–ä¸ºRobotå¯¹è±¡</li>
</ol>
<h4 id="1-è°ˆè°ˆclassloader">1. è°ˆè°ˆClassLoader</h4>
<ul>
<li>ClassLoaderä¸»è¦å·¥ä½œåœ¨Classè£…è½½çš„åŠ è½½é˜¶æ®µ</li>
<li>å…¶ä¸»è¦ä½œç”¨æ˜¯ä»ç³»ç»Ÿå¤–éƒ¨è·å¾—ClassäºŒè¿›åˆ¶æ•°æ®æµã€‚</li>
<li>ä»–æ˜¯Javaçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ‰€æœ‰çš„Classéƒ½æ˜¯ç”±ClassLoaderè¿›è¡ŒåŠ è½½çš„</li>
<li>ClassLoaderè´Ÿè´£é€šè¿‡å°†Classæ–‡ä»¶é‡Œçš„äºŒè¿›åˆ¶æ•°æ®æµè£…è½½è¿›ç³»ç»Ÿ</li>
<li>ç„¶åäº¤ç»™Javaè™šæ‹Ÿæœºè¿›è¡Œè¿æ¥ã€åˆå§‹åŒ–ç­‰æ“ä½œ</li>
</ul>
<h4 id="2-classloaderçš„ç§ç±»">2. ClassLoaderçš„ç§ç±»</h4>
<ol>
<li>BootStrapClassLoaderï¼šC++ç¼–å†™ï¼ŒåŠ è½½æ ¸å¿ƒåº“java.*</li>
<li>ExtClassLoaderï¼šJavaç¼–å†™ï¼ŒåŠ è½½æ‰©å±•åº“ javax.*</li>
<li>AppClassLoaderï¼šJavaç¼–å†™ï¼ŒåŠ è½½ç¨‹åºæ‰€åœ¨ç›®å½•</li>
</ol>
<h4 id="3-è‡ªå®šä¹‰classloaderçš„å®ç°">3. è‡ªå®šä¹‰ClassLoaderçš„å®ç°</h4>
<ol>
<li>å…³é”®å‡½æ•°
<ul>
<li>findClass</li>
<li>defineClass</li>
</ul>
</li>
</ol>
<pre><code class="language-java">public class MyClassLoader extends ClassLoader {
  	// éœ€è¦åŠ è½½çš„ç±»çš„è·¯å¾„
    private String path;
  	// classçš„åå­—
    private String classLoaderName;
    public MyClassLoader(String path, String classLoaderName) {
        this.path = path;
        this.classLoaderName = classLoaderName;
    }
    //ç”¨äºå¯»æ‰¾ç±»æ–‡ä»¶
    @Override
    public Class findClass(String name) {
        byte[] b = loadClassData(name);
        return defineClass(name, b, 0, b.length);
    }
    //ç”¨äºåŠ è½½ç±»æ–‡ä»¶
    private byte[] loadClassData(String name) {
        name = path + name + &quot;.class&quot;;
        InputStream in = null;
        ByteArrayOutputStream out = null;
        try {
            in = new FileInputStream(new File(name));
            out = new ByteArrayOutputStream();
            int i = 0;
            while ((i = in.read()) != -1) {
                out.write(i);
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            try {
                out.close();
                in.close();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        return out.toByteArray();
    }
}
</code></pre>
<p>###1.5 åŒäº²å§”æ´¾æœºåˆ¶</p>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1588817688490.png" alt="" loading="lazy"></figure>
<ul>
<li>é¿å…å¤šä»½åŒæ ·å­—èŠ‚ç çš„åŠ è½½</li>
</ul>
<h3 id="16-ç±»çš„åŠ è½½æ–¹å¼">1.6 ç±»çš„åŠ è½½æ–¹å¼</h3>
<ol>
<li>éšå¼åŠ è½½ï¼šnew</li>
<li>æ˜¾ç¤ºåŠ è½½ï¼šloadClassï¼ŒforNameç­‰</li>
</ol>
<h4 id="1-loadclasså’Œfornameçš„åŒºåˆ«">1. loadClasså’ŒforNameçš„åŒºåˆ«</h4>
<ol>
<li>
<p>ç±»çš„è£…è½½è¿‡ç¨‹</p>
<ul>
<li>åŠ è½½
<ol>
<li>é€šè¿‡ClassLoaderåŠ è½½classæ–‡ä»¶å­—èŠ‚ç ï¼Œç”Ÿæˆclasså¯¹è±¡</li>
</ol>
</li>
<li>é“¾æ¥
<ol>
<li>æ ¡éªŒï¼šæ£€æŸ¥åŠ è½½çš„classçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§</li>
<li>å‡†å¤‡ï¼šä¸ºç±»å˜é‡åˆ†é…å­˜å‚¨ç©ºé—´å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹åŒ–</li>
<li>è§£æï¼šJVMå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li>
</ol>
</li>
<li>åˆå§‹åŒ–
<ol>
<li>æ‰§è¡Œç±»å˜é‡èµ‹å€¼å’Œé™æ€ä»£ç å—</li>
</ol>
</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1588817704849.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>ä¸¤è€…åŒºåˆ«</p>
<ul>
<li>Class.forNameå¾—åˆ°çš„classæ˜¯å·²ç»åˆå§‹åŒ–å®Œæˆçš„</li>
<li>ClassLoader.loadClasså¾—åˆ°çš„classæ˜¯è¿˜æ²¡æœ‰å®Œæˆé“¾æ¥çš„</li>
</ul>
</li>
</ol>
<h3 id="17-javaçš„å†…å­˜æ¨¡å‹">1.7 Javaçš„å†…å­˜æ¨¡å‹</h3>
<h4 id="1-å†…å­˜ç®€ä»‹">1. å†…å­˜ç®€ä»‹</h4>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1588817717649.png" alt="" loading="lazy"></figure>
<h4 id="2åœ°å€ç©ºé—´çš„åˆ’åˆ†">2.åœ°å€ç©ºé—´çš„åˆ’åˆ†</h4>
<ol>
<li>å†…æ ¸ç©ºé—´</li>
<li>ç”¨æˆ·ç©ºé—´</li>
</ol>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1588817731598.png" alt="" loading="lazy"></figure>
<h4 id="3-jvmæ¶æ„">3. JVMæ¶æ„</h4>
<figure data-type="image" tabindex="5"><img src="https://zu3zz.github.io/post-images/1588817740833.png" alt="" loading="lazy"></figure>
<ul>
<li>Class Loaderï¼šä¾æ®ç‰¹å®šæ ¼å¼ï¼ŒåŠ è½½classåˆ°å†…å­˜</li>
<li>Execution Engineï¼šå¯¹å‘½ä»¤è¿›è¡Œè§£æ</li>
<li>Native Interfaceï¼šèåˆä¸åŒå¼€å‘è¯­è¨€çš„åŸç”Ÿåº“ä¸ºjavaæ‰€ç”¨</li>
<li>Runtime Data Areaï¼šJVMå†…å­˜ç©ºé—´ç»“æ„æ¨¡å‹</li>
</ul>
<h4 id="4-jvmå†…å­˜æ¨¡å‹jdk8">4. JVMå†…å­˜æ¨¡å‹â€”â€”JDK8</h4>
<figure data-type="image" tabindex="6"><img src="https://zu3zz.github.io/post-images/1588817751249.png" alt="" loading="lazy"></figure>
<ul>
<li>çº¿ç¨‹ç§æœ‰ï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li>çº¿ç¨‹å…±äº«ï¼šMetaSpaceã€Javaå †</li>
<li>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼š
<ul>
<li>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç è¡Œå·æŒ‡ç¤ºå™¨ï¼ˆé€»è¾‘è®¡æ•°å™¨ï¼‰</li>
<li>æ”¹å˜è®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤</li>
<li>å’Œçº¿ç¨‹æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»å³â€çº¿ç¨‹ç§æœ‰â€œ</li>
<li>å¯¹Javaæ–¹æ³•è®¡æ•°ï¼Œå¦‚æœæ˜¯Nativeæ–¹æ³•åˆ™è®¡æ•°å™¨å€¼ä¸ºUndefined</li>
<li>ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼</li>
</ul>
</li>
<li>Javaè™šæ‹Ÿæœºæ ˆï¼ˆStackï¼‰
<ul>
<li>Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹</li>
<li>åŒ…å«å¤šä¸ªæ ˆå¸§</li>
</ul>
</li>
<li>å±€éƒ¨å˜é‡è¡¨å’Œæ“ä½œæ•°æ ˆ
<ul>
<li>å±€éƒ¨å˜é‡è¡¨ï¼šåŒ…å«æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ‰€æœ‰å˜é‡</li>
<li>æ“ä½œæ•°æ ˆï¼šå…¥æ ˆã€å‡ºæ ˆã€å¤åˆ¶ã€äº¤æ¢ã€äº§ç”Ÿæ¶ˆè´¹å˜é‡</li>
</ul>
</li>
</ul>
<h4 id="5-çº¿ç¨‹å…±äº«">5. çº¿ç¨‹å…±äº«</h4>
<ol>
<li>
<p>å…ƒç©ºé—´ï¼ˆMetaSpaceï¼‰å’Œæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰çš„åŒºåˆ«</p>
<ul>
<li>
<p>å…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œè€Œæ°¸ä¹…ä»£ä½¿ç”¨çš„æ˜¯jvmçš„å†…å­˜</p>
<pre><code class="language-java">java.lang.OutOfMemoryError: PermGen Space
</code></pre>
</li>
</ul>
</li>
<li>
<p><code>MetaSpace</code>ç›¸æ¯”<code>PermGem</code>çš„ä¼˜åŠ¿</p>
<ul>
<li>å­—ç¬¦ä¸²å¸¸é‡æ± å­˜åœ¨æ°¸ä¹…ä»£ä¸­ï¼Œå®¹æ˜“å‡ºç°æ€§èƒ½é—®é¢˜å’Œå†…å­˜æº¢å‡º</li>
<li>ç±»å’Œæ–¹æ³•çš„ä¿¡æ¯å¤§å°éš¾ä»¥ç¡®å®šï¼Œç»™æ°¸ä¹…ä»£çš„å¤§å°æŒ‡å®šå¸¦æ¥å›°éš¾</li>
<li>æ°¸ä¹…ä»£ä¼šä¸ºGCå¸¦æ¥ä¸å¿…è¦çš„å¤æ‚æ€§</li>
<li>æ–¹ä¾¿<code>HotSpot</code>ä¸å…¶ä»–<code>JVM</code>å¦‚<code>Jrockit</code>çš„ç»§æ‰¿</li>
</ul>
</li>
<li>
<p>Javaå †ï¼ˆHeapï¼‰</p>
<ul>
<li>
<p>å¯¹è±¡å®ä¾‹çš„åˆ†é…åŒºåŸŸ</p>
<figure data-type="image" tabindex="7"><img src="https://zu3zz.github.io/post-images/1588817797666.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>GCç®¡ç†çš„ä¸»è¦åŒºåŸŸ</p>
<figure data-type="image" tabindex="8"><img src="https://zu3zz.github.io/post-images/1588817804182.png" alt="" loading="lazy"></figure>
</li>
</ul>
</li>
</ol>
<h3 id="18-jvmè°ƒä¼˜å‚æ•°">1.8 JVMè°ƒä¼˜å‚æ•°</h3>
<ul>
<li>-Xmsï¼šå †çš„åˆå§‹å¤§å°</li>
<li>-Xmxï¼šå †èƒ½è¾¾åˆ°çš„æœ€å¤§å€¼</li>
<li>-Xssï¼šè§„å®šäº†æ¯ä¸ªçº¿ç¨‹è™šæ‹Ÿæœºæ ˆï¼ˆå †æ ˆï¼‰çš„å¤§å°</li>
</ul>
<pre><code class="language-java">// ç¤ºä¾‹ä»£ç 
java -Xms128m -Xmx128m -Xss256k -jar xxxxx.jar
</code></pre>
<h3 id="19-å†…å­˜åˆ†é…ç­–ç•¥">1.9 å†…å­˜åˆ†é…ç­–ç•¥</h3>
<h4 id="1-å†…å­˜åˆ†é…ç­–ç•¥">1. å†…å­˜åˆ†é…ç­–ç•¥</h4>
<ul>
<li>é™æ€å­˜å‚¨ï¼šç¼–è¯‘æ—¶ç¡®å®šæ¯ä¸ªæ•°æ®ç›®æ ‡åœ¨è¿è¡Œæ—¶çš„å­˜å‚¨ç©ºé—´éœ€æ±‚</li>
<li>æ ˆå¼å­˜å‚¨ï¼ˆåŠ¨æ€å­˜å‚¨ï¼‰ï¼šæ•°æ®åŒºéœ€æ±‚åœ¨ç¼–è¯‘æ—¶æœªçŸ¥ï¼Œè¿è¡Œæ—¶æ¨¡å—å…¥å£å‰ç¡®å®š</li>
<li>å †å¼å­˜å‚¨ï¼šç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶æ¨¡å—å…¥å£éƒ½æ— æ³•ç¡®å®šï¼ŒåŠ¨æ€åˆ†é…</li>
</ul>
<h4 id="2-javaå†…å­˜ä¸­å †å’Œæ ˆçš„åŒºåˆ«">2. Javaå†…å­˜ä¸­å †å’Œæ ˆçš„åŒºåˆ«</h4>
<ul>
<li>è”ç³»ï¼šå¼•ç”¨å¯¹è±¡ã€æ•°ç»„æ—¶ï¼Œæ ˆé‡Œå®šä¹‰å˜é‡ä¿å­˜å †ä¸­ç›®æ ‡çš„é¦–åœ°å€</li>
<li>ç®¡ç†æ–¹å¼ï¼šæ ˆè‡ªåŠ¨é‡Šæ”¾ï¼Œå †éœ€è¦GC</li>
<li>ç©ºé—´å¤§å°ï¼šæ ˆæ¯”å †å°</li>
<li>ç¢ç‰‡ç›¸å…³ï¼šæ ˆäº§ç”Ÿçš„ç¢ç‰‡è¿œå°äºå †</li>
<li>åˆ†é…æ–¹å¼ï¼šæ ˆæ”¯æŒé™æ€å’ŒåŠ¨æ€åˆ†é…ï¼Œè€Œå †ä»…æ”¯æŒåŠ¨æ€åˆ†é…</li>
<li>æ•ˆç‡ï¼šæ ˆçš„æ•ˆç‡æ¯”å †é«˜</li>
<li>è¯¦è§£ä¸€ä¸ªæ™®é€šçš„ç±»åœ¨åŠ è½½çš„æ—¶å€™ï¼ˆå…ƒç©ºé—´ã€å †ã€çº¿ç¨‹ç‹¬å éƒ¨åˆ†ï¼‰ä¹‹é—´çš„è”ç³»</li>
</ul>
<pre><code class="language-java">// æœ‰å¦‚ä¸‹ä¸€ä¸ªç±»
public class HelloWorld {
  private String name;
  public void sayHello() {
    System.out.println(&quot;Hello&quot; + name);
  }
  public void setName(String name){
    this.name = name;
  }
  public static void main(String[] args){
    int a = 1;
    HelloWorld hw = new HelloWorld();
    hw.setName(&quot;test&quot;);
    hw.sayHello();
  }
}
</code></pre>
<figure data-type="image" tabindex="9"><img src="https://zu3zz.github.io/post-images/1588817818449.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Javaå¤šçº¿ç¨‹ä¸å¹¶å‘(1) -- çº¿ç¨‹åˆ›å»º]]></title>
        <id>https://zu3zz.github.io/post/java-thread-1/</id>
        <link href="https://zu3zz.github.io/post/java-thread-1/">
        </link>
        <updated>2020-02-21T12:33:07.000Z</updated>
        <summary type="html"><![CDATA[<p>Javaå¤šè¿›ç¨‹çš„ç¬¬ä¸€ç¯‡~ å…³äºçº¿ç¨‹åˆ›å»ºçš„æ–¹æ³•ä¸åº•å±‚åŸç†ğŸ˜‡</p>
]]></summary>
        <content type="html"><![CDATA[<p>Javaå¤šè¿›ç¨‹çš„ç¬¬ä¸€ç¯‡~ å…³äºçº¿ç¨‹åˆ›å»ºçš„æ–¹æ³•ä¸åº•å±‚åŸç†ğŸ˜‡</p>
<!-- more -->
<h1 id="javaå¤šå¹¶å‘-çº¿ç¨‹åˆ›å»º">Javaå¤šå¹¶å‘ -- çº¿ç¨‹åˆ›å»º</h1>
<h2 id="å®ç°å¤šçº¿ç¨‹çš„æ–¹æ³•">å®ç°å¤šçº¿ç¨‹çš„æ–¹æ³•</h2>
<ul>
<li>
<p>å®ç°å¤šçº¿ç¨‹çš„å®˜æ–¹æ­£ç¡®æ–¹æ³•ï¼š2ç§</p>
<ul>
<li>
<p>æ–¹æ³•ä¸€ï¼šå®ç°Runnableæ¥å£</p>
<pre><code class="language-java">// ç”¨Runnableæ–¹å¼åˆ›å»ºçº¿ç¨‹
public class RunnableStyle implements Runnable{
  public static void main(String[] args){
    Thread thread = new Thread(new RunnableStyle());
    thread.start();
  }
  @Override
  public void run() {
    System.out.println(&quot;ç”¨Runnableæ–¹æ³•å®ç°çº¿ç¨‹&quot;);
  }
}
// æ‰“å°è¾“å‡º ç”¨Runnableæ–¹æ³•å®ç°çº¿ç¨‹
</code></pre>
</li>
<li>
<p>æ–¹æ³•äºŒï¼š ç»§æ‰¿Threadç±»</p>
<pre><code class="language-java">// ç”¨Threadæ–¹å¼åˆ›å»ºçº¿ç¨‹
public class ThreadStyle extends Thread{
  public static void main(String[] args){
    new ThreadStyle().start();
  }
  @Override
  public void run() {
    System.out.println(&quot;ç”¨Threadç±»å®ç°çº¿ç¨‹&quot;);
  }
}
// æ‰“å°è¾“å‡º ç”¨Threadç±»å®ç°çº¿ç¨‹
</code></pre>
</li>
</ul>
</li>
<li>
<p>ä¸¤ç§æ–¹æ³•çš„å¯¹æ¯”</p>
<ul>
<li>æ–¹æ³•1ï¼ˆå®ç°Runnableæ¥å£ï¼‰æ›´å¥½</li>
<li>è§£è€¦</li>
<li>æ€§èƒ½æ¶ˆè€—æ›´ä½</li>
<li>å¦‚æœå·²ç»ç»§æ‰¿ï¼Œé™åˆ¶äº†å¯æ‰©å±•æ€§</li>
</ul>
</li>
<li>
<p>ä¸¤ç§æ–¹æ³•çš„æœ¬è´¨å¯¹æ¯”ï¼ˆçœ‹æºç ï¼‰</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šæœ€ç»ˆè°ƒç”¨target.run()</li>
<li>æ–¹æ³•äºŒï¼šrun()æ•´ä¸ªéƒ½è¢«é‡å†™</li>
</ul>
</li>
<li>
<p>åŒæ—¶ä½¿ç”¨ä¸¤ç§æ–¹æ³•ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p>
<pre><code class="language-java">/**
 * æè¿°ï¼š     åŒæ—¶ä½¿ç”¨Runnableå’ŒThreadä¸¤ç§å®ç°çº¿ç¨‹çš„æ–¹å¼
 */
public class BothRunnableThread {
    public static void main(String[] args) {
        new Thread(new Runnable() {
            @Override
            public void run() {
                System.out.println(&quot;æˆ‘æ¥è‡ªRunnable&quot;);
            }
        }) {
            @Override
            public void run() {
                System.out.println(&quot;æˆ‘æ¥è‡ªThread&quot;);
            }
        }.start();
    }
}
// æ‰“å°è¾“å‡º æˆ‘æ¥è‡ªThread
</code></pre>
</li>
<li>
<p>å‡†ç¡®çš„æ¥è¯´ï¼Œåˆ›å»ºçº¿ç¨‹åªæœ‰ä¸€ç§æ–¹å¼å°±æ˜¯æ„é€ Threadç±»ï¼Œè€Œå®ç°çº¿ç¨‹çš„å•å…ƒåˆ›å»ºæœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>æ–¹æ³•ä¸€ï¼šå®ç°Runnableæ¥å£çš„runæ–¹æ³•ï¼Œå¹¶æŠŠRunnableå®ä¾‹ä¼ ç»™Threadç±»</li>
<li>æ–¹æ³•äºŒï¼šé‡å†™Threadç±»çš„runæ–¹æ³•ï¼ˆç»§æ‰¿Threadç±»ï¼‰</li>
</ul>
</li>
<li>
<p>å…¸å‹é”™è¯¯è§‚ç‚¹</p>
<ul>
<li>çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹ä¹Ÿç®—æ˜¯ä¸€ç§æ–°å»ºçº¿ç¨‹çš„æ–¹å¼</li>
<li>é€šè¿‡ **Callable ** å’Œ <strong>FutureTask</strong> æ¥åˆ›å»ºçº¿ç¨‹</li>
<li><strong>æ— è¿”å›å€¼</strong>æ˜¯å®ç°runnableæ¥å£ï¼Œ**æœ‰è¿”å›å€¼ **æ˜¯å®ç°Callableæ¥å£ï¼Œæ‰€ä»¥callableæ˜¯æ–°çš„å®ç°çº¿ç¨‹çš„æ–¹å¼</li>
<li>å®šæ—¶å™¨ï¼ˆåº•å±‚ä¹Ÿæ˜¯è‡ªåŠ¨åˆ›å»ºï¼‰</li>
<li>åŒ¿åå†…éƒ¨ç±»ï¼ˆè¯­æ³•å±‚é¢ï¼‰</li>
<li>Lambdaè¡¨è¾¾å¼ï¼ˆè¯­æ³•å±‚é¢ï¼‰</li>
</ul>
</li>
<li>
<p>æœ¬è´¨ä¸‡å˜ä¸ç¦»å…¶å®—</p>
</li>
<li>
<p>å¸¸è§é¢è¯•é—®é¢˜</p>
<ul>
<li>æœ‰å¤šå°‘ç§å®ç°çº¿ç¨‹çš„æ–¹æ³•ï¼Ÿ5ç‚¹æ€è·¯
<ul>
<li>ä»ä¸åŒçš„è§’åº¦çœ‹ï¼Œä¼šæœ‰ä¸åŒçš„ç­”æ¡ˆ</li>
<li>å…¸å‹ç­”æ¡ˆæ˜¯ä¸¤ç§</li>
<li>æˆ‘ä»¬çœ‹åŸç†ï¼Œä¸¤ç§æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„</li>
<li>å…·ä½“å±•å¼€è¯´å…¶ä»–æ–¹å¼</li>
<li>ç»“è®º</li>
</ul>
</li>
<li>å®ç°Runnableæ¥å£å’Œç»§æ‰¿Threadç±»é‚£ç§æ–¹å¼æ›´å¥½
<ul>
<li>ä»ä»£ç æ¶æ„è§’åº¦ï¼ˆè§£è€¦åˆï¼‰</li>
<li>æ–°å»ºçº¿ç¨‹çš„æŸè€—ï¼ˆæ–°å»ºç±»æ¶ˆè€—å¤§ï¼‰</li>
<li>Javaä¸æ”¯æŒåŒç»§æ‰¿ï¼ˆç»§æ‰¿ä¼šéº»çƒ¦ï¼‰</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸»æµç¼“å­˜Redisç¬”è®°]]></title>
        <id>https://zu3zz.github.io/post/interview-redis/</id>
        <link href="https://zu3zz.github.io/post/interview-redis/">
        </link>
        <updated>2020-02-16T13:15:30.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ½è¯¦ç»†è®²è§£ä¸»æµç¼“å­˜é¢è¯•ä¼šé‡åˆ°çš„é—®é¢˜ï¼ŒåŒ…å«Redisåˆ†å¸ƒå¼é”ã€å¼‚æ­¥é˜Ÿåˆ—ã€æŒä¹…åŒ–ã€é›†ç¾¤ç­‰ğŸ½</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ½è¯¦ç»†è®²è§£ä¸»æµç¼“å­˜é¢è¯•ä¼šé‡åˆ°çš„é—®é¢˜ï¼ŒåŒ…å«Redisåˆ†å¸ƒå¼é”ã€å¼‚æ­¥é˜Ÿåˆ—ã€æŒä¹…åŒ–ã€é›†ç¾¤ç­‰ğŸ½</p>
<!-- more -->
<h1 id="ä¸»æµç¼“å­˜redisç¬”è®°">ä¸»æµç¼“å­˜Redisç¬”è®°</h1>
<h2 id="1-ä¸»æµåº”ç”¨æ¶æ„">1. ä¸»æµåº”ç”¨æ¶æ„</h2>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1581859003669.png" alt="" loading="lazy"></figure>
<h3 id="11-ç¼“å­˜ä¸­é—´ä»¶-memcacheå’Œredisçš„åŒºåˆ«">1.1 ç¼“å­˜ä¸­é—´ä»¶---- Memcacheå’ŒRedisçš„åŒºåˆ«</h3>
<h4 id="1-memcacheä»£ç å±‚æ¬¡ç±»ä¼¼hash">1. Memcacheï¼šä»£ç å±‚æ¬¡ç±»ä¼¼Hash</h4>
<ul>
<li>æ”¯æŒç®€å•æ•°æ®ç±»å‹</li>
<li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–å­˜å‚¨</li>
<li>ä¸æ”¯æŒä¸»ä»</li>
<li>ä¸æ”¯æŒåˆ†ç‰‡</li>
</ul>
<h4 id="2-redis">2. Redis</h4>
<ul>
<li>æ•°æ®ç±»å‹ä¸°å¯Œ</li>
<li>æ”¯æŒæ•°æ®ç£ç›˜æŒä¹…åŒ–å­˜å‚¨</li>
<li>æ”¯æŒä¸»ä»</li>
<li>æ”¯æŒåˆ†ç‰‡</li>
</ul>
<hr>
<h3 id="12-ä¸ºä»€ä¹ˆredisèƒ½è¿™ä¹ˆå¿«">1.2 ä¸ºä»€ä¹ˆRedisèƒ½è¿™ä¹ˆå¿«</h3>
<h4 id="1-100000qpsæ¯ç§’å†…æŸ¥è¯¢æ¬¡æ•°">1. 100000+QPSï¼ˆæ¯ç§’å†…æŸ¥è¯¢æ¬¡æ•°ï¼‰</h4>
<ul>
<li>å®Œå…¨åŸºäºå†…å­˜ï¼Œç»å¤§éƒ¨åˆ†è¯·æ±‚æ˜¯çº¯ç²¹çš„å†…å­˜æ“ä½œï¼Œæ‰§è¡Œæ•ˆç‡é«˜</li>
<li>æ•°æ®ç»“æ„ç®€å•ï¼Œå¯¹æ•°æ®æ“ä½œä¹Ÿç®€å•</li>
<li>é‡‡ç”¨å•çº¿ç¨‹ï¼Œå•çº¿ç¨‹ä¹Ÿèƒ½å¤„ç†é«˜å¹¶å‘è¯·æ±‚ï¼Œæƒ³å¤šæ ¸ä¹Ÿå¯ä»¥å¯åŠ¨å¤šå®ä¾‹</li>
<li>ä½¿ç”¨å¤šè·¯I/Oå¤ç”¨æ¨¡å‹ï¼Œéé˜»å¡IO</li>
</ul>
<hr>
<h3 id="13-å¤šè·¯ioå¤ç”¨æ¨¡å‹">1.3 å¤šè·¯I/Oå¤ç”¨æ¨¡å‹</h3>
<h4 id="1-fd-file-descriptoræ–‡ä»¶æè¿°ç¬¦">1. FD: File descriptorï¼Œæ–‡ä»¶æè¿°ç¬¦</h4>
<ul>
<li>ä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶é€šè¿‡å”¯ä¸€çš„æè¿°ç¬¦è¿›è¡Œå¼•ç”¨ï¼Œè¯¥æè¿°ç¬¦æ˜¯æ‰“å¼€æ–‡ä»¶çš„å…ƒæ•°æ®åˆ°æ–‡ä»¶æœ¬èº«çš„æ˜ å°„</li>
</ul>
<h4 id="2-ä¼ ç»Ÿçš„é˜»å¡ioæ¨¡å‹">2. ä¼ ç»Ÿçš„é˜»å¡I/Oæ¨¡å‹</h4>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1581859021180.png" alt="" loading="lazy"></figure>
<h4 id="3-select-ç³»ç»Ÿè°ƒç”¨">3. Select ç³»ç»Ÿè°ƒç”¨</h4>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1581859027686.png" alt="" loading="lazy"></figure>
<h4 id="4-redisé‡‡ç”¨çš„ioå¤šè·¯å¤ç”¨å‡½æ•°epollkqueueevportselect">4. Redisé‡‡ç”¨çš„I/Oå¤šè·¯å¤ç”¨å‡½æ•°ï¼šepoll/kqueue/evport/select</h4>
<ul>
<li>å› åœ°åˆ¶å®œ</li>
<li>ä¼˜å…ˆå­¦åˆ™æ—¶é—´å¤æ‚åº¦ä¸ºO(1)çš„I/Oå¤šè·¯å¤ç”¨å‡½æ•°ä½œä¸ºåº•å±‚å®ç°</li>
<li>ä»¥æ—¶é—´å¤æ‚åº¦çš„O(N)çš„selectä½œä¸ºä¿åº•</li>
<li>åŸºäºreactè®¾è®¡æ¨¡å¼ç›‘å¬I/Oäº‹ä»¶</li>
</ul>
<h2 id="2-redisçš„æ•°æ®ç±»å‹">2. Redisçš„æ•°æ®ç±»å‹</h2>
<h3 id="1-ä¾›ç”¨æˆ·ä½¿ç”¨çš„æ•°æ®ç±»å‹">1. ä¾›ç”¨æˆ·ä½¿ç”¨çš„æ•°æ®ç±»å‹</h3>
<ul>
<li>
<p>Stringï¼šæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼ŒäºŒè¿›åˆ¶å®‰å…¨ï¼ˆåº•å±‚ä½¿ç”¨sdshdrï¼‰</p>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1581859149419.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>Hashï¼šStringå…ƒç´ ç»„æˆçš„å­—å…¸ï¼Œé€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼ˆhmset key1 value1 key2 value2...ï¼‰</p>
</li>
<li>
<p>Listï¼šåˆ—è¡¨ï¼ŒæŒ‰ç…§Stringå…ƒç´ æ’å…¥é¡ºåºæ’åº</p>
</li>
<li>
<p>Setï¼šStringå…ƒç´ ç»„æˆçš„æ— åºé›†åˆï¼Œé€šè¿‡å“ˆå¸Œè¡¨å®ç°ï¼Œä¸å…è®¸é‡å¤(sadd myset 1)</p>
</li>
<li>
<p>Sorted Setï¼šé€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°è¾¾çš„æ’åºï¼ˆzadd myzset 3 a)\</p>
</li>
<li>
<p>é«˜çº§ï¼šç”¨æ¥è®¡æ•°çš„HyperLogLogï¼Œç”¨äºæ”¯æŒå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯çš„Geo</p>
</li>
</ul>
<h3 id="2-åº•å±‚æ•°æ®ç±»å‹åŸºç¡€">2. åº•å±‚æ•°æ®ç±»å‹åŸºç¡€</h3>
<ol>
<li>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</li>
<li>é“¾è¡¨</li>
<li>å­—å…¸</li>
<li>è·³è·ƒè¡¨</li>
<li>æ•´æ•°é›†åˆ</li>
<li>å‹ç¼©åˆ—è¡¨</li>
<li>å¯¹è±¡</li>
</ol>
<h2 id="3-ä»æµ·é‡keyé‡ŒæŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„key">3. ä»æµ·é‡keyé‡ŒæŸ¥è¯¢æŸä¸€å›ºå®šå‰ç¼€çš„Key</h2>
<h3 id="1-keys-patternæŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼patternçš„key">1. KEYS patternï¼šæŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆç»™å®šæ¨¡å¼patternçš„key</h3>
<ul>
<li>KEYSæŒ‡ä»¤ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰åŒ¹é…çš„key</li>
<li>é”®çš„æ•°é‡è¿‡å¤§ä¼šä½¿å¾—æœåŠ¡å¡é¡¿</li>
</ul>
<h3 id="2-scan-cursor-match-pattern-count-count">2. SCAN cursor [MATCH pattern] [COUNT count]</h3>
<ul>
<li>åŸºäºæ¸¸æ ‡çš„è¿­ä»£å™¨ï¼Œéœ€è¦åŸºäºä¸Šä¸€æ¬¡çš„æ¸¸æ ‡å»¶ç»­ä¹‹å‰çš„è¿­ä»£è¿‡ç¨‹</li>
<li>ä»¥0ä½œä¸ºæ¸¸æ ‡å¼€å§‹ä¸€æ¬¡æ–°çš„è¿­ä»£ï¼Œç›´åˆ°å‘½ä»¤è¿”å›æ¸¸æ ‡0å®Œæˆä¸€æ¬¡éå†</li>
<li>ä¸ä¿è¯æ¯æ¬¡æ‰§è¡Œéƒ½è¿”å›æŸä¸ªç»™å®šæ•°é‡çš„å…ƒç´ ï¼Œæ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</li>
<li>ä¸€æ¬¡è¿”å›çš„æ•°é‡ä¸å¯æ§ï¼Œåªèƒ½æ˜¯å¤§æ¦‚ç‡ç¬¦åˆcountå‚æ•°</li>
</ul>
<h2 id="4-å¦‚ä½•é€šè¿‡rediså®ç°åˆ†å¸ƒå¼é”">4. å¦‚ä½•é€šè¿‡Rediså®ç°åˆ†å¸ƒå¼é”</h2>
<h3 id="1-åˆ†å¸ƒå¼é”éœ€è¦è§£å†³çš„é—®é¢˜">1. åˆ†å¸ƒå¼é”éœ€è¦è§£å†³çš„é—®é¢˜</h3>
<ul>
<li>äº’æ–¥æ€§</li>
<li>å®‰å…¨æ€§</li>
<li>æ­»é”</li>
<li>å®¹é”™</li>
</ul>
<h3 id="2-setnx-key-valueå¦‚æœkeyä¸å­˜åœ¨åˆ™åˆ›å»ºå¹¶èµ‹å€¼">2. SETNX key valueï¼šå¦‚æœkeyä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¹¶èµ‹å€¼</h3>
<h3 id="3-è§£å†³setnx-é•¿æœŸæœ‰æ•ˆçš„é—®é¢˜">3. è§£å†³SETNX é•¿æœŸæœ‰æ•ˆçš„é—®é¢˜</h3>
<ol>
<li>
<p>EXPIRE key seconds</p>
<ul>
<li>è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´ï¼Œå½“keyè¿‡æœŸæ—¶ï¼ˆç”Ÿå­˜æ—¶é—´ä¸º0ï¼‰ï¼Œä¼šè¢«è‡ªåŠ¨åˆ é™¤</li>
</ul>
</li>
<li>
<figure data-type="image" tabindex="5"><img src="https://zu3zz.github.io/post-images/1581859174423.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>SET key value [EX seconds] [PX milliseconds] [NX|XX]</p>
<ul>
<li>EX secondï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºsecondç§’</li>
<li>PX millisecondï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸ºmillisecondæ¯«ç§’</li>
<li>NX ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶å€™ï¼Œæ‰å¯¹é”®è¿›è¡Œæ“ä½œ ï¼ˆç­‰åŒäºä¸Šé¢ SETNX key valueï¼‰</li>
<li>XXï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶å€™ï¼Œæ‰å¯¹é”®è¿›è¡Œæ“ä½œ</li>
<li>SET æ“ä½œæˆåŠŸå®Œæˆæ—¶ï¼Œ è¿”å›OK, å¦åˆ™è¿”å›nil</li>
</ul>
</li>
</ol>
<h3 id="4-å¤§é‡keyåŒæ—¶è¿‡æœŸçš„æ³¨æ„äº‹é¡¹">4. å¤§é‡keyåŒæ—¶è¿‡æœŸçš„æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>é›†ä¸­è¿‡æœŸï¼Œç”±äºæ¸…é™¤å¤§é‡çš„keyå¾ˆè€—æ—¶ï¼Œä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ç°è±¡</li>
<li>è§£å†³æ–¹æ¡ˆï¼šåœ¨è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´çš„æ—¶å€™ï¼Œç»™æ¯ä¸ªkeyåŠ ä¸Šéšæœºå€¼</li>
</ol>
<h2 id="5-ä½¿ç”¨redisåšå¼‚æ­¥é˜Ÿåˆ—">5. ä½¿ç”¨Redisåšå¼‚æ­¥é˜Ÿåˆ—</h2>
<h3 id="1-ä½¿ç”¨listä½œä¸ºé˜Ÿåˆ—">1. ä½¿ç”¨Listä½œä¸ºé˜Ÿåˆ—</h3>
<ol>
<li>
<p>RPUSHç”Ÿäº§æ¶ˆæ¯ LPOPæ¶ˆè´¹æ¶ˆæ¯</p>
<ul>
<li>ç¼ºç‚¹ï¼šæ²¡æœ‰ç­‰å¾…é˜Ÿåˆ—é‡Œæœ‰å€¼å°±ç›´æ¥æ¶ˆè´¹</li>
<li>å¯ä»¥é€šè¿‡åœ¨åº”ç”¨å±‚å¼•å…¥Sleepæœºåˆ¶å»è°ƒç”¨LPOPé‡è¯•</li>
</ul>
</li>
<li>
<p><code>BLPOP key [key...] timeout</code>ï¼šé˜»å¡ç›´åˆ°é˜Ÿåˆ—æœ‰æ¶ˆæ¯æˆ–è€…è¶…æ—¶</p>
</li>
</ol>
<h3 id="2-pubsubä¸»é¢˜è®¢é˜…è€…æ¨¡å¼">2. pub/subï¼šä¸»é¢˜è®¢é˜…è€…æ¨¡å¼</h3>
<ul>
<li>å‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsubï¼‰æ¥æ”¶æ¶ˆæ¯</li>
<li>å…ˆè®¢é˜…ä¸€ä¸ªé¢‘é“ï¼Œä¼šè‡ªåŠ¨è·å¾—è¿™ä¸ªé¢‘é“é‡Œçš„æ¶ˆæ¯</li>
<li>ç¼ºç‚¹ï¼šæ¶ˆæ¯çš„å‘å¸ƒæ˜¯æ— çŠ¶æ€çš„ï¼Œæ— æ³•è¡¨å¾å¯è¾¾</li>
</ul>
<h2 id="6-rediså¦‚ä½•åšæŒä¹…åŒ–">6. Rediså¦‚ä½•åšæŒä¹…åŒ–</h2>
<h3 id="1-rdbå¿«ç…§æŒä¹…åŒ–ä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§">1. RDBï¼ˆå¿«ç…§ï¼‰æŒä¹…åŒ–ï¼šä¿å­˜æŸä¸ªæ—¶é—´ç‚¹çš„å…¨é‡æ•°æ®å¿«ç…§</h3>
<ol>
<li>SAVEï¼šé˜»å¡Redisçš„æœåŠ¡å™¨è¿›ç¨‹ï¼Œç›´åˆ°RDBæ–‡ä»¶è¢«åˆ›å»ºå®Œæ¯•</li>
<li><strong>BGSAVEï¼šForkå‡ºä¸€ä¸ªå­è¿›ç¨‹æ¥åˆ›å»ºRDBæ–‡ä»¶ï¼Œä¸é˜»å¡æœåŠ¡å™¨</strong></li>
</ol>
<h3 id="2-è‡ªåŠ¨åŒ–è§¦å‘rbdæŒä¹…åŒ–çš„æ–¹å¼">2. è‡ªåŠ¨åŒ–è§¦å‘RBDæŒä¹…åŒ–çš„æ–¹å¼</h3>
<ol>
<li>æ ¹æ®redis.confé…ç½®é‡Œçš„<code>SAVE m n</code> å®šæ—¶è§¦å‘ï¼ˆç”¨çš„æ˜¯BGSAVEï¼‰</li>
<li>ä¸»ä»å¤åˆ¶æ—¶ï¼Œä¸»èŠ‚ç‚¹è‡ªåŠ¨è§¦å‘</li>
<li>æŒ‡å®šDebug Reload</li>
<li>æ‰§è¡ŒShutdownä¸”æ²¡æœ‰å¼€å‘AOFæŒä¹…åŒ–</li>
</ol>
<h3 id="3-bgsaveçš„åŸç†">3. BGSAVEçš„åŸç†</h3>
<figure data-type="image" tabindex="6"><img src="https://zu3zz.github.io/post-images/1581859203147.png" alt="" loading="lazy"></figure>
<ul>
<li>ç³»ç»Ÿè°ƒç”¨fork()ï¼šåˆ›å»ºè¿›ç¨‹ï¼Œå®ç°äº†Copy-on-Write</li>
<li>ç¼ºç‚¹
<ul>
<li>å†…å­˜æ•°æ®çš„å…¨é‡åŒæ­¥ï¼Œæ•°æ®é‡å¤§ä¼šç”±äºI/Oè€Œå½±å“æ€§èƒ½</li>
<li>å¯èƒ½ä¼šå› ä¸ºRedisæŒ‚æ‰è€ŒæŸå¤±ä»å½“å‰è‡³æœ€è¿‘ä¸€æ¬¡å¿«ç…§æœŸé—´çš„æ•°æ®</li>
</ul>
</li>
</ul>
<hr>
<h3 id="4-aofappend-only-fileæŒä¹…åŒ–ä¿å­˜å†™çŠ¶æ€">4. AOFï¼ˆAppend-Only-Fileï¼‰æŒä¹…åŒ–ï¼šä¿å­˜å†™çŠ¶æ€</h3>
<ol>
<li>
<p>è®°å½•ä¸‹é™¤äº†æŸ¥è¯¢ä»¥å¤–çš„æ‰€æœ‰å˜æ›´æ•°æ®åº“çŠ¶æ€çš„æŒ‡ä»¤</p>
</li>
<li>
<p>ä»¥appendçš„å½¢å¼è¿½åŠ ä¿å­˜åˆ°AOFæ–‡ä»¶ä¸­ï¼ˆå¢é‡ï¼‰</p>
</li>
<li>
<p>AOFé»˜è®¤æ˜¯å…³é—­çš„ åœ¨confæ–‡ä»¶ä¸­é…ç½®</p>
</li>
<li>
<p>æ—¥å¿—é‡å†™è§£å†³AOFæ–‡ä»¶å¤§å°ä¸æ–­å¢å¤§çš„é—®é¢˜ï¼ŒåŸç†å¦‚ä¸‹ï¼š</p>
<ul>
<li>è°ƒç”¨forkï¼ˆï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹</li>
<li>å­è¿›ç¨‹å§æ–°çš„AOFå†™åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶é‡Œï¼Œä¸ä¾èµ–åŸæ¥çš„AOFæ–‡ä»¶</li>
<li>ä¸»è¿›ç¨‹æŒç»­å°†æ–°çš„å˜åŠ¨åŒæ—¶å†™åˆ°å†…å­˜å’ŒåŸæ¥çš„AOFé‡Œ</li>
<li>ä¸»è¿›ç¨‹è·å–å­è¿›ç¨‹é‡å†™AOFçš„å®Œæˆä¿¡å·ï¼Œå¾€æ–°AOFåŒæ­¥å¢é‡å˜åŠ¨</li>
<li>ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶</li>
</ul>
</li>
</ol>
<hr>
<h3 id="5-æ•°æ®æ¢å¤è¿‡ç¨‹">5. æ•°æ®æ¢å¤è¿‡ç¨‹</h3>
<ol>
<li>å…ˆçœ‹æœ‰æ²¡æœ‰AOFæ–‡ä»¶ï¼Œå†æ¢å¤</li>
<li>åœ¨çœ‹æœ‰æ²¡æœ‰RDBæ–‡ä»¶ï¼Œå†æ¢å¤</li>
</ol>
<hr>
<h3 id="6-ä¸¤è€…ä¼˜ç¼ºç‚¹">6. ä¸¤è€…ä¼˜ç¼ºç‚¹</h3>
<ol>
<li>RDBä¼˜ç‚¹ï¼šå…¨å±€æ•°æ®å¿«ç…§ï¼Œæ–‡ä»¶å°ï¼Œæ¢å¤å¿«</li>
<li>RDBç¼ºç‚¹ï¼šæ— æ³•ä¿å­˜æœ€è¿‘ä¸€æ¬¡å¿«ç…§ä¹‹åçš„æ•°æ®</li>
<li>AOFä¼˜ç‚¹ï¼šå¯è¯»æ€§é«˜ï¼Œé€‚åˆä¿å­˜å¢é‡æ•°æ®ï¼Œæ•°æ®ä¸æ˜“ä¸¢å¤±</li>
<li>AOFç¼ºç‚¹ï¼šæ–‡ä»¶ä½“ç§¯å¤§ï¼Œæ¢å¤æ—¶é—´é•¿</li>
</ol>
<hr>
<h3 id="7-ä½¿ç”¨rdb-aofæ··åˆæŒä¹…åŒ–æ–¹å¼">7. ä½¿ç”¨RDB-AOFæ··åˆæŒä¹…åŒ–æ–¹å¼</h3>
<ul>
<li>BGSAVEåšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼ŒAOFåšå¢é‡æŒä¹…åŒ–</li>
</ul>
<h2 id="7-pipeline">7. Pipeline</h2>
<h3 id="1-ä½¿ç”¨pipelineçš„å¥½å¤„">1. ä½¿ç”¨pipelineçš„å¥½å¤„</h3>
<ol>
<li>pipelineå’Œlinuxçš„ç®¡é“ç±»ä¼¼</li>
<li>redisåŸºäºè¯·æ±‚/ç›¸åº”æ¨¡å‹ï¼Œå•ä¸ªè¯·æ±‚å¤„ç†éœ€è¦ä¸€ä¸€åº”ç­”</li>
<li>Pipelineæ‰¹é‡æ‰§è¡ŒæŒ‡ä»¤ï¼ŒèŠ‚çœå¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´</li>
<li>æœ‰é¡ºåºä¾èµ–çš„æŒ‡ä»¤å»ºè®®åˆ†æ‰¹å‘é€</li>
</ol>
<hr>
<h3 id="2-redisçš„åŒæ­¥æœºåˆ¶">2. Redisçš„åŒæ­¥æœºåˆ¶</h3>
<ol>
<li>
<p>ä¸»ä»åŒæ­¥åŸç†ï¼ˆMaster/Slaveï¼‰</p>
<figure data-type="image" tabindex="7"><img src="https://zu3zz.github.io/post-images/1581859218260.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>å…¨åŒæ­¥è¿‡ç¨‹</p>
<ul>
<li>Slaveå‘é€syncå‘½ä»¤åˆ°master</li>
<li>Masterå¯åŠ¨ä¸€ä¸ªåå°è¿›ç¨‹ï¼Œå°†Redisä¸­çš„æ•°æ®å¿«ç…§ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆBGSAVEï¼‰</li>
<li>Masterå°†ä¿å­˜æ•°æ®å¿«ç…§æœŸé—´æ¥æ”¶åˆ°çš„å†™å‘½ä»¤ç¼“å­˜èµ·æ¥</li>
<li>Masterå®Œæˆå†™æ–‡ä»¶æ“ä½œåï¼Œå°†è¯¥æ–‡ä»¶å‘é€ç»™Slave</li>
<li>ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶æ›¿æ¢æ‰æ—§çš„AOFæ–‡ä»¶</li>
<li>Masterå°†è¿™æœŸé—´æ”¶é›†åˆ°çš„å¢é‡å†™å‘½ä»¤å‘é€ç»™Slaveç«¯</li>
</ul>
</li>
<li>
<p>å¢é‡åŒæ­¥è¿‡ç¨‹</p>
<ul>
<li>Masteræ¥æ”¶åˆ°ç”¨æˆ·çš„æ“ä½œæŒ‡ä»¤ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦ä¼ æ’­åˆ°Slave</li>
<li>å°†æ“ä½œè®°å½•è¿½åŠ åˆ°AOFæ–‡ä»¶</li>
<li>å°†æ“ä½œä¼ æ’­åˆ°å…¶ä»–Slaveï¼š
<ol>
<li>å¯¹é½ä¸»ä»åº“</li>
<li>å¾€ç›¸åº”ç¼“å­˜å†™å…¥æŒ‡ä»¤</li>
</ol>
</li>
<li>å°†ç¼“å­˜ä¸­çš„æ•°æ®å‘é€ç»™Slave</li>
</ul>
</li>
<li>
<p>Redis Sentinelï¼ˆRediså“¨å…µï¼‰</p>
<ol>
<li>è§£å†³ä¸»ä»åŒæ­¥Masterå®•æœºåçš„ä¸»ä»åˆ‡æ¢é—®é¢˜ï¼š
<ul>
<li>ç›‘æ§ï¼šæ£€æŸ¥ä¸»ä»æœåŠ¡å™¨æ˜¯å¦è¿è¡Œæ­£å¸¸</li>
<li>æé†’ï¼šé€šè¿‡APIå‘ç®¡ç†å‘˜æˆ–è€…å…¶ä»–åº”ç”¨ç¨‹åºå‘é€æ•…éšœé€šçŸ¥</li>
<li>è‡ªåŠ¨æ•…éšœè¿ç§»ï¼šä¸»ä»åˆ‡æ¢</li>
</ul>
</li>
</ol>
</li>
<li>
<p>æµè¨€åè®®Gossip</p>
<ol>
<li>åœ¨æ‚ä¹±æ— ç« ä¸­å¯»æ±‚ä¸€è‡´</li>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½éšæœºåœ°ä¸å¯¹æ–¹é€šä¿¡ï¼Œæœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹çš„çŠ¶æ€è¾¾æˆä¸€è‡´</li>
<li>ç§å­èŠ‚ç‚¹å®šæœŸéšæœºå‘å…¶ä»–èŠ‚ç‚¹å‘é€èŠ‚ç‚¹åˆ—è¡¨ä»¥åŠéœ€è¦ä¼ æ’­çš„æ¶ˆæ¯</li>
<li>ä¸ä¿è¯ä¿¡æ¯ä¸€å®šä¼šä¼ é€’ç»™æ‰€æœ‰èŠ‚ç‚¹ï¼Œä½†æ˜¯æœ€ç»ˆä¼šè¶‹äºä¸€è‡´</li>
</ol>
</li>
</ol>
<h2 id="8-redisé›†ç¾¤">8. Redisé›†ç¾¤</h2>
<h3 id="1-å¦‚ä½•ä»æµ·é‡æ•°æ®é‡Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€">1. å¦‚ä½•ä»æµ·é‡æ•°æ®é‡Œå¿«é€Ÿæ‰¾åˆ°æ‰€éœ€</h3>
<ul>
<li>åˆ†ç‰‡ï¼šæŒ‰ç…§æŸç§è§„åˆ™å»åˆ’åˆ†æ•°æ®ï¼Œåˆ†æ•£å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Š</li>
</ul>
<hr>
<h3 id="2-redisçš„é›†ç¾¤åŸç†">2. Redisçš„é›†ç¾¤åŸç†</h3>
<ul>
<li>
<p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼šå¯¹ 2^32 å–æ¨¡ï¼Œå°†å“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆè™šæ‹Ÿçš„åœ†ç¯</p>
</li>
<li>
<p>å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œæ‰¾åˆ°æœ€è¿‘çš„HashèŠ‚ç‚¹</p>
<figure data-type="image" tabindex="8"><img src="https://zu3zz.github.io/post-images/1581859268434.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>å¦‚æœæ­¤æ—¶<code>Node C</code>å®•æœº,æ•°æ®éƒ½ä¼šåˆ°<code>Node D</code>ä¸­</p>
</li>
</ul>
<figure data-type="image" tabindex="9"><img src="https://zu3zz.github.io/post-images/1581859274355.png" alt="" loading="lazy"></figure>
<ul>
<li>
<p>æ–°å¢ä¸€å°æœåŠ¡å™¨ <code>Node X</code></p>
<figure data-type="image" tabindex="10"><img src="https://zu3zz.github.io/post-images/1581859282580.png" alt="" loading="lazy"></figure>
</li>
</ul>
<h3 id="3-æ•°æ®å€¾æ–œé—®é¢˜">3. æ•°æ®å€¾æ–œé—®é¢˜</h3>
<ol>
<li>
<p>Hashç¯çš„æ•°æ®å€¾æ–œé—®é¢˜</p>
<figure data-type="image" tabindex="11"><img src="https://zu3zz.github.io/post-images/1581859296841.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹è§£å†³æ•°æ®å€¾æ–œçš„é—®é¢˜ï¼ˆèŠ‚ç‚¹è¿‡å°‘æ—¶æœ‰ç”¨ï¼‰ï¼ˆè®¾ç½®è™šæ‹ŸèŠ‚ç‚¹32ä¸ªï¼‰</p>
<figure data-type="image" tabindex="12"><img src="https://zu3zz.github.io/post-images/1581859303063.png" alt="" loading="lazy"></figure>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ•°æ®åº“é¢è¯•è€ƒç‚¹]]></title>
        <id>https://zu3zz.github.io/post/interview-database/</id>
        <link href="https://zu3zz.github.io/post/interview-database/">
        </link>
        <updated>2020-02-12T10:51:52.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ°è¯¦ç»†è®²è§£æ•°æ®åº“é¢è¯•å¸¸è§é—®é¢˜ï¼ŒåŒ…å«ç´¢å¼•ã€é”ã€äº‹åŠ¡ç­‰å†…å®¹ğŸ°</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ°è¯¦ç»†è®²è§£æ•°æ®åº“é¢è¯•å¸¸è§é—®é¢˜ï¼ŒåŒ…å«ç´¢å¼•ã€é”ã€äº‹åŠ¡ç­‰å†…å®¹ğŸ°</p>
<!-- more -->
<h1 id="æ•°æ®åº“é¢è¯•æ€»ç»“">æ•°æ®åº“é¢è¯•æ€»ç»“</h1>
<h2 id="1-æ¶æ„">1. æ¶æ„</h2>
<h3 id="1-rdbms">1. RDBMS</h3>
<ol>
<li>ç¨‹åºå®ä¾‹
<ul>
<li>å­˜å‚¨ç®¡ç†</li>
<li>ç¼“å­˜æœºåˆ¶</li>
<li>SQLè§£æ</li>
<li>æ—¥å¿—ç®¡ç†</li>
<li>æƒé™åˆ’åˆ†</li>
<li><strong>ç´¢å¼•ç®¡ç†</strong></li>
<li><strong>é”ç®¡ç†</strong></li>
</ul>
</li>
<li>å­˜å‚¨ï¼ˆæ–‡ä»¶ç³»ç»Ÿï¼‰</li>
</ol>
<h2 id="2-ç´¢å¼•">2. ç´¢å¼•</h2>
<ol>
<li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼•ï¼šé¿å…å…¨è¡¨æ‰«æ/å¿«é€ŸæŸ¥è¯¢æ•°æ®</li>
<li>ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼•ï¼šä¸»é”®ã€å”¯ä¸€é”®</li>
<li>ç´¢å¼•çš„æ•°æ®ç»“æ„
<ul>
<li>å»ºç«‹äºŒå‰æŸ¥æ‰¾æ ‘è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾</li>
<li>å»ºç«‹B-Treeç»“æ„è¿›è¡ŒæŸ¥æ‰¾</li>
<li>å»ºç«‹B+-Treeç»“æ„è¿›è¡ŒæŸ¥æ‰¾</li>
<li>å»ºç«‹Hashç»“æ„è¿›è¡ŒæŸ¥æ‰¾</li>
</ul>
</li>
</ol>
<hr>
<h3 id="1-ä¼˜åŒ–ç´¢å¼•">1. ä¼˜åŒ–ç´¢å¼•</h3>
<ol>
<li>
<p>äºŒå‰æŸ¥æ‰¾æ ‘</p>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1581850416812.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>B-Treeï¼ˆlognï¼‰</p>
<ol>
<li>æ ¹èŠ‚ç‚¹è‡³å°‘åŒ…æ‹¬ä¸¤ä¸ªå­©å­</li>
<li>æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå«æœ‰mä¸ªå­©å­ï¼ˆm&gt;=2ï¼‰</li>
<li>é™¤æ ¹èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹å¤–ï¼Œå…¶ä»–æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰ceilï¼ˆm/2ï¼‰ä¸ªå­©å­</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹éƒ½ä½äºåŒä¸€å±‚</li>
</ol>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1581850429749.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>B+æ ‘</p>
<ol>
<li>å®šä¹‰åŸºæœ¬ä¸Bæ ‘ç›¸åŒ</li>
<li>é™¤äº†éå¶å­èŠ‚ç‚¹çš„æŒ‡é’ˆå¿…é¡»ä¸å¶å­ç»“ç‚¹æ•°ç›¸åŒ</li>
<li>éå¶å­èŠ‚ç‚¹çš„å­æ ‘æŒ‡é’ˆP[i]ï¼ŒæŒ‡å‘å…³é”®å­—ç¬¦[K[i]ï¼ŒK[i+1]]çš„å­æ ‘</li>
<li>éå¶å­èŠ‚ç‚¹ä»…ç”¨æ¥ç´¢å¼•ï¼Œæ•°æ®éƒ½ä¿å­˜åœ¨å¶å­ç»“ç‚¹ä¸­</li>
<li>æ‰€æœ‰å¶å­èŠ‚ç‚¹å‡æœ‰ä¸€ä¸ªé“¾æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªå¶å­ç»“ç‚¹</li>
</ol>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1581850440775.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>ä¸ºä»€ä¹ˆB+æ ‘æ›´é€‚åˆç”¨æ¥åšå­˜å‚¨ç´¢å¼•</p>
<ul>
<li>B+æ ‘çš„ç£ç›˜è¯»å†™ä»£ä»·æ›´ä½</li>
<li>B+æ ‘çš„æŸ¥è¯¢æ•ˆç‡æ›´åŠ ç¨³å®š</li>
<li>B+æ ‘æ›´æœ‰åˆ©äºå¯¹æ•°æ®åº“çš„æ‰«æ</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-hashç´¢å¼•">2. Hashç´¢å¼•</h3>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1581850457121.png" alt="" loading="lazy"></figure>
<h4 id="ç¼ºç‚¹">ç¼ºç‚¹ï¼š</h4>
<ol>
<li>ä»…ä»…èƒ½æ»¡è¶³â€œ=â€ï¼Œâ€œIN&quot;ï¼Œä¸èƒ½ä½¿ç”¨èŒƒå›´æŸ¥è¯¢</li>
<li>æ— æ³•è¢«ç”¨æ¥é¿å…æ•°æ®çš„æ’åºæ“ä½œ</li>
<li>ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•é”®æŸ¥è¯¢</li>
<li>ä¸èƒ½é¿å…è¡¨æ‰«æ</li>
<li>é‡åˆ°å¤§é‡Hashå€¼ç›¸ç­‰çš„æƒ…å†µåæ€§èƒ½å¹¶ä¸ä¸€å®šå°±ä¼šæ¯”B-Treeç´¢å¼•é«˜</li>
</ol>
<hr>
<h3 id="3-bitmapç´¢å¼•äº†è§£">3. BitMapç´¢å¼•ï¼ˆäº†è§£ï¼‰</h3>
<ul>
<li>ä½å›¾ç´¢å¼•</li>
</ul>
<hr>
<h3 id="4-å¯†é›†ç´¢å¼•ä¸ç¨€ç–ç´¢å¼•çš„åŒºåˆ«">4. å¯†é›†ç´¢å¼•ä¸ç¨€ç–ç´¢å¼•çš„åŒºåˆ«</h3>
<ul>
<li>å¯†é›†ç´¢å¼•æ–‡ä»¶ä¸­çš„æ¯ä¸ªæœç´¢ç å€¼éƒ½å¯¹åº”ä¸€ä¸ªç´¢å¼•å€¼</li>
<li>ç³»æ•°ç´¢å¼•æ–‡ä»¶åªä¸ºç´¢å¼•ç çš„æŸäº›å€¼å»ºç«‹ç´¢å¼•é¡¹</li>
</ul>
<ol>
<li>å¯¹äºInnoDB
<ol>
<li>è‹¥ä¸€ä¸ªä¸»é”®è¢«å®šä¹‰ï¼Œåˆ™è¯¥ä¸»é”®ä½œä¸ºå¯†é›†ç´¢å¼•</li>
<li>è‹¥æ²¡æœ‰ä¸»é”®è¢«å®šä¹‰ï¼Œè¯¥è¡¨çš„ç¬¬ä¸€ä¸ªå”¯ä¸€éç©ºç´¢å¼•åˆ™ä½œä¸ºå¯†é›†ç´¢å¼•</li>
<li>è‹¥æ²¡æœ‰ï¼Œinnodbå†…éƒ¨ä¼šç”Ÿæˆä¸€ä¸ªéšè—ä¸»é”®ï¼ˆå¯†é›†ç´¢å¼•ï¼‰</li>
<li>éä¸»é”®ç´¢å¼•å­˜å‚¨ç›¸å…³é”®ä½å’Œå…¶å¯¹åº”çš„ä¸»é”®å€¼ï¼ŒåŒ…å«ä¸¤æ¬¡æŸ¥æ‰¾</li>
<li>ç´¢å¼•å’Œæ•°æ®æ˜¯å­˜åœ¨ä¸€èµ·çš„</li>
</ol>
</li>
<li>å¯¹äºMyISAM
<ol>
<li>éƒ½æ˜¯ç¨€ç–ç´¢å¼•</li>
<li>ç´¢å¼•å’Œæ•°æ®æ˜¯åˆ†å¼€çš„</li>
</ol>
</li>
</ol>
<hr>
<h3 id="5-é—®é¢˜å›é¡¾ä¸æ€»ç»“">5. é—®é¢˜å›é¡¾ä¸æ€»ç»“</h3>
<ol>
<li>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç´¢å¼•</li>
<li>ä»€ä¹ˆæ ·çš„ä¿¡æ¯èƒ½æˆä¸ºç´¢å¼•</li>
<li>ç´¢å¼•çš„æ•°æ®ç»“æ„</li>
<li>å¯†é›†ç´¢å¼•å’Œç³»æ•°ç´¢å¼•çš„åŒºåˆ«</li>
</ol>
<hr>
<h3 id="6-ä¸€äº›è¡ç”Ÿé—®é¢˜">6. ä¸€äº›è¡ç”Ÿé—®é¢˜</h3>
<h4 id="61-å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢sql">6.1 å¦‚ä½•å®šä½å¹¶ä¼˜åŒ–æ…¢æŸ¥è¯¢Sql</h4>
<ol>
<li>æ ¹æ®æ…¢æ—¥å¿—å®šä½æ…¢æŸ¥è¯¢sql</li>
<li>ä½¿ç”¨explainç­‰å·¥å…·åˆ†æsql
<ul>
<li>using filesortï¼šæ–‡ä»¶æ’åº ä¸èƒ½ä½¿ç”¨ç´¢å¼•</li>
<li>using temporaryï¼šä½¿ç”¨ä¸´æ—¶è¡¨</li>
</ul>
</li>
<li>ä¿®æ”¹sqlæˆ–è€…å°½é‡è®©sqlèµ°ç´¢å¼•</li>
</ol>
<h4 id="62-è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™çš„æˆå› ">6.2 è”åˆç´¢å¼•çš„æœ€å·¦åŒ¹é…åŸåˆ™çš„æˆå› </h4>
<ul>
<li>MySQLä¼šä¸€ç›´å‘å³åŒ¹é…åˆ°èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ã€betweenã€likeï¼‰å°±åœæ­¢åŒ¹é…</li>
</ul>
<pre><code class="language-sql"> a = 1 and b = 2 and c &gt; 3 and d = 4 
 å¦‚æœé‡åˆ°ï¼ˆa,b,c,d)è¿™æ ·çš„ï¼Œåˆ°cå°±åœæ­¢äº†
</code></pre>
<h4 id="63-ç´¢å¼•æ˜¯å»ºç«‹çš„è¶Šå¤šè¶Šå¥½å—">6.3 ç´¢å¼•æ˜¯å»ºç«‹çš„è¶Šå¤šè¶Šå¥½å—</h4>
<ul>
<li>å¦ã€‚æ•°æ®é‡å°çš„è¡¨ä¸éœ€è¦å»ºç«‹ç´¢å¼•ï¼Œå»ºç«‹æˆ–å¢åŠ é¢å¤–çš„ç´¢å¼•å¼€é”€</li>
<li>æ•°æ®å˜æ›´éœ€è¦ç»´æŠ¤ç´¢å¼•ï¼Œå› æ­¤æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€æ›´å¤šçš„ç»´æŠ¤æˆæœ¬</li>
<li>æ›´å¤šçš„ç´¢å¼•æ„å‘³ç€ä¹Ÿéœ€è¦æ›´å¤šçš„ç©ºé—´</li>
</ul>
<h2 id="3-é”">3. é”</h2>
<h3 id="31-å¸¸è§é—®é¢˜">3.1 å¸¸è§é—®é¢˜</h3>
<ol>
<li>MyISAMä¸InnoDBå…³äºé”æ–¹é¢çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</li>
<li>æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</li>
<li>äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„2çº§åˆ«ä¸‹çš„å¹¶å‘è®¿é—®é—®é¢˜</li>
<li>InnoDBå¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯»</li>
<li>RCã€RRçº§åˆ«ä¸‹çš„InnoDBçš„éé˜»å¡è¯»å¦‚ä½•å®ç°</li>
</ol>
<hr>
<h4 id="1-myisamä¸innodbå…³äºé”æ–¹é¢çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ">1. MyISAMä¸InnoDBå…³äºé”æ–¹é¢çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</h4>
<ol>
<li>MyISAMé»˜è®¤ç”¨çš„æ˜¯è¡¨çº§é”ï¼Œä¸æ”¯æŒè¡Œçº§é”</li>
<li>InnoDBé»˜è®¤ç”¨çš„æ˜¯è¡Œçº§é”ï¼Œä¹Ÿæ”¯æŒè¡¨çº§é”</li>
<li>å†™é” åˆå« æ’å®ƒé”</li>
<li>è¯»é” åˆå« å…±äº«é”</li>
<li>å…ˆè¯»å†å†™ä¸ä¼šè¢«é”</li>
<li>å…ˆå†™å†è¯»ä¼šè¢«é”</li>
</ol>
<figure data-type="image" tabindex="5"><img src="https://zu3zz.github.io/post-images/1581850500524.png" alt="" loading="lazy"></figure>
<h4 id="2-myisamé€‚åˆçš„åœºæ™¯">2. MyISAMé€‚åˆçš„åœºæ™¯</h4>
<ol>
<li>é¢‘ç¹æ‰§è¡Œå…¨è¡¨countè¯­å¥</li>
<li>å¯¹æ•°æ®è¿›è¡Œå¢åˆ æ”¹çš„é¢‘ç‡ä¸æï¼ŒæŸ¥è¯¢éå¸¸é¢‘ç¹</li>
<li>æ²¡æœ‰äº‹åŠ¡</li>
</ol>
<h4 id="3-innodbé€‚åˆçš„åœºæ™¯">3. InnoDBé€‚åˆçš„åœºæ™¯</h4>
<ol>
<li>æ•°æ®å¢åˆ æ”¹æŸ¥éƒ½ç›¸å½“é¢‘ç¹</li>
<li>å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè¦æ±‚æ”¯æŒäº‹åŠ¡</li>
</ol>
<h3 id="32-æ•°æ®åº“é”çš„åˆ†ç±»">3.2 æ•°æ®åº“é”çš„åˆ†ç±»</h3>
<ul>
<li>æŒ‰é”çš„ç²’åº¦åˆ†åŒ–ï¼Œå¯åˆ†ä¸ºè¡¨çº§é”ã€è¡Œçº§é”ã€é¡µçº§é”</li>
<li>æŒ‰é”çš„çº§åˆ«åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºå…±äº«é”ã€æ’å®ƒé”</li>
<li>æŒ‰æ·é”æ–¹å¼åˆ’åˆ†ï¼Œè¯¾åˆ†ä¸ºè‡ªåŠ¨é”ã€æ˜¾å¼é”</li>
<li>æŒ‰æ“ä½œåˆ’åˆ†ï¼Œå¯åˆ†ä¸ºDMLé”ã€DDLé”</li>
<li>æŒ‰ä½¿ç”¨æ–¹å¼åˆ’åˆ†ï¼Œå¯åˆ†ä¸ºä¹è§‚é”ã€æ‚²è§‚é”</li>
</ul>
<h4 id="1-ä¹è§‚é”çš„å®ç°æ–¹å¼">1. ä¹è§‚é”çš„å®ç°æ–¹å¼</h4>
<ul>
<li>åŸºäºæ—¶é—´æˆ³</li>
<li>åŸºäºç‰ˆæœ¬å·ï¼ˆå†™SQLè¯­å¥çš„æ—¶å€™å…ˆæ£€æŸ¥versionï¼‰</li>
</ul>
<h3 id="33-æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§">3.3 æ•°æ®åº“äº‹åŠ¡çš„å››å¤§ç‰¹æ€§</h3>
<ol>
<li>åŸå­æ€§ï¼ˆAtomicï¼‰ï¼šå‘ç”Ÿé”™è¯¯å›æ»š</li>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</li>
<li>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”è¯¥å½±å“åˆ°å…¶ä»–äº‹åŠ¡</li>
<li>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šredo log</li>
</ol>
<h3 id="34-äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„çº§åˆ«ä¸‹çš„å¹¶å‘è®¿é—®é—®é¢˜">3.4 äº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥åŠå„çº§åˆ«ä¸‹çš„å¹¶å‘è®¿é—®é—®é¢˜</h3>
<ol>
<li>æ›´æ–°ä¸¢å¤±ï¼šmysqlæ‰€æœ‰äº‹åŠ¡éš”ç¦»çº§åˆ«åœ¨æ•°æ®åº“å±‚é¢ä¸Šå‡å¯é¿å…</li>
<li>è„è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ï¼šREADâ€”â€”COMMITTEDäº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥ä¸Šå¯é¿å…ï¼ˆMyISAMé»˜è®¤ï¼‰
<ul>
<li>åªèƒ½è¯»åˆ°å…¶ä»–äº‹åŠ¡æäº¤çš„çº§åˆ«ï¼Œå°±ä¸ä¼šé€ æˆé—®é¢˜äº†</li>
</ul>
</li>
<li>ä¸å¯é‡å¤è¯»ï¼šREPEATABLE-READäº‹åŠ¡éš”ç¦»çº§åˆ«ä»¥ä¸Šå¯é¿å…ï¼ˆInnoDBé»˜è®¤ï¼‰</li>
<li>å¹»è¯»ï¼šå¦å¤–ä¸€ä¸ªäº‹åŠ¡å¯¹åŒä¸€ä¸ªæ•°æ®åº“è¿›è¡Œäº†æ’å…¥æˆ–è€…åˆ é™¤æ“ä½œï¼šSERIALIZABLEäº‹åŠ¡éš”ç¦»çº§åˆ«å¯é¿å…</li>
</ol>
<figure data-type="image" tabindex="6"><img src="https://zu3zz.github.io/post-images/1581850513584.png" alt="" loading="lazy"></figure>
<h3 id="35-innodbè¯¾é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯»">3.5 InnoDBè¯¾é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹å¦‚ä½•é¿å…å¹»è¯»</h3>
<ol>
<li>è¡¨è±¡ï¼šå¿«ç…§è¯»ï¼ˆéé˜»å¡è¯»ï¼‰â€”â€”ä¼ªMVCC
<ul>
<li>å½“å‰è¯»ï¼šupdateã€deleteã€insertã€select...lock in share mode</li>
<li>å¿«ç…§è¯»ï¼šä¸åŠ é”çš„éé˜»å¡è¯»ã€select</li>
<li>å†æ¬¡è°ƒç”¨å¿«ç…§è¯»ä¼šå‡ºé—®é¢˜</li>
</ul>
</li>
<li>å†…åœ¨ï¼šnext-keyé”ï¼ˆè¡Œé”+gapé”ï¼‰ï¼ˆæä¸æ‡‚ï¼‰
<ul>
<li>åœ¨Serializableä¸‹ æ˜¯ç”¨çš„è¿™ä¸ª</li>
</ul>
</li>
</ol>
<h3 id="36-rc-rrçº§åˆ«ä¸‹çš„innodbçš„éé˜»å¡è¯»å¦‚ä½•å®ç°">3.6 RCã€RRçº§åˆ«ä¸‹çš„InnoDBçš„éé˜»å¡è¯»å¦‚ä½•å®ç°</h3>
<ol>
<li>æ•°æ®è¡Œé‡Œçš„DB_TRX_IDã€DB_ROLL_PTRã€DB_ROW_IDå­—æ®µ</li>
<li>ä» undoæ—¥å¿— é‡Œæ¢å¤</li>
<li>read view</li>
</ol>
<h2 id="4-è¯­æ³•">4. è¯­æ³•</h2>
<ol>
<li>GROUP BY</li>
<li>HAVING</li>
<li>ç»Ÿè®¡ç›¸å…³ï¼šCOUNTã€SUMã€MAXã€MINã€AVG</li>
</ol>
<h3 id="1-group-byåˆ†ç»„">1. GROUP BYï¼ˆåˆ†ç»„ï¼‰</h3>
<ul>
<li>æ»¡è¶³ â€œselectå­—å¥ä¸­çš„åˆ—åå¿…é¡»ä¸ºåˆ†ç»„åˆ—æˆ–è€…åˆ—å‡½æ•°â€</li>
<li>åˆ—å‡½æ•°å¯¹äºgroup byå­—å¥å®šä¹‰çš„æ¯ä¸ªç»„å„è¿”å›ä¸€ä¸ªç»“æœ</li>
<li>å¦‚æœç”¨group byï¼Œé‚£ä¹ˆä½ çš„Selectè¯­å¥ä¸­é€‰å‡ºçš„åˆ—è¦ä¹ˆæ˜¯ä½ group byé‡Œç”¨åˆ°çš„åˆ—ï¼Œè¦ä¹ˆå°±æ˜¯å¸¦æœ‰ä¹‹å‰æˆ‘ä»¬è¯´çš„å¦‚sum minç­‰åˆ—å‡½æ•°çš„åˆ—ï¼Œå¦‚æœå¸¦ä¸Šå…¶ä»–çš„ï¼Œä¼šæŠ¥é”™ã€‚</li>
</ul>
<h3 id="2-havingè¿‡æ»¤">2. HAVINGï¼ˆè¿‡æ»¤ï¼‰</h3>
<ul>
<li>é€šå¸¸ä¸GROUP BYå­—å¥ä¸€èµ·ä½¿ç”¨</li>
<li>WHEREè¿‡æ»¤è¡Œï¼ŒHAVINGè¿‡æ»¤ç»„</li>
<li>å‡ºç°åœ¨åŒä¸€è¡Œsqlçš„é¡ºåºï¼šWHERE&gt;GROUP BY&gt;HAVING</li>
</ul>
<h3 id="3è‡ªå·±å¤šç»ƒ">3.è‡ªå·±å¤šç»ƒ</h3>
<h2 id="5-myisamä¸innodbåŒºåˆ«">5 MyISAMä¸InnoDBåŒºåˆ«</h2>
<ol>
<li>InnoDBæ”¯æŒäº‹åŠ¡ï¼ŒMyISAMä¸æ”¯æŒï¼Œå¯¹äºInnoDBæ¯ä¸€æ¡SQLè¯­è¨€éƒ½é»˜è®¤å°è£…æˆäº‹åŠ¡ï¼Œè‡ªåŠ¨æäº¤ï¼Œè¿™æ ·ä¼šå½±å“é€Ÿåº¦ï¼Œæ‰€ä»¥æœ€å¥½æŠŠå¤šæ¡SQLè¯­è¨€æ”¾åœ¨beginå’Œcommitä¹‹é—´ï¼Œç»„æˆä¸€ä¸ªäº‹åŠ¡ï¼›</li>
<li>InnoDBæ”¯æŒå¤–é”®ï¼Œè€ŒMyISAMä¸æ”¯æŒã€‚å¯¹ä¸€ä¸ªåŒ…å«å¤–é”®çš„InnoDBè¡¨è½¬ä¸ºMYISAMä¼šå¤±è´¥ï¼›</li>
<li>InnoDBæ˜¯èšé›†ç´¢å¼•ï¼Œä½¿ç”¨B+Treeä½œä¸ºç´¢å¼•ç»“æ„ï¼Œæ•°æ®æ–‡ä»¶æ˜¯å’Œï¼ˆä¸»é”®ï¼‰ç´¢å¼•ç»‘åœ¨ä¸€èµ·çš„ï¼ˆè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰B+Treeç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼‰ï¼Œå¿…é¡»è¦æœ‰ä¸»é”®ï¼Œé€šè¿‡ä¸»é”®ç´¢å¼•æ•ˆç‡å¾ˆé«˜ã€‚ä½†æ˜¯è¾…åŠ©ç´¢å¼•éœ€è¦ä¸¤æ¬¡æŸ¥è¯¢ï¼Œå…ˆæŸ¥è¯¢åˆ°ä¸»é”®ï¼Œç„¶åå†é€šè¿‡ä¸»é”®æŸ¥è¯¢åˆ°æ•°æ®ã€‚å› æ­¤ï¼Œä¸»é”®ä¸åº”è¯¥è¿‡å¤§ï¼Œå› ä¸ºä¸»é”®å¤ªå¤§ï¼Œå…¶ä»–ç´¢å¼•ä¹Ÿéƒ½ä¼šå¾ˆå¤§ã€‚</li>
<li>InnoDBä¸ä¿å­˜è¡¨çš„å…·ä½“è¡Œæ•°ï¼Œæ‰§è¡Œselect count(*) from tableæ—¶éœ€è¦å…¨è¡¨æ‰«æã€‚è€ŒMyISAMç”¨ä¸€ä¸ªå˜é‡ä¿å­˜äº†æ•´ä¸ªè¡¨çš„è¡Œæ•°ï¼Œæ‰§è¡Œä¸Šè¿°è¯­å¥æ—¶åªéœ€è¦è¯»å‡ºè¯¥å˜é‡å³å¯ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼ˆæ³¨æ„ä¸èƒ½åŠ æœ‰ä»»ä½•WHEREæ¡ä»¶ï¼‰</li>
<li>Innodbä¸æ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œè€ŒMyISAMæ”¯æŒå…¨æ–‡ç´¢å¼•ï¼Œåœ¨æ¶‰åŠå…¨æ–‡ç´¢å¼•é¢†åŸŸçš„æŸ¥è¯¢æ•ˆç‡ä¸ŠMyISAMé€Ÿåº¦æ›´å¿«é«˜ï¼›PSï¼š5.7ä»¥åçš„InnoDBæ”¯æŒå…¨æ–‡ç´¢å¼•äº†</li>
<li>MyISAMè¡¨æ ¼å¯ä»¥è¢«å‹ç¼©åè¿›è¡ŒæŸ¥è¯¢æ“ä½œ</li>
<li>InnoDBæ”¯æŒè¡¨ã€è¡Œ(é»˜è®¤)çº§é”ï¼Œè€ŒMyISAMæ”¯æŒè¡¨çº§é”</li>
<li>InnoDBè¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆç”¨æˆ·æ²¡æœ‰æŒ‡å®šçš„è¯ä¼šè‡ªå·±æ‰¾æˆ–ç”Ÿäº§ä¸€ä¸ªä¸»é”®ï¼‰ï¼Œè€ŒMyisamå¯ä»¥æ²¡æœ‰</li>
<li>Innodbå­˜å‚¨æ–‡ä»¶æœ‰frmã€ibdï¼Œè€ŒMyisamæ˜¯frmã€MYDã€MYI
<ul>
<li>Innodbï¼šfrmæ˜¯è¡¨å®šä¹‰æ–‡ä»¶ï¼Œibdæ˜¯æ•°æ®æ–‡ä»¶</li>
<li>Myisamï¼šfrmæ˜¯è¡¨å®šä¹‰æ–‡ä»¶ï¼Œmydæ˜¯æ•°æ®æ–‡ä»¶ï¼Œmyiæ˜¯ç´¢å¼•æ–‡ä»¶</li>
</ul>
</li>
</ol>
<h2 id="6-sqlè¯­å¥çš„ä¼˜åŒ–">6. SQLè¯­å¥çš„ä¼˜åŒ–</h2>
<h4 id="1-å®šä½æ…¢sqlè¯­å¥">1. å®šä½æ…¢SQLè¯­å¥</h4>
<ul>
<li>
<p>å¥½æ…¢è¯¢å¯ä»¥å¸®æˆ‘ä»¬æ‰¾åˆ°æ‰§è¡Œæ…¢çš„ SQLï¼Œåœ¨ä½¿ç”¨å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹ä¸‹æ…¢æŸ¥è¯¢æ˜¯å¦å·²ç»å¼€å¯ï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤å³å¯ï¼š</p>
<pre><code class="language-sql">mysql &gt; show variables like '%slow_query_log';
</code></pre>
</li>
<li>
<p>æˆ‘ä»¬èƒ½çœ‹åˆ° slow_query_log=OFFï¼Œä¹Ÿå°±æ˜¯è¯´æ…¢æŸ¥è¯¢æ—¥å¿—æ­¤æ—¶æ˜¯å…³ä¸Šçš„ã€‚æˆ‘ä»¬å¯ä»¥æŠŠæ…¢æŸ¥è¯¢æ—¥å¿—æ‰“å¼€ï¼Œæ³¨æ„è®¾ç½®å˜é‡å€¼çš„æ—¶å€™éœ€è¦ä½¿ç”¨ globalï¼Œå¦åˆ™ä¼šæŠ¥é”™</p>
<pre><code class="language-sql">mysql &gt; set global slow_query_log='ON';
mysql &gt; set global long_query_time = 3;
</code></pre>
</li>
</ul>
<h4 id="2-ä½¿ç”¨explain">2. ä½¿ç”¨EXPLAIN</h4>
<p>EXPLAIN å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£æ•°æ®è¡¨çš„è¯»å–é¡ºåºã€SELECT å­å¥çš„ç±»å‹ã€æ•°æ®è¡¨çš„è®¿é—®ç±»å‹ã€å¯ä½¿ç”¨çš„ç´¢å¼•ã€å®é™…ä½¿ç”¨çš„ç´¢å¼•ã€ä½¿ç”¨çš„ç´¢å¼•é•¿åº¦ã€ä¸Šä¸€ä¸ªè¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ã€è¢«ä¼˜åŒ–å™¨æŸ¥è¯¢çš„è¡Œçš„æ•°é‡ä»¥åŠé¢å¤–çš„ä¿¡æ¯ï¼ˆæ¯”å¦‚æ˜¯å¦ä½¿ç”¨äº†å¤–éƒ¨æ’åºï¼Œæ˜¯å¦ä½¿ç”¨äº†ä¸´æ—¶è¡¨ç­‰ï¼‰ç­‰ã€‚</p>
<pre><code class="language-sql">EXPLAIN SELECT comment_id, comment_text, user_id FROM product_comment WHERE comment_id = 500000;
</code></pre>
<h4 id="3-ä½¿ç”¨profile">3. ä½¿ç”¨PROFILE</h4>
<ul>
<li>SHOW PROFILE ç›¸æ¯” EXPLAIN èƒ½çœ‹åˆ°æ›´è¿›ä¸€æ­¥çš„æ‰§è¡Œè§£æï¼ŒåŒ…æ‹¬ SQL éƒ½åšäº†ä»€ä¹ˆã€æ‰€èŠ±è´¹çš„æ—¶é—´ç­‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œprofiling æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¼šè¯çº§åˆ«å¼€å¯è¿™ä¸ªåŠŸèƒ½ã€‚</li>
</ul>
<pre><code class="language-sql">mysql &gt; set profiling = 'ON';
mysql &gt; show profiles;
</code></pre>
<ul>
<li>ä¸è¿‡ SHOW PROFILE å‘½ä»¤å°†è¢«å¼ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä» information_schema ä¸­çš„ profiling æ•°æ®è¡¨è¿›è¡ŒæŸ¥çœ‹ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è®¡ç®—æœºç½‘ç»œé¢è¯•è€ƒç‚¹æ€»ç»“]]></title>
        <id>https://zu3zz.github.io/post/interview-network/</id>
        <link href="https://zu3zz.github.io/post/interview-network/">
        </link>
        <updated>2020-02-06T17:00:31.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ±ä¸€æ–‡æ€»ç»“è®¡ç®—æœºç½‘ç»œé¢è¯•å¸¸è§è€ƒç‚¹ï¼ŒåŒ…æ‹¬TCP HTTPç­‰ğŸ±</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ±ä¸€æ–‡æ€»ç»“è®¡ç®—æœºç½‘ç»œé¢è¯•å¸¸è§è€ƒç‚¹ï¼ŒåŒ…æ‹¬TCP HTTPç­‰ğŸ±</p>
<!-- more -->
<h1 id="è®¡ç®—æœºç½‘ç»œé¢è¯•è€ƒç‚¹æ€»ç»“">è®¡ç®—æœºç½‘ç»œé¢è¯•è€ƒç‚¹æ€»ç»“</h1>
<h2 id="1-tcpçš„ä¸‰æ¬¡æ¡æ‰‹">1. TCPçš„ä¸‰æ¬¡æ¡æ‰‹</h2>
<ol>
<li>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œå»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYNåŒ…ï¼ŒSYN=jåˆ°æœåŠ¡å™¨ï¼Œå¹¶ä¸”è¿›å…¥SYN_SENDçŠ¶æ€ï¼Œç­‰åˆ°æœåŠ¡å™¨ç¡®è®¤</li>
<li>æœåŠ¡å™¨æ”¶åˆ°SYNåŒ…ï¼Œå¿…é¡»ç¡®è®¤å®¢æˆ·çš„SYNå€¼ï¼ˆack=j+1ï¼‰ï¼ŒåŒæ—¶è‡ªå·±ä¹Ÿå‘é€ä¸€ä¸ªSYNåŒ…ï¼ŒSYN=Kï¼Œçº§SYN + ACKåŒ…ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¹Ÿè¿›å…¥SYN_SENDçŠ¶æ€</li>
<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨ç«¯çš„SYN+ACKåŒ…ï¼Œå‘æœåŠ¡å™¨å‘é€ç¡®è®¤åŒ…ACKï¼ˆack = k + 1ï¼‰ï¼Œæ­¤åŒ…å‘é€å®Œæ¯•ä¹‹åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½è¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œä¸‰æ¬¡æ¡æ‰‹å®Œæˆã€‚</li>
</ol>
<h4 id="11-ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹">1.1 ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹</h4>
<ul>
<li>ä¸ºäº†åˆå§‹åŒ–Seqence Numberçš„åˆå§‹å€¼ï¼Œç”¨äºæ‹¼æ¥æ•°æ®</li>
</ul>
<h4 id="12-synè¶…æ—¶">1.2 SYNè¶…æ—¶</h4>
<ul>
<li>ä¸æ–­é‡è¯•ï¼ŒLinuxé»˜è®¤63ç§’</li>
</ul>
<h4 id="13-é’ˆå¯¹syn-flood">1.3 é’ˆå¯¹Syn Flood</h4>
<ul>
<li>
<p>syné˜Ÿåˆ—æ»¡äº†ä¹‹åï¼Œé€šè¿‡tcp_syncookieså‚æ•°å›å‘ SYN Cookie</p>
</li>
<li>
<p>è‹¥æ­£å¸¸è¿æ¥åˆ™Clinetä¼šå›å‘SYN Cookieï¼Œç›´æ¥å»ºç«‹è¿æ¥</p>
</li>
</ul>
<h4 id="14-clientå‡ºç°æ•…éšœ">1.4 Clientå‡ºç°æ•…éšœ</h4>
<ul>
<li>å‘å¯¹æ–¹å‘é€ä¿æ´»æ¢æµ‹æŠ¥æ–‡</li>
</ul>
<h2 id="2-tcpå››æ¬¡æŒ¥æ‰‹">2. TCPå››æ¬¡æŒ¥æ‰‹</h2>
<ol>
<li>Clientå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³ç³»Clientåˆ°Serverçš„æ•°æ®ä¼ é€ï¼ŒClientè¿›å…¥FIN_WAIT_1çŠ¶æ€</li>
<li>Serveræ”¶åˆ°FINä¹‹åï¼Œå‘é€ä¸€ä¸ªACKç»™Clientï¼Œç¡®è®¤éœ€è¦ä¸ºæ”¶åˆ°åºå·+1ï¼ˆä¸SYNç›¸åŒï¼Œä¸€ä¸ªFINå ç”¨ä¸€ä¸ªåºå·ï¼‰ï¼ŒServerè¿›å…¥CLOSE_WAITçŠ¶æ€</li>
<li>Serverå‘é€ä¸€ä¸ªFINï¼Œç”¨æ¥å…³é—­Serveråˆ°Clientçš„æ•°æ®ä¼ é€ï¼ŒServerè¿›å…¥LAST_ACKçŠ¶æ€</li>
<li>Clientæ”¶åˆ°FINä¹‹åï¼ŒClientè¿›å…¥TIME_WAITçŠ¶æ€ï¼Œæ¥ç€å‘é€ä¸€ä¸ªACKç»™Serverï¼Œç¡®è®¤åºå·ä¸ºæ”¶åˆ°åºå·+1ï¼ŒServerè¿›å…¥CLOSEDçŠ¶æ€ï¼Œå®Œæˆå››æ¬¡æŒ¥æ‰‹ã€‚</li>
</ol>
<h2 id="3-tcpå’Œudp">3. TCPå’ŒUDP</h2>
<ol>
<li>é¢å‘éè¿æ¥ï¼Œæ²¡æœ‰å¿«é‡ä¼ ç­‰ã€‚</li>
<li>ä¸ç»´æŠ¤è¿æ¥çŠ¶æ€ï¼Œæ”¯æŒåŒæ—¶å‘å¤šä¸ªå®¢æˆ·ç«¯ä¼ è¾“ç›¸åŒçš„æ¶ˆæ¯</li>
<li>æ•°æ®åŒ…æŠ¥å¤´åªæœ‰8ä¸ªå­—èŠ‚</li>
<li>é¢å‘æŠ¥æ–‡</li>
<li>å°½æœ€å¤§åŠªåŠ›äº¤ä»˜</li>
</ol>
<hr>
<h3 id="31-åŒºåˆ«">3.1 åŒºåˆ«</h3>
<ol>
<li>é¢å‘è¿æ¥ vs æ— è¿æ¥</li>
<li>å¯é æ€§</li>
<li>æœ‰åºæ€§</li>
<li>é€Ÿåº¦</li>
<li>é‡çº§</li>
</ol>
<hr>
<h3 id="32-æ»‘åŠ¨çª—å£åè®®">3.2 æ»‘åŠ¨çª—å£åè®®</h3>
<ol>
<li>RTT: å‘é€æ•°æ®åŒ…åˆ°æ”¶åˆ°å¯¹åº”çš„ACKï¼Œæ‰€èŠ±è´¹çš„æ—¶é—´</li>
<li>RTO: é‡ä¼ æ—¶é—´é—´éš”</li>
<li>ä½¿ç”¨æ»‘åŠ¨çª—å£åšæµé‡æ§åˆ¶ä¸ä¹±åºé‡æ‹
<ul>
<li>ä¿è¯TCPçš„å¯é æ€§</li>
<li>ä¿è¯TCPçš„æµé‡æ§åˆ¶ç‰¹æ€§</li>
</ul>
</li>
</ol>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1581008533854.png" alt="" loading="lazy"></figure>
<h2 id="4-http11">4. HTTP(1.1)</h2>
<h3 id="1-ä¸»è¦ç‰¹ç‚¹">1. ä¸»è¦ç‰¹ç‚¹</h3>
<ol>
<li>æ”¯æŒå®¢æˆ·/æœåŠ¡å™¨æ¨¡å¼</li>
<li>ç®€å•å¿«é€Ÿ</li>
<li>çµæ´»</li>
<li>æ— è¿æ¥</li>
</ol>
<hr>
<h3 id="2-è¯·æ±‚ç›¸åº”çš„æ­¥éª¤">2. è¯·æ±‚/ç›¸åº”çš„æ­¥éª¤</h3>
<ol>
<li>å®¢æˆ·ç«¯è¿æ¥åˆ°WebæœåŠ¡å™¨</li>
<li>å‘é€HTTPè¯·æ±‚</li>
<li>æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶è¿”å›HTTPç›¸åº”</li>
<li>é‡Šæ”¾è¿æ¥TCPè¿æ¥</li>
<li>å®¢æˆ·ç«¯æµè§ˆå™¨è§£æHTMLå†…å®¹</li>
</ol>
<hr>
<h3 id="3-è¾“å…¥urlä¹‹åæŒ‰ä¸‹å›è½¦ä¹‹åç»è¿‡çš„æµç¨‹">3. è¾“å…¥URLä¹‹åï¼ŒæŒ‰ä¸‹å›è½¦ä¹‹åç»è¿‡çš„æµç¨‹</h3>
<ol>
<li>DNSè§£æ æ‰¾å¯¹å¯¹åº”çš„IPåœ°å€</li>
<li>TCPè¿æ¥</li>
<li>å‘é€HTTPè¯·æ±‚</li>
<li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›HTTPæŠ¥æ–‡</li>
<li>æœåŠ¡å™¨è§£ææ¸²æŸ“é¡µé¢</li>
<li>è¿æ¥ç»“æŸ</li>
</ol>
<hr>
<h3 id="4-httpçŠ¶æ€ç ">4. HTTPçŠ¶æ€ç </h3>
<ul>
<li>äº”ç§å¯èƒ½å–å€¼
<ul>
<li>1xxï¼šæŒ‡ç¤ºä¿¡æ¯--è¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç†</li>
<li>2xxï¼šæˆåŠŸ--è¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€</li>
<li>3xxï¼šé‡å®šå‘--è¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œ</li>
<li>4xxï¼šå®¢æˆ·ç«¯é”™è¯¯--è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è€…è¯·æ±‚æ— æ³•å®ç°</li>
<li>5xxï¼šæœåŠ¡å™¨ç«¯é”™è¯¯--æœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚</li>
</ul>
</li>
<li>å¸¸è§çŠ¶æ€ç 
<ul>
<li>200 OKï¼šæ­£å¸¸ è¿”å›ä¿¡æ¯</li>
<li>400 Bad Requestï¼šå®¢æˆ·ç«¯è¯·æ±‚æœ‰è¯­æ³•é”™è¯¯ï¼Œä¸èƒ½è¢«æœåŠ¡å™¨æ‰€ç†è§£</li>
<li>401 Unauthorizedï¼šè¯·æ±‚æœªç»æˆæƒï¼Œè¿™ä¸ªçŠ¶æ€ç å¿…é¡»å’ŒWWW-AuthenticateæŠ¥å¤´åŸŸä¸€èµ·ä½¿ç”¨</li>
<li>403 Forbiddenï¼šæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æä¾›æœåŠ¡</li>
<li>404 Not Foundï¼šè¯·æ±‚èµ„æºä¸å­˜åœ¨ï¼Œegï¼Œè¾“å…¥äº†é”™è¯¯çš„URL</li>
<li>500 Internal Server Errorï¼šæœåŠ¡å™¨å‘ç”Ÿä¸å¯é¢„æœŸçš„é”™è¯¯</li>
<li>503 Server Unabailableï¼šæœåŠ¡å™¨å½“å‰ä¸èƒ½å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä¸€æ®µæ—¶é—´åå¯èƒ½æ¢å¤æ­£å¸¸</li>
</ul>
</li>
</ul>
<hr>
<h3 id="5-getå’Œpostè¯·æ±‚çš„åŒºåˆ«">5. GETå’ŒPOSTè¯·æ±‚çš„åŒºåˆ«</h3>
<h4 id="1-ä»ä¸‰ä¸ªå±‚é¢æ¥è§£ç­”">1. ä»ä¸‰ä¸ªå±‚é¢æ¥è§£ç­”</h4>
<ol>
<li>HttpæŠ¥æ–‡å±‚é¢ï¼šGETå°†è¯·æ±‚ä¿¡æ¯ï¼ˆé”®å€¼å¯¹ï¼‰æ”¾åˆ°URLä¸­ï¼ŒPOSTåˆ™æ”¾åœ¨æŠ¥æ–‡ä½“ä¸­</li>
<li>æ•°æ®åº“å±‚é¢ï¼šGETç¬¦åˆå¹‚ç­‰æ€§å’Œå®‰å…¨æ€§ï¼ŒPOSTä¸ç¬¦åˆï¼ˆä¸¤ä¸ªéƒ½ä¸ç¬¦åˆï¼‰</li>
<li>å…¶ä»–å±‚é¢ï¼šGETå¯ä»¥è¢«ç¼“å­˜ã€è¢«å­˜å‚¨ï¼Œè€ŒPOSTä¸è¡Œ</li>
</ol>
<hr>
<h3 id="6-cookieå’Œsessionçš„åŒºåˆ«">6. Cookieå’ŒSessionçš„åŒºåˆ«</h3>
<h4 id="cookieç®€ä»‹">Cookieç®€ä»‹</h4>
<ul>
<li>æ˜¯ç”±æœåŠ¡å™¨å‘ç»™å®¢æˆ·ç«¯çš„ç‰¹æ®Šä¿¡æ¯ï¼Œä»¥æ–‡æœ¬çš„å½¢å¼å­˜æ”¾åœ¨å®¢æˆ·ç«¯</li>
<li>å®¢æˆ·ç«¯å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œä¼šå§Cookieå›å‘</li>
<li>æœåŠ¡å™¨æ¥æ”¶åˆ°åï¼Œä¼šè§£æCookieç”Ÿæˆä¸å®¢æˆ·ç«¯ç›¸å¯¹åº”çš„å†…å®¹</li>
</ul>
<h4 id="cookieçš„è®¾ç½®ä»¥åŠå‘é€è¿‡ç¨‹">Cookieçš„è®¾ç½®ä»¥åŠå‘é€è¿‡ç¨‹</h4>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1581008546981.png" alt="" loading="lazy"></figure>
<h4 id="sessionç®€ä»‹">Sessionç®€ä»‹</h4>
<ul>
<li>æœåŠ¡å™¨ç«¯çš„æœºåˆ¶ï¼Œåœ¨æœåŠ¡å™¨ä¸Šä¿å­˜çš„ä¿¡æ¯ï¼ˆç±»ä¼¼hashè¡¨ï¼‰</li>
<li>è§£æå®¢æˆ·ç«¯è¯·æ±‚å¹¶æ“ä½œsession idï¼ŒæŒ‰éœ€ä¿å­˜çŠ¶æ€ä¿¡æ¯</li>
</ul>
<h4 id="sessionçš„å®ç°æ–¹å¼">Sessionçš„å®ç°æ–¹å¼</h4>
<ol>
<li>ä½¿ç”¨Cookieæ¥å®ç°ï¼šæœåŠ¡å™¨ç»™å®¢æˆ·ç«¯ä¸€ä¸ªJSessionID</li>
<li>ä½¿ç”¨URLå›å†™æ¥å®ç°</li>
</ol>
<h4 id="cookieå’Œsessionçš„åŒºåˆ«">Cookieå’ŒSessionçš„åŒºåˆ«</h4>
<ol>
<li>Cookieæ•°æ®å­˜æ”¾åœ¨å®¢æˆ·çš„æµè§ˆå™¨ä¸Šï¼ŒSessionæ•°æ®æ”¾åœ¨æœåŠ¡å™¨ä¸Š</li>
<li>Sessionç›¸å¯¹äºCookieæ›´å®‰å…¨</li>
<li>è‹¥è€ƒè™‘å‡è½»æœåŠ¡å™¨è´Ÿæ‹…ï¼Œåº”å½“ä½¿ç”¨Cookie</li>
</ol>
<h2 id="5-httpå’Œhttpsçš„åŒºåˆ«">5 HTTPå’ŒHTTPSçš„åŒºåˆ«</h2>
<h3 id="1-httpsç®€ä»‹">1. HTTPSç®€ä»‹</h3>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1581008556887.png" alt="" loading="lazy"></figure>
<hr>
<h3 id="2-sslsecurity-sockets-layer-å®‰å…¨å¥—æ¥å±‚">2. SSLï¼ˆSecurity Sockets Layer, å®‰å…¨å¥—æ¥å±‚ï¼‰</h3>
<ol>
<li>ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨ä»¥åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®</li>
<li>æ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–çš„APIï¼ŒSSL3.0åæ›´åä¸ºTLS</li>
<li>é‡‡ç”¨èº«ä»½éªŒè¯å’Œæ•°æ®åŠ å¯†ä¿è¯ç½‘ç»œé€šä¿¡çš„å®‰å…¨å’Œæ•°æ®çš„å®Œæ•´æ€§</li>
</ol>
<hr>
<h3 id="3-åŠ å¯†æ–¹å¼">3. åŠ å¯†æ–¹å¼</h3>
<ol>
<li>å¯¹ç§°åŠ å¯†ï¼šåŠ å¯†å’Œè§£å¯†éƒ½ä½¿ç”¨åŒä¸€ä¸ªå¯†é’¥</li>
<li>éå¯¹ç§°åŠ å¯†ï¼šåŠ å¯†ä½¿ç”¨çš„å¯†é’¥å’Œè§£å¯†ä½¿ç”¨çš„å¯†é’¥æ˜¯ä¸ç›¸åŒçš„</li>
<li>å“ˆå¸Œç®—æ³•ï¼šå°†ä»»æ„é•¿åº¦çš„ä¿¡æ¯è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„å€¼ï¼Œç®—æ³•ä¸å¯é€†</li>
<li>æ•°å­—ç­¾åï¼šè¯æ˜æŸä¸ªä¿¡æ¯æˆ–è€…æ–‡ä»¶æ˜¯æŸä¸ªäººå‘å‡º/è®¤åŒçš„</li>
</ol>
<hr>
<h3 id="4-æ•°æ®ä¼ è¾“æµç¨‹">4. æ•°æ®ä¼ è¾“æµç¨‹</h3>
<ol>
<li>æµè§ˆå™¨å°†æ”¯æŒçš„åŠ å¯†ç®—æ³•ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨é€‰æ‹©ä¸€å¥—æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œä»¥è¯ä¹¦çš„å½¢å¼å›å‘æµè§ˆå™¨</li>
<li>æµè§ˆå™¨éªŒè¯è¯ä¹¦åˆæ³•æ€§ï¼Œå¹¶ç»“åˆè¯ä¹¦å…¬é’¥åŠ å¯†ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†ä¿¡æ¯ï¼ŒéªŒè¯å“ˆå¸Œï¼ŒåŠ å¯†å“åº”æ¶ˆæ¯å›å‘æµè§ˆå™¨</li>
<li>æµè§ˆå™¨è§£å¯†å“åº”ä¿¡æ¯ï¼Œå¹¶å¯¹æ¶ˆæ¯è¿›è¡ŒéªŒè¯ï¼Œä¹‹åå°±ç”¨åŒä¸€å¥—ç§˜é’¥è¿›è¡ŒåŠ å¯†äº¤æ¢</li>
</ol>
<hr>
<h3 id="5-httpå’Œhttpsçš„åŒºåˆ«-2">5. HTTPå’ŒHTTPSçš„åŒºåˆ«</h3>
<ol>
<li>HTTPSéœ€è¦åˆ°CAç”³è¯·è¯ä¹¦ï¼ŒHTTPä¸éœ€è¦</li>
<li>HTTPSå¯†æ–‡ä¼ è¾“ï¼ŒHTTPæ˜æ–‡ä¼ è¾“</li>
<li>è¿æ¥æ–¹å¼ä¸åŒï¼ŒHTTPSé»˜è®¤ä½¿ç”¨443ç«¯å£ï¼ŒHTTPä½¿ç”¨80ç«¯å£</li>
<li>HTTPS = HTTP+åŠ å¯†+è®¤è¯+å®Œæ•´æ€§ä¿æŠ¤ï¼Œè¾ƒHTTPå®‰å…¨</li>
</ol>
<hr>
<h3 id="6-æ½œåœ¨å±é™©">6. æ½œåœ¨å±é™©</h3>
<ol>
<li>æµè§ˆå™¨é»˜è®¤å¡«å……httpï¼š// ï¼Œè¯·æ±‚éœ€è¦è¿›è¡Œè·³è½¬ï¼Œåˆè¢«åŠ«æŒçš„é£é™©</li>
<li>å¯ä»¥ä½¿ç”¨HSTSï¼ˆHTTP Strict Transport Securityï¼‰ä¼˜åŒ–</li>
</ol>
<h2 id="6-socket">6. Socket</h2>
<ul>
<li>Socketæ˜¯å¯¹TCP/IPåè®®çš„æŠ½è±¡ï¼Œæ˜¯æ“ä½œç³»ç»Ÿå¯¹å¤–å¼€æ”¾çš„æ¥å£</li>
</ul>
<h3 id="1-socketé€šä¿¡æµç¨‹">1. Socketé€šä¿¡æµç¨‹</h3>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1581008567663.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SparkSQLå®æˆ˜ç¬”è®°ï¼ˆ2ï¼‰---- SparkSQL æ¦‚è¿°]]></title>
        <id>https://zu3zz.github.io/post/sparksql-2/</id>
        <link href="https://zu3zz.github.io/post/sparksql-2/">
        </link>
        <updated>2020-01-14T11:46:21.000Z</updated>
        <content type="html"><![CDATA[<h1 id="sparksql-å®æˆ˜ç¬”è®°2-sparksql-æ¦‚è¿°">SparkSQL å®æˆ˜ç¬”è®°ï¼ˆ2ï¼‰---- SparkSQL æ¦‚è¿°</h1>
<p>##1. ä¸ºä»€ä¹ˆéœ€è¦ SQLï¼Ÿ</p>
<ol>
<li>
<p>äº‹å®ä¸Šçš„æ ‡å‡†</p>
<ul>
<li>
<p>MySQL/Oracle/DB2... RBDMS å…³ç³»å‹æ•°æ®åº“ æ˜¯ä¸æ˜¯è¿‡æ—¶å‘¢ï¼Ÿ</p>
</li>
<li>
<p>æ•°æ®è§„æ¨¡ å¤§æ•°æ®çš„å¤„ç†</p>
<pre><code class="language-shell">MRï¼šJava
Sparkï¼šScalaã€Javaã€Python
</code></pre>
</li>
<li>
<p>ç›´æ¥ä½¿ç”¨ SQL è¯­å¥æ¥å¯¹æ•°æ®è¿›è¡Œå¤„ç†åˆ†æå‘¢ï¼Ÿ ç¬¦åˆå¸‚åœºçš„éœ€æ±‚</p>
<pre><code class="language-shell">Hive SparkSQL Impala...
</code></pre>
</li>
<li>
<p>å—ä¼—é¢å¤§ã€å®¹æ˜“ä¸Šæ‰‹ã€æ˜“å­¦æ˜“ç”¨:<code>DDL DML</code></p>
<pre><code class="language-shell"># access.logæ—¥å¿—
1,zhangsan,10,beijing
2,lisi,11,shanghai
3,wangwu,12,shenzhen
</code></pre>
</li>
<li>
<p><code>table: Hive/Spark SQL/Impala</code> ï¼šå…±äº«å…ƒæ•°æ®</p>
<ul>
<li>name: access</li>
<li>columns: id int,name string,age int,city string</li>
</ul>
<pre><code class="language-mysql">SQL: select xxx from access where ... group by ... having....
</code></pre>
</li>
</ul>
</li>
</ol>
<h2 id="2-sql-on-hadoop">2. SQL on Hadoop</h2>
<ol>
<li>
<p>ä½¿ç”¨ SQL è¯­å¥å¯¹å¤§æ•°æ®è¿›è¡Œç»Ÿè®¡åˆ†æï¼Œæ•°æ®æ˜¯åœ¨ Hadoop</p>
</li>
<li>
<p><code>Apache Hive</code></p>
<ul>
<li>SQL è½¬æ¢æˆä¸€ç³»åˆ—å¯ä»¥åœ¨ Hadoop ä¸Šè¿è¡Œçš„ MapReduce/Tez/Spark ä½œä¸š</li>
<li>SQL åˆ°åº•åº•å±‚æ˜¯è¿è¡Œåœ¨å“ªç§åˆ†å¸ƒå¼å¼•æ“ä¹‹ä¸Šçš„ï¼Œæ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ªå‚æ•°æ¥è®¾ç½®</li>
<li>åŠŸèƒ½ï¼š
<ul>
<li>SQLï¼šå‘½ä»¤è¡Œã€ä»£ç </li>
<li>å¤šè¯­è¨€ Apache Thrift é©±åŠ¨</li>
<li>è‡ªå®šä¹‰çš„ UDF å‡½æ•°ï¼šæŒ‰ç…§æ ‡å‡†æ¥å£å®ç°ï¼Œæ‰“åŒ…ï¼ŒåŠ è½½åˆ° Hive ä¸­</li>
<li>å…ƒæ•°æ®</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Cloudera Impala</code></p>
<ul>
<li>ä½¿ç”¨äº†è‡ªå·±çš„æ‰§è¡Œå®ˆæŠ¤è¿›ç¨‹é›†åˆï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™äº›è¿›ç¨‹æ˜¯éœ€è¦ä¸ Hadoop DN å®‰è£…åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</li>
<li>åŠŸèƒ½ï¼š
<ul>
<li>92 SQL æ”¯æŒ</li>
<li>Hive æ”¯æŒ</li>
<li>å‘½ä»¤è¡Œã€ä»£ç </li>
<li>ä¸ Hive èƒ½å¤Ÿå…±äº«å…ƒæ•°æ®</li>
<li>æ€§èƒ½æ–¹é¢æ˜¯ Hive è¦å¿«é€Ÿä¸€äº›ï¼ŒåŸºäºå†…å­˜</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Spark SQL</code></p>
<ul>
<li>
<p>Spark ä¸­çš„ä¸€ä¸ªå­æ¨¡å—ï¼Œæ˜¯ä¸æ˜¯ä»…ä»…åªç”¨ SQL æ¥å¤„ç†å‘¢ï¼Ÿ</p>
<pre><code class="language-shell">$ Hiveï¼šSQL ==&gt; MapReduce
</code></pre>
</li>
<li>
<p><code>Spark</code>ï¼šèƒ½ä¸èƒ½ç›´æ¥æŠŠ SQL è¿è¡Œåœ¨ Spark å¼•æ“ä¹‹ä¸Šå‘¢ï¼Ÿ</p>
<ol>
<li><code>Shark</code>ï¼š <code>SQL==&gt;Spark</code> ï¼ˆä¸å†ç»´æŠ¤ï¼‰
<ul>
<li>ä¼˜ç‚¹ï¼šå¿« ä¸ Hive èƒ½å¤Ÿå…¼å®¹</li>
<li>ç¼ºç‚¹ï¼šæ‰§è¡Œè®¡åˆ’ä¼˜åŒ–å®Œå…¨ä¾èµ–äº Hive è¿›ç¨‹ vs çº¿ç¨‹</li>
<li>ä½¿ç”¨ï¼šéœ€è¦ç‹¬ç«‹ç»´æŠ¤ä¸€ä¸ªæ‰“äº†è¡¥ä¸çš„ Hive æºç åˆ†æ”¯</li>
</ul>
</li>
<li><code>Spark SQL</code>: è¿™æ˜¯ Spark é¡¹ç›®ä¸­çš„<code>SQL</code>å­é¡¹ç›®</li>
</ol>
</li>
</ul>
</li>
<li>
<p><code>Hive on Spark</code> ï¼š è¿™æ˜¯<code>Hive</code>é¡¹ç›®ä¸­çš„ï¼Œé€šè¿‡åˆ‡æ¢ Hive çš„æ‰§è¡Œå¼•æ“å³å¯ï¼Œåº•å±‚æ·»åŠ äº† Spark æ‰§è¡Œå¼•æ“çš„æ”¯æŒ</p>
</li>
<li>
<p><code>Presto</code></p>
<ul>
<li>äº¤äº’å¼æŸ¥è¯¢å¼•æ“ SQL</li>
<li>åŠŸèƒ½ï¼š
<ul>
<li>å…±äº«å…ƒæ•°æ®ä¿¡æ¯</li>
<li>92 SQL è¯­æ³•</li>
<li>æä¾›äº†ä¸€ç³»åˆ—çš„è¿æ¥å™¨ï¼Œ<code>Hive</code> <code>Cassandra</code>...</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Drill</code></p>
<ol>
<li>HDFSã€Hiveã€Spark SQL</li>
<li>æ”¯æŒå¤šç§åç«¯å­˜å‚¨ï¼Œç„¶åç›´æ¥è¿›è¡Œå„ç§åç«¯æ•°æ®çš„å¤„ç†</li>
<li>æœªæ¥çš„è¶‹åŠ¿</li>
</ol>
</li>
<li>
<p><code>Phoenix</code></p>
<ol>
<li>HBase çš„æ•°æ®ï¼Œæ˜¯è¦åŸºäº API è¿›è¡ŒæŸ¥è¯¢</li>
<li>Phoenix ä½¿ç”¨ SQL æ¥æŸ¥è¯¢ HBase ä¸­çš„æ•°æ®</li>
<li>ä¸»è¦ç‚¹ï¼šå¦‚æœæƒ³æŸ¥è¯¢çš„å¿«çš„è¯ï¼Œè¿˜æ˜¯å–å†³äº ROWKEY çš„è®¾è®¡</li>
</ol>
</li>
</ol>
<h2 id="3-spark-sql-æ˜¯ä»€ä¹ˆ">3. Spark SQL æ˜¯ä»€ä¹ˆ</h2>
<h3 id="31-spark-sql-æ¦‚å¿µ">3.1 Spark SQL æ¦‚å¿µ</h3>
<ol>
<li>
<p>Spark SQL is Apache Spark's module for working with structured data.</p>
<ul>
<li>è¯¯åŒºä¸€ï¼šSpark SQL å°±æ˜¯ä¸€ä¸ª SQL å¤„ç†æ¡†æ¶</li>
</ul>
<ol>
<li>
<p>é›†æˆæ€§ï¼šåœ¨ Spark ç¼–ç¨‹ä¸­æ— ç¼å¯¹æ¥å¤šç§å¤æ‚çš„ SQL</p>
</li>
<li>
<p>ç»Ÿä¸€çš„æ•°æ®è®¿é—®æ–¹å¼ï¼šä»¥ç±»ä¼¼çš„æ–¹å¼è®¿é—®å¤šç§ä¸åŒçš„æ•°æ®æºï¼Œè€Œä¸”å¯ä»¥è¿›è¡Œç›¸å…³æ“ä½œ</p>
<pre><code class="language-scala">spark.read.format(&quot;json&quot;).load(path)
spark.read.format(&quot;text&quot;).load(path)
spark.read.format(&quot;parquet&quot;).load(path)
spark.read.format(&quot;json&quot;).option(&quot;...&quot;,&quot;...&quot;).load(path)
</code></pre>
</li>
<li>
<p>å…¼å®¹ Hive</p>
<ul>
<li>allowing you to access existing Hive warehouses</li>
<li>å¦‚æœä½ æƒ³æŠŠ Hive çš„ä½œä¸šè¿ç§»åˆ° Spark SQLï¼Œè¿™æ ·çš„è¯ï¼Œè¿ç§»æˆæœ¬å°±ä¼šä½å¾ˆå¤š</li>
</ul>
</li>
<li>
<p>æ ‡å‡†çš„æ•°æ®è¿æ¥ï¼šæä¾›æ ‡å‡†çš„<code>JDBC/ODBC</code>è¿æ¥æ–¹å¼åˆ° Server ä¸Š</p>
</li>
</ol>
</li>
<li>
<p>Spark SQL åº”ç”¨å¹¶ä¸å±€é™äº SQL</p>
<ol>
<li>è¿˜æ”¯æŒ Hiveã€JSONã€Parquet æ–‡ä»¶çš„ç›´æ¥è¯»å–ä»¥åŠæ“ä½œ</li>
<li>SQL ä»…ä»…æ˜¯ Spark SQL ä¸­çš„ä¸€ä¸ªåŠŸèƒ½è€Œå·²</li>
</ol>
</li>
<li>
<p>ä¸ºä»€ä¹ˆè¦å­¦ä¹  Spark SQL</p>
<ol>
<li>SQL å¸¦æ¥çš„ä¾¿åˆ©æ€§</li>
<li>Spark Coreï¼š RDD Scala/Java
<ul>
<li>éœ€è¦ç†Ÿæ‚‰ Javaã€Scala è¯­è¨€</li>
</ul>
</li>
<li>Spark SQL
<ul>
<li>Catalyst ä¸ºæˆ‘ä»¬è‡ªåŠ¨åšäº†å¾ˆå¤šçš„ä¼˜åŒ–å·¥ä½œ</li>
<li>SQL(åªè¦äº†è§£ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åä½¿ç”¨ SQL æ¥å®ç°)</li>
<li>DF/DSï¼šé¢å‘ API ç¼–ç¨‹çš„ï¼Œä½¿ç”¨ä¸€äº› Java/Scala</li>
</ul>
</li>
</ol>
</li>
</ol>
<h3 id="32-spark-sql-æ¶æ„">3.2 Spark SQL æ¶æ„</h3>
<h4 id="321-å‰ç«¯frontend">3.2.1 å‰ç«¯ï¼ˆFrontEndï¼‰</h4>
<ol>
<li>
<p>Hive AST : SQL è¯­å¥ï¼ˆå­—ç¬¦ä¸²ï¼‰==&gt; æŠ½è±¡è¯­æ³•æ ‘</p>
</li>
<li>
<p>Spark Program : DF/DS API</p>
</li>
<li>
<p>Streaming SQL</p>
</li>
<li>
<p>Catalyst</p>
<ul>
<li>Unresolved LogicPlan</li>
</ul>
<pre><code class="language-mysql">select empno, ename from emp
</code></pre>
</li>
<li>
<p>Schema Catalog å’Œ MetaStore</p>
</li>
<li>
<p>LogicPlan</p>
</li>
<li>
<p>Optimized LogicPlan</p>
<pre><code class="language-mysql">select * from (select ... from xxx limit 10) limit 5;
å°†æˆ‘ä»¬çš„SQLä½œç”¨ä¸Šå¾ˆå¤šå†…ç½®çš„Ruleï¼Œä½¿å¾—æˆ‘ä»¬æ‹¿åˆ°çš„é€»è¾‘æ‰§è¡Œè®¡åˆ’æ˜¯æ¯”è¾ƒå¥½çš„
</code></pre>
<p><code>Physical Plan</code></p>
</li>
</ol>
<h4 id="322-åç«¯backend">3.2.2 åç«¯ï¼ˆBackendï¼‰</h4>
<ol>
<li>
<p><code>spark-shell</code></p>
<ul>
<li>æ¯ä¸ª Spark åº”ç”¨ç¨‹åºï¼ˆspark-shellï¼‰åœ¨ä¸åŒç›®å½•ä¸‹å¯åŠ¨ï¼Œå…¶å®åœ¨è¯¥ç›®å½•ä¸‹æ˜¯æœ‰ metastore_db</li>
<li>å•ç‹¬çš„</li>
<li>å¦‚æœä½ æƒ³ spark-shell å…±äº«æˆ‘ä»¬çš„å…ƒæ•°æ®çš„è¯ï¼Œè‚¯å®šè¦æŒ‡å®šå…ƒæ•°æ®ä¿¡æ¯==&gt; åç»­è®² Spark SQL æ•´åˆ Hive çš„æ—¶å€™è®²è§£</li>
<li><code>spark.sql</code>(sql è¯­å¥)</li>
</ul>
</li>
<li>
<p>spark-sql çš„ä½¿ç”¨<br>
spark-shell ä½ ä¼šå‘ç°å¦‚æœè¦æ“ä½œ SQL ç›¸å…³çš„ä¸œè¥¿ï¼Œè¦ä½¿ç”¨ spark.sql(sql è¯­å¥)</p>
<pre><code class="language-mysql">explain extended
select a.key\*(3+5), b.value from t a join t b on a.key = b.key and a.key &gt; 3;
</code></pre>
<ul>
<li>ä¼˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥æŠŠä¸€äº›æ¡ä»¶è¿‡æ»¤å‰ç½®</li>
</ul>
</li>
<li>
<p>spark-shell å¯åŠ¨æµç¨‹åˆ†æ</p>
<ul>
<li>
<p>REPL: Read-Eval-Print Loop è¯»å–-æ±‚å€¼-è¾“å‡º</p>
</li>
<li>
<p>æä¾›ç»™ç”¨æˆ·å³æ—¶äº¤äº’ä¸€ä¸ªå‘½ä»¤çª—å£</p>
<pre><code class="language-mysql">case \$å˜é‡å in
æ¨¡å¼ 1
command1
;;
æ¨¡å¼ 2
command2
;;
\*)
default
;;
esac
</code></pre>
</li>
<li>
<p>spark-shell åº•å±‚è°ƒç”¨çš„æ˜¯ spark-submit</p>
</li>
<li>
<p>spark-submit åº•å±‚è°ƒç”¨çš„æ˜¯ spark-class</p>
</li>
</ul>
</li>
<li>
<p><strong>spark-sql æ‰§è¡Œæµç¨‹åˆ†æ</strong></p>
<ul>
<li>spark-sql åº•å±‚è°ƒç”¨çš„ä¹Ÿæ˜¯ spark-submit</li>
<li>å› ä¸º spark-sql å®ƒå°±æ˜¯ä¸€ä¸ª Spark åº”ç”¨ç¨‹åºï¼Œå’Œ spark-shell ä¸€æ ·</li>
<li>å¯¹äºä½ æƒ³å¯åŠ¨ä¸€ä¸ª Spark åº”ç”¨ç¨‹åºï¼Œè‚¯å®šè¦å€ŸåŠ©äº spark-submit è¿™è„šæœ¬è¿›è¡Œæäº¤</li>
<li>spark-sql è°ƒç”¨çš„ç±»æ˜¯<code>org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver</code></li>
<li>spark-shell è°ƒç”¨çš„ç±»æ˜¯ <code>org.apache.spark.repl.Main</code></li>
</ul>
</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SparkSQLå®æˆ˜ç¬”è®°ï¼ˆ1ï¼‰---- éƒ¨ç½²ã€é¡¹ç›®å‡†å¤‡]]></title>
        <id>https://zu3zz.github.io/post/sparksql-1/</id>
        <link href="https://zu3zz.github.io/post/sparksql-1/">
        </link>
        <updated>2020-01-13T08:43:13.000Z</updated>
        <content type="html"><![CDATA[<h1 id="sparksqlå®æˆ˜ç¬”è®°1-éƒ¨ç½²-é¡¹ç›®å‡†å¤‡">SparkSQLå®æˆ˜ç¬”è®°ï¼ˆ1ï¼‰---- éƒ¨ç½²ã€é¡¹ç›®å‡†å¤‡</h1>
<h2 id="1-å…³äºmapreduceçš„é—®é¢˜">1. å…³äºMapReduceçš„é—®é¢˜</h2>
<ul>
<li>
<p>MapReduceçš„æ§½ç‚¹ä¸€</p>
<ul>
<li>
<p>éœ€æ±‚ï¼šç»Ÿè®¡å•è¯å‡ºç°çš„ä¸ªæ•°ï¼ˆè¯é¢‘ç»Ÿè®¡ï¼‰</p>
<ul>
<li>
<p>fileä¸­æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°</p>
<pre><code class="language-txt">hello,hello,hello
world,world
pk
</code></pre>
</li>
</ul>
</li>
</ul>
<ol>
<li>è¯»å–fileä¸­æ¯ä¸€è¡Œçš„æ•°æ®</li>
<li>æŒ‰ç…§åˆ†éš”ç¬¦æŠŠæ¯ä¸€è¡Œçš„å†…å®¹è¿›è¡Œæ‹†åˆ†</li>
<li>æŒ‰ç…§ç›¸åŒçš„keyåˆ†å‘åˆ°åŒä¸€ä¸ªä»»åŠ¡ä¸Šå»è¿›è¡Œç´¯åŠ çš„æ“ä½œ</li>
</ol>
<ul>
<li>
<p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¸èƒ½å†ç®€å•çš„ä¸€ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦å¼€å‘å¾ˆå¤šçš„ä»£ç </p>
<ol>
<li>è‡ªå®šä¹‰Mapper</li>
<li>è‡ªå®šä¹‰Reducer</li>
<li>é€šè¿‡DriveræŠŠMapperå’ŒReducerä¸²èµ·æ¥</li>
<li>æ‰“åŒ…ï¼Œä¸Šä¼ åˆ°é›†ç¾¤ä¸Šå»</li>
<li>åœ¨é›†ç¾¤ä¸Šæäº¤æˆ‘ä»¬çš„wcç¨‹åº</li>
</ol>
</li>
<li>
<p>ä¸€å¥è¯ï¼šå°±æ˜¯ä¼šèŠ±è´¹éå¸¸å¤šçš„æ—¶é—´åœ¨éä¸šåŠ¡é€»è¾‘æ”¹åŠ¨çš„å·¥ä½œä¸Š</p>
</li>
</ul>
</li>
<li>
<p>MapReduceåæ§½ç‚¹äºŒ</p>
<pre><code class="language-shell">Input =&gt; MapReduce ==&gt; Output ==&gt; MapReduce ==&gt; Output
</code></pre>
</li>
<li>
<p>å›é¡¾ä¸‹MapReduceæ‰§è¡Œæµç¨‹ï¼š</p>
<ul>
<li>MapTaskæˆ–è€…ReduceTaskéƒ½æ˜¯è¿›ç¨‹çº§åˆ«</li>
<li>ç¬¬ä¸€ä¸ªMRçš„è¾“å‡ºè¦å…ˆè½åœ°ï¼Œç„¶åç¬¬äºŒä¸ªMRæŠŠç¬¬ä¸€ä¸ªMRçš„è¾“å‡ºå½“åšè¾“å…¥</li>
<li>ä¸­é—´è¿‡ç¨‹çš„æ•°æ®æ˜¯è¦è½åœ°</li>
</ul>
</li>
</ul>
<h2 id="2-spark">2. Spark</h2>
<ol>
<li>
<p>ç‰¹æ€§</p>
<ol>
<li>
<p>Speed:</p>
<ul>
<li>
<p>both batch and streaming data</p>
</li>
<li>
<p>æ‰¹æµä¸€ä½“ Spark Flink</p>
</li>
</ul>
</li>
<li>
<p>Ease of Use</p>
<ul>
<li>high-level operators</li>
</ul>
</li>
<li>
<p>Generality</p>
<ul>
<li>stack  æ ˆ   ç”Ÿæ€</li>
</ul>
</li>
<li>
<p>Runs Everywhere</p>
<ul>
<li>It can access diverse data sources</li>
<li>YARN/Local/Standalone Sparkåº”ç”¨ç¨‹åºçš„ä»£ç éœ€è¦æ”¹åŠ¨å—ï¼Ÿ</li>
<li>--masteræ¥æŒ‡å®šä½ çš„Sparkåº”ç”¨ç¨‹åºå°†è¦è¿è¡Œåœ¨ä»€ä¹ˆæ¨¡å¼ä¸‹</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="3-éƒ¨ç½²é—®é¢˜">3. éƒ¨ç½²é—®é¢˜</h2>
<h3 id="31-jdkéƒ¨ç½²">3.1 <code>JDK</code>éƒ¨ç½²</h3>
<ul>
<li>
<p>ä¸‹è½½ï¼šhttps://www.oracle.com/index.html</p>
</li>
<li>
<p>æœåŠ¡å™¨ç«¯ï¼š</p>
<ul>
<li>
<p>ä¸‹è½½linuxç‰ˆæœ¬çš„jdk</p>
</li>
<li>
<p>è§£å‹ï¼š<code>tar -zxvf jdk-8u91-linux-x64.tar.gz -C ~/app</code></p>
</li>
<li>
<p>é…ç½®ç¯å¢ƒå˜é‡ï¼š <code>~/.bash_profile</code></p>
<pre><code class="language-shell">export JAVA_HOME=/home/hadoop/app/jdk1.8.0_91
export PATH=$JAVA_HOME/bin:$PATH
</code></pre>
</li>
<li>
<p>ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š<code>source ~/.bash_profile</code></p>
</li>
</ul>
</li>
<li>
<p>å®¢æˆ·ç«¯ï¼šWin/Mac/Linux</p>
<ul>
<li>Mac/Linuxï¼šå°±å’ŒæœåŠ¡å™¨ç«¯å®‰è£…æ–¹æ³•ä¸€è‡´</li>
</ul>
</li>
</ul>
<h3 id="32-mavenå’Œideaéƒ¨ç½²">3.2 <code>Maven</code>å’Œ<code>IDEA</code>éƒ¨ç½²</h3>
<ol>
<li>
<p>Mavenï¼šIDEA+Mavenæ¥ç®¡ç†åº”ç”¨ç¨‹åº</p>
<ul>
<li>ä¸ºä»€ä¹ˆä½ å¼€å‘çš„æ—¶å€™ä¸ç›´æ¥æ‹·è´jaråŒ…å‘¢ï¼Ÿ</li>
<li>åœ¨mavenä¸­çš„pom.xmlä¸­æ·»åŠ æˆ‘ä»¬æ‰€éœ€è¦çš„dependencyå°±è¡Œ</li>
</ul>
</li>
<li>
<p>å®˜ç½‘ï¼šmaven.apache.org</p>
<ul>
<li>
<p><code>wget http://mirrors.tuna.tsinghua.edu.cn/apache/maven/maven-3/3.6.1/binaries/apache-maven-3.6.1-bin.tar.gz</code></p>
</li>
<li>
<p>è§£å‹ï¼š<code>tar -zxvf apache-maven-3.6.1-bin.tar.gz -C ~/app/</code></p>
</li>
<li>
<p>é…ç½®ç¯å¢ƒå˜é‡ï¼š<code>~/.bash_profile</code></p>
<pre><code class="language-shell">export MAVEN_HOME=/home/hadoop/app/apache-maven-3.6.1
export PATH=$MAVEN_HOME/bin:$PATH
</code></pre>
</li>
<li>
<p>ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼š<code>source ~/.bash_profile</code></p>
</li>
<li>
<p>æœåŠ¡å™¨ç«¯ï¼šä½ æ˜¯éœ€è¦è¿›è¡Œä½¿ç”¨mavenæ¥ç¼–è¯‘æˆ‘ä»¬çš„spark</p>
</li>
<li>
<p>å®¢æˆ·ç«¯ï¼šWin/Mac/Linux</p>
</li>
<li>
<p>æˆ‘ä»¬å¼€å‘åº”ç”¨ç¨‹åºæ˜¯åœ¨æœ¬åœ°/æœ¬æœºï¼ŒIDEA+Mavenï¼Œæ‰€ä»¥æœ¬åœ°ä¹Ÿæ˜¯éœ€è¦å®‰è£…mavençš„</p>
</li>
<li>
<p>æœ¬åœ°Win/Mac/Linuxçš„mavenå®‰è£…æ–¹å¼å’ŒæœåŠ¡å™¨ç«¯æ˜¯ä¸€æ¨¡ä¸€æ ·çš„</p>
</li>
<li>
<p>å¦‚æœä½ æ˜¯winç”¨æˆ·ï¼Œä¸€å®šè¦æ³¨æ„: $MAVEN_HOME/conf/setting.xml</p>
<pre><code class="language-xml">&lt;!-- localRepository
	   | The path to the local repository maven will use to store artifacts.
	   |
	   | Default: ${user.home}/.m2/repository
	  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;
	  --&gt;
</code></pre>
</li>
<li>
<p>Winç”¨æˆ·ï¼Œé»˜è®¤æ˜¯åœ¨Cç›˜ï¼Œæ‰€ä»¥å»ºè®®å¤§å®¶æ›´æ”¹Mavenæœ¬åœ°ä»“åº“çš„è·¯å¾„</p>
</li>
</ul>
</li>
<li>
<p>IDEAå®˜ç½‘ï¼šhttp://www.jetbrains.com/</p>
</li>
</ol>
<h3 id="33-hadoopéƒ¨ç½²">3.3 <code>Hadoop</code>éƒ¨ç½²</h3>
<h4 id="331-ä½¿ç”¨cdh-cdh5151">3.3.1 ä½¿ç”¨<code>CDH</code> <code>cdh5.15.1</code></h4>
<ul>
<li>
<p>ä¸‹è½½åœ°å€ï¼šhttps://archive.cloudera.com/cdh5/cdh/5/</p>
</li>
<li>
<p>Hadoopï¼š<code>wget https://archive.cloudera.com/cdh5/cdh/5/hadoop-2.6.0-cdh5.15.1.tar.gz</code></p>
</li>
<li>
<p>è§£å‹ï¼š<code>tar -zxvf hadoop-2.6.0-cdh5.15.1.tar.gz -C ~/app/</code></p>
</li>
<li>
<p>ä¿®æ”¹<code>hadoop-env.sh</code></p>
<pre><code class="language-shell">export JAVA_HOME=/home/hadoop/app/jdk1.8.0_91
</code></pre>
</li>
<li>
<p>ä¿®æ”¹core-site.xml</p>
<pre><code class="language-xml">&lt;property&gt;
	&lt;name&gt;fs.default.name&lt;/name&gt;
	&lt;value&gt;hdfs://hadoop000:8020&lt;/value&gt;
&lt;/property&gt;
</code></pre>
</li>
<li>
<p>ä¿®æ”¹hdfs-site.xml</p>
<pre><code class="language-xml">&lt;property&gt;
	&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;
	&lt;value&gt;/home/hadoop/tmp/dfs/data&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
	&lt;name&gt;dfs.replication&lt;/name&gt;
	&lt;value&gt;1&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
	&lt;name&gt;dfs.permissions&lt;/name&gt;
	&lt;value&gt;false&lt;/value&gt;
&lt;/property&gt;
</code></pre>
</li>
<li>
<p>ä¿®æ”¹yarn-site.xml</p>
<pre><code class="language-xml">&lt;property&gt;
	&lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
	&lt;value&gt;mapreduce_shuffle&lt;/value&gt;
&lt;/property&gt;
</code></pre>
</li>
<li>
<p>ä¿®æ”¹mapred-site.xml</p>
<pre><code class="language-xml">&lt;property&gt;
	&lt;name&gt;mapreduce.framework.name&lt;/name&gt;
	&lt;value&gt;yarn&lt;/value&gt;
&lt;/property&gt;
</code></pre>
</li>
<li>
<p>ä¿®æ”¹slavesï¼ˆå¯é€‰ï¼‰</p>
<ul>
<li>hadoop000</li>
</ul>
</li>
<li>
<p>é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
<pre><code class="language-shell">export HADOOP_HOME=/home/hadoop/app/hadoop-2.6.0-cdh5.15.1
export PATH=$HADOOP_HOME/bin:$PATH
</code></pre>
</li>
<li>
<p>é…ç½®SSHçš„å…å¯†ç ç™»å½•</p>
</li>
<li>
<p>åœ¨å¯åŠ¨HDFSä¹‹å‰ï¼Œä¸€å®šè¦å…ˆå¯¹HDFSå¯¹æ ¼å¼åŒ–</p>
<ul>
<li>åˆ‡è®°ï¼šæ ¼å¼åŒ–åªä¼šä¸€æ¬¡ï¼Œå› ä¸ºä¸€æ—¦æ ¼å¼åŒ–äº†ï¼Œé‚£ä¹ˆHDFSä¸Šçš„æ•°æ®å°±æ²¡äº†</li>
<li>æ ¼å¼åŒ–å‘½ä»¤ï¼š<code>hdfs namenode -format</code></li>
</ul>
</li>
<li>
<p>å¯åŠ¨HDFS</p>
<ol>
<li>
<p>é€ä¸ªè¿›ç¨‹å¯åŠ¨/åœæ­¢</p>
<pre><code class="language-shell">$ hadoop-daemon.sh start/stop namenode
$ hadoop-daemon.sh start/stop datanode
</code></pre>
<ul>
<li>jpséªŒè¯</li>
<li>å¦‚æœå‘ç°æœ‰ç¼ºå¤±çš„è¿›ç¨‹ï¼Œé‚£ä¹ˆå°±æ‰¾ç¼ºå¤±è¿›ç¨‹çš„åç§°å¯¹åº”çš„æ—¥å¿—(logè€Œä¸æ˜¯out)</li>
</ul>
</li>
<li>
<p>ä¸€é”®å¼å¯åŠ¨HDFS</p>
<pre><code class="language-shell">$ start-dfs.sh
$ stop-dfs.sh
</code></pre>
</li>
</ol>
</li>
</ul>
<h3 id="34-hiveéƒ¨ç½²">3.4 Hiveéƒ¨ç½²</h3>
<ol>
<li>
<p>Hadoopï¼šwget https://archive.cloudera.com/cdh5/cdh/5/hive-1.1.0-cdh5.15.1.tar.gz</p>
</li>
<li>
<p>ç³»ç»Ÿç¯å¢ƒå˜é‡</p>
<pre><code class="language-shell">export HIVE_HOME=/home/hadoop/app/hive-1.1.0-cdh5.15.1
export PATH=$HIVE_HOME/bin:$PATH
</code></pre>
</li>
<li>
<p>éœ€è¦å®‰è£…<code>MySQL</code> ä¸<code>yum</code></p>
<ul>
<li>
<p>éœ€è¦æ‹·è´MySQLçš„é©±åŠ¨$HIVE_HOME/lib  ç‰ˆæœ¬5.x</p>
</li>
<li>
<p>ä¿®æ”¹<code>$HIVE_HOME/conf/hive-site.xml</code>æ–‡ä»¶</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;

&lt;configuration&gt;
&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
  &lt;value&gt;jdbc:mysql://localhost:3306/pk?createDatabaseIfNotExist=true&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
  &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
  &lt;value&gt;root&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
  &lt;value&gt;root&lt;/value&gt;
&lt;/property&gt;

&lt;/configuration&gt;
</code></pre>
</li>
</ul>
</li>
<li>
<p>Hive: HDFSä¸Šçš„æ•°æ® + MySQLä¸­å…ƒæ•°æ®ä¿¡æ¯</p>
</li>
</ol>
<h2 id="4-sparkè¿è¡Œæ¨¡å¼">4. Sparkè¿è¡Œæ¨¡å¼</h2>
<ol>
<li>localï¼šæœ¬åœ°è¿è¡Œï¼Œåœ¨å¼€å‘ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯¥æ¨¡å¼è¿›è¡Œ<strong>æµ‹è¯•</strong>æ˜¯éå¸¸æ–¹ä¾¿çš„</li>
<li>standaloneï¼šHadoopéƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹çš„ï¼ŒåŒç†Sparkå¯ä»¥éƒ¨ç½²å¤šä¸ªèŠ‚ç‚¹  <strong>ç”¨çš„ä¸å¤š</strong></li>
<li>YARNï¼šå°†Sparkä½œä¸šæäº¤åˆ°Hadoop(YARN)é›†ç¾¤ä¸­è¿è¡Œï¼ŒSparkä»…ä»…åªæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯è€Œå·² <strong>æœ€å¤šçš„ç”¨æ³•</strong></li>
<li>Mesosï¼šä¸å¸¸ç”¨</li>
<li>K8Sï¼š2.3ç‰ˆæœ¬æ‰æ­£å¼ç¨å¾®ç¨³å®š   æ˜¯æœªæ¥æ¯”è¾ƒå¥½çš„ä¸€ä¸ªæ–¹å‘</li>
<li>è¡¥å……ï¼šè¿è¡Œæ¨¡å¼å’Œä»£ç æ²¡æœ‰ä»»ä½•å…³ç³»ï¼ŒåŒä¸€ä»½ä»£ç å¯ä»¥ä¸åšä¿®æ”¹è¿è¡Œåœ¨ä¸åŒçš„è¿è¡Œæ¨¡å¼ä¸‹</li>
</ol>
<h2 id="5-æ„å»ºåº”ç”¨">5. æ„å»ºåº”ç”¨</h2>
<ol>
<li>
<p>ä½¿ç”¨<code>IDEA</code>+<code>Maven</code>æ¥æ„å»ºæˆ‘ä»¬çš„Sparkåº”ç”¨</p>
</li>
<li>
<p>åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä¸€ä¸‹<code>MAVEN</code>å‘½ä»¤</p>
<pre><code class="language-shell">mvn archetype:generate -DarchetypeGroupId=net.alchim31.maven \
-DarchetypeArtifactId=scala-archetype-simple \
-DremoteRepositories=http://scala-tools.org/repo-releases \
-DarchetypeVersion=1.5 \
-DgroupId=com.imooc.bigdata \
-DartifactId=sparksql-train \
-Dversion=1.0
</code></pre>
</li>
<li>
<p>æ‰“å¼€IDEAï¼ŒæŠŠè¿™ä¸ªé¡¹ç›®ä¸­çš„pom.xmlæ‰“å¼€å³å¯</p>
</li>
<li>
<p>åŒæ—¶ï¼Œåœ¨<code>pom.xml</code>ä¸­æ·»åŠ ä¸€ä¸‹ç›¸å…³é…ç½®</p>
<pre><code class="language-xml">pom.xml
&lt;properties&gt;
    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;encoding&gt;UTF-8&lt;/encoding&gt;
    &lt;scala.tools.version&gt;2.11&lt;/scala.tools.version&gt;
    &lt;scala.version&gt;2.11.8&lt;/scala.version&gt;
    &lt;spark.version&gt;2.4.3&lt;/spark.version&gt;
    &lt;hadoop.version&gt;2.6.0-cdh5.15.1&lt;/hadoop.version&gt;
&lt;/properties&gt;	

æ·»åŠ CDHçš„ä»“åº“
&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;cloudera&lt;/id&gt;
        &lt;url&gt;https://repository.cloudera.com/artifactory/cloudera-repos&lt;/url&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;

æ·»åŠ Spark SQLå’ŒHadoop Clientçš„ä¾èµ–
&lt;!--Spark SQLä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;
    &lt;artifactId&gt;spark-sql_2.11&lt;/artifactId&gt;
    &lt;version&gt;${spark.version}&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- Hadoopç›¸å…³ä¾èµ–--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.hadoop&lt;/groupId&gt;
    &lt;artifactId&gt;hadoop-client&lt;/artifactId&gt;
    &lt;version&gt;${hadoop.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</li>
</ol>
<h2 id="6-å®æˆ˜è¯é¢‘ç»Ÿè®¡æ¡ˆä¾‹">6. å®æˆ˜ï¼šè¯é¢‘ç»Ÿè®¡æ¡ˆä¾‹</h2>
<ol>
<li>
<p>è¾“å…¥ï¼šæ–‡ä»¶</p>
<ul>
<li>éœ€æ±‚ï¼šç»Ÿè®¡å‡ºæ–‡ä»¶ä¸­æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°
<ol>
<li>è¯»æ¯ä¸€è¡Œæ•°æ®</li>
<li>æŒ‰ç…§åˆ†éš”ç¬¦æŠŠæ¯ä¸€è¡Œçš„æ•°æ®æ‹†æˆå•è¯</li>
<li>æ¯ä¸ªå•è¯èµ‹ä¸Šæ¬¡æ•°ä¸º1</li>
<li>æŒ‰ç…§å•è¯è¿›è¡Œåˆ†å‘ï¼Œç„¶åç»Ÿè®¡å•è¯å‡ºç°çš„æ¬¡æ•°</li>
<li>æŠŠç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ä¸­</li>
</ol>
</li>
</ul>
</li>
<li>
<p>è¾“å‡ºï¼šæ–‡ä»¶</p>
</li>
<li>
<p>ä½¿ç”¨localæ¨¡å¼è¿è¡Œspark-shell</p>
<pre><code class="language-shell">./spark-shell --master local
</code></pre>
<ul>
<li>
<p>æ‰“åŒ…æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œè®©å…¶è¿è¡Œåœ¨localæ¨¡å¼ä¸‹</p>
</li>
<li>
<p>å¦‚ä½•è¿è¡ŒjaråŒ…å‘¢ï¼Ÿ</p>
</li>
</ul>
<pre><code class="language-shell">./spark-submit \
--class  com.imooc.bigdata.chapter02.SparkWordCountAppV2 \
--master local \
/home/hadoop/lib/sparksql-train-1.0.jar \
file:///home/hadoop/data/wc.data file:///home/hadoop/data/out 
</code></pre>
<ul>
<li>ä½¿ç”¨localæ¨¡å¼çš„è¯ï¼Œä½ åªéœ€è¦æŠŠsparkçš„å®‰è£…åŒ…è§£å‹å¼€ï¼Œä»€ä¹ˆéƒ½ä¸ç”¨åŠ¨ï¼Œå°±èƒ½ä½¿ç”¨</li>
</ul>
</li>
<li>
<p>å¦‚ä½•æäº¤Sparkåº”ç”¨ç¨‹åºåˆ°YARNä¸Šæ‰§è¡Œ</p>
<pre><code class="language-shell">./spark-submit \
--class  com.imooc.bigdata.chapter02.SparkWordCountAppV2 \
--master yarn \
--name SparkWordCountAppV2 \
/home/hadoop/lib/sparksql-train-1.0.jar \
hdfs://hadoop000:8020/pk/wc.data hdfs://hadoop000:8020/pk/out
</code></pre>
</li>
<li>
<p>è¦å°†Sparkåº”ç”¨ç¨‹åºè¿è¡Œåœ¨YARNä¸Šï¼Œä¸€å®šè¦é…ç½®<code>HADOOP_CONF_DIR</code>æˆ–è€…<code>YARN_CONF_DIR</code></p>
<p>æŒ‡å‘<code>$HADOOP_HOME/etc/conf</code></p>
</li>
<li>
<p>localå’ŒYARNæ¨¡å¼ï¼šé‡ç‚¹æŒæ¡</p>
</li>
<li>
<p>Standaloneï¼šäº†è§£</p>
<ul>
<li>
<p>å¤šä¸ªæœºå™¨ï¼Œé‚£ä¹ˆä½ æ¯ä¸ªæœºå™¨éƒ½éœ€è¦éƒ¨ç½²spark</p>
</li>
<li>
<p>ç›¸å…³é…ç½®ï¼š</p>
<pre><code class="language-shell">$SPARK_HOME/conf/slaves
	hadoop000
SPARK_HOME/conf/spark-env.sh
	SPARK_MASTER_HOST=hadoop000
</code></pre>
</li>
<li>
<p>å¯åŠ¨Sparké›†ç¾¤</p>
<pre><code class="language-shell">$SPARK_HOME/sbin/start-all.sh
jpsï¼š Master  Worker
</code></pre>
</li>
<li>
<p>sparkæäº¤ä½œä¸š</p>
<pre><code class="language-shell">./spark-submit \
--class  com.imooc.bigdata.chapter02.SparkWordCountAppV2 \
--master spark://hadoop000:7077 \
--name SparkWordCountAppV2 \
/home/hadoop/lib/sparksql-train-1.0.jar \
hdfs://hadoop000:8020/pk/wc.data hdfs://hadoop000:8020/pk/out2
</code></pre>
</li>
<li>
<p>ä¸ç®¡ä»€ä¹ˆè¿è¡Œæ¨¡å¼ï¼Œä»£ç ä¸ç”¨æ”¹å˜ï¼Œåªéœ€è¦åœ¨<code>spark-submit</code>è„šæœ¬æäº¤æ—¶</p>
<p>é€šè¿‡<code>--master xxx</code> æ¥è®¾ç½®ä½ çš„è¿è¡Œæ¨¡å¼å³å¯</p>
</li>
</ul>
</li>
</ol>
<h2 id="7-å®æˆ˜ä»£ç ">7. å®æˆ˜ä»£ç </h2>
<ul>
<li><code>Scala</code>ç‰ˆæœ¬</li>
</ul>
<pre><code class="language-scala">package com.zth.bigdata.examples
import org.apache.spark.{SparkConf, SparkContext}
/**
 * Author: 3zZ.
 * Date: 2020/1/13 3:14 ä¸‹åˆ
 */
object SparkWordCountApp {
  def main(args: Array[String]): Unit = {
    /**
     * master: è¿è¡Œæ¨¡å¼ local
     */
    val sparkConf = new SparkConf().setMaster(&quot;local&quot;).setAppName(&quot;SparkWordCountApp&quot;)
    val sc = new SparkContext(sparkConf)

    val rdd = sc.textFile(&quot;/Users/3zz/Code/Spark/spark-sql-train/data/input.txt&quot;)
    /**
     * æŒ‰ç…§å•è¯ä¸ªæ•°è¿›è¡Œé™åºæ’åˆ—
     */
    rdd.flatMap(_.split(&quot;,&quot;)).map((_, 1))
      .reduceByKey(_ + _).map(x =&gt; (x._2, x._1))
      .sortByKey(false).map(x =&gt;(x._2,x._1))
      .collect().foreach(println)
    //      .saveAsTextFile(&quot;/Users/3zz/Code/Spark/spark-sql-train/data/out&quot;).
    sc.stop()
  }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HBaseå­¦ä¹ ç¬”è®° ---- æ•´åˆç¯‡]]></title>
        <id>https://zu3zz.github.io/post/hbase-1/</id>
        <link href="https://zu3zz.github.io/post/hbase-1/">
        </link>
        <updated>2020-01-11T15:54:39.000Z</updated>
        <content type="html"><![CDATA[<h1 id="hbase">Hbase</h1>
<h2 id="1-æ•°æ®å­˜å‚¨">1. æ•°æ®å­˜å‚¨</h2>
<h3 id="11-rdbms">1.1 RDBMS:</h3>
<ol>
<li>
<p>Data is typed structured before stored</p>
</li>
<li>
<p>ä¼ ç»ŸSQL</p>
<table>
<thead>
<tr>
<th>data</th>
<th>location</th>
</tr>
</thead>
<tbody>
<tr>
<td>entity</td>
<td>table</td>
</tr>
<tr>
<td>record</td>
<td>row</td>
</tr>
<tr>
<td>query</td>
<td>group by ã€join</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>å¤§æ•°æ®æ—¶ä»£ï¼Œå¦‚ä½•åšå®æ—¶æŸ¥è¯¢ï¼Ÿ</p>
</li>
<li>
<p>hadoop/HDFSï¼šèƒ½å­˜ æ²¡æ³•è¿›è¡Œå®æ—¶æŸ¥è¯¢ï¼Œéšæœºè¯»å†™</p>
</li>
<li>
<p>NoSQLï¼ˆNOT only SQLï¼‰ï¼šHBaseã€Redis</p>
</li>
</ol>
<h3 id="12-hbaseåœ¨hadoopç”Ÿæ€åœˆä¸­çš„ä½ç½®">1.2 Hbaseåœ¨Hadoopç”Ÿæ€åœˆä¸­çš„ä½ç½®</h3>
<ol>
<li>HBaseæ˜¯Hadoopç”Ÿæ€åœˆä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†</li>
<li>HBaseæ˜¯æ„å»ºåœ¨HDFSçº¸ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´HBaseçš„æ•°æ®å¯ä»¥å­˜å‚¨åœ¨HDFSä¸Šé¢</li>
<li>å¯ä»¥é€šè¿‡MapReduce/Sparkæ¥å¤„ç†Hbaseä¸­çš„æ•°æ®</li>
<li>HBaseä¹Ÿæä¾›äº†shellã€APIçš„æ–¹å¼è¿›è¡Œæ•°æ®çš„è®¿é—®</li>
</ol>
<h3 id="13-è¡Œå¼vsåˆ—å¼">1.3 è¡Œå¼VSåˆ—å¼</h3>
<ol>
<li>
<p>è¡Œå¼</p>
<ul>
<li>
<p>æŒ‰è¡Œå­˜å‚¨</p>
</li>
<li>
<p>æ²¡æœ‰ç´¢å¼•æŸ¥è¯¢çš„æ—¶å€™éœ€è¦è€—è´¹å¤§é‡çš„IO</p>
</li>
<li>
<p>å¯ä»¥é€šè¿‡å»ºç«‹ç´¢å¼•æˆ–è€…è§†å›¾æ¥æé€Ÿ</p>
</li>
<li>
<p>1,3zz,23</p>
</li>
</ul>
</li>
<li>
<p>åˆ—å¼</p>
<ul>
<li>å‹ç¼©ã€å¹¶è¡Œå¤„ç†</li>
<li>æ•°æ®å°±æ˜¯ç´¢å¼•ï¼Œå¤§å¤§é™ä½IO</li>
</ul>
</li>
</ol>
<h3 id="14-hbaseç‰¹ç‚¹">1.4 HBaseç‰¹ç‚¹</h3>
<ol>
<li>
<p>å¤§ï¼šæ•°æ®é‡å¤§</p>
</li>
<li>
<p>é¢å‘åˆ—ï¼šåˆ—æ—ï¼ˆå¯ä»¥å­˜æ”¾å¾ˆå¤šåˆ—ï¼‰ï¼Œåˆ—æ—/åˆ—ç‹¬ç«‹ç´¢å¼•</p>
</li>
<li>
<p>ç¨€ç–ï¼š</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>...</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>3zz</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>4xx</td>
<td>0</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>5yy</td>
<td>0</td>
<td></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>æ•°æ®ç±»å‹å•ä¸€ï¼šbyte/string</p>
</li>
<li>
<p>æ— æ¨¡å¼ï¼šæ¯ä¸€è¡Œçš„æ•°æ®æ‰€å¯¹åº”çš„åˆ—ä¸ä¸€å®šç›¸åŒï¼Œæ¯è¡Œçš„åˆ—æ˜¯å¯ä»¥åŠ¨æ€æ·»åŠ çš„</p>
<pre><code class="language-shell">3zz age/birthday/company
4xx company/province/city
</code></pre>
</li>
<li>
<p>æ•°æ®å¤šç‰ˆæœ¬ï¼šæ¯”å¦‚companyå¯ä»¥å­˜æ”¾ä¸åŒçš„ç‰ˆæœ¬çš„å€¼</p>
<p>é»˜è®¤æƒ…å†µä¸‹ç‰ˆæœ¬å·æ˜¯è‡ªåŠ¨åˆ†é…çš„ï¼Œæ˜¯åˆ—çš„å€¼æ’å…¥æ—¶çš„æ—¶é—´æˆ³</p>
</li>
</ol>
<h3 id="15-hbase-vs-mysql">1.5 HBase VS MySQL</h3>
<ol>
<li>
<p>æ•°æ®ç±»å‹ä¸åŒ</p>
</li>
<li>
<p>æ•°æ®æ“ä½œï¼š</p>
<ol>
<li>å…³è”æŸ¥è¯¢ï¼šMapReduce/Spark/Phoenix</li>
<li>get/put/scan...</li>
</ol>
</li>
<li>
<p>å­˜å‚¨æ¨¡å¼</p>
<ol>
<li>
<p>MySQL</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>tel</th>
<th>Address</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>a</td>
<td>11</td>
<td>123</td>
<td>...</td>
</tr>
<tr>
<td>2</td>
<td>b</td>
<td>22</td>
<td>456</td>
<td>...</td>
</tr>
<tr>
<td>3</td>
<td>c</td>
<td>33</td>
<td>789</td>
<td>...</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>åœ¨HBaseä¸­</p>
<pre><code class="language-shell">basic_info: id	name 
private_info: age	tel		address
</code></pre>
</li>
</ol>
</li>
<li>
<p>transactionäº‹åŠ¡æ€§ï¼šå•è¡Œ</p>
</li>
<li>
<p>æ•°æ®é‡ï¼šHBaseå¤§</p>
</li>
<li>
<p>ååé‡ï¼šMillionçº§åˆ«</p>
</li>
</ol>
<h3 id="hbase-vs-hdfs">HBase vs HDFS</h3>
<ol>
<li>write patternï¼ˆå†™æ¨¡å¼ï¼‰</li>
<li>read patternï¼ˆè¯»æ¨¡å¼ï¼‰</li>
<li>SQL</li>
<li>data sizeï¼ˆæ•°æ®é‡ï¼‰</li>
</ol>
<h3 id="hbaseä¼˜åŠ¿">HBaseä¼˜åŠ¿</h3>
<ol>
<li>æˆç†Ÿ</li>
<li>é«˜æ•ˆ</li>
<li>åˆ†å¸ƒå¼</li>
</ol>
<h3 id="æ•°æ®æ¨¡å‹">æ•°æ®æ¨¡å‹</h3>
<ol>
<li>
<p>rowkey</p>
<ul>
<li>
<p>ä¸»é”®</p>
</li>
<li>
<p>å­—ç¬¦ä¸²ï¼ŒæŒ‰å­—å…¸é¡ºåºå­˜å‚¨ï¼Œåœ¨HBaseå†…éƒ¨ä¿å­˜çš„æ˜¯å­—èŠ‚æ•°ç»„</p>
</li>
</ul>
</li>
<li>
<p>åˆ—æ—ï¼šColumn Family ï¼ˆCFï¼‰</p>
<ul>
<li>
<p>æ˜¯åœ¨åˆ›å»ºè¡¨çš„æ—¶å€™å°±è¦æŒ‡å®šçš„</p>
</li>
<li>
<p>åˆ—æ—æ˜¯ä¸€ç³»åˆ—åˆ—çš„é›†åˆ</p>
</li>
<li>
<p>ä¸€ä¸ªåˆ—æ—æ‰€æœ‰åˆ—æœ‰ç€ç›¸åŒçš„å‰ç¼€</p>
<pre><code class="language-shell">basic_info: id
basic_info: name
private_info: age
private_info: tel
private_info: address
</code></pre>
</li>
</ul>
</li>
<li>
<p>åˆ—ï¼šColumn / Qualifier</p>
<ul>
<li>å±äºæŸä¸€ä¸ªåˆ—æ—</li>
</ul>
</li>
<li>
<p>æ¯æ¡è®°å½•è¢«åˆ’åˆ†åˆ°è‹¥å¹²ä¸ªCFä¸­ï¼Œæ¯æ¡è®°å½•å¯¹åº”ä¸€ä¸ªrowkeyï¼Œæ¯ä¸ªCFç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªColumnæ„æˆ</p>
</li>
<li>
<p>å­˜å‚¨å•å…ƒï¼šCell</p>
<ul>
<li>HBaseä¸­ROWå’ŒColumnç¡®å®šçš„ä¸€ä¸ªå­˜å‚¨å•å…ƒ</li>
<li>æ¯ä¸ªCelléƒ½ä¿å­˜è¿™åŒä¸€ä»½æ•°æ®çš„å¤šä¸ªç‰ˆæœ¬</li>
<li>åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œæ—¶é—´æˆ³å¯ä»¥ç”±HBaseè‡ªåŠ¨èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºèµ‹å€¼</li>
<li>æ¯ä¸ªCellä¸­ï¼Œä¸åŒç‰ˆæœ¬çš„æ•°æ®æŒ‰ç…§æ—¶é—´æˆ³çš„å€’åºæ’åˆ—</li>
</ul>
<pre><code class="language-shell">{rowkey, column, version} ==&gt; HBase ä¸­çš„ä¸€ä¸ªCell
</code></pre>
</li>
</ol>
<h2 id="2-hbaseå®‰è£…">2. HBaseå®‰è£…</h2>
<h3 id="21-å‰ç½®éœ€è¦">2.1 å‰ç½®éœ€è¦</h3>
<ol>
<li>JDKï¼ˆç•¥è¿‡ï¼‰</li>
<li>ZooKeeperå®‰è£…ï¼ˆbrewï¼‰</li>
<li>Hadoopå®‰è£…ï¼ˆä½¿ç”¨cdhç‰ˆæœ¬ï¼Œè¯¦ç»†é…ç½®å‚ç…§å‰é¢åšå®¢ï¼‰</li>
</ol>
<h3 id="22hbaseå®‰è£…">2.2HBaseå®‰è£…ï¼š</h3>
<ol>
<li>
<p>åœ¨.bash_profileä¸­æ·»åŠ HBASE_HOME</p>
</li>
<li>
<p>åœ¨HBaseçš„<code>conf</code>ç›®å½•ä¸­ä¿®æ”¹ä¸¤ä¸ªæ–‡ä»¶</p>
<ol>
<li>
<p>åœ¨<code>hbase-env.sh</code>æ–‡ä»¶ä¸­</p>
<pre><code class="language-shell"># 1.ä¿®æ”¹javaçš„è·¯å¾„
# The java implementation to use.  Java 1.7+ required.
# export JAVA_HOME=/usr/java/jdk1.6.0/
export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk-12.0.1.jdk/Contents/Home
# æ³¨æ„ è¿™é‡Œä¸€å®šè¦æ˜¯ç”¨1.8çš„ç‰ˆæœ¬ï¼ ä¸Šé¢ä½¿ç”¨java12æ˜¯è¦å‡ºå¤§é—®é¢˜çš„


# 2.ä¿®æ”¹zookeeperé…ç½®
# Tell HBase whether it should manage it's own instance of Zookeeper or not.
export HBASE_MANAGES_ZK=false
</code></pre>
</li>
<li>
<p>åœ¨<code>hbase-site.xml</code>ä¸­é…ç½®</p>
<pre><code class="language-xml">&lt;configuration&gt;
&lt;!--hbaseçš„æ•°æ®å­˜æ”¾åœ°å€ï¼ˆæœ¬æœºï¼‰--&gt;
&lt;property&gt;
  &lt;name&gt;hbase.rootdir&lt;/name&gt;
  &lt;value&gt;hdfs://localhost:8020/hbase&lt;/value&gt;
&lt;/property&gt;
&lt;!--åˆ†å¸ƒå¼é…ç½®--&gt;
&lt;property&gt;
  &lt;name&gt;hbase.cluster.distributed&lt;/name&gt;
  &lt;value&gt;true&lt;/value&gt;
&lt;/property&gt;
&lt;!--æœ¬æœºzookeeperåœ°å€--&gt;
&lt;property&gt;
  &lt;name&gt;hbase.zookeeper.quorum&lt;/name&gt;
  &lt;value&gt;localhost:2181&lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
</li>
</ol>
</li>
</ol>
<h3 id="23-å¯åŠ¨hbase">2.3 å¯åŠ¨HBase</h3>
<ol>
<li>å…ˆå¯åŠ¨hadoopç›®å½•ä¸‹<code>sbin/start-dfs.sh</code></li>
<li>å¯åŠ¨zookeeper<code>zKserver start</code></li>
<li>å¯åŠ¨HBaseç›®å½•ä¸‹çš„<code>bin/start-hbase.sh</code></li>
<li>æ‰“å¼€æœ¬æœº60010ç«¯å£ï¼Œæœ‰ç•Œé¢ åˆ™æˆåŠŸ</li>
</ol>
<h3 id="24-hbase-shellä½¿ç”¨">2.4 HBase shellä½¿ç”¨</h3>
<ol>
<li>åœ¨<code>bin</code>ç›®å½•ä¸‹è¾“å…¥<code>hbase shell</code>å³å¯è¿›å…¥shellè„šæœ¬
<ol>
<li>æŸ¥çœ‹ç‰ˆæœ¬<code>version</code></li>
<li>æŸ¥çœ‹æœåŠ¡å™¨çš„çŠ¶æ€<code>status</code></li>
</ol>
</li>
</ol>
<h2 id="3-hbaseç›¸å…³æ“ä½œ">3. HBaseç›¸å…³æ“ä½œ</h2>
<h3 id="31-ddlæ“ä½œ">3.1 DDLæ“ä½œ</h3>
<ul>
<li>åˆ›å»ºã€æŸ¥è¯¢</li>
</ul>
<pre><code class="language-sql"># åˆ›å»º
create 'member','member_id','address','info'
# æŸ¥è¯¢è¯¦ç»†ä¿¡æ¯
desc 'member'
</code></pre>
<ul>
<li>è¿”å›ä¿¡æ¯å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="language-shell">{NAME =&gt; 'address', BLOOMFILTER =&gt; 'ROW', VERSIONS =&gt; '1', IN_MEMORY =&gt; 'false', KEEP_DELETED_CELLS =&gt; 'FALSE', DATA_BLOCK_ENCOD
ING =&gt; 'NONE', TTL =&gt; 'FOREVER', COMPRESSION =&gt; 'NONE', MIN_VERSIONS =&gt; '0', BLOCKCACHE =&gt; 'true', BLOCKSIZE =&gt; '65536', REPLICA
TION_SCOPE =&gt; '0'}                                                                                                              
{NAME =&gt; 'info', BLOOMFILTER =&gt; 'ROW', VERSIONS =&gt; '1', IN_MEMORY =&gt; 'false', KEEP_DELETED_CELLS =&gt; 'FALSE', DATA_BLOCK_ENCODING
 =&gt; 'NONE', TTL =&gt; 'FOREVER', COMPRESSION =&gt; 'NONE', MIN_VERSIONS =&gt; '0', BLOCKCACHE =&gt; 'true', BLOCKSIZE =&gt; '65536', REPLICATIO
N_SCOPE =&gt; '0'}                                                                                                                 
{NAME =&gt; 'member_id', BLOOMFILTER =&gt; 'ROW', VERSIONS =&gt; '1', IN_MEMORY =&gt; 'false', KEEP_DELETED_CELLS =&gt; 'FALSE', DATA_BLOCK_ENC
ODING =&gt; 'NONE', TTL =&gt; 'FOREVER', COMPRESSION =&gt; 'NONE', MIN_VERSIONS =&gt; '0', BLOCKCACHE =&gt; 'true', BLOCKSIZE =&gt; '65536', REPLI
CATION_SCOPE =&gt; '0'} 
</code></pre>
<ul>
<li>ä¹Ÿå¯ä»¥åœ¨å›¾å½¢åŒ–ç•Œé¢ï¼Œå³60010ç«¯å£ä¸ŠæŸ¥çœ‹,ç‚¹å‡»æœ€ä¸Šé¢çš„<code>Table Details</code></li>
</ul>
<pre><code class="language-shell"># æŸ¥çœ‹æœ‰å“ªäº›è¡¨
hbase(main):007:0&gt; list
=&gt; [&quot;member&quot;]
# åˆ é™¤åˆ—æ—ä¸­çš„ä¸€åˆ—
hbase(main):008:0&gt; alter 'member' ,'delete'=&gt;'member_id'
1/1 regions updated.
Done.
</code></pre>
<ul>
<li>æ­¤æ—¶åœ¨æŸ¥çœ‹<code>member</code>è¡¨çš„ç»“æ„</li>
</ul>
<pre><code class="language-shell">hbase(main):009:0&gt; desc 'member'

COLUMN FAMILIES DESCRIPTION                                                                                                     
{NAME =&gt; 'address', BLOOMFILTER =&gt; 'ROW', VERSIONS =&gt; '1', IN_MEMORY =&gt; 'false', KEEP_DELETED_CELLS =&gt; 'FALSE', DATA_BLOCK_ENCOD
ING =&gt; 'NONE', TTL =&gt; 'FOREVER', COMPRESSION =&gt; 'NONE', MIN_VERSIONS =&gt; '0', BLOCKCACHE =&gt; 'true', BLOCKSIZE =&gt; '65536', REPLICA
TION_SCOPE =&gt; '0'}                                                                                                              
{NAME =&gt; 'info', BLOOMFILTER =&gt; 'ROW', VERSIONS =&gt; '1', IN_MEMORY =&gt; 'false', KEEP_DELETED_CELLS =&gt; 'FALSE', DATA_BLOCK_ENCODING
 =&gt; 'NONE', TTL =&gt; 'FOREVER', COMPRESSION =&gt; 'NONE', MIN_VERSIONS =&gt; '0', BLOCKCACHE =&gt; 'true', BLOCKSIZE =&gt; '65536', REPLICATIO
N_SCOPE =&gt; '0'} 
</code></pre>
<ul>
<li>
<p>å¯ä»¥å‘ç°<code>member_id</code>å·²ç»è¢«æˆ‘ä»¬åˆ æ‰äº†</p>
</li>
<li>
<p>åˆ é™¤è¡¨</p>
</li>
</ul>
<pre><code class="language-shell"># å…ˆdisable
hbase(main):011:0&gt; disable 'member'
# å†drop
hbase(main):012:0&gt; drop 'member'
# æ­¤æ—¶å†æŸ¥çœ‹æ‰€æœ‰è¡¨
hbase(main):013:0&gt; list
=&gt; []
</code></pre>
<h3 id="32-dmlæ“ä½œ">3.2 DMLæ“ä½œ</h3>
<ol>
<li>
<p>ä¸ºäº†æ–¹ä¾¿ï¼Œé‡æ–°åˆ›å»ºä¸€å¼ è¡¨</p>
<pre><code class="language-shell"># è¡¨åä¸ºmemberï¼Œåˆ—æ—ä¸ºaddressã€info
create 'member','address','info'
</code></pre>
</li>
<li>
<p>åˆ›å»º/ä¿®æ”¹/åˆ é™¤è¡¨</p>
<pre><code class="language-shell"># rowkeyä¸ºè¡Œåï¼ˆè¡¨åï¼‰ cfä¸ºåˆ—æ— columnä¸ºåˆ—æ—ä¸­çš„ä¸€åˆ—
æ’å…¥æ•°æ®ï¼š put è¡¨å,rowkey,cf:column,key
</code></pre>
</li>
<li>
<p>å®é™…è¯­å¥å¦‚ä¸‹</p>
<pre><code class="language-shell">put 'member','3z','info:age','23'
put 'member','3z','info:birthday','1996-07-31'
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹memberä¸­æ•°æ®</p>
<pre><code class="language-shell">scan 'member'
# è¿”å›ç»“æœ
ROW					COLUMN+CELL
3z					column=info:age, timestamp=12341241212, value=23
3z					column=info:birthday, timestamp=12341241213, value=1996-07-31
</code></pre>
</li>
<li>
<p>è·å–æŸä¸€è¡Œçš„æ•°æ®</p>
<pre><code class="language-shell"># è·å–æ‰€æœ‰3zçš„æ•°æ®
get 'member','3z'
# è¿”å›ç»“æœ
COLUMN                            CELL                                                                                          
 info:age                         timestamp=1577955149575, value=23
 info:birthday                    timestamp=1577955128970, value=1996-07-31
</code></pre>
</li>
<li>
<p>ä¿®æ”¹æŸä¸€åˆ—</p>
<pre><code class="language-shell">put 'member','3z','info:age','18'
# è·å–å½“å‰å¹´é¾„
get 'member','3z','info:age'
# è¿”å›ç»“æœ
COLUMN                            CELL
 info:age                         timestamp=1577955321212, value=18
# ageå·²ç»è¢«æ›´æ–°
</code></pre>
</li>
<li>
<p>åˆ é™¤æŸä¸€åˆ—</p>
<pre><code class="language-shell">delete 'member','3z','info:birthday'
# å†æŸ¥çœ‹3zçš„ä¿¡æ¯
get 'member','3z'
# è¿”å›ç»“æœ
COLUMN                            CELL
 info:age                         timestamp=1577955321212, value=18
# åˆ é™¤æˆåŠŸ
</code></pre>
</li>
<li>
<p>ç»Ÿè®¡ä¸€ä¸‹å‡ è¡Œ</p>
<pre><code class="language-shell">count 'member'
# è¿”å›ç»“æœ
==&gt; 1
</code></pre>
</li>
<li>
<p>åˆ é™¤æŸä¸ªä¸€æ•´è¡Œ</p>
<pre><code class="language-shell">deleteall 'member','3z'
</code></pre>
</li>
<li>
<p>æ¸…ç©ºä¸€å¼ è¡¨</p>
<pre><code class="language-shell">truncate 'member'
# ä¼šå…ˆè‡ªå·±disable åœ¨truncate
Truncating 'member' table (it may take a while):
 - Disabling table...
 - Truncating table...
0 row(s) in 3.4130 seconds
</code></pre>
</li>
</ol>
<h2 id="4-hbase-apiå¼€å‘javascala">4. HBase APIå¼€å‘ï¼šJava/Scala</h2>
<ol>
<li>
<p><code>maven:pom.xml</code>ï¼šè‰¯å¥½çš„ç½‘ç»œæ”¯æŒ</p>
<pre><code class="language-java">package com.zth.bigdata.hbase;

import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.hbase.*;
import org.apache.hadoop.hbase.client.*;
import org.apache.hadoop.hbase.util.Bytes;
import org.junit.After;
import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;

import java.io.IOException;

/**
 * Author: 3zZ.
 * Date: 2020/1/11 6:14 ä¸‹åˆ
 */
public class HbaseApp {
    Connection connection = null;
    Table table = null;
    Admin admin = null;

    String tableName = &quot;3z_hbase_java_api&quot;;

    @Before
    public void setUp() {
        Configuration configuration = new Configuration();
        configuration.set(&quot;hbase.rootdir&quot;, &quot;hdfs://localhost:8020/hbase&quot;);
        configuration.set(&quot;hbase.zookeeper.quorum&quot;, &quot;localhost:2181&quot;);
        try {
            connection = ConnectionFactory.createConnection(configuration);
            admin = connection.getAdmin();

            Assert.assertNotNull(connection);
            Assert.assertNotNull(admin);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    @Test
    public void getConnection() {
    }

    @Test
    public void createTable() throws Exception {
        TableName table = TableName.valueOf(tableName);
        if (admin.tableExists(table)) {
            System.out.println(tableName + &quot;å·²ç»å­˜åœ¨&quot;);
        } else {
            HTableDescriptor descriptor = new HTableDescriptor(table);
            descriptor.addFamily(new HColumnDescriptor(&quot;info&quot;));
            descriptor.addFamily(new HColumnDescriptor(&quot;address&quot;));
            admin.createTable(descriptor);
            System.out.println(tableName + &quot;åˆ›å»ºæˆåŠŸ&quot;);
        }
    }

    @Test
    public void queryTableInfos() throws Exception {
        HTableDescriptor[] tables = admin.listTables();
        if (tables.length &gt; 0) {
            for (HTableDescriptor table : tables) {
                System.out.println(table.getNameAsString());
                HColumnDescriptor[] columnDescriptors = table.getColumnFamilies();
                for (HColumnDescriptor hColumnDescriptor : columnDescriptors) {
                    System.out.println(&quot;\t&quot; + hColumnDescriptor.getNameAsString());
                }
            }
        }
    }

    @Test
    public void testPut() throws Exception {
        table = connection.getTable(TableName.valueOf(tableName));
        Put put = new Put(Bytes.toBytes(&quot;3z&quot;));
        // é€šè¿‡PUTè®¾ç½®è¦æ·»åŠ æ•°æ®çš„CFã€qualifierã€value
        put.addColumn(Bytes.toBytes(&quot;info&quot;), Bytes.toBytes(&quot;age&quot;), Bytes.toBytes(&quot;24&quot;));
        put.addColumn(Bytes.toBytes(&quot;info&quot;), Bytes.toBytes(&quot;birthday&quot;), Bytes.toBytes(&quot;731&quot;));
        put.addColumn(Bytes.toBytes(&quot;info&quot;), Bytes.toBytes(&quot;company&quot;), Bytes.toBytes(&quot;HIT&quot;));

        put.addColumn(Bytes.toBytes(&quot;address&quot;), Bytes.toBytes(&quot;country&quot;), Bytes.toBytes(&quot;CN&quot;));
        put.addColumn(Bytes.toBytes(&quot;address&quot;), Bytes.toBytes(&quot;province&quot;), Bytes.toBytes(&quot;BJ&quot;));
        put.addColumn(Bytes.toBytes(&quot;address&quot;), Bytes.toBytes(&quot;city&quot;), Bytes.toBytes(&quot;BJ&quot;));
        //  å°†æ•°æ®putåˆ°hbaseä¸­å»
        table.put(put);
    }

    @Test
    public void testUpdate() throws Exception {
        table = connection.getTable(TableName.valueOf(tableName));
        Put put = new Put(Bytes.toBytes(&quot;2z&quot;));
        put.addColumn(Bytes.toBytes(&quot;info&quot;), Bytes.toBytes(&quot;age&quot;), Bytes.toBytes(&quot;25&quot;));
        table.put(put);
    }

    @Test
    public void testGet01() throws Exception {
        table = connection.getTable(TableName.valueOf(tableName));
        Get get = new Get(&quot;3z&quot;.getBytes());
        get.addColumn(Bytes.toBytes(&quot;info&quot;), Bytes.toBytes(&quot;age&quot;));
        Result result = table.get(get);
        printResult(result);
    }
    @Test
    public void testScan01() throws Exception{
        table = connection.getTable(TableName.valueOf(tableName));
        Scan scan = new Scan();
        ResultScanner rs = table.getScanner(scan);
        for (Result result: rs){
            printResult(result);
        }
    }

    public void printResult(Result result) {
        for (Cell cell : result.rawCells()) {
            System.out.println(Bytes.toString(result.getRow()) + &quot;\t&quot; +
                    Bytes.toString(CellUtil.cloneFamily(cell)) + &quot;\t&quot; +
                    Bytes.toString(CellUtil.cloneQualifier(cell)) + &quot;\t&quot; +
                    Bytes.toString(CellUtil.cloneValue(cell)) + &quot;\t&quot; +
                    cell.getTimestamp()
            );
        }
    }

    @After
    public void tearDown() {
        try {
            connection.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
</code></pre>
</li>
<li>
<p>å°ç»“</p>
<ul>
<li>
<p><code>Connection</code></p>
</li>
<li>
<p><code>Admin</code></p>
</li>
<li>
<p><code>HTableDescriptor</code></p>
</li>
<li>
<p><code>HcolumnDescriptor</code></p>
</li>
<li>
<p>åˆ›å»ºè¡¨</p>
</li>
<li>
<p>åˆ é™¤è¡¨</p>
</li>
<li>
<p>æ·»åŠ è®°å½•ï¼šå•æŒ‘ã€å¤šæ¡</p>
</li>
<li>
<p>ä¿®æ”¹è®°å½•</p>
</li>
<li>
<p>æ ¹æ®<code>RowKey</code>è·å–å•æŒ‘è®°å½•</p>
</li>
<li>
<p><code>Scan</code>ï¼šç©ºã€èµ·å§‹ã€èµ·å§‹ç»“å°¾ã€<code>Get</code></p>
</li>
<li>
<p><code>Filter</code> : <code>RowFilter</code>ã€<code>PrefixFilter</code>ã€<code>FilterList</code></p>
</li>
</ul>
</li>
</ol>
]]></content>
    </entry>
</feed>