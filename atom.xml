<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://Zu3zz.github.io</id>
    <title>ç¬¬ä¸‰æ–°ä¸œäº¬</title>
    <updated>2019-10-18T11:00:27.847Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://Zu3zz.github.io"/>
    <link rel="self" href="https://Zu3zz.github.io/atom.xml"/>
    <subtitle>Everyone Can (Not) Comprehend.</subtitle>
    <logo>https://Zu3zz.github.io/images/avatar.png</logo>
    <icon>https://Zu3zz.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, ç¬¬ä¸‰æ–°ä¸œäº¬</rights>
    <entry>
        <title type="html"><![CDATA[Pythonä¸å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶(1)----æ¦‚å¿µç¯‡]]></title>
        <id>https://Zu3zz.github.io/post/message-queue-python</id>
        <link href="https://Zu3zz.github.io/post/message-queue-python">
        </link>
        <updated>2019-10-18T10:51:28.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸŒˆæœ€è¿‘åœ¨å­¦ä¹ æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç”±äºå¤§æ•°æ®ç«¯å¤©ç”Ÿé è¿‘æ•°æ®ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦å¯¹æ—¥å¿—ç­‰æ–‡ä»¶è¿›è¡Œåˆ†æ<br>
ğŸŠé‚£ä¹ˆè¿™ä¸€ç³»åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨Pythonè¯­è¨€å¯¹å¸¸ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¸€æ¬¡æ•´åˆ<br>
ğŸ‰çœ‹çœ‹å¦‚ä½•å°†nginxã€kafkaã€zookeeperã€redisã€logstashä¸€èµ·ï¼Œä½¿ç”¨pythonè¯­è¨€æ­å»ºä¸€ä¸ªæ—¥å¿—æŠ¥è­¦ç³»ç»Ÿå§</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸŒˆæœ€è¿‘åœ¨å­¦ä¹ æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç”±äºå¤§æ•°æ®ç«¯å¤©ç”Ÿé è¿‘æ•°æ®ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦å¯¹æ—¥å¿—ç­‰æ–‡ä»¶è¿›è¡Œåˆ†æ<br>
ğŸŠé‚£ä¹ˆè¿™ä¸€ç³»åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨Pythonè¯­è¨€å¯¹å¸¸ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¸€æ¬¡æ•´åˆ<br>
ğŸ‰çœ‹çœ‹å¦‚ä½•å°†nginxã€kafkaã€zookeeperã€redisã€logstashä¸€èµ·ï¼Œä½¿ç”¨pythonè¯­è¨€æ­å»ºä¸€ä¸ªæ—¥å¿—æŠ¥è­¦ç³»ç»Ÿå§</p>
<!-- more -->
<h2 id="1-å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¯”è¾ƒ">1. å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¯”è¾ƒ</h2>
<h3 id="11-å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»">1.1 å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»</h3>
<ul>
<li>Redis</li>
<li>RabbitMQ</li>
<li>RocketMQ</li>
<li>ZeroMQ</li>
<li>Kafka</li>
</ul>
<h3 id="12-å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å¯¹æ¯”">1.2 å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å¯¹æ¯”</h3>
<ul>
<li>å®ç°è¯­è¨€</li>
<li>å¯¹å¤–æ¥å£</li>
<li>æŒä¹…åŒ–ç­–ç•¥</li>
<li>æ¶ˆæ¯å¤„ç†æ¨¡å¼</li>
<li>æ—¶åºä¿è¯</li>
</ul>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯ä¸­é—´ä»¶</th>
<th>å®ç°è¯­è¨€</th>
<th>æŒä¹…åŒ–</th>
<th>æ¶ˆæ¯å¤„ç†æ¨¡å¼</th>
<th>æ—¶åºä¿è¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>Redis</td>
<td>C</td>
<td>æ”¯æŒç£ç›˜</td>
<td>Push-Pull Pub-Sub</td>
<td>æœ‰åº</td>
</tr>
<tr>
<td>RabbitMQ</td>
<td>Erlang</td>
<td>ç£ç›˜</td>
<td>Push</td>
<td>å•æ¶ˆè´¹è€…æœ‰åº</td>
</tr>
<tr>
<td>RocketMQ</td>
<td>Java</td>
<td>ç£ç›˜</td>
<td>Puch-Pull</td>
<td>åŒé˜Ÿåˆ—æœ‰åº</td>
</tr>
<tr>
<td>Kafka</td>
<td>Scala</td>
<td>ç£ç›˜</td>
<td>Pull</td>
<td>å•Parititionæœ‰åº</td>
</tr>
</tbody>
</table>
<h2 id="2-æ¶ˆæ¯ä¸­é—´ä»¶å¸¸è§æ¦‚å¿µ">2. æ¶ˆæ¯ä¸­é—´ä»¶å¸¸è§æ¦‚å¿µ</h2>
<h3 id="21-æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„å„ç§æ¦‚å¿µå’Œè§’è‰²">2.1 æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„å„ç§æ¦‚å¿µå’Œè§’è‰²</h3>
<ul>
<li>Producer/borker/cunsumer</li>
<li>Queue/channel/topic</li>
<li>Partition</li>
<li>Publish/subscribe</li>
<li>Acknowledge</li>
</ul>
<h3 id="22-ç”Ÿäº§è€…">2.2 ç”Ÿäº§è€…</h3>
<figure data-type="image" tabindex="1"><img src="https://Zu3zz.github.io/post-images/1571396146907.png" alt="producer"></figure>
<h3 id="23-partition">2.3 Partition</h3>
<ul>
<li>ä¸€ä¸ªtopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartition</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://Zu3zz.github.io/post-images/1571396164758.png" alt=""></figure>
<h3 id="24-è®¢é˜…">2.4 è®¢é˜…</h3>
<figure data-type="image" tabindex="3"><img src="https://Zu3zz.github.io/post-images/1571396178821.png" alt=""></figure>
<h3 id="25-æ¶ˆæ¯ç¡®è®¤æœºåˆ¶">2.5 æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</h3>
<ul>
<li>åªæœ‰ç»è¿‡ç”¨æˆ·ç¡®è®¤çš„æ¶ˆæ¯æ‰ä¼šä»queueä¸­å»é™¤</li>
</ul>
<figure data-type="image" tabindex="4"><img src="https://Zu3zz.github.io/post-images/1571396204405.png" alt=""></figure>
<h2 id="3-redis">3. Redis</h2>
<h3 id="31-redisç®€ä»‹">3.1 Redisç®€ä»‹</h3>
<p><strong>Rediså…³é”®è¯</strong></p>
<ul>
<li>Key-value</li>
<li>é«˜æ€§èƒ½</li>
<li>ç¼“å­˜</li>
<li>Cå¼€å‘</li>
<li>äº”å¤§æ•°æ®ç»“æ„</li>
<li>luaæ‰©å±•</li>
</ul>
<h3 id="32-rediså¸¸è§åº”ç”¨åœºæ™¯">3.2 Rediså¸¸è§åº”ç”¨åœºæ™¯</h3>
<ol>
<li>
<p>String</p>
<ul>
<li>ç¼“å­˜äºŒè¿›åˆ¶å¯¹è±¡ï¼Œæ¯”å¦‚å›¾ç‰‡ã€åºåˆ—åŒ–å¯¹è±¡ç­‰</li>
<li>è®¡æ•°å™¨ï¼Œæ¯”å¦‚æ–‡ç« è®¿é—®é‡ç»Ÿè®¡</li>
<li>ä½è¿ç®—ï¼ŒèŠ‚çº¦å†…å­˜</li>
</ul>
</li>
<li>
<p>List</p>
<ul>
<li>è·å–æœ€æ–°çš„Næ¡æ•°æ®</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>å®æ—¶åˆ†æç³»ç»Ÿï¼Œæ¯”å¦‚æœåŠ¡å™¨ç›‘æ§ç¨‹åº</li>
</ul>
</li>
<li>
<p>Hash</p>
<ul>
<li>
<p>ç±»ä¼¼Pythonä¸­çš„Dict</p>
</li>
<li>
<p>å­˜å‚¨å…·æœ‰å¤šä¸ªå±æ€§çš„å¯¹è±¡</p>
</li>
<li>
<p>æ¯”å¦‚ç”¨æˆ·çš„å¹´é¾„ã€å§“åã€æ€§åˆ«ã€ç§¯åˆ†</p>
</li>
</ul>
</li>
<li>
<p>Set</p>
<ul>
<li>é›†åˆæ“ä½œï¼Œæ¯”å¦‚é€šè¿‡äº¤é›†å®ç°å…±åŒå…³æ³¨ï¼Œå…±åŒå¥½å‹</li>
<li>å­˜å‚¨æ— åºä¸é‡å¤æ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨æ–‡ç« æ ‡ç­¾</li>
</ul>
</li>
<li>
<p>Sorted Set</p>
<ul>
<li>TopNæ’åºï¼Œæ¯”å¦‚æ’è¡Œæ¦œ</li>
<li>èŒƒå›´æŸ¥æ‰¾ï¼Œæ¯”å¦‚åˆ¤æ–­ipåœ°å€æ‰€åœ¨åœ°</li>
<li>ä¼˜å…ˆçº§é˜Ÿåˆ—</li>
<li>è¿‡æœŸé¡¹ç›®å¤„ç†</li>
</ul>
</li>
<li>
<p>Pub Sub</p>
<ul>
<li>å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</li>
<li>æ¯”å¦‚å³æ—¶èŠå¤©ï¼Œç¾¤èŠ</li>
</ul>
</li>
</ol>
<h3 id="33-rediså®‰è£…ä¸é»˜è®¤é…ç½®">3.3 Rediså®‰è£…ä¸é»˜è®¤é…ç½®</h3>
<h4 id="331redisæœåŠ¡å™¨é»˜è®¤é…ç½®">3.3.1RedisæœåŠ¡å™¨é»˜è®¤é…ç½®</h4>
<ul>
<li>ç«¯å£å·ï¼šport=6379</li>
<li>IPåœ°å€ bind=0.0.0.0</li>
<li>æ•°æ®åº“å­˜æ”¾ä½ç½® dir=./</li>
<li>æ•°æ®åº“åå­— dbfilename=dump.rdb</li>
<li>å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ daemonize=no</li>
</ul>
<h4 id="332-redisæœåŠ¡å™¨é…ç½®æ–‡ä»¶">3.3.2 RedisæœåŠ¡å™¨é…ç½®æ–‡ä»¶</h4>
<ul>
<li>
<p>RedisæœåŠ¡å™¨å¯ç”¨é…ç½®æ–‡ä»¶ï¼šè¿è¡Œ</p>
<pre><code class="language-shell">redis-server name.conf
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹redisæœåŠ¡å™¨æ‰€æœ‰é€‰é¡¹é…ç½®ï¼šè¿è¡Œ</p>
<pre><code class="language-shell">redis-cli config get '*'
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹redisæœåŠ¡å™¨æŸä¸ªé…ç½®é€‰é¡¹ï¼šè¿è¡Œ</p>
<pre><code class="language-shell">redis-cli config get xxx(e.g: bind)
</code></pre>
</li>
</ul>
<h4 id="333-å¸¸è§å‚æ•°">3.3.3 å¸¸è§å‚æ•°</h4>
<ol>
<li>--daemonize
<ul>
<li>å«ä¹‰ï¼šæ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„å½¢å¼å¯åŠ¨(åå°å¯åŠ¨)</li>
<li>ç”¨æ³•ï¼šdaemonize yes|no</li>
<li>é»˜è®¤å€¼ï¼šno</li>
<li>å®ä¾‹ï¼šdaemonize yes</li>
</ul>
</li>
<li>--bind
<ul>
<li>å«ä¹‰ï¼šredisç›‘å¬çš„ipåœ°å€</li>
<li>ç”¨æ³•ï¼šbind ipåœ°å€</li>
<li>é»˜è®¤å€¼ï¼š127.0.0.1</li>
<li>å®ä¾‹ï¼šbind 0.0.0.0(ç›‘å¬æ‰€æœ‰)</li>
</ul>
</li>
<li>--port(ä¸€èˆ¬ä¸æ”¹)
<ul>
<li>å«ä¹‰ï¼šredisç›‘å¬çš„ç«¯å£å·</li>
<li>ç”¨æ³•ï¼šport ç«¯å£å·</li>
<li>é»˜è®¤å€¼ï¼š6379</li>
<li>å®ä¾‹ï¼šport 6380</li>
</ul>
</li>
<li>--dir
<ul>
<li>å«ä¹‰ï¼šredisæŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ç›®å½•</li>
<li>ç”¨æ³•ï¼šdir æ–‡ä»¶è·¯å¾„</li>
<li>é»˜è®¤å€¼ï¼š./</li>
<li>å®ä¾‹ï¼šdir /mnt/redis/data/</li>
</ul>
</li>
<li>--dbfilename
<ul>
<li>å«ä¹‰ï¼šredisæŒä¹…åŒ–æ–‡ä»¶æ–‡ä»¶å</li>
<li>ç”¨æ³•ï¼šdbfilename æ–‡ä»¶å</li>
<li>é»˜è®¤å€¼ï¼šdump.rdb</li>
<li>å®ä¾‹ï¼šdbfilename xxxx.rdb(e.g. user.rdb)</li>
</ul>
</li>
<li>--unixsocket(æ•ˆç‡é«˜äºsocketå¥—æ¥å­—)
<ul>
<li>å«ä¹‰ï¼šredisç›‘å¬çš„unixå¥—æ¥å­—åœ°å€</li>
<li>ç”¨æ³•ï¼šunixsocketæ–‡ä»¶åœ°å€</li>
<li>é»˜è®¤å€¼ï¼šç©º</li>
<li>å®ä¾‹ï¼šunixsocket /tmp/redis.sock</li>
</ul>
</li>
</ol>
<h3 id="34-rediså¸¸è§æ“ä½œå’Œå‘½ä»¤">3.4 Rediså¸¸è§æ“ä½œå’Œå‘½ä»¤</h3>
<p><strong>é¦–å…ˆä½¿ç”¨redis-serverå¯åŠ¨redisæœåŠ¡ï¼Œç„¶åä½¿ç”¨redis-cliè¿›å…¥å‘½ä»¤è¡Œç•Œé¢</strong></p>
<h4 id="341-rediså¸¸ç”¨å‘½ä»¤è®²è§£">3.4.1 Rediså¸¸ç”¨å‘½ä»¤è®²è§£</h4>
<ul>
<li>æµ‹è¯•å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥æ˜¯å¦æ­£å¸¸ï¼šPING</li>
<li>è·å¾—ç¬¦åˆè§„åˆ™çš„é”®ååˆ—è¡¨ï¼šKEYS pattern</li>
<li>åˆ¤æ–­ä¸€ä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼šEXISTS key</li>
<li>åˆ é™¤ä¸€ä¸ªé”®ï¼šDEL key</li>
<li>è·å–é”®çš„ç±»å‹ï¼šTYPE key</li>
<li>æ¸…ç©ºå½“å‰æ•°æ®åº“æ‰€æœ‰æ•°æ®ï¼šFLUSHDB</li>
<li>è®¾ç½®ä¸€ä¸ªé”®çš„ç”Ÿè‚²ç”Ÿå­˜æ—¶é—´ï¼šEXPIRE key seconds</li>
<li>è¿”å›ä¸€ä¸ªé”®çš„ç”Ÿè‚²ç”Ÿå­˜æ—¶é—´ï¼šTTL key</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; ping
PONG
127.0.0.1:6379&gt; keys *
 1) &quot;1558695101775_0.7258740928094547&quot;
 2) &quot;1558693978601_0.21519364815403463&quot;
 3) &quot;1558695158141_0.8666190807031027&quot;
127.0.0.1:6379&gt; flushdb
OK
127.0.0.1:6379&gt; keys *
(empty list or set)
127.0.0.1:6379&gt; set foo bar
OK
127.0.0.1:6379&gt; keys foo
1) &quot;foo&quot;
127.0.0.1:6379&gt; type foo
string
127.0.0.1:6379&gt; exists foo
(integer) 1
127.0.0.1:6379&gt; del foo
(integer) 1
127.0.0.1:6379&gt; keys *
(empty list or set)
127.0.0.1:6379&gt; set foo bar
OK
127.0.0.1:6379&gt; expire foo 60
(integer) 1
127.0.0.1:6379&gt; ttl foo
(integer) 58
127.0.0.1:6379&gt; ttl foo
(integer) -2
</code></pre>
<h4 id="342-rediså¸¸ç”¨å‘½ä»¤ä¹‹string">3.4.2 Rediså¸¸ç”¨å‘½ä»¤ä¹‹String</h4>
<ul>
<li>SET</li>
<li>GET</li>
<li>INCR(é€’å¢ä¸€ä¸ªå€¼ä¸ºæ•´æ•°çš„string)</li>
<li>MSET(æ‰¹é‡è®¾ç½®)</li>
<li>MGET(æ‰¹é‡è·å–)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; set foo barstring
OK
127.0.0.1:6379&gt; get foo
&quot;barstring&quot;
127.0.0.1:6379&gt; get ffo
(nil)
127.0.0.1:6379&gt; mset foo1 bar1 foo2 bar2 foo3 bar3
OK
127.0.0.1:6379&gt; mget foo1 foo2 foo3
1) &quot;bar1&quot;
2) &quot;bar2&quot;
3) &quot;bar3&quot;
127.0.0.1:6379&gt; set num 1
OK
127.0.0.1:6379&gt; incr num
(integer) 2
127.0.0.1:6379&gt; get num
&quot;2&quot;
</code></pre>
<h4 id="343-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹hash">3.4.3 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹Hash</h4>
<ul>
<li>HSET</li>
<li>HGET</li>
<li>HMSET</li>
<li>HMGET</li>
<li>HGETALL</li>
<li>HDEL</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; hset user name 3zz
(integer) 1
127.0.0.1:6379&gt; hset user sex man
(integer) 1
127.0.0.1:6379&gt; hget user name
&quot;3zz&quot;
127.0.0.1:6379&gt; hgetall user
1) &quot;name&quot;
2) &quot;3zz&quot;
3) &quot;sex&quot;
4) &quot;man&quot;
127.0.0.1:6379&gt; hdel user name
(integer) 1
127.0.0.1:6379&gt; hgetall user
1) &quot;sex&quot;
2) &quot;man&quot;
127.0.0.1:6379&gt; del user
(integer) 1
127.0.0.1:6379&gt; exists user
(integer) 0
</code></pre>
<h4 id="344-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹list">3.4.4 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹List</h4>
<ul>
<li>LPUSH(ä»å·¦ä¾§æ”¾å…¥)</li>
<li>RPUSH(ä»å³ä¾§æ”¾å…¥)</li>
<li>LPOP(ä»å·¦ä¾§æ‹¿å‡º)</li>
<li>RPOP(ä»å³ä¾§æ‹¿å‡º)</li>
<li>BRPOP(æœ‰æ•°æ®åˆ™è¿”å›ï¼Œæ²¡æœ‰å°±ä¸€ç›´ç­‰å¾…ç›´åˆ°æœ‰æ•°æ®)</li>
<li>LLEN(è¿”å›é•¿åº¦)</li>
<li>LRANGE(è¿”å›ä»ç´¢å¼•startåˆ°endä¸¤ç«¯çš„å…ƒç´ ï¼Œå·¦å³éƒ½é—­)</li>
<li>RPOPLPUSH(å…ˆå³æ‹¿å‡º å·¦æ”¾å…¥)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; lpush list0 a
(integer) 1
127.0.0.1:6379&gt; lpush list0 b c 
(integer) 4
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;
127.0.0.1:6379&gt; rpush list0 d e
(integer) 5
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;
4) &quot;d&quot;
5) &quot;e&quot;
127.0.0.1:6379&gt; llen list0
(integer) 5
127.0.0.1:6379&gt; rpoplpush list0 list1
&quot;e&quot;
127.0.0.1:6379&gt; lrange list1 0 -1
1) &quot;e&quot;
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;
4) &quot;d&quot;
127.0.0.1:6379&gt; rpoplpush list0 list0 
&quot;d&quot;
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;d&quot;
2) &quot;c&quot;
3) &quot;b&quot;
4) &quot;a&quot;
127.0.0.1:6379&gt; llen list0
(integer) 4
</code></pre>
<h4 id="345-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹set">3.4.5 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹Set</h4>
<ul>
<li>SADD</li>
<li>SREM</li>
<li>SMEMBERS</li>
<li>SISMEMBER</li>
<li>SDIFF(å·®é›†)</li>
<li>SINTER(å¹¶é›†)</li>
<li>SUNION(äº¤é›†)</li>
<li>SCARD(å…ƒç´ ä¸ªæ•°)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; sadd letters a b
(integer) 2
127.0.0.1:6379&gt; SMEMBERS letters
1) &quot;b&quot;
2) &quot;a&quot;
127.0.0.1:6379&gt; SISMEMBER letters a
(integer) 1
127.0.0.1:6379&gt; sadd setA 1 2 3
(integer) 3
127.0.0.1:6379&gt; sadd setB 2 3 4
(integer) 3
127.0.0.1:6379&gt; sdiff setA setB
1) &quot;1&quot;
127.0.0.1:6379&gt; SINTER seta setb
(empty list or set)
127.0.0.1:6379&gt; SINTER setA setB
1) &quot;2&quot;
2) &quot;3&quot;
127.0.0.1:6379&gt; SUNION setA setB
1) &quot;1&quot;
2) &quot;2&quot;
3) &quot;3&quot;
4) &quot;4&quot;
127.0.0.1:6379&gt; scard setA
(integer) 3
</code></pre>
<h4 id="346-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹sorted-set">3.4.6 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹Sorted Set</h4>
<ul>
<li>ZADD(æ·»åŠ å…ƒç´ )</li>
<li>ZSCORE(è·å¾—æŸä¸ªå…ƒç´ )</li>
<li>ZRANGE(æŒ‰ç…§æ¬¡åºç»™å‡ºå­˜åœ¨çš„å…ƒç´ )</li>
<li>ZRANGEBYSCORE(ç»™å‡ºç»™å®šrangeé‡Œçš„æ‰€æœ‰å…ƒç´ ï¼Œå·¦å³éƒ½é—­)</li>
<li>ZINCRBY(å¢åŠ ä¸€ä¸ªå…ƒç´ åˆ†æ•°)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; ZADD scoreboard 10 x 20 y 30 z 15 a
(integer) 4
127.0.0.1:6379&gt; zscore scoreboard y
&quot;20&quot;
127.0.0.1:6379&gt; zrange scoreboard 2 3
1) &quot;y&quot;
2) &quot;z&quot;
127.0.0.1:6379&gt; ZRANGEBYSCORE scoreboard 15 25
1) &quot;a&quot;
2) &quot;y&quot;
127.0.0.1:6379&gt; ZINCRBY scoreboard 30 x
&quot;40&quot;
</code></pre>
<h2 id="4-pythonä¸redis">4. Pythonä¸Redis</h2>
<h3 id="41-redis-pythonå®¢æˆ·ç«¯ä»‹ç»">4.1 Redis Pythonå®¢æˆ·ç«¯ä»‹ç»</h3>
<blockquote>
<p><strong>æ¨èä½¿ç”¨redis-py</strong></p>
</blockquote>
<ul>
<li>
<p>Getting Started</p>
<pre><code class="language-shell">&gt;&gt;&gt; import redis
&gt;&gt;&gt; r = redis.StrictRedis(host=&quot;localhost&quot;, port=6379,db=0)
&gt;&gt;&gt; r.set('foo','bar')
True
&gt;&gt;&gt; r.get('foo')
'bar'
</code></pre>
</li>
</ul>
<h3 id="42-æ¶ˆæ¯é˜Ÿåˆ—çš„æ’å…¥ä¸å–å‡º">4.2 æ¶ˆæ¯é˜Ÿåˆ—çš„æ’å…¥ä¸å–å‡º</h3>
<h4 id="421-åŸºäº-redis-py-ç”Ÿäº§è€…å¼€å‘">4.2.1 åŸºäº redis-py ç”Ÿäº§è€…å¼€å‘</h4>
<ul>
<li>
<p>æ¯2ç§’éšæœºç”Ÿæˆä¸€ä¸ªç”¨æˆ·åæ’å…¥åˆ°é˜Ÿåˆ—ä¸­</p>
</li>
<li>
<p>LPUSH</p>
<pre><code class="language-python"># producer1.py
import redis 
import names
import time

r = redis.StrictRedis(host='localhost', port=6379, db=0)

while True:
  time.sleep(2)
  name = names.get_full_name()
  x = r.lpush('names',name)
  print(x,name)
</code></pre>
</li>
</ul>
<h4 id="422-åŸºäº-redis-py-æ¶ˆè´¹è€…å¼€å‘">4.2.2 åŸºäº redis-py æ¶ˆè´¹è€…å¼€å‘</h4>
<ul>
<li>
<p>å°†é˜Ÿåˆ—ä¸­çš„ç”¨æˆ·åæŒ‰ç…§æ’å…¥é¡ºåºå–å‡ºå¹¶æ‰“å°åˆ°å±å¹•ä¸Š</p>
</li>
<li>
<p>BRPOP</p>
<pre><code class="language-python"># consumer1.py
import redis

r = redis.StrictRedis(host='localhost', port=6379, db=0)

def consume(key):
  while(True):
    value = r.brpop(key)
    yield value

for v in consume('names'):
  print(v)
</code></pre>
</li>
</ul>
<h3 id="43-åŸºäºé¢‘é“çš„å‘å¸ƒä¸è®¢é˜…">4.3 åŸºäºé¢‘é“çš„å‘å¸ƒä¸è®¢é˜…</h3>
<h4 id="431-åŸºäº-redis-py-ç”Ÿäº§è€…å¼€å‘">4.3.1 åŸºäº redis-py ç”Ÿäº§è€…å¼€å‘</h4>
<ul>
<li>
<p>æ¯2ç§’éšæœºç”Ÿæˆä¸€ä¸ªç”¨æˆ·åå‘å¸ƒåˆ°é¢‘é“ä¸­</p>
</li>
<li>
<p>PUBLISH</p>
<pre><code class="language-python"># producer2.py
import redis 
import names
import time

r = redis.StrictRedis(host='localhost', port=6379, db=0)

while True:
  time.sleep(2)
  name = names.get_full_name()
  x = r.publish('names',name)
  print(x,name)
</code></pre>
</li>
</ul>
<h4 id="432-åŸºäº-redis-py-æ¶ˆè´¹è€…å¼€å‘">4.3.2 åŸºäº redis-py æ¶ˆè´¹è€…å¼€å‘</h4>
<ul>
<li>
<p>è®¢é˜…å‘å¸ƒç”¨æˆ·åçš„é¢‘é“ï¼Œæœ‰æ–°çš„æ¶ˆæ¯æ—¶æ‰“å°åˆ°å±å¹•ä¸Š</p>
</li>
<li>
<p>SUBSCRIBE</p>
<pre><code class="language-python"># consumer2.py
import redis

r = redis.StrictRedis(host='localhost', port=6379, db=0)

ps = r.pubsub()
ps.subscribe('names')

for item in ps.listen():
  print(item)
</code></pre>
</li>
</ul>
<h2 id="5-kafka">5. Kafka</h2>
<h3 id="51-kafkaç®€ä»‹ä¸åº”ç”¨åœºæ™¯">5.1 Kafkaç®€ä»‹ä¸åº”ç”¨åœºæ™¯</h3>
<ol>
<li>
<p>Kafkaç®€ä»‹-å…³é”®è¯</p>
<ul>
<li>ç£ç›˜æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>é«˜æ€§èƒ½</li>
<li>åˆ†å¸ƒå¼</li>
<li>Zookeeper</li>
<li>å®æ—¶æµå¤„ç†</li>
<li>é‡å¤æ¶ˆè´¹</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--API</p>
<ul>
<li>ç”Ÿäº§è€…API</li>
<li>æ¶ˆè´¹è€…API</li>
<li>æµå¤„ç†å™¨API</li>
<li>è¿æ¥å™¨API</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--ç”Ÿäº§è€…</p>
<ul>
<li>å¼‚æ­¥é€šä¿¡ï¼Œæ‰€æœ‰ç½‘è·¯è¯·æ±‚å¼‚æ­¥å‘é€</li>
<li>æ‰¹é‡å‘é€ï¼Œé€šè¿‡è®¾ç½®batch sizeæˆ–è€…timeoutä¸€æ¬¡å‘é€å¤šä¸ªæ¶ˆæ¯</li>
<li>çº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«å•ä¸ªç”Ÿäº§è€…å®ä¾‹</li>
<li>è´Ÿè½½å‡è¡¡ï¼Œé‡‡ç”¨å†…éƒ¨é»˜è®¤æœºåˆ¶æˆ–è€…è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</li>
<li>è¿”å›ç»“æœï¼Œè¿”å›æ¶ˆæ¯çš„topicï¼Œoffsetç­‰å…ƒæ•°æ®</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--æ¶ˆè´¹è€…</p>
<ul>
<li>ç»Ÿä¸€APIï¼Œä¸åœ¨åŒºåˆ†high-level consumer APIå’Œlow-level consumer API</li>
<li>å¤šæ¬¡æ¶ˆè´¹ï¼Œä¸ä¼šåˆ é™¤å·²æ¶ˆè´¹çš„ä¿¡æ¯ï¼Œå…è®¸é‡å¤æ¶ˆè´¹</li>
<li>è´Ÿè½½å‡è¡¡ï¼ŒåŸºäºpartitionå’Œconsumer groupè‡ªåŠ¨è´Ÿè½½å‡è¡¡</li>
<li>æµé‡æ§åˆ¶ï¼Œå…è®¸å¼€å‘è€…æ§åˆ¶æ¯æ¬¡è¯·æ±‚è¿”å›æ¶ˆæ¯çš„æ¡æ•°</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--å®‰å…¨</p>
<ul>
<li>è¿æ¥è®¤è¯ï¼Œè¿æ¥åˆ°æœåŠ¡å™¨çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯ä½¿ç”¨SSLæˆ–è€…SASLè¿›è¡ŒéªŒè¯</li>
<li>æƒé™ç®¡ç†ï¼Œbrokerè¿æ¥Zookeeperè¿›è¡Œæƒé™ç®¡ç†</li>
<li>åŠ å¯†ä¼ è¾“ï¼Œæ•°æ®ä¼ è¾“è¿›è¡ŒåŠ å¯†</li>
<li>æˆæƒç®¡ç†ï¼Œå®¢æˆ·ç«¯è¯»ã€å†™æ“ä½œå¯ä»¥è¿›è¡Œæˆæƒç®¡ç†</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--è¿æ¥å™¨<br>
<img src="https://Zu3zz.github.io/post-images/1571396233737.jpeg" alt=""></p>
</li>
</ol>
<h3 id="52-kafkaå¸¸è§åº”ç”¨åœºæ™¯">5.2 Kafkaå¸¸è§åº”ç”¨åœºæ™¯</h3>
<ul>
<li>æ¶ˆæ¯æœåŠ¡å™¨</li>
<li>ç½‘ç«™æ´»åŠ¨è·Ÿè¸ª</li>
<li>å®æ—¶æ•°æ®æµèšåˆ</li>
<li>æ—¥å¿—èšåˆ</li>
</ul>
<h3 id="53-kafkaå®‰è£…ä¸ç®€å•ç”¨ä¾‹">5.3 Kafkaå®‰è£…ä¸ç®€å•ç”¨ä¾‹</h3>
<h4 id="531-å®‰è£…">5.3.1 å®‰è£…</h4>
<ol>
<li>
<p>ä¸‹è½½å¹¶ä¸”è§£å‹ç¼©kafkaå®‰è£…åŒ… è¿™é‡Œé€‰æ‹©å½“å‰æœ€è¿‘çš„2.3.0ç‰ˆæœ¬</p>
<pre><code class="language-shell">$ wget http://apache.website-solution.net/kafka/2.3.0/kafka-2.3.0-src.tgz
$ tar -xzf kafka_2.12-2.3.0.tgz
$ cd kafka_2.12-2.3.0
</code></pre>
</li>
<li>
<p>å®‰è£…Gradleå’ŒZookeeperï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç† è¿™é‡Œç»Ÿä¸€ä½¿ç”¨</p>
<pre><code class="language-shell">$ brew install gradle
$ brew install zookeeper
</code></pre>
</li>
</ol>
<h4 id="532-å¯åŠ¨æœåŠ¡">5.3.2 å¯åŠ¨æœåŠ¡</h4>
<ol>
<li>
<p>å¯åŠ¨Zookeeper</p>
<pre><code class="language-shell">$ bin/zookeeper-server-start.sh config/zookeeper.properties
å¦‚æœæ˜¯ä½¿ç”¨homebrew ç›´æ¥ä½¿ç”¨ä¸‹é¢ä¸¤æ¡å‘½ä»¤å³å¯
$ zkServer
$ zkCli
</code></pre>
</li>
<li>
<p>å¯åŠ¨kafka</p>
<pre><code class="language-bash">$ bin/kafka-server-start.sh config/server.properties
</code></pre>
</li>
</ol>
<h4 id="533-åˆ›å»ºä¸€ä¸ªtopic">5.3.3 åˆ›å»ºä¸€ä¸ªTopic</h4>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨Topic</p>
<pre><code class="language-shell">$ bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹å½“å‰å·²ç»åˆ›å»ºçš„æµ‹è¯•Topic</p>
<pre><code class="language-shell">$ bin/kafka-topics.sh --list --bootstrap-server localhost:9092
test1
</code></pre>
<p>è¾“å‡ºtest1 è¯´æ˜åˆ›å»ºæˆåŠŸ</p>
</li>
</ol>
<h4 id="534-æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹">5.3.4 æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹</h4>
<ol>
<li>
<p>é€šè¿‡produceräº§ç”Ÿæ¶ˆæ¯</p>
<pre><code class="language-shell">$ bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
&gt;this is message one
&gt;this is message two
</code></pre>
</li>
<li>
<p>é€šè¿‡comsumeræ‹¿åˆ°æ‰€æœ‰å½“å‰æ¶ˆæ¯</p>
<pre><code class="language-shell">$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning
this is message one
this is message two
</code></pre>
<p>æˆåŠŸè¾“å‡ºè¾“å…¥çš„æ¶ˆæ¯</p>
</li>
</ol>
<h3 id="54-kafkaçš„é…ç½®">5.4 Kafkaçš„é…ç½®</h3>
<h4 id="541-kafkaæœåŠ¡å™¨é…ç½®æ–‡ä»¶">5.4.1 KafkaæœåŠ¡å™¨é…ç½®æ–‡ä»¶</h4>
<ul>
<li>
<p>é…ç½®æ–‡ä»¶ä½äºconfig/server.propertiesä¸‹</p>
</li>
<li>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°†é…ç½®æ–‡ä»¶å¯¼å‡ºè‡³broker.propertiesä¸­</p>
<pre><code class="language-shell">$ grep '^[^#]' server.properties &gt; broker.properties
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹broker.propertiesä¸­å»é™¤äº†æ³¨é‡Šçš„å†…å®¹</p>
<pre><code class="language-shell">broker.id=0
num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/tmp/kafka-logs
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
zookeeper.connect=localhost:2181
zookeeper.connection.timeout.ms=6000
group.initial.rebalance.delay.ms=0
</code></pre>
</li>
</ul>
<h4 id="542-kafkaé»˜è®¤é…ç½®é¡¹">5.4.2 Kafkaé»˜è®¤é…ç½®é¡¹</h4>
<blockquote>
<p>åŠ ç²—çš„ä¸ºé‡è¦é…ç½®</p>
</blockquote>
<ol>
<li>
<p>Disk IO</p>
<ul>
<li>num.io.threads = 8 è®¾ç½®brokerå¤„ç†ç£ç›˜IOçš„çº¿ç¨‹æ•°</li>
<li>num.partitions = 1 è®¾ç½®æ¯ä¸ªtopicçš„åˆ†åŒºä¸ªæ•°</li>
<li>num.recovery.threads.per.data.dir = 1 é…ç½®æ¯ä¸ªæ•°æ®æ¢å¤æ—¶çš„çº¿ç¨‹æ•°</li>
<li><strong>log.dirs = /tmp/kafka-logs kafkaæ•°æ®çš„å­˜æ”¾ç›®å½•</strong></li>
<li>log.retention.hours = 168 æ¶ˆæ¯çš„å­˜å‚¨æ—¶é—´ å•ä½æ˜¯å°æ—¶</li>
<li>log.segment.bytes = 1073741824 topicçš„partitionæ˜¯ä»¥segmentçš„å½¢å¼å­˜å‚¨çš„</li>
<li>log.retention.check.interval.ms=300000 å®šæ—¶æ£€æŸ¥æ–‡ä»¶å¤§å°</li>
</ul>
</li>
<li>
<p>Network</p>
<ul>
<li>num.network.threads = 3 è®¾ç½®brokerå¤„ç†ç½‘ç»œè¯·æ±‚çš„æœ€å¤§çº¿ç¨‹æ•° ä¸€èˆ¬å¯è®¾ç½®ä¸ºCPUçš„æ ¸æ•°</li>
<li>socket.send.buffer.bytes=102400 socketå‘é€ç¼“å†²åŒºçš„å¤§å°ï¼›-1å³ä¸ºæ“ä½œç³»ç»Ÿé»˜è®¤å€¼</li>
<li>socket.receive.buffer.bytes=102400 æ¥å—ç¼“å†²åŒºï¼›-1ä¸ºé»˜è®¤å€¼</li>
<li>socket.request.max.bytes=104857600 æ¯ä¸€ä¸ªsocketçš„æœ€å¤§å­—èŠ‚æ•°</li>
</ul>
</li>
<li>
<p>Cluster</p>
<ul>
<li>
<p>zookeeper.connect=localhost:2181 zookeeperçš„é›†ç¾¤åœ°å€ï¼›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œä¸­é—´ç”¨é€—å·åˆ†éš”</p>
</li>
<li>
<p>zookeeper.connection.timeout.ms=6000 è¿æ¥çš„è¶…æ—¶æ—¶é—´</p>
</li>
<li>
<p><strong>broker.id=0 brokeråœ¨é›†ç¾¤ä¸­çš„å”¯ä¸€æ ‡è¯†ï¼›å¦‚æœæ²¡æœ‰ï¼Œzookeeperä»1001å¼€å§‹é€’å¢</strong></p>
</li>
</ul>
</li>
</ol>
<h3 id="55-kafkaç›¸å…³æ¦‚å¿µ">5.5 Kafkaç›¸å…³æ¦‚å¿µ</h3>
<h4 id="551-å¸¸è§æ¦‚å¿µ-é›†ç¾¤">5.5.1 å¸¸è§æ¦‚å¿µ--é›†ç¾¤</h4>
<ul>
<li>Clusterï¼šé›†ç¾¤</li>
<li>Brokerï¼šæ¯ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªBroker</li>
<li>Producerï¼šç”Ÿäº§è€…</li>
<li>Consumerï¼šæ¶ˆè´¹è€…</li>
<li>Consumer Groupï¼šå®ç°topicå¹¿æ’­çš„æ‰‹æ®µ</li>
</ul>
<h4 id="552-å¸¸è§æ¦‚å¿µ-æ¶ˆæ¯">5.5.2 å¸¸è§æ¦‚å¿µ--æ¶ˆæ¯</h4>
<ul>
<li>Recordï¼šæ¯ä¸€æ¡æ¶ˆæ¯</li>
<li>Topicï¼šæ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½ä¼šæœ‰ä¸€ä¸ªTopic</li>
<li>Partitionï¼šæ¯ä¸ªTopicåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªPartition</li>
<li>Segmentï¼šæ¯ä¸ªPartitionåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªSegment</li>
<li>Offsetï¼šPartitionä¸­æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰çš„åºåˆ—å·ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯</li>
<li>Replicationï¼šå‰¯æœ¬ï¼›kafkaæ”¯æŒä»¥Partitionä¸ºå•ä½å¯¹æ¶ˆæ¯è¿›è¡Œå¤‡ä»½</li>
<li>Leaderï¼šæ‰€æœ‰è¯»å†™è¯·æ±‚éƒ½ç”±Leaderæ¥å¤„ç†</li>
</ul>
<h4 id="553-å¸¸è§æ¦‚å¿µ-topic">5.5.3 å¸¸è§æ¦‚å¿µ--Topic</h4>
<ul>
<li>
<p>Topicå¯ä»¥è¢«çœ‹åšæ˜¯ä¸€ä¸ªé˜Ÿåˆ—</p>
<figure data-type="image" tabindex="5"><img src="https://Zu3zz.github.io/post-images/1571396270203.png" alt="topic"></figure>
</li>
</ul>
<h4 id="554-å¸¸è§æ¦‚å¿µ-partition">5.5.4 å¸¸è§æ¦‚å¿µ--Partition</h4>
<figure data-type="image" tabindex="6"><img src="https://Zu3zz.github.io/post-images/1571396287204.png" alt="partition"></figure>
<h4 id="555-å¸¸è§æ¦‚å¿µ-segment">5.5.5 å¸¸è§æ¦‚å¿µ--Segment</h4>
<figure data-type="image" tabindex="7"><img src="https://Zu3zz.github.io/post-images/1571396308603.png" alt="segment"></figure>
<h4 id="556-å¸¸è§æ¦‚å¿µ-é›†ç¾¤">5.5.6 å¸¸è§æ¦‚å¿µ--é›†ç¾¤</h4>
<figure data-type="image" tabindex="8"><img src="https://Zu3zz.github.io/post-images/1571396330337.png" alt="é›†ç¾¤"></figure>
<h2 id="6-pythonä¸kafka">6. Pythonä¸Kafka</h2>
<ul>
<li>ç”±äºæœ‰å¾ˆå¤špythonåº“éƒ½å¯ä»¥ä½¿ç”¨kafka</li>
<li>çŸ¥åçš„æœ‰kafka-pythonï¼›pykafkaï¼›faustï¼›è¿™é‡Œä½¿ç”¨kafka-python</li>
</ul>
<blockquote>
<p>ä½¿ç”¨pipå®‰è£…</p>
<p>pip install kafka-python</p>
</blockquote>
<ol>
<li>
<p>åˆ›å»ºkafkaProducer.py</p>
<pre><code class="language-python">from kafka import KafkaProducer
import names

producer = KafkaProducer()

for _ in range(10):
    name = names.get_full_name()
    future = producer.send('test', bytes(name,'utf-8'))
    result = future.get(60)
    print(result)
</code></pre>
</li>
<li>
<p>åˆ›å»ºkafkaConsumer.py</p>
<pre><code class="language-python">from kafka import KafkaConsumer

consumer = KafkaConsumer('test',group_id='test01')

for msg in consumer:
    print(msg)
</code></pre>
</li>
<li>
<p>è¿›è¡Œæ•°æ®çš„äº§ç”Ÿä¸æ¶ˆè´¹</p>
<pre><code class="language-shell">$ python kafkaProducer.py 
RecordMetadata(topic='test', partition=0, topic_partition=TopicPartition(topic='test', partition=0), offset=14, timestamp=1571317704074, checksum=None, serialized_key_size=-1, serialized_value_size=15, serialized_header_size=-1)
RecordMetadata(topic='test', partition=0, topic_partition=TopicPartition(topic='test', partition=0), offset=15, timestamp=1571317704182, checksum=None, serialized_key_size=-1, serialized_value_size=12, serialized_header_size=-1)
...
</code></pre>
<pre><code class="language-shell">$ python kafkaConsumer.py 
ConsumerRecord(topic='test', partition=0, offset=14, timestamp=1571317704074, timestamp_type=0, key=None, value=b'Margaret Medina', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=15, serialized_header_size=-1)
ConsumerRecord(topic='test', partition=0, offset=15, timestamp=1571317704182, timestamp_type=0, key=None, value=b'Mark Mccarty', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=12, serialized_header_size=-1)
...
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡Produceräº§ç”Ÿçš„æ•°æ®å·²ç»è¢«ConsumeræˆåŠŸæ‹¿åˆ°ã€‚</p>
</li>
</ol>
<h2 id="7-æ¡†æ¶æ•´åˆ">7. æ¡†æ¶æ•´åˆ</h2>
<h3 id="71-é‡‡é›†æ—¥å¿—">7.1 é‡‡é›†æ—¥å¿—</h3>
<h4 id="711-æ—¥å¿—é‡‡é›†æ–¹æ¡ˆä»‹ç»">7.1.1 æ—¥å¿—é‡‡é›†æ–¹æ¡ˆä»‹ç»</h4>
<ul>
<li>flume</li>
<li>rsyslog</li>
<li>heka</li>
<li>logstash</li>
</ul>
<h4 id="712-nginxè®¿é—®æ—¥å¿—æ ¼å¼é…ç½®">7.1.2 nginxè®¿é—®æ—¥å¿—æ ¼å¼é…ç½®</h4>
<ul>
<li>
<p>è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼</p>
</li>
<li>
<p>ç›´æ¥è¾“å‡ºjson</p>
<pre><code class="language-shell">log_format json '{&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,'
								'&quot;host&quot;:&quot;$server_addr&quot;,'
								'&quot;clientip&quot;:&quot;$remote_addr&quot;,'
								'&quot;size&quot;:$body_bytes_sent,'
								'&quot;responsetime&quot;:$request_time,'
								'&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,'
								'&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,'
								'&quot;http_host&quot;:&quot;$host&quot;,'
								'&quot;url&quot;:&quot;$url&quot;,'
								'&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,'
								'&quot;refer&quot;:&quot;$http_referer&quot;,'
								'&quot;agent&quot;:&quot;$http_user_agent&quot;,'
								'&quot;status&quot;:&quot;$status&quot;}';
asscess_log /tmp/nginx/access.log json;
</code></pre>
</li>
<li>
<p>å¯ä»¥çœ‹åˆ°nginxçš„accessæ—¥å¿—å°±æ˜¯jsonæ ¼å¼çš„äº†</p>
</li>
</ul>
<h3 id="72-logstashé…ç½®">7.2 logstashé…ç½®</h3>
<ul>
<li>logstashé…ç½®ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†
<ol>
<li>input</li>
<li>filter</li>
<li>output</li>
</ol>
</li>
</ul>
<h4 id="721-kafkaæ’ä»¶">7.2.1 kafkaæ’ä»¶</h4>
<ul>
<li>
<p>é…ç½®logstash output kafkaæ’ä»¶</p>
<pre><code class="language-shell">input {
    file {
        path =&gt; &quot;/pot/openresty/nginx/logs/access.log&quot;
        codec =&gt; json
    }
}
filter {
    # å¯¹useragentè¿›è¡Œé¢„å¤„ç†
    useragent {
        source =&gt; &quot;agent&quot;
        target =&gt; &quot;user_agent&quot;
        remove_field =&gt; &quot;agent&quot;
    }
    # å¯¹ipåœ°å€çš„åœ°åŒºè¿›è¡Œé¢„å¤„ç†
    geoip {
        source =&gt; &quot;clientip&quot;
        target =&gt; &quot;geoip&quot;
    }
}
output {
    # debugç”¨
    stdout {
        codec =&gt; rubydebug
    }
    # logstash output kafkaæ’ä»¶
    kafka {
        codec =&gt; json
        topic_id =&gt; &quot;nginx&quot;
        # kafkaå¯¹å¤–åœ°å€
        bootstrap_servers =&gt; &quot;localhost:9092&quot;
    }
}
</code></pre>
</li>
</ul>
<h3 id="73-å¯åŠ¨æ—¥å¿—">7.3 å¯åŠ¨æ—¥å¿—</h3>
<p><strong>ä¾æ¬¡è¿è¡Œä¸€ä¸‹åº”ç”¨</strong></p>
<ul>
<li>nginx</li>
<li>logstash</li>
<li>kafka</li>
<li>Zookeeper</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SpringBootç³»åˆ—(2)----é…ç½®æ–‡ä»¶]]></title>
        <id>https://Zu3zz.github.io/post/springboot-2</id>
        <link href="https://Zu3zz.github.io/post/springboot-2">
        </link>
        <updated>2019-10-10T09:11:01.000Z</updated>
        <summary type="html"><![CDATA[<center>ğŸé‚£ä¹ˆåˆåˆ°äº†æˆ‘ä»¬SpringBootç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼ï¼</center>
<center>ğŸ€è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥è®²è®²SpringBootä¸­çš„é…ç½®ç›¸å…³é—®é¢˜ï¼Œä¾æ—§æœ‰æºç çº§åˆ«çš„åˆ†æå“¦ï¼</center>]]></summary>
        <content type="html"><![CDATA[<center>ğŸé‚£ä¹ˆåˆåˆ°äº†æˆ‘ä»¬SpringBootç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼ï¼</center>
<center>ğŸ€è¿™ä¸€ç¯‡ï¼Œæˆ‘ä»¬æ¥è®²è®²SpringBootä¸­çš„é…ç½®ç›¸å…³é—®é¢˜ï¼Œä¾æ—§æœ‰æºç çº§åˆ«çš„åˆ†æå“¦ï¼</center>
<!-- more -->
<h2 id="1-é…ç½®æ–‡ä»¶">1ã€é…ç½®æ–‡ä»¶</h2>
<ul>
<li>
<p>Spring Bootä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åæ˜¯å›ºå®šçš„</p>
<ol>
<li>application.properties</li>
<li>application.yml</li>
</ol>
</li>
<li>
<p>é…ç½®æ–‡ä»¶çš„ä½œç”¨ï¼šä¿®æ”¹SpringBootè‡ªåŠ¨é»˜è®¤çš„è®¾ç½®å€¼ï¼›SpringBootåœ¨åº•å±‚éƒ½ç»™æˆ‘ä»¬è‡ªåŠ¨é…ç½®å¥½äº†</p>
</li>
<li>
<p>YAML( YAML Ain't Markup Language)</p>
<ul>
<li>
<p>YAML A Markup Language: æ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€</p>
</li>
<li>
<p>YAML isn't Markup Language: ä¸æ˜¯ä¸€ä¸ªæ ‡è®°è¯­è¨€</p>
</li>
<li>
<p>æ ‡è®°è¯­è¨€ï¼š</p>
<ul>
<li>
<p>ä»¥å‰çš„é…ç½®æ–‡ä»¶ï¼šå¤§å¤šä½¿ç”¨ <strong>xxxx.xml</strong>æ–‡ä»¶ï¼›</p>
</li>
<li>
<p>YAML: <strong>ä»¥æ•°æ®ä¸ºä¸­å¿ƒ</strong>ï¼Œæ¯”JSONã€XMLæ›´é€‚åˆåšé…ç½®æ–‡ä»¶</p>
</li>
<li>
<p>YAMLé…ç½®ä¾‹å­</p>
<pre><code class="language-yml">server:
	port: 8081
</code></pre>
</li>
<li>
<p>XML:</p>
<pre><code class="language-xml">&lt;server&gt;
  &lt;port&gt;8081&lt;/port&gt;
&lt;/server&gt;
</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="2-yamlè¯­æ³•">2ã€ YAMLè¯­æ³•</h2>
<h3 id="1-åŸºæœ¬è¯­æ³•">1ã€åŸºæœ¬è¯­æ³•</h3>
<ul>
<li>
<p>k:(ç©ºæ ¼)v : è¡¨ç¤ºä¸€å¯¹é”®å€¼å¯¹(ç©ºæ ¼å¿…é¡»æœ‰)ï¼›</p>
</li>
<li>
<p>ä»¥<strong>ç©ºæ ¼</strong>çš„ç¼©è¿›æ¥æ§åˆ¶å±‚çº§å…³ç³»ï¼›åªè¦æ˜¯å·¦å¯¹é½çš„ä¸€åˆ—æ•°æ®ï¼Œéƒ½æ˜¯åŒä¸€å±‚çº§çš„</p>
<pre><code class="language-text">server:
	port: 8081
	path: /hello
</code></pre>
</li>
<li>
<p>å±æ€§å’Œå€¼ä¹Ÿæ˜¯å¤§å°å†™æ•æ„Ÿçš„</p>
</li>
</ul>
<h3 id="2-å€¼çš„å†™æ³•">2ã€å€¼çš„å†™æ³•</h3>
<h4 id="å­—é¢é‡æ™®é€šçš„å€¼æ•°å­—-å­—ç¬¦ä¸²-å¸ƒå°”å€¼">å­—é¢é‡ï¼šæ™®é€šçš„å€¼(æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼)</h4>
<ul>
<li>
<p>Kï¼šVï¼šå­—é¢ç›´æ¥æ¥å†™</p>
</li>
<li>
<p>å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·</p>
<ul>
<li>&quot;&quot;:åŒå¼•å·ï¼›ä¸ä¼šè½¬ä¹‰å­—ç¬¦ä¸²é‡Œé¢çš„ç‰¹æ®Šå­—ç¬¦ï¼›ç‰¹æ®Šå­—ç¬¦ä¼šä½œä¸ºæœ¬èº«æƒ³è¡¨è¾¾çš„æ„æ€</li>
</ul>
<pre><code class="language-yaml">name: &quot;zhangsan \n lisi&quot;
è¾“å‡ºï¼š zhangsan æ¢è¡Œ lisi
</code></pre>
<ul>
<li>:å•å¼•å·ï¼›ä¼šè½¬ä¹‰ç‰¹æ®Šå­—ç¬¦ï¼Œç‰¹æ®Šå­—ç¬¦æœ€ç»ˆåªæ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²æ•°æ®</li>
</ul>
<pre><code class="language-yaml">name: 'zhangsan \n lisi'
è¾“å‡ºï¼š zhangsan \n  lisi
</code></pre>
</li>
</ul>
<h4 id="å¯¹è±¡-mapå±æ€§å’Œå€¼é”®å€¼å¯¹">å¯¹è±¡ã€Map(å±æ€§å’Œå€¼)(é”®å€¼å¯¹)ï¼š</h4>
<ul>
<li>
<p>kï¼švï¼šåœ¨ä¸‹ä¸€è¡Œæ¥å†™å¯¹è±¡çš„å±æ€§å’Œå€¼çš„å…³ç³»ï¼›æ³¨æ„ç¼©è¿›</p>
<ul>
<li>å¯¹è±¡è¿˜æ˜¯kï¼švçš„æ–¹å¼</li>
</ul>
<pre><code class="language-yaml">friends:
	lastname: zhangsan
	age: 20
</code></pre>
<ul>
<li>è¡Œå†…å†™æ³•</li>
</ul>
<pre><code class="language-yaml">fridends: {lastName: zhangsan, age: 18}
</code></pre>
</li>
</ul>
<h4 id="æ•°ç»„list-set">æ•°ç»„ï¼ˆListã€Setï¼‰ï¼š</h4>
<ul>
<li>
<p>ç”¨- å€¼è¡¨ç¤ºæ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ </p>
<pre><code class="language-yaml">pets:
 - cat
 - dot
 - pig
</code></pre>
</li>
<li>
<p>è¡Œå†…å†™æ³•</p>
<pre><code class="language-yaml">pets: [cat,dog,pig]
</code></pre>
</li>
</ul>
<h2 id="3-é…ç½®æ–‡ä»¶å€¼æ³¨å…¥">3ã€é…ç½®æ–‡ä»¶å€¼æ³¨å…¥</h2>
<ul>
<li>é…ç½®æ–‡ä»¶</li>
</ul>
<pre><code class="language-yaml">person:
	lastName: hello
	age: 18
	boss: false
	birth: 2019/10/7
	maps: {k1:v1, k2:v2}
	lists:
	 - lisi
	 - zhaoliu
	dog:
		name: å°ç‹—
		age: 12
</code></pre>
<ul>
<li>JavaBean</li>
</ul>
<pre><code class="language-java">/**
 * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­
 * @ConfigurationPropertiesï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›
 *      prefix = &quot;person&quot;ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„
 * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ï¼›
 */
@Component
@ConfigurationProperties(prefix = &quot;person&quot;)
public class Person {
    private String lastName;
    private Integer age;
    private Boolean boss;
    private Date birth;
  
    private Map&lt;String,Object&gt; maps;
    private List&lt;Object&gt; lists;
    private Dog dog;
}
</code></pre>
<ul>
<li>æˆ‘ä»¬å¯ä»¥å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œä»¥åç¼–å†™é…ç½®å°±æœ‰æç¤ºäº†</li>
</ul>
<pre><code class="language-xml">&lt;!--å¯¼å…¥é…ç½®æ–‡ä»¶å¤„ç†å™¨ï¼Œé…ç½®æ–‡ä»¶è¿›è¡Œç»‘å®šå°±ä¼šæœ‰æç¤º--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
  &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</code></pre>
<ul>
<li>SpringBootä¸­çš„æµ‹è¯•ç±»</li>
</ul>
<pre><code class="language-java">/**
 * SpringBootå•å…ƒæµ‹è¯•
 * å¯ä»¥åœ¨æµ‹è¯•æœŸé—´å¾ˆæ–¹ä¾¿çš„ç±»ä¼¼ç¼–ç ä¸€æ ·è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ç­‰å®¹å™¨çš„åŠŸèƒ½
 */
@RunWith(SpringRunner.class)
@SpringBootTest
public class DemoApplicationTests {}
</code></pre>
<h4 id="1-propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç ">1ã€propertiesé…ç½®æ–‡ä»¶åœ¨ideaä¸­é»˜è®¤utf-8å¯èƒ½ä¼šä¹±ç </h4>
<ul>
<li>è°ƒæ•´IDEAä¸­çš„é»˜è®¤ç¼–ç <img src="https://Zu3zz.github.io/post-images/1571315004181.png" alt="è°ƒæ•´IDEA"></li>
</ul>
<h4 id="2-valueè·å–å€¼å’Œconfigurationpropertiesè·å–å€¼æ¯”è¾ƒ">2ã€@Valueè·å–å€¼å’Œ@ConfigurationPropertiesè·å–å€¼æ¯”è¾ƒ</h4>
<table>
<thead>
<tr>
<th></th>
<th>@ConfigurationProperties</th>
<th>@Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>åŠŸèƒ½</td>
<td>æ‰¹é‡æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å±æ€§</td>
<td>ä¸€ä¸ªä¸ªæŒ‡å®š</td>
</tr>
<tr>
<td>æ¾æ•£ç»‘å®š(é©¼å³°ä¸ä¸‹åˆ’çº¿è½¬æ¢)</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>SpEL(Springè¡¨è¾¾å¼)</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
</tr>
<tr>
<td>JSR303æ•°æ®æ ¡éªŒ(@Validated)</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
<tr>
<td>å¤æ‚ç±»å‹å°è£…</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
</tr>
</tbody>
</table>
<ul>
<li>é…ç½®æ–‡ä»¶ymlè¿˜æ˜¯propertiesä»–ä»¬éƒ½èƒ½è·å–åˆ°å€¼ï¼›</li>
<li>å¦‚æœè¯´ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨æŸä¸ªä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦è·å–ä¸€ä¸‹é…ç½®æ–‡ä»¶ä¸­çš„æŸé¡¹å€¼ï¼Œä½¿ç”¨@Valueï¼›</li>
<li>å¦‚æœè¯´ï¼Œæˆ‘ä»¬ä¸“é—¨ç¼–å†™äº†ä¸€ä¸ªJavaBeanæ¥å’Œé…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä½¿ç”¨@ConfigurationPropertiesï¼›</li>
</ul>
<h4 id="3-é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ">3ã€é…ç½®æ–‡ä»¶æ³¨å…¥å€¼æ•°æ®æ ¡éªŒ</h4>
<pre><code class="language-java">@Component
@ConfigurationProperties(prefix = &quot;person&quot;)
@Validated
public class Person {
    /**
     * &lt;bean class=&quot;Person&quot;&gt;
     * 	&lt;property name=&quot;lastName&quot; value=&quot;å­—é¢é‡/${key}ä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼/#{Springè¡¨è¾¾å¼}&quot;&gt;
     	&lt;/property&gt;
     * &lt;bean/&gt;
     */
   	// lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼
    @Email
    // @Value(&quot;${person.last-name}&quot;)
    private String lastName;
    // @Value(&quot;#{11*2}&quot;)
    private Integer age;
    // @Value(&quot;true&quot;)
    private Boolean boss;
    private Date birth;
    private Map&lt;String,Object&gt; maps;
    private List&lt;Object&gt; lists;
    private Dog dog;
}
</code></pre>
<h4 id="4-propertysource-importresource">4ã€@PropertySource &amp; @ImportResource</h4>
<ul>
<li><strong>@PropertySource:</strong> ï¼š åŠ è½½æŒ‡å®šçš„é…ç½®æ–‡ä»¶</li>
</ul>
<pre><code class="language-java">/**
 * å°†é…ç½®æ–‡ä»¶ä¸­é…ç½®çš„æ¯ä¸€ä¸ªå±æ€§çš„å€¼ï¼Œæ˜ å°„åˆ°è¿™ä¸ªç»„ä»¶ä¸­
 * @ConfigurationPropertiesï¼šå‘Šè¯‰SpringBootå°†æœ¬ç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œé…ç½®æ–‡ä»¶ä¸­ç›¸å…³çš„é…ç½®è¿›è¡Œç»‘å®šï¼›
 *      prefix = &quot;person&quot;ï¼šé…ç½®æ–‡ä»¶ä¸­å“ªä¸ªä¸‹é¢çš„æ‰€æœ‰å±æ€§è¿›è¡Œä¸€ä¸€æ˜ å°„
 * åªæœ‰è¿™ä¸ªç»„ä»¶æ˜¯å®¹å™¨ä¸­çš„ç»„ä»¶ï¼Œæ‰èƒ½å®¹å™¨æä¾›çš„@ConfigurationPropertiesåŠŸèƒ½ï¼›
 *  @ConfigurationProperties(prefix = &quot;person&quot;)é»˜è®¤ä»å…¨å±€é…ç½®æ–‡ä»¶ä¸­è·å–å€¼ï¼›
 */
@PropertySource(value = {&quot;classpath:person.properties&quot;})
@Component
@ConfigurationProperties(prefix = &quot;person&quot;)
//@Validated
public class Person {
   	//lastNameå¿…é¡»æ˜¯é‚®ç®±æ ¼å¼
   	// @Email
    //@Value(&quot;${person.last-name}&quot;)
    private String lastName;
    //@Value(&quot;#{11*2}&quot;)
    private Integer age;
    //@Value(&quot;true&quot;)
    private Boolean boss;
}
</code></pre>
<ul>
<li>
<p><strong>@ImportResource</strong>: å¯¼å…¥Sprinigçš„é…ç½®æ–‡ä»¶ï¼Œè®©é…ç½®æ–‡ä»¶é‡Œé¢çš„å†…å®¹ç”Ÿæ•ˆ</p>
</li>
<li>
<p>Spring Booté‡Œé¢æ²¡æœ‰Springçš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬è‡ªå·±ç¼–å†™çš„é…ç½®æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è‡ªåŠ¨è¯†åˆ«ï¼›</p>
</li>
<li>
<p>æƒ³è®©Springçš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼ŒåŠ è½½è¿›æ¥ï¼Œ@<strong>ImportResource</strong>æ ‡æ³¨åœ¨ä¸€ä¸ªé…ç½®ç±»ä¸Š</p>
<pre><code class="language-java">@ImportResource(locations = {&quot;classpath:beans.xml&quot;})
å¯¼å…¥Springçš„é…ç½®æ–‡ä»¶è®©å…¶ç”Ÿæ•ˆ
</code></pre>
</li>
<li>
<p>ä¸æ¥ç¼–å†™Springä¸­çš„é…ç½®æ–‡ä»¶</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;
    &lt;bean id=&quot;helloService&quot; class=&quot;com.zth.springboot.service.HelloService&quot;&gt;&lt;/bean&gt;
&lt;/beans&gt;
</code></pre>
</li>
<li>
<p><strong>ä¸Šé¢è¿™ç§æ–¹å¼åœ¨SpringBoot2.xä¸­å·²ç»ä¸å†ä½¿ç”¨ï¼ï¼ï¼ï¼ï¼ï¼ï¼</strong></p>
</li>
<li>
<p>SpringBootæ¨èç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶çš„æ–¹å¼ï¼šæ¨èä½¿ç”¨å…¨æ³¨è§£çš„æ–¹å¼</p>
<ol>
<li>é…ç½®ç±»**@Configuration** -----&gt; Springé…ç½®æ–‡ä»¶</li>
<li>ä½¿ç”¨**@Bean**ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</li>
</ol>
<pre><code class="language-java">/**
 * @Configurationï¼šæŒ‡æ˜å½“å‰ç±»æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼›å°±æ˜¯æ¥æ›¿ä»£ä¹‹å‰çš„Springé…ç½®æ–‡ä»¶
 * åœ¨é…ç½®æ–‡ä»¶ä¸­ç”¨&lt;bean&gt;&lt;bean/&gt;æ ‡ç­¾æ·»åŠ ç»„ä»¶
 */
@Configuration
public class MyAppConfig {
    //å°†æ–¹æ³•çš„è¿”å›å€¼æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›å®¹å™¨ä¸­è¿™ä¸ªç»„ä»¶é»˜è®¤çš„idå°±æ˜¯æ–¹æ³•å
    @Bean
    public HelloService helloService02(){
        System.out.println(&quot;é…ç½®ç±»@Beanç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶äº†...&quot;);
        return new HelloService();
    }
}
</code></pre>
</li>
</ul>
<h2 id="4-é…ç½®æ–‡ä»¶å ä½ç¬¦">4ã€é…ç½®æ–‡ä»¶å ä½ç¬¦</h2>
<h3 id="1-éšæœºæ•°">1ã€éšæœºæ•°</h3>
<pre><code class="language-java">${random.value}ã€${random.int}ã€${random.long}
${random.int(10)}ã€${random.int[1024,65536]}
</code></pre>
<h3 id="2-å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼å¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨æŒ‡å®šé»˜è®¤å€¼">2ã€å ä½ç¬¦è·å–ä¹‹å‰é…ç½®çš„å€¼ï¼Œå¦‚æœæ²¡æœ‰å¯ä»¥æ˜¯ç”¨:æŒ‡å®šé»˜è®¤å€¼</h3>
<pre><code class="language-properties">person.last-name=å¼ ä¸‰${random.uuid}
person.age=${random.int}
person.birth=2017/12/15
person.boss=false
person.maps.k1=v1
person.maps.k2=14
person.lists=a,b,c
person.dog.name=${person.hello:hello}_dog
person.dog.age=15
</code></pre>
<h2 id="5-profile">5ã€Profile</h2>
<h3 id="1-å¤šprofileæ–‡ä»¶">1ã€å¤šProfileæ–‡ä»¶</h3>
<ul>
<li>æˆ‘ä»¬åœ¨ä¸»é…ç½®æ–‡ä»¶ç¼–å†™çš„æ—¶å€™ï¼Œæ–‡ä»¶åå¯ä»¥æ˜¯   application-{profile}.properties/yml</li>
<li>å½“åˆ›å»ºå¤šä¸ªæ–‡ä»¶æ—¶ï¼Œé»˜è®¤ä½¿ç”¨application.propertiesçš„é…ç½®ï¼›</li>
</ul>
<h3 id="2-ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼">2ã€ymlæ”¯æŒå¤šæ–‡æ¡£å—æ–¹å¼</h3>
<ul>
<li>ymlæ›´ç®€æ´ä¸€äº›</li>
</ul>
<pre><code class="language-yml">server:
  port: 8081
spring:
  profiles:
    active: prod # æ¿€æ´»prodç¯å¢ƒ
---
server:
  port: 8083
spring:
  profiles: dev
---
server:
  port: 8084
spring:
  profiles: prod  #æŒ‡å®šå±äºå“ªä¸ªç¯å¢ƒ
</code></pre>
<h3 id="3-æ¿€æ´»æŒ‡å®šprofile">3ã€æ¿€æ´»æŒ‡å®šprofile</h3>
<p>1ã€åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®š  spring.profiles.active=devï¼ˆymlä¸­é…ç½®å¦‚ä¸Šï¼‰</p>
<p>2ã€å‘½ä»¤è¡Œï¼š</p>
<pre><code class="language-shell">java -jar spring-boot-02-config-0.0.1-SNAPSHOT.jar --spring.profiles.active=devï¼›
</code></pre>
<ul>
<li>å¯ä»¥ç›´æ¥åœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œé…ç½®ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°ï¼Œåœ¨IDEAä¸­é…ç½®**--spring.profiles.active=dev**</li>
</ul>
<p>3ã€è™šæ‹Ÿæœºå‚æ•°ï¼›</p>
<pre><code class="language-shell">-Dspring.profiles.active=dev
</code></pre>
<h2 id="6-é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®">6ã€é…ç½®æ–‡ä»¶åŠ è½½ä½ç½®</h2>
<ul>
<li>
<p>springboot å¯åŠ¨ä¼šæ‰«æä»¥ä¸‹ä½ç½®çš„application.propertiesæˆ–è€…application.ymlæ–‡ä»¶ä½œä¸ºSpring bootçš„é»˜è®¤é…ç½®æ–‡ä»¶</p>
<ol>
<li>â€“file:./config/</li>
<li>â€“file:./</li>
<li>â€“classpath:/config/</li>
<li>â€“classpath:/</li>
</ol>
</li>
<li>
<p>ä¼˜å…ˆçº§ç”±é«˜åˆ°åº•ï¼Œé«˜ä¼˜å…ˆçº§çš„é…ç½®ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼›</p>
</li>
<li>
<p>SpringBootä¼šä»è¿™å››ä¸ªä½ç½®å…¨éƒ¨åŠ è½½ä¸»é…ç½®æ–‡ä»¶ï¼›<strong>äº’è¡¥é…ç½®</strong>ï¼›</p>
</li>
<li>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡spring.config.locationæ¥æ”¹å˜é»˜è®¤çš„é…ç½®æ–‡ä»¶ä½ç½®</p>
</li>
<li>
<p><strong>é¡¹ç›®æ‰“åŒ…å¥½ä»¥åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°çš„å½¢å¼ï¼Œå¯åŠ¨é¡¹ç›®çš„æ—¶å€™æ¥æŒ‡å®šé…ç½®æ–‡ä»¶çš„æ–°ä½ç½®ï¼›æŒ‡å®šé…ç½®æ–‡ä»¶å’Œé»˜è®¤åŠ è½½çš„è¿™äº›é…ç½®æ–‡ä»¶å…±åŒèµ·ä½œç”¨å½¢æˆäº’è¡¥é…ç½®ï¼›</strong></p>
<pre><code class="language-shell">java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar --spring.config.location=G:/application.properties
</code></pre>
</li>
</ul>
<h2 id="7-å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº">7ã€å¤–éƒ¨é…ç½®åŠ è½½é¡ºåº</h2>
<ul>
<li>
<p><strong>SpringBootä¹Ÿå¯ä»¥ä»ä»¥ä¸‹ä½ç½®åŠ è½½é…ç½®ï¼› ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼›é«˜ä¼˜å…ˆçº§çš„é…ç½®è¦†ç›–ä½ä¼˜å…ˆçº§çš„é…ç½®ï¼Œæ‰€æœ‰çš„é…ç½®ä¼šå½¢æˆäº’è¡¥é…ç½®</strong></p>
<ol>
<li><strong>å‘½ä»¤è¡Œå‚æ•°</strong></li>
</ol>
<ul>
<li>
<p>æ‰€æœ‰çš„é…ç½®éƒ½å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè¿›è¡ŒæŒ‡å®š</p>
<pre><code class="language-shell">java -jar spring-boot-02-config-02-0.0.1-SNAPSHOT.jar --server.port=8087  --server.context-path=/abc
</code></pre>
</li>
<li>
<p>å¤šä¸ªé…ç½®ç”¨ç©ºæ ¼åˆ†å¼€ï¼› --é…ç½®é¡¹=å€¼</p>
</li>
</ul>
<ol start="2">
<li>æ¥è‡ªjava: comp/envçš„JNDIå±æ€§</li>
<li>Javaç³»ç»Ÿå±æ€§(System.getProperties())</li>
<li>æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡</li>
<li>RandomValuePropertySourceé…ç½®çš„random.*å±æ€§å€¼</li>
<li><strong>jaråŒ…å¤–éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></li>
<li><strong>jaråŒ…å†…éƒ¨çš„application-{profile}.propertiesæˆ–application.yml(å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></li>
</ol>
</li>
<li>
<p><strong>å†æ¥åŠ è½½ä¸å¸¦profile</strong></p>
<ol start="8">
<li><strong>jaråŒ…å¤–éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></li>
<li><strong>jaråŒ…å†…éƒ¨çš„application.propertiesæˆ–application.yml(ä¸å¸¦spring.profile)é…ç½®æ–‡ä»¶</strong></li>
<li>@Configurationæ³¨è§£ç±»ä¸Šçš„@PropertySource</li>
<li>é€šè¿‡SpringApplication.setDefaultPropertiesæŒ‡å®šçš„é»˜è®¤å±æ€§</li>
</ol>
</li>
<li>
<p>æ‰€æœ‰æ”¯æŒçš„é…ç½®åŠ è½½æ¥æºï¼›<a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#boot-features-external-config">å‚è€ƒå®˜æ–¹æ–‡æ¡£</a></p>
</li>
</ul>
<h2 id="8-è‡ªåŠ¨é…ç½®åŸç†">8ã€è‡ªåŠ¨é…ç½®åŸç†</h2>
<ul>
<li>é…ç½®æ–‡ä»¶åˆ°åº•èƒ½å†™ä»€ä¹ˆï¼Ÿæ€ä¹ˆå†™ï¼Ÿè‡ªåŠ¨é…ç½®åŸç†ï¼Ÿ</li>
<li><a href="https://docs.spring.io/spring-boot/docs/1.5.9.RELEASE/reference/htmlsingle/#common-application-properties">é…ç½®æ–‡ä»¶èƒ½é…ç½®çš„å±æ€§å‚ç…§</a></li>
</ul>
<h3 id="1-è‡ªåŠ¨é…ç½®åŸç†">1ã€<strong>è‡ªåŠ¨é…ç½®åŸç†</strong></h3>
<ol>
<li>
<p>SpringBootå¯åŠ¨çš„æ—¶å€™åŠ è½½ä¸»é…ç½®ç±»ï¼Œå¼€å¯äº†è‡ªåŠ¨é…ç½®åŠŸèƒ½**@EnableAutoConfiguration**</p>
</li>
<li>
<p><strong>@EnableAutoConfigurationçš„ä½œç”¨</strong></p>
<ul>
<li>
<p>åˆ©ç”¨EnableAutoConfigurationImportSelectorç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€äº›ç»„ä»¶ï¼Ÿ</p>
</li>
<li>
<p>å¯ä»¥æŸ¥çœ‹selectImports()æ–¹æ³•çš„å†…å®¹</p>
</li>
<li>
<p>List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);è·å–å€™é€‰çš„é…ç½®</p>
<pre><code class="language-java">SpringFactoriesLoader.loadFactoryNames()
æ‰«ææ‰€æœ‰jaråŒ…ç±»è·¯å¾„ä¸‹  META-INF/spring.factories
æŠŠæ‰«æåˆ°çš„è¿™äº›æ–‡ä»¶çš„å†…å®¹åŒ…è£…æˆpropertieså¯¹è±¡
ä»propertiesä¸­è·å–åˆ°EnableAutoConfiguration.classç±»ï¼ˆç±»åï¼‰å¯¹åº”çš„å€¼ï¼Œç„¶åæŠŠä»–ä»¬æ·»åŠ åœ¨å®¹å™¨ä¸­
</code></pre>
</li>
<li>
<p>å°†ç±»è·¯å¾„ä¸‹çš„ META-INF/spring.factoriesé‡Œé¢é…ç½®çš„æ‰€æœ‰EnableAutoConfigurationçš„å€¼åŠ å…¥åˆ°äº†å®¹å™¨ä¸­ï¼›</p>
</li>
</ul>
<pre><code class="language-properties"># Auto Configure
org.springframework.boot.autoconfigure.EnableAutoConfiguration=\
org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\
org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\
org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\
org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration,\
org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration,\...
# çœç•¥è‹¥å¹²
</code></pre>
<ul>
<li>æ¯ä¸€ä¸ªè¿™æ ·çš„  xxxAutoConfigurationç±»éƒ½æ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼Œéƒ½åŠ å…¥åˆ°å®¹å™¨ä¸­ï¼›ç”¨ä»–ä»¬æ¥åšè‡ªåŠ¨é…ç½®ï¼›</li>
</ul>
</li>
<li>
<p>æ¯ä¸€ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œè‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</p>
</li>
<li>
<p>ä»¥**HttpEncodingAutoConfigurationï¼ˆHttpç¼–ç è‡ªåŠ¨é…ç½®ï¼‰**ä¸ºä¾‹è§£é‡Šè‡ªåŠ¨é…ç½®åŸç†ï¼›</p>
<pre><code class="language-java">// è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œä»¥å‰ç¼–å†™çš„é…ç½®æ–‡ä»¶ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶
@Configuration

// å¯åŠ¨æŒ‡å®šç±»çš„ConfigurationPropertiesåŠŸèƒ½ï¼›å°†é…ç½®æ–‡ä»¶ä¸­å¯¹åº”çš„å€¼å’ŒHttpPropertiesç»‘å®šèµ·æ¥ï¼›å¹¶æŠŠHttpPropertiesåŠ å…¥åˆ°iocå®¹å™¨ä¸­
@EnableConfigurationProperties(HttpProperties.class)

// Springåº•å±‚@Conditionalæ³¨è§£ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³æŒ‡å®šçš„æ¡ä»¶ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„é…ç½®å°±ä¼šç”Ÿæ•ˆï¼›åˆ¤æ–­å½“å‰åº”ç”¨æ˜¯å¦æ˜¯webåº”ç”¨ï¼Œå¦‚æœæ˜¯ï¼Œå½“å‰é…ç½®ç±»ç”Ÿæ•ˆ
@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)

// åˆ¤æ–­å½“å‰é¡¹ç›®æœ‰æ²¡æœ‰è¿™ä¸ªç±»CharacterEncodingFilterï¼›SpringMVCä¸­è¿›è¡Œä¹±ç è§£å†³çš„è¿‡æ»¤å™¨ï¼›
@ConditionalOnClass(CharacterEncodingFilter.class)

// åˆ¤æ–­é…ç½®æ–‡ä»¶ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé…ç½®  spring.http.encoding.enabledï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ¤æ–­ä¹Ÿæ˜¯æˆç«‹çš„
@ConditionalOnProperty(prefix = &quot;spring.http.encoding&quot;, value = &quot;enabled&quot;, matchIfMissing = true)
public class HttpEncodingAutoConfiguration {
  // è¿™é‡Œä¸SpringBooté…ç½®æ–‡ä»¶è¿›è¡Œæ˜ å°„
  private final HttpProperties.Encoding properties;
  
  // åªæœ‰ä¸€ä¸ªæœ‰å‚æ„é€ å™¨çš„æƒ…å†µä¸‹ï¼Œå‚æ•°çš„å€¼å°±ä¼šä»å®¹å™¨ä¸­æ‹¿
	public HttpEncodingAutoConfiguration(HttpProperties properties) {
		this.properties = properties.getEncoding();
	}
	@Bean // ç»™å®¹å™¨ä¸­æ·»åŠ ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶çš„æŸäº›å€¼éœ€è¦ä»propertiesä¸­è·å–
	@ConditionalOnMissingBean // åˆ¤æ–­å®¹å™¨ä¸­æ˜¯å¦æœ‰è¿™ä¸ªç»„ä»¶
	public CharacterEncodingFilter characterEncodingFilter() {
		CharacterEncodingFilter filter = new OrderedCharacterEncodingFilter();
		filter.setEncoding(this.properties.getCharset().name());
		filter.setForceRequestEncoding(this.properties.shouldForce(Type.REQUEST));
		filter.setForceResponseEncoding(this.properties.shouldForce(Type.RESPONSE));
		return filter;
	}
}
</code></pre>
<ul>
<li>
<p>æ ¹æ®å½“å‰ä¸åŒçš„æ¡ä»¶åˆ¤æ–­ï¼Œå†³å®šè¿™ä¸ªé…ç½®ç±»ï¼Œæ˜¯å¦ç”Ÿæ•ˆ</p>
</li>
<li>
<p>ä¸€æ—¦è¿™ä¸ªé…ç½®ç±»ç”Ÿæ•ˆï¼›è¿™ä¸ªé…ç½®ç±»å°±ä¼šç»™å®¹å™¨ä¸­æ·»åŠ å„ç§ç»„ä»¶ï¼›è¿™äº›ç»„ä»¶çš„å±æ€§éƒ½æ˜¯åœ¨xxxxPropertiesç±»ä¸­å°è£…ç€ï¼›é…ç½®æ–‡ä»¶èƒ½é…ç½®ä»€ä¹ˆå°±å¯ä»¥å‚ç…§æŸä¸ªåŠŸèƒ½å¯¹åº”çš„è¿™ä¸ªé…ç½®ç±»</p>
<pre><code class="language-java">// ä»é…ç½®æ–‡ä»¶ä¸­è·å–æŒ‡å®šçš„å€¼å’Œbeançš„å±æ€§è¿›è¡Œç»‘å®š
@ConfigurationProperties(prefix = &quot;spring.http&quot;)
public class HttpProperties {
  public static class Encoding {
    public static final Charset DEFAULT_CHARSET = StandardCharsets.UTF_8;
  }
}
</code></pre>
</li>
</ul>
</li>
</ol>
<ul>
<li>
<p><strong>SpringBootçš„ç²¾é«“</strong></p>
<ol>
<li><strong>SpringBootä¼šåŠ è½½å¤§é‡çš„è‡ªåŠ¨é…ç½®ç±»</strong></li>
<li><strong>æˆ‘ä»¬çœ‹æˆ‘ä»¬éœ€è¦çš„åŠŸèƒ½æœ‰æ²¡æœ‰SpringBooté»˜è®¤å†™å¥½çš„è‡ªåŠ¨é…ç½®ç±»</strong></li>
<li><strong>æˆ‘ä»¬å†æ¥çœ‹è¿™ä¸ªè‡ªåŠ¨é…ç½®ç±»ä¸­åˆ°åº•é…ç½®äº†å“ªäº›ç»„ä»¶ï¼›(åªè¦æˆ‘ä»¬è¦ç”¨çš„ç»„ä»¶æœ‰ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ¥é…ç½®äº†)</strong></li>
<li><strong>ç»™å®¹å™¨ä¸­è‡ªåŠ¨é…ç½®ç±»æ·»åŠ ç»„ä»¶çš„æ—¶å€™ï¼Œä¼šä»propertiesç±»ä¸­è·å–æŸäº›å±æ€§ã€‚æˆ‘ä»¬å°±å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šè¿™äº›å±æ€§çš„å€¼ï¼›</strong></li>
</ol>
</li>
<li>
<p>xxxxAutoConfigurartionï¼šè‡ªåŠ¨é…ç½®ç±»ï¼›</p>
</li>
<li>
<p>ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶</p>
</li>
<li>
<p>xxxxProperties:å°è£…é…ç½®æ–‡ä»¶ä¸­ç›¸å…³å±æ€§ï¼›</p>
</li>
</ul>
<h3 id="2-ç»†èŠ‚">2ã€ç»†èŠ‚</h3>
<h4 id="1-conditionalæ´¾ç”Ÿæ³¨è§£springä¸­åŸç”Ÿçš„conditionalä½œç”¨">1ã€@Conditionalæ´¾ç”Ÿæ³¨è§£(Springä¸­åŸç”Ÿçš„@Conditionalä½œç”¨)</h4>
<ul>
<li>
<p>ä½œç”¨ï¼šå¿…é¡»æ˜¯@ConditionalæŒ‡å®šçš„æ¡ä»¶æˆç«‹ï¼Œæ‰ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ï¼Œé…ç½®é‡Œé¢çš„æ‰€æœ‰å†…å®¹æ‰ç”Ÿæ•ˆï¼›</p>
<table>
<thead>
<tr>
<th>@Conditionalæ‰©å±•æ³¨è§£</th>
<th>ä½œç”¨ï¼ˆåˆ¤æ–­æ˜¯å¦æ»¡è¶³å½“å‰æŒ‡å®šæ¡ä»¶ï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>@ConditionalOnJava</td>
<td>ç³»ç»Ÿçš„javaç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚</td>
</tr>
<tr>
<td>@ConditionalOnBean</td>
<td>å®¹å™¨ä¸­å­˜åœ¨æŒ‡å®šBeanï¼›</td>
</tr>
<tr>
<td>@ConditionalOnMissingBean</td>
<td>å®¹å™¨ä¸­ä¸å­˜åœ¨æŒ‡å®šBeanï¼›</td>
</tr>
<tr>
<td>@ConditionalOnExpression</td>
<td>æ»¡è¶³SpELè¡¨è¾¾å¼æŒ‡å®š</td>
</tr>
<tr>
<td>@ConditionalOnClass</td>
<td>ç³»ç»Ÿä¸­æœ‰æŒ‡å®šçš„ç±»</td>
</tr>
<tr>
<td>@ConditionalOnMissingClass</td>
<td>ç³»ç»Ÿä¸­æ²¡æœ‰æŒ‡å®šçš„ç±»</td>
</tr>
<tr>
<td>@ConditionalOnSingleCandidate</td>
<td>å®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªæŒ‡å®šçš„Beanï¼Œæˆ–è€…è¿™ä¸ªBeanæ˜¯é¦–é€‰Bean</td>
</tr>
<tr>
<td>@ConditionalOnProperty</td>
<td>ç³»ç»Ÿä¸­æŒ‡å®šçš„å±æ€§æ˜¯å¦æœ‰æŒ‡å®šçš„å€¼</td>
</tr>
<tr>
<td>@ConditionalOnResource</td>
<td>ç±»è·¯å¾„ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šèµ„æºæ–‡ä»¶</td>
</tr>
<tr>
<td>@ConditionalOnWebApplication</td>
<td>å½“å‰æ˜¯webç¯å¢ƒ</td>
</tr>
<tr>
<td>@ConditionalOnNotWebApplication</td>
<td>å½“å‰ä¸æ˜¯webç¯å¢ƒ</td>
</tr>
<tr>
<td>@ConditionalOnJndi</td>
<td>JNDIå­˜åœ¨æŒ‡å®šé¡¹</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h4 id="2-è‡ªåŠ¨é…ç½®ç±»å¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆ">2ã€è‡ªåŠ¨é…ç½®ç±»å¿…é¡»åœ¨ä¸€å®šçš„æ¡ä»¶ä¸‹æ‰èƒ½ç”Ÿæ•ˆ</h4>
<ul>
<li>
<p>æˆ‘ä»¬æ€ä¹ˆçŸ¥é“å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆï¼Ÿ</p>
</li>
<li>
<p><strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯ç”¨  debug=trueå±æ€§ï¼›æ¥è®©æ§åˆ¶å°æ‰“å°è‡ªåŠ¨é…ç½®æŠ¥å‘Š</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„çŸ¥é“å“ªäº›å“ªäº›è‡ªåŠ¨é…ç½®ç±»ç”Ÿæ•ˆ</p>
<pre><code class="language-shell">============================
CONDITIONS EVALUATION REPORT
============================
Positive matches: ï¼ˆè‡ªåŠ¨é…ç½®ç±»å¯ç”¨çš„ï¼‰
-----------------
CodecsAutoConfiguration matched:
    - @ConditionalOnClass found required class 'org.springframework.http.codec.CodecConfigurer' (OnClassCondition)

CodecsAutoConfiguration.JacksonCodecConfiguration matched:
    - @ConditionalOnClass found required class 'com.fasterxml.jackson.databind.ObjectMapper' (OnClassCondition)
    ä¸‹é¢è‹¥å¹²çœç•¥...
    
Negative matches:ï¼ˆæ²¡æœ‰å¯åŠ¨ï¼Œæ²¡æœ‰åŒ¹é…æˆåŠŸçš„è‡ªåŠ¨é…ç½®ç±»ï¼‰
-----------------
ActiveMQAutoConfiguration:
    Did not match:
        - @ConditionalOnClass did not find required classes 'javax.jms.ConnectionFactory', 'org.apache.activemq.ActiveMQConnectionFactory' (OnClassCondition)

AopAutoConfiguration:
    Did not match:
        - @ConditionalOnClass did not find required classes 'org.aspectj.lang.annotation.Aspect', 'org.aspectj.lang.reflect.Advice' (OnClassCondition)
</code></pre>
</li>
</ul>
<hr>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[SpringBootç³»åˆ—(1)----SpringBootå…¥é—¨]]></title>
        <id>https://Zu3zz.github.io/post/springboot-1</id>
        <link href="https://Zu3zz.github.io/post/springboot-1">
        </link>
        <updated>2019-10-07T08:53:18.000Z</updated>
        <summary type="html"><![CDATA[<center>ğŸ‰å¼€æ–°å‘å•¦ Javaåç«¯ç³»åˆ—ä¹‹SpringBootç¯‡ç¬¬ä¸€ç« ï¼šSpringBootå…¥é—¨ğŸ‰</center>
<center>ğŸŠğŸŠæœ‰æºç çº§åˆ«çš„åˆ†æå“¦~~ğŸŠğŸŠ</center>]]></summary>
        <content type="html"><![CDATA[<center>ğŸ‰å¼€æ–°å‘å•¦ Javaåç«¯ç³»åˆ—ä¹‹SpringBootç¯‡ç¬¬ä¸€ç« ï¼šSpringBootå…¥é—¨ğŸ‰</center>
<center>ğŸŠğŸŠæœ‰æºç çº§åˆ«çš„åˆ†æå“¦~~ğŸŠğŸŠ</center>
<!-- more -->
<h2 id="1-spring-boot-å…¥é—¨">1ã€Spring Boot å…¥é—¨</h2>
<h3 id="1-spring-boot-ç®€ä»‹">1ã€ Spring Boot ç®€ä»‹</h3>
<blockquote>
<p>ç®€åŒ–Springåº”ç”¨å¼€å‘çš„ä¸€ä¸ªæ¡†æ¶;</p>
<p>æ•´ä¸ªSpringæŠ€æœ¯æ ˆçš„ä¸€ä¸ªå¤§æ•´åˆ;</p>
<p>J2EEå¼€å‘çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ;</p>
</blockquote>
<h2 id="2-å¾®æœåŠ¡">2ã€å¾®æœåŠ¡</h2>
<p>2014ï¼Œmartin fowler</p>
<p>å¾®æœåŠ¡ï¼šæ¶æ„é£æ ¼ï¼ˆæœåŠ¡å¾®åŒ–ï¼‰</p>
<p>ä¸€ä¸ªåº”ç”¨åº”è¯¥æ˜¯ä¸€ç»„å°å‹æœåŠ¡ï¼›å¯ä»¥é€šè¿‡HTTPçš„æ–¹å¼è¿›è¡Œäº’é€šï¼›</p>
<p>å•ä½“åº”ç”¨ï¼šALL IN ONE</p>
<p>å¾®æœåŠ¡ï¼šæ¯ä¸€ä¸ªåŠŸèƒ½å…ƒç´ æœ€ç»ˆéƒ½æ˜¯ä¸€ä¸ªå¯ç‹¬ç«‹æ›¿æ¢å’Œç‹¬ç«‹å‡çº§çš„è½¯ä»¶å•å…ƒï¼›</p>
<p><a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa">è¯¦ç»†å‚ç…§å¾®æœåŠ¡æ–‡æ¡£</a></p>
<h2 id="3-ç¯å¢ƒå‡†å¤‡">3ã€ç¯å¢ƒå‡†å¤‡</h2>
<p>ç¯å¢ƒçº¦æŸ</p>
<ul>
<li>jdk1.8ï¼šSpring Boot æ¨èjdk1.7åŠä»¥ä¸Šï¼›java version &quot;1.8.0_112&quot;</li>
<li>maven3.xï¼šmaven 3.3ä»¥ä¸Šç‰ˆæœ¬ï¼›Apache Maven 3.3.9</li>
<li>IntelliJIDEA2017ï¼šIntelliJ IDEA 2017.2.2 x64ã€STS</li>
<li>SpringBoot 1.5.9.RELEASEï¼š1.5.9ï¼›</li>
</ul>
<p>ç»Ÿä¸€ç¯å¢ƒï¼›</p>
<h3 id="1-mavenè®¾ç½®">1ã€MAVENè®¾ç½®</h3>
<p>ç»™maven çš„settings.xmlé…ç½®æ–‡ä»¶çš„profilesæ ‡ç­¾æ·»åŠ </p>
<pre><code class="language-xml">&lt;profile&gt;
  &lt;id&gt;jdk-1.8&lt;/id&gt;
  &lt;activation&gt;
    &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;
    &lt;jdk&gt;1.8&lt;/jdk&gt;
  &lt;/activation&gt;
  &lt;properties&gt;
    &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
    &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;maven.compiler.compilerVersion&gt;1.8&lt;/maven.compiler.compilerVersion&gt;
  &lt;/properties&gt;
&lt;/profile&gt;
</code></pre>
<h3 id="2-ideaè®¾ç½®">2ã€IDEAè®¾ç½®</h3>
<p>æ•´åˆmaven</p>
<figure data-type="image" tabindex="1"><img src="https://Zu3zz.github.io/post-images/1570438626151.png" alt="IDEA"></figure>
<figure data-type="image" tabindex="2"><img src="https://Zu3zz.github.io/post-images/1570438637757.png" alt="IDEA_MAVEN"></figure>
<h2 id="4-spring-boot-helloworld">4ã€Spring Boot HelloWorld</h2>
<p>ä¸€ä¸ªåŠŸèƒ½ï¼š</p>
<p>æµè§ˆå™¨å‘é€helloè¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å¹¶å¤„ç†ï¼Œç›¸åº”HelloWorldå­—ç¬¦ä¸²;</p>
<h3 id="1-åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹jar">1ã€åˆ›å»ºä¸€ä¸ªmavenå·¥ç¨‹ï¼›(jar)</h3>
<h3 id="2-å¯¼å…¥spring-bootç›¸å…³çš„ä¾èµ–">2ã€å¯¼å…¥spring bootç›¸å…³çš„ä¾èµ–</h3>
<pre><code class="language-xml">&lt;parent&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
  &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;
&lt;/parent&gt;
&lt;dependencies&gt;
  &lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
  &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>
<h3 id="3-ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºå¯åŠ¨spring-bootåº”ç”¨">3ã€ç¼–å†™ä¸€ä¸ªä¸»ç¨‹åºï¼šå¯åŠ¨Spring Bootåº”ç”¨</h3>
<pre><code class="language-java">/**
 *  @SpringBootApplication æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨
 */
@SpringBootApplication
public class HelloWorldMainApplication {
  public static void main(String[] args) {
    // Springåº”ç”¨å¯åŠ¨èµ·æ¥
    SpringApplication.run(HelloWorldMainApplication.class,args);
  }
}
</code></pre>
<h3 id="4-ç¼–å†™ç›¸å…³çš„controller-service">4ã€ç¼–å†™ç›¸å…³çš„Controllerã€Service</h3>
<pre><code class="language-java">@Controller
public class HelloController{
  @ResponseBody
  @RequestMapping(&quot;/hello&quot;)
  public String hello(){
    return &quot;Hello World&quot;;
  }
}
</code></pre>
<h3 id="5-è¿è¡Œä¸»ç¨‹åºæµ‹è¯•">5ã€è¿è¡Œä¸»ç¨‹åºæµ‹è¯•</h3>
<h3 id="6-ç®€åŒ–éƒ¨ç½²">6ã€ç®€åŒ–éƒ¨ç½²</h3>
<pre><code class="language-xml">&lt;!-- è¿™ä¸ªæ’ä»¶ï¼Œå¯ä»¥å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„jaråŒ…ï¼›--&gt;
&lt;build&gt;
  &lt;plugins&gt;
    &lt;plugin&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
    &lt;/plugin&gt;
  &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p>å°†è¿™ä¸ªåº”ç”¨æ‰“æˆjaråŒ…ï¼Œç›´æ¥ä½¿ç”¨java -jarçš„å‘½ä»¤è¿›è¡Œæ‰§è¡Œï¼›</p>
<h2 id="5-hello-world-æ¢ç©¶">5ã€Hello World æ¢ç©¶</h2>
<h3 id="1-pomæ–‡ä»¶">1ã€POMæ–‡ä»¶</h3>
<h4 id="1-çˆ¶é¡¹ç›®">1ã€çˆ¶é¡¹ç›®</h4>
<pre><code class="language-xml">&lt;parent&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
  &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;
&lt;/parent&gt;

ä»–çš„çˆ¶é¡¹ç›®æ˜¯
&lt;parent&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-dependencies&lt;/artifactId&gt;
  &lt;version&gt;1.5.9.RELEASE&lt;/version&gt;
  &lt;relativePath&gt;../../spring-boot-dependencies&lt;/relativePath&gt;
&lt;/parent&gt;
ä»–æ¥çœŸæ­£ç®¡ç†Spring Bootåº”ç”¨é‡Œé¢çš„æ‰€æœ‰ä¾èµ–ç‰ˆæœ¬ï¼›
</code></pre>
<p>Spring Bootçš„ç‰ˆæœ¬ä»²è£ä¸­å¿ƒ;</p>
<p>ä»¥åæˆ‘ä»¬å¯¼å…¥ä¾èµ–é»˜è®¤æ˜¯ä¸éœ€è¦å†™ç‰ˆæœ¬çš„;(æ²¡æœ‰åœ¨dependenciesé‡Œé¢ç®¡ç†çš„ä¾èµ–è‡ªç„¶éœ€è¦å£°æ˜ç‰ˆæœ¬å·)</p>
<h4 id="2-å¯åŠ¨å™¨">2ã€å¯åŠ¨å™¨</h4>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p><strong>spring-boot-starter-web</strong></p>
<p>spring-boot-starterï¼šspring-bootåœºæ™¯å¯åŠ¨å™¨ï¼›å¸®æˆ‘ä»¬å¯¼å…¥äº†webæ¨¡å—æ­£å¸¸è¿è¡Œæ‰€ä¾èµ–çš„ç»„ä»¶ï¼›</p>
<p>Spring Bootå°†æ‰€æœ‰çš„åŠŸèƒ½åœºæ™¯éƒ½æŠ½å–å‡ºæ¥ï¼Œåšæˆä¸€ä¸ªä¸ªçš„startersï¼ˆå¯åŠ¨å™¨ï¼‰ï¼Œåªéœ€è¦åœ¨é¡¹ç›®é‡Œé¢å¼•å…¥è¿™äº›starterç›¸å…³åœºæ™¯çš„æ‰€æœ‰ä¾èµ–éƒ½ä¼šå¯¼å…¥è¿›æ¥ã€‚è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±å¯¼å…¥ä»€ä¹ˆåœºæ™¯çš„å¯åŠ¨å™¨</p>
<h3 id="2-ä¸»ç¨‹åºç±»ä¸»å…¥å£ç±»">2ã€ä¸»ç¨‹åºç±»ï¼Œä¸»å…¥å£ç±»</h3>
<pre><code class="language-java">/**
 *  @SpringBootApplication æ¥æ ‡æ³¨ä¸€ä¸ªä¸»ç¨‹åºç±»ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªSpring Bootåº”ç”¨
 */
@SpringBootApplication
public class HelloWorldMainApplication {
  public static void main(String[] args) {
    // Springåº”ç”¨å¯åŠ¨èµ·æ¥
    SpringApplication.run(HelloWorldMainApplication.class,args);
  }
}
</code></pre>
<p>@<strong>SpringBootApplication</strong>:    Spring Bootåº”ç”¨æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šè¯´æ˜è¿™ä¸ªç±»æ˜¯SpringBootçš„ä¸»é…ç½®ç±»ï¼ŒSpringBootå°±åº”è¯¥è¿è¡Œè¿™ä¸ªç±»çš„mainæ–¹æ³•æ¥å¯åŠ¨SpringBootåº”ç”¨ï¼›</p>
<pre><code class="language-java">@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(excludeFilters = {
  @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
  @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {}
</code></pre>
<ul>
<li>
<p>@<strong>SpringBootConfiguration</strong>:Spring Bootçš„é…ç½®ç±»ï¼›</p>
<ul>
<li>æ ‡æ³¨åœ¨æŸä¸ªç±»ä¸Šï¼Œè¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªSpring Bootçš„é…ç½®ç±»ï¼›</li>
<li>@<strong>Configuration</strong>:é…ç½®ç±»ä¸Šæ¥æ ‡æ³¨è¿™ä¸ªæ³¨è§£ï¼›
<ul>
<li>é…ç½®ç±» -----  é…ç½®æ–‡ä»¶ï¼›é…ç½®ç±»ä¹Ÿæ˜¯å®¹å™¨ä¸­çš„ä¸€ä¸ªç»„ä»¶ï¼›@Component</li>
</ul>
</li>
</ul>
</li>
<li>
<p>@<strong>EnableAutoConfiguration</strong>ï¼šå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›</p>
<ul>
<li>
<p>ä»¥å‰æˆ‘ä»¬éœ€è¦é…ç½®çš„ä¸œè¥¿ï¼ŒSpring Bootå¸®æˆ‘ä»¬è‡ªåŠ¨é…ç½®ï¼›@<strong>EnableAutoConfiguration</strong>å‘Šè¯‰SpringBootå¼€å¯è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼›è¿™æ ·è‡ªåŠ¨é…ç½®æ‰èƒ½ç”Ÿæ•ˆï¼›</p>
<pre><code class="language-java">@AutoConfigurationPackage
@Import(EnableAutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {}
</code></pre>
<ul>
<li>
<p>@<strong>AutoConfigurationPackage</strong>ï¼šè‡ªåŠ¨é…ç½®åŒ…</p>
</li>
<li>
<p>@<strong>Import</strong>(AutoConfigurationPackages.Registrar.class)ï¼š</p>
<ul>
<li>
<p>Springçš„åº•å±‚æ³¨è§£@Importï¼Œç»™å®¹å™¨ä¸­å¯¼å…¥ä¸€ä¸ªç»„ä»¶ï¼›å¯¼å…¥çš„ç»„ä»¶ç”±AutoConfigurationPackages.Registrar.classæ¥å®ç°</p>
</li>
<li>
<p>å°†ä¸»é…ç½®ç±»ï¼ˆ@SpringBootApplicationæ ‡æ³¨çš„ç±»ï¼‰çš„æ‰€åœ¨åŒ…åŠä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ°Springå®¹å™¨ï¼›</p>
</li>
<li>
<p>@<strong>Import</strong>(EnableAutoConfigurationImportSelector.class)ï¼›</p>
<p>ç»™å®¹å™¨å¯¼å…¥ç»„ä»¶</p>
<ul>
<li>
<p><strong>EnableAutoConfigurationImportSelector</strong>ï¼šå¯¼å…¥å“ªäº›ç»„ä»¶çš„é€‰æ‹©å™¨ï¼›</p>
</li>
<li>
<p>å°†æ‰€æœ‰éœ€è¦å¯¼å…¥çš„ç»„ä»¶ä»¥å…¨ç±»åçš„æ–¹å¼è¿”å›ï¼›è¿™äº›ç»„ä»¶å°±ä¼šè¢«æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼›</p>
</li>
<li>
<p>ä¼šç»™å®¹å™¨ä¸­å¯¼å…¥éå¸¸å¤šçš„è‡ªåŠ¨é…ç½®ç±»ï¼ˆxxxAutoConfigurationï¼‰ï¼›å°±æ˜¯ç»™å®¹å™¨ä¸­å¯¼å…¥è¿™ä¸ªåœºæ™¯éœ€è¦çš„æ‰€æœ‰ç»„ä»¶ï¼Œå¹¶é…ç½®å¥½è¿™äº›ç»„ä»¶ï¼›		<img src="https://Zu3zz.github.io/post-images/1570438503004.png" alt="è‡ªåŠ¨é…ç½®ç±»"></p>
</li>
<li>
<p>æœ‰äº†è‡ªåŠ¨é…ç½®ç±»ï¼Œå…å»äº†æˆ‘ä»¬æ‰‹åŠ¨ç¼–å†™é…ç½®æ³¨å…¥åŠŸèƒ½ç»„ä»¶ç­‰çš„å·¥ä½œï¼›</p>
</li>
</ul>
<pre><code class="language-java">  SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class,classLoader)
</code></pre>
<ul>
<li>
<p>Spring Bootåœ¨å¯åŠ¨çš„æ—¶å€™ä»ç±»è·¯å¾„ä¸‹çš„META-INF/spring.factoriesä¸­è·å–<strong>EnableAutoConfiguration</strong>æŒ‡å®šçš„å€¼ï¼Œå°†è¿™äº›å€¼ä½œä¸ºè‡ªåŠ¨é…ç½®ç±»å¯¼å…¥åˆ°å®¹å™¨ä¸­ï¼Œè‡ªåŠ¨é…ç½®ç±»å°±ç”Ÿæ•ˆï¼Œå¸®æˆ‘ä»¬è¿›è¡Œè‡ªåŠ¨é…ç½®å·¥ä½œï¼›<img src="https://Zu3zz.github.io/post-images/1570438722722.png" alt="SpringFactories"></p>
</li>
<li>
<p>ä»¥å‰æˆ‘ä»¬éœ€è¦è‡ªå·±é…ç½®çš„ä¸œè¥¿ï¼Œç°åœ¨è‡ªåŠ¨é…ç½®ç±»éƒ½å¸®æˆ‘ä»¬å®ç°äº†ï¼›</p>
</li>
<li>
<p>J2EEçš„æ•´ä½“æ•´åˆè§£å†³æ–¹æ¡ˆå’Œè‡ªåŠ¨é…ç½®éƒ½åœ¨spring-boot-autoconfigure-2.x.x.RELEASE.jarï¼›</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="6-ä½¿ç”¨spring-initializerå¿«é€Ÿåˆ›å»ºspring-booté¡¹ç›®">6ã€ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºSpring Booté¡¹ç›®</h2>
<h3 id="1-idea-ä½¿ç”¨spring-initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®">1ã€IDEA: ä½¿ç”¨Spring Initializerå¿«é€Ÿåˆ›å»ºé¡¹ç›®</h3>
<ul>
<li>IDEéƒ½æ”¯æŒä½¿ç”¨Springçš„é¡¹ç›®åˆ›å»ºæƒ³åˆ°å¿«é€Ÿåˆ›å»ºä¸€ä¸ªSpring Booté¡¹ç›®ï¼›</li>
<li>é€‰æ‹©æˆ‘ä»¬éœ€è¦çš„æ¨¡å—ï¼›å‘å¯¼ä¼šè”ç½‘åˆ›å»ºSpring Booté¡¹ç›®ï¼›</li>
<li>é»˜è®¤ç”Ÿæˆçš„Spring Booté¡¹ç›®ï¼š
<ul>
<li>ä¸»ç¨‹åºå·²ç»å†™å¥½ï¼Œæˆ‘ä»¬åªéœ€è¦å†™è‡ªå·±çš„é€»è¾‘</li>
<li>resourcesæ–‡ä»¶å¤¹ä¸­çš„ç›®å½•ç»“æ„
<ul>
<li>static: ä¿å­˜æ‰€æœ‰çš„é™æ€èµ„æºï¼šjsã€cssã€images</li>
<li>templatesï¼šä¿å­˜æ‰€æœ‰çš„æ¨¡æ¿é¡µé¢ï¼›(Spring Booté»˜è®¤jaråŒ…ä½¿ç”¨åµŒå…¥å¼çš„Tomcatï¼Œ é»˜è®¤ä¸æ”¯æŒJSPé¡µé¢)ï¼›å¯ä»¥ä½¿ç”¨æ¨¡æ¿å¼•æ“ï¼ˆfreemarkerã€thymeleafï¼‰ï¼›</li>
<li>application.propertiesï¼šSpring Bootåº”ç”¨çš„é…ç½®æ–‡ä»¶ï¼›å¯ä»¥ä¿®æ”¹ä¸€äº›é»˜è®¤é…ç½®</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-stsä½¿ç”¨-spring-starter-projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®">2ã€STSä½¿ç”¨ Spring Starter Projectå¿«é€Ÿåˆ›å»ºé¡¹ç›®</h3>
<hr>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[LeetCode-double-week-10]]></title>
        <id>https://Zu3zz.github.io/post/leetcode-double-week-10</id>
        <link href="https://Zu3zz.github.io/post/leetcode-double-week-10">
        </link>
        <updated>2019-10-06T11:56:00.000Z</updated>
        <summary type="html"><![CDATA[<center>åˆåˆ°äº†æ¯å‘¨æ‹¼æ‰‹é€Ÿçš„æ—¶åˆ»äº†ï¼(å¤§é›¾</center>
<center>ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘</center>
<center>è¿™å‘¨é¢˜ç›®éš¾åº¦é€‚ä¸­ å†²ï¼</center>]]></summary>
        <content type="html"><![CDATA[<center>åˆåˆ°äº†æ¯å‘¨æ‹¼æ‰‹é€Ÿçš„æ—¶åˆ»äº†ï¼(å¤§é›¾</center>
<center>ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘</center>
<center>è¿™å‘¨é¢˜ç›®éš¾åº¦é€‚ä¸­ å†²ï¼</center>
<!-- more -->
<h2 id="ç¬¬ä¸€é¢˜">ç¬¬ä¸€é¢˜</h2>
<h3 id="5079ä¸‰ä¸ªæœ‰åºæ•°ç»„çš„äº¤é›†">5079.ä¸‰ä¸ªæœ‰åºæ•°ç»„çš„äº¤é›†</h3>
<ul>
<li>
<p>ç»™å‡ºä¸‰ä¸ªå‡ä¸º ä¸¥æ ¼é€’å¢æ’åˆ— çš„æ•´æ•°æ•°ç»„Â arr1ï¼Œarr2 å’ŒÂ arr3ã€‚</p>
</li>
<li>
<p>è¿”å›ä¸€ä¸ªç”±Â ä»… åœ¨è¿™ä¸‰ä¸ªæ•°ç»„ä¸­Â åŒæ—¶å‡ºç°Â çš„æ•´æ•°æ‰€æ„æˆçš„æœ‰åºæ•°ç»„ã€‚</p>
</li>
</ul>
<ol>
<li>ç¤ºä¾‹ï¼š</li>
</ol>
<pre><code class="language-shell">è¾“å…¥: arr1 = [1,2,3,4,5], arr2 = [1,2,5,7,9], arr3 = [1,3,4,5,8]
è¾“å‡º: [1,5]
è§£é‡Š: åªæœ‰ 1 å’Œ 5 åŒæ—¶åœ¨è¿™ä¸‰ä¸ªæ•°ç»„ä¸­å‡ºç°.
</code></pre>
<h3 id="æ€è·¯">æ€è·¯</h3>
<p>ç›´æ¥åˆ›å»ºä¸€ä¸ªæ¯”è¾ƒå¤§çš„æ•°ç»„ï¼Œéå†ä¸‰éï¼Œæ¯æ¬¡éå†åˆ°çš„æ•°å­—éƒ½åœ¨ç›¸åº”ä½ç½®ä¸Š+1ï¼Œå¦‚æœæ•°ç»„ä¸­æœ‰å€¼ä¸º3ï¼Œè¯´æ˜ä¸‰ä¸ªæ•°ç»„ä¸­éƒ½æœ‰<br>
æ—¶é—´å¤æ‚åº¦O(n) æ¯”è¾ƒå¿«<br>
å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥å¾ªç¯ä¸€éæŸ¥çœ‹æ˜¯å¦è¿™ä¸ªæ•°éƒ½åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­ï¼Œä½†æ˜¯è¿™æ ·å°±æ˜¯O(nlogn)ï¼Œä¼šç›¸å¯¹æ…¢ä¸€äº›</p>
<h3 id="python-solution">Python solution</h3>
<pre><code class="language-python">class Solution:
    def arraysIntersection(self, arr1: List[int], arr2: List[int], arr3: List[int]) -&gt; List[int]:
        res = [0] * 2010
        res1 = []
        for i in arr1:
            res[i]+=1
        for i in arr2:
            res[i]+=1
        for i in arr3:
            res[i]+=1
        for j in range(len(res)):
            if res[j] == 3:
                res1.append(j)
        return res1
</code></pre>
<h2 id="ç¬¬äºŒé¢˜">ç¬¬äºŒé¢˜</h2>
<h3 id="5080-æŸ¥æ‰¾ä¸¤æ£µäºŒå‰æœç´¢æ ‘ä¹‹å’Œ">5080. æŸ¥æ‰¾ä¸¤æ£µäºŒå‰æœç´¢æ ‘ä¹‹å’Œ</h3>
<ul>
<li>
<p>ç»™å‡ºä¸¤æ£µäºŒå‰æœç´¢æ ‘ï¼Œè¯·ä½ ä»ä¸¤æ£µæ ‘ä¸­å„æ‰¾å‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½¿å¾—è¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼ä¹‹å’Œç­‰äºç›®æ ‡å€¼ Targetã€‚</p>
</li>
<li>
<p>å¦‚æœå¯ä»¥æ‰¾åˆ°è¿”å› Trueï¼Œå¦åˆ™è¿”å› Falseã€‚</p>
</li>
</ul>
<ol>
<li>ç¤ºä¾‹ 1ï¼š</li>
</ol>
<pre><code class="language-shell">è¾“å…¥ï¼šroot1 = [2,1,4], root2 = [1,0,3], target = 5
è¾“å‡ºï¼štrue
è§£é‡Šï¼š2 åŠ  3 å’Œä¸º 5 ã€‚
</code></pre>
<ol start="2">
<li>ç¤ºä¾‹ 2ï¼š</li>
</ol>
<pre><code class="language-shell">è¾“å…¥ï¼šroot1 = [0,-10,10], root2 = [5,1,7,0,2], target = 18
è¾“å‡ºï¼šfalse
</code></pre>
<h3 id="æ€è·¯-2">æ€è·¯</h3>
<p>æš‚æ—¶æ²¡æœ‰æƒ³åˆ°æ›´å¥½çš„äº†<br>
é¦–å…ˆï¼ŒæŠŠä¸¤ä¸ªäºŒå‰æœç´¢æ ‘å˜æˆsetï¼Œæ‰€ä½¿ç”¨åˆ°çš„å‡½æ•°å°±å¦‚ä¸Šå›¾t2så’Œ_t2sæ‰€ç¤ºã€‚ç„¶ååœ¨ä¸¤ä¸ªsetä¸­è¿›è¡Œç±»ä¼¼twosumçš„æ“ä½œ<br>
ä½†æ˜¯å¯ä»¥åˆ©ç”¨äºŒå‰æœç´¢æ ‘çš„æ€§è´¨ï¼Œå³æ‰€æœ‰å·¦å­æ ‘çš„èŠ‚ç‚¹å€¼éƒ½å°äºæ ¹èŠ‚ç‚¹ï¼Œå³å­æ ‘çš„èŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæ ¹èŠ‚ç‚¹ã€‚ä½†æ˜¯è¿™é“é¢˜å¥½åƒè¿™æ ·åšå°±éº»çƒ¦äº†ï¼Œç´¢æ€§è½¬æˆæ•°ç»„çœäº‹ä¸€ç‚¹ã€‚</p>
<h3 id="python-solution-2">Python Solution</h3>
<pre><code class="language-python"># Definition for a binary tree node.
# class TreeNode:
#     def __init__(self, x):
#         self.val = x
#         self.left = None
#         self.right = None

class Solution:
    def _t2s(self, root, s):
        if root:
            s.add(root.val)
            self._t2s(root.left, s)
            self._t2s(root.right, s)
    def t2s(self, root):
        s = set()
        self._t2s(root,s)
        return s
    def twoSumBSTs(self, root1: TreeNode, root2: TreeNode, target: int) -&gt; bool:
        t1 = self.t2s(root1)
        t2 = self.t2s(root2)
        for i in t1:
            if target - i in t2:
                return True
        return False
</code></pre>
<h2 id="ç¬¬ä¸‰é¢˜">ç¬¬ä¸‰é¢˜</h2>
<h3 id="5081-æ­¥è¿›æ•°">5081. æ­¥è¿›æ•°</h3>
<ul>
<li>
<p>å¦‚æœä¸€ä¸ªæ•´æ•°ä¸Šçš„æ¯ä¸€ä½æ•°å­—ä¸å…¶ç›¸é‚»ä½ä¸Šçš„æ•°å­—çš„ç»å¯¹å·®éƒ½æ˜¯ 1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°å°±æ˜¯ä¸€ä¸ªã€Œæ­¥è¿›æ•°ã€ã€‚</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼Œ <strong>321</strong> æ˜¯ä¸€ä¸ªæ­¥è¿›æ•°ï¼Œè€Œ <strong>421</strong> ä¸æ˜¯ã€‚</p>
</li>
<li>
<p>ç»™ä½ ä¸¤ä¸ªæ•´æ•°ï¼Œlow å’Œ highï¼Œè¯·ä½ æ‰¾å‡ºåœ¨ [low, high] èŒƒå›´å†…çš„æ‰€æœ‰æ­¥è¿›æ•°ï¼Œå¹¶è¿”å› æ’åºå çš„ç»“æœã€‚</p>
</li>
</ul>
<ol>
<li>å®ä¾‹ï¼š</li>
</ol>
<pre><code class="language-shell">è¾“å…¥ï¼šlow = 0, high = 21
è¾“å‡ºï¼š[0,1,2,3,4,5,6,7,8,9,10,12,21]
</code></pre>
<h3 id="æ€è·¯-3">æ€è·¯</h3>
<p>æ‰¾å‡ºä»lowåˆ°highçš„èŒƒå›´é‡Œæ»¡è¶³è¿›æ­¥æ•°è¦æ±‚çš„æ•°å­—ã€‚<br>
ä½¿ç”¨ä¸€ä¸ªqueueæ¥å­˜å‚¨æ‰€æœ‰æ•°å­—ï¼Œå…·ä½“å®ç°å°±æ˜¯ä»1å¼€å§‹ï¼Œqueueä¸­æ·»åŠ 10ï¼Œ01ï¼›å¯¹äº2ï¼Œæ·»åŠ 12ï¼Œ21.....<br>
å¹¶ä¸”è¦æ»¡è¶³æ‰€æœ‰æ·»åŠ çš„æ•°å­—å°äºhigh.<br>
æœ€åsortedä¸€éå°±å¯ä»¥äº†<br>
ä¸çŸ¥é“pythoné‡Œçš„queueå’‹ç”¨ï¼Œè¿˜æ˜¯ç”¨å›è€æœ¬è¡Œcppå§ã€‚</p>
<h3 id="cpp-solution">Cpp Solution</h3>
<pre><code class="language-cpp">class Solution {
public:
    vector&lt;int&gt; countSteppingNumbers(int low, int high) {
        vector&lt;int&gt; res;
        queue&lt;int&gt; q;
        int i,j;
        for(i=1;i&lt;10&amp;&amp;i&lt;=high;i++)q.push(i);
        if(!low)res.push_back(0);
        while(!q.empty())
        {
            i=q.front();
            q.pop();
            if(i&gt;=low) res.push_back(i);
            j=i%10;
            if(j&amp;&amp;i*10LL+j-1&lt;=high)q.push(i*10+j-1);
            if(j&lt;9&amp;&amp;i*10LL+j+1&lt;=high)q.push(i*10+j+1);
        }
        sort(res.begin(),res.end());
        return res;
    }
};
</code></pre>
<h2 id="ç¬¬å››é¢˜">ç¬¬å››é¢˜</h2>
<h3 id="5099éªŒè¯å›æ–‡å­—ç¬¦ä¸²iii">5099.éªŒè¯å›æ–‡å­—ç¬¦ä¸²III</h3>
<ul>
<li>
<p>ç»™å‡ºä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªæ•´æ•° kï¼Œè¯·ä½ å¸®å¿™åˆ¤æ–­è¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ä¸€ä¸ªã€ŒK å›æ–‡ã€ã€‚</p>
</li>
<li>
<p>æ‰€è°“ã€ŒK å›æ–‡ã€ï¼šå¦‚æœå¯ä»¥é€šè¿‡ä»å­—ç¬¦ä¸²ä¸­åˆ å»æœ€å¤š k ä¸ªå­—ç¬¦å°†å…¶è½¬æ¢ä¸ºå›æ–‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸ªã€ŒK å›æ–‡ã€ã€‚</p>
</li>
</ul>
<ol>
<li>ç¤ºä¾‹ï¼š</li>
</ol>
<pre><code class="language-shell">è¾“å…¥ï¼šs = &quot;abcdeca&quot;, k = 2
è¾“å‡ºï¼štrue
è§£é‡Šï¼šåˆ é™¤å­—ç¬¦ â€œbâ€ å’Œ â€œeâ€ã€‚
</code></pre>
<h3 id="æ€è·¯-4">æ€è·¯</h3>
<p>é¦–å…ˆå…ˆæŠŠç»™å®šçš„å­—ç¬¦ä¸²sé€†åºå¾—åˆ°s2,æŠŠsä¸s2è¿›è¡Œæ¯”è¾ƒã€‚<br>
dpæ–¹ç¨‹å°±æ˜¯ç”¨æ¥è®°å½•åˆ°äº†æœ€åä¸€ä½ï¼Œsä¸s2æœ‰å¤šå°‘ä½èƒ½å¤Ÿç›¸ç­‰ï¼Œå¦‚æœåŠ ä¸Šäº†kè¿˜èƒ½å¤Ÿå¤§äºå­—ç¬¦ä¸²æœ¬èº«çš„é•¿åº¦ï¼Œé‚£ä¹ˆå°±æ˜¯â€œKå›æ–‡â€ã€‚<br>
ç”¨pythonå†™å¥½åƒå¾ˆæ–¹ä¾¿ ç´¢æ€§åˆæ¢å›pythonäº†</p>
<h3 id="python-solution-3">Python Solution</h3>
<pre><code class="language-python">class Solution:
    def isValidPalindrome(self, s: str, k: int) -&gt; bool:
        s2 = s[::-1]
        n = len(s)
        dp = [[0] * (n+1) for i in range(n+1)]
        for i in range(1,n+1):
            for j in range(1,n+1):
                if s[i-1] == s2[j-1]:
                    dp[i][j] = dp[i-1][j-1] +1
                else:
                    dp[i][j] = max(dp[i-1][j],dp[i][j-1])
        if dp[-1][-1] +k &gt;= n:
            return True
        return False
</code></pre>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>æ¯å‘¨çš„åŒå‘¨èµ›éš¾åº¦é€‚ä¸­ï¼Œæ¯”è¾ƒé€‚åˆæ–°æ‰‹æ‰“ã€‚ä¸è¿‡è¿™ä¸€å‘¨é¦™æ¸¯å±€åŠ¿åŠ¨è¡ï¼Œå­¦æ ¡ä¹Ÿåœè¯¾äº†ï¼Œåœ¨å®¶å‘†ç€çœŸçªå¿ƒå•Šã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[HDFSç³»åˆ—(1)----å®‰è£…]]></title>
        <id>https://Zu3zz.github.io/post/hdfs-3</id>
        <link href="https://Zu3zz.github.io/post/hdfs-3">
        </link>
        <updated>2019-09-13T10:54:04.000Z</updated>
        <summary type="html"><![CDATA[<center>è¿™ç¯‡æ–‡ç« å’±ä»¬å°±æ¥è®²è®²å¦‚ä½•å®‰è£…HDFS</center>]]></summary>
        <content type="html"><![CDATA[<center>è¿™ç¯‡æ–‡ç« å’±ä»¬å°±æ¥è®²è®²å¦‚ä½•å®‰è£…HDFS</center>
<!-- more -->
<h1 id="hdfs-æ¦‚è¿°">HDFS æ¦‚è¿°</h1>
<ol>
<li>åˆ†å¸ƒå¼</li>
<li>commodity hardware</li>
<li>fault-tolerant å®¹é”™</li>
<li>high throughput</li>
<li>large data sets</li>
</ol>
<h2 id="hdfs-æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ">HDFS æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿ</h2>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿï¼šLinuxã€Windowsã€Mac....
<ul>
<li>ç›®å½•ç»“æ„: C /</li>
<li>å­˜æ”¾çš„æ˜¯æ–‡ä»¶æˆ–è€…æ–‡ä»¶å¤¹</li>
<li>å¯¹å¤–æä¾›æœåŠ¡ï¼šåˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥çœ‹ã€ç§»åŠ¨ç­‰ç­‰</li>
<li>æ™®é€šæ–‡ä»¶ç³»ç»Ÿ vs åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ
<ul>
<li>å•æœº</li>
<li>åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿèƒ½å¤Ÿæ¨ªè·¨ N ä¸ªæœºå™¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="hdfs-å‰æå’Œè®¾è®¡ç›®æ ‡">HDFS å‰æå’Œè®¾è®¡ç›®æ ‡</h2>
<ul>
<li>Hardware Failure ç¡¬ä»¶é”™è¯¯
<ul>
<li>æ¯ä¸ªæœºå™¨åªå­˜å‚¨æ–‡ä»¶çš„éƒ¨åˆ†æ•°æ®ï¼Œblocksize=128M</li>
<li>block å­˜æ”¾åœ¨ä¸åŒçš„æœºå™¨ä¸Šçš„ï¼Œç”±äºå®¹é”™ï¼ŒHDFS é»˜è®¤é‡‡ç”¨ 3 å‰¯æœ¬æœºåˆ¶</li>
</ul>
</li>
<li>Streaming Data Access æµå¼æ•°æ®è®¿é—®
<ul>
<li>The emphasis is on high throughput of data access</li>
<li>rather than low latency of data access.</li>
</ul>
</li>
<li>Large Data Sets å¤§è§„æ¨¡æ•°æ®é›†</li>
<li>Moving Computation is Cheaper than Moving Data ç§»åŠ¨è®¡ç®—æ¯”ç§»åŠ¨æ•°æ®æ›´åˆ’ç®—</li>
</ul>
<h2 id="hdfs-çš„æ¶æ„">HDFS çš„æ¶æ„</h2>
<ol>
<li>NameNode(master) and DataNodes(slave)</li>
<li>master/slave çš„æ¶æ„</li>
<li>NN:</li>
</ol>
<ul>
<li>the file system namespace
<ul>
<li>/home/hadoop/software</li>
<li>/home/hadoop/app</li>
<li>regulates access to files by clients</li>
</ul>
</li>
</ul>
<ol start="4">
<li>
<p>DNï¼šstorage</p>
</li>
<li>
<p>HDFS exposes a file system namespace and allows user data to be stored in files.</p>
</li>
<li>
<p>a file is split into one or more blocks</p>
<ul>
<li>blocksize: 128M</li>
<li>150M æ‹†æˆ 2 ä¸ª block</li>
</ul>
</li>
<li>
<p>blocks are stored in a set of DataNodes</p>
<ul>
<li>ä¸ºä»€ä¹ˆï¼Ÿ å®¹é”™ï¼ï¼ï¼</li>
</ul>
</li>
<li>
<p>NameNode executes file system namespace operationsï¼šCRUD</p>
</li>
<li>
<p>determines the mapping of blocks to DataNodes</p>
<ul>
<li>
<p>a.txt 150M blocksize=128M</p>
</li>
<li>
<p>a.txt æ‹†åˆ†æˆ 2 ä¸ª block ä¸€ä¸ªæ˜¯ block1ï¼š128M å¦ä¸€ä¸ªæ˜¯ block2ï¼š22M<br>
block1 å­˜æ”¾åœ¨å“ªä¸ª DNï¼Ÿblock2 å­˜æ”¾åœ¨å“ªä¸ª DNï¼Ÿ</p>
</li>
<li>
<p>a.txt<br>
_ block1ï¼š128M, 192.168.199.1<br>
_ block2ï¼š22M, 192.168.199.2<br>
_ get a.txt<br>
_ è¿™ä¸ªè¿‡ç¨‹å¯¹äºç”¨æˆ·æ¥è¯´æ˜¯ä¸æ„ŸçŸ¥çš„</p>
</li>
</ul>
</li>
<li>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼š1 ä¸ª Node éƒ¨ç½²ä¸€ä¸ªç»„ä»¶</p>
</li>
</ol>
<h2 id="è¯¾ç¨‹ç¯å¢ƒä»‹ç»">è¯¾ç¨‹ç¯å¢ƒä»‹ç»ï¼š</h2>
<h3 id="æœ¬è¯¾ç¨‹å½•åˆ¶çš„ç³»ç»Ÿæ˜¯-macæ‰€ä»¥æˆ‘é‡‡ç”¨çš„-linux-å®¢æˆ·ç«¯æ˜¯-mac-è‡ªå¸¦çš„-shell">æœ¬è¯¾ç¨‹å½•åˆ¶çš„ç³»ç»Ÿæ˜¯ Macï¼Œæ‰€ä»¥æˆ‘é‡‡ç”¨çš„ linux å®¢æˆ·ç«¯æ˜¯ mac è‡ªå¸¦çš„ shell</h3>
<ul>
<li>å¦‚æœä½ ä»¬æ˜¯ winï¼šxshellã€crt</li>
<li>æœåŠ¡å™¨/linux åœ°å€ï¼š192.168.199.233</li>
<li>è¿æ¥åˆ° linux ç¯å¢ƒ<br>
_ ç™»é™†ï¼šssh hadoop@192.168.199.233<br>
_ ç™»é™†æˆåŠŸä»¥åï¼š[hadoop@hadoop000 ~]$
<ul>
<li>linuxæœºå™¨ï¼šç”¨æˆ·åhadoopã€å¯†ç 123456ã€hostnameæ˜¯* * hadoop000</li>
<li>åˆ›å»ºè¯¾ç¨‹ä¸­æ‰€éœ€è¦çš„ç›®å½•ï¼ˆåˆé€‚çš„æ–‡ä»¶å­˜æ”¾åœ¨åˆé€‚çš„ç›®å½•ï¼‰
<ol>
<li>[hadoop@hadoop000 ~]$ mkdir software å­˜æ”¾è¯¾ç¨‹æ‰€ä½¿ç”¨çš„è½¯ä»¶å®‰è£…åŒ… 2. [hadoop@hadoop000 ~]$ mkdir app       å­˜æ”¾è¯¾ç¨‹æ‰€æœ‰è½¯ä»¶çš„å®‰è£…ç›®å½•</li>
<li>[hadoop@hadoop000 ~]$ mkdir data å­˜æ”¾è¯¾ç¨‹ä¸­ä½¿ç”¨çš„æ•°æ® 4. [hadoop@hadoop000 ~]$ mkdir lib       å­˜æ”¾è¯¾ç¨‹ä¸­å¼€å‘è¿‡çš„ä½œä¸šjarå­˜æ”¾çš„ç›®å½•</li>
<li>[hadoop@hadoop000 ~]$ mkdir shell å­˜æ”¾è¯¾ç¨‹ä¸­ç›¸å…³çš„è„šæœ¬ 6. [hadoop@hadoop000 ~]$ mkdir maven_resp å­˜æ”¾è¯¾ç¨‹ä¸­ä½¿ç”¨åˆ°çš„ maven ä¾èµ–åŒ…å­˜æ”¾çš„ç›®å½•</li>
</ol>
</li>
</ul>
</li>
<li>å­¦å‘˜é—®ï¼šroot å¯†ç  1. åˆ‡æ¢ hadoop åˆ° root ç”¨æˆ·ï¼š[hadoop@hadoop000 ~]$ sudo -i 2. åˆ‡æ¢ root åˆ° hadoop ç”¨æˆ·ï¼š[root@hadoop000 ~]# su hadoop 3. æˆ‘ OOTB ç¯å¢ƒä¸­åˆ›å»ºçš„ hadoop ç”¨æˆ·æ˜¯æœ‰ sudo æƒé™ï¼šsudo vi /etc/hosts</li>
<li>Linux ç‰ˆæœ¬ï¼š * ä»¥å‰çš„è¯¾ç¨‹æ˜¯ centos6.4ï¼Œæœ¬æ¬¡è¯¾ç¨‹å‡çº§æˆ centos7</li>
</ul>
<h3 id="hadoop-ç¯å¢ƒæ­å»º">Hadoop ç¯å¢ƒæ­å»º</h3>
<ul>
<li>ä½¿ç”¨çš„ Hadoop ç›¸å…³ç‰ˆæœ¬ï¼šCDH</li>
<li>CDH ç›¸å…³è½¯ä»¶åŒ…ä¸‹è½½åœ°å€ï¼šhttp://archive.cloudera.com/cdh5/cdh/5/</li>
<li>Hadoop ä½¿ç”¨ç‰ˆæœ¬ï¼šhadoop-2.6.0-cdh5.15.1</li>
<li>Hadoop ä¸‹è½½ï¼šwget http://archive.cloudera.com/cdh5/cdh/5/hadoop-2.6.0-cdh5.15.1.tar.gz</li>
<li>Hive ä½¿ç”¨ç‰ˆæœ¬ï¼šhive-1.1.0-cdh5.15.1</li>
</ul>
<h3 id="hadoophivespark-ç›¸å…³æ¡†æ¶çš„å­¦ä¹ ">Hadoop/Hive/Spark ç›¸å…³æ¡†æ¶çš„å­¦ä¹ ï¼š</h3>
<ul>
<li>
<p>ä½¿ç”¨å•æœºç‰ˆè¶³å¤Ÿ</p>
</li>
<li>
<p>å¦‚æœä½¿ç”¨é›†ç¾¤å­¦ä¹ ä¼šå¯¼è‡´ï¼šä»å…¥é—¨åˆ°æ”¾å¼ƒ</p>
</li>
<li>
<p>ä½¿ç”¨ Linux/Mac å­¦ä¹ </p>
</li>
<li>
<p>ä¸€å®šä¸è¦ä½¿ç”¨ Windows æ­å»º Hadoop ç¯å¢ƒ</p>
</li>
<li>
<p>æ‰€ä»¥ Linux åŸºç¡€æ˜¯è¦ä¼šçš„</p>
</li>
</ul>
<h3 id="hadoop-å®‰è£…å‰ç½®è¦æ±‚">Hadoop å®‰è£…å‰ç½®è¦æ±‚</h3>
<ul>
<li>Java 1.8+</li>
<li>ssh</li>
</ul>
<h3 id="å®‰è£…-java">å®‰è£… Java</h3>
<ul>
<li>æ‹·è´æœ¬åœ°è½¯ä»¶åŒ…åˆ°æœåŠ¡å™¨ï¼šscp jdk-8u91-linux-x64.tar.gz hadoop@192.168.199.233:~/software/</li>
<li>è§£å‹ jdk åˆ°~/app/ï¼štar -zvxf jdk-8u91-linux-x64.tar.gz -C ~/app/</li>
<li>æŠŠ jdk é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼š ~/.bash_profile - export JAVA_HOME=/home/hadoop/app/jdk1.8.0_91 - export PATH=<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>J</mi><mi>A</mi><mi>V</mi><msub><mi>A</mi><mi>H</mi></msub><mi>O</mi><mi>M</mi><mi>E</mi><mi mathvariant="normal">/</mi><mi>b</mi><mi>i</mi><mi>n</mi><mo>:</mo></mrow><annotation encoding="application/x-tex">JAVA_HOME/bin:</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.09618em;">J</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.22222em;">V</span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord">/</span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span>PATH</li>
<li>ä½¿å¾—é…ç½®ä¿®æ”¹ç”Ÿæ•ˆï¼šsource .bash_profile</li>
<li>éªŒè¯ï¼šjava -version</li>
</ul>
<h3 id="å®‰è£…-ssh-æ— å¯†ç ç™»é™†">å®‰è£… ssh æ— å¯†ç ç™»é™†</h3>
<ul>
<li>
<p>ls</p>
</li>
<li>
<p>ls -a</p>
</li>
<li>
<p>ls -la å¹¶æ²¡æœ‰å‘ç°ä¸€ä¸ª.ssh çš„æ–‡ä»¶å¤¹</p>
</li>
<li>
<p>ssh-keygen -t rsa ä¸€è·¯å›è½¦</p>
</li>
<li>
<p>cd ~/.ssh</p>
</li>
<li>
<p>[hadoop@hadoop000 .ssh]$ ll</p>
</li>
<li>
<p>æ€»ç”¨é‡ 12</p>
<pre><code class="language-shell">-rw------- 1 hadoop hadoop 1679 10æœˆ 15 02:54 id_rsa  ç§é’¥
-rw-r--r-- 1 hadoop hadoop  398 10æœˆ 15 02:54 id_rsa.pub å…¬é’¥
-rw-r--r-- 1 hadoop hadoop  358 10æœˆ 15 02:54 known_hosts
cat id_rsa.pub &gt;&gt; authorized_keys
chmod 600 authorized_keys
</code></pre>
</li>
</ul>
<h3 id="hadoophdfså®‰è£…">Hadoop(HDFS)å®‰è£…</h3>
<ul>
<li>
<p>ä¸‹è½½<br>
_ è§£å‹ï¼š~/app<br>
_ æ·»åŠ  HADOOP_HOME/bin åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡<br>
_ ä¿®æ”¹ Hadoop é…ç½®æ–‡ä»¶<br>
_ hadoop-env.sh<br>
_ export JAVA_HOME=/home/hadoop/app/jdk1.8.0_91<br>
_ core-site.xml</p>
<pre><code class="language-xml">  &lt;property&gt;
      &lt;name&gt;fs.defaultFS&lt;/name&gt;
      &lt;value&gt;hdfs://hadoop000:8020&lt;/value&gt;
  &lt;/property&gt;

  hdfs-site.xml
  &lt;property&gt;
      &lt;name&gt;dfs.replication&lt;/name&gt;
      &lt;value&gt;1&lt;/value&gt;
  &lt;/property&gt;

  &lt;property&gt;
      &lt;name&gt;hadoop.tmp.dir&lt;/name&gt;
      &lt;value&gt;/home/hadoop/app/tmp&lt;/value&gt;
  &lt;/property&gt;
</code></pre>
<ul>
<li>slaves<br>
_ hadoop000<br>
_ å¯åŠ¨ HDFSï¼š<br>
_ ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ—¶å€™ä¸€å®šè¦æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿï¼Œä¸è¦é‡å¤æ‰§è¡Œ: hdfs namenode -format<br>
_ å¯åŠ¨é›†ç¾¤ï¼š<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mi>A</mi><mi>D</mi><mi>O</mi><mi>O</mi><msub><mi>P</mi><mi>H</mi></msub><mi>O</mi><mi>M</mi><mi>E</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>b</mi><mi>i</mi><mi>n</mi><mi mathvariant="normal">/</mi><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mo>âˆ’</mo><mi>d</mi><mi>f</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>h</mi><mo>âˆ—</mo><mi mathvariant="normal">éªŒ</mi><mi mathvariant="normal">è¯</mi><mo>:</mo><mn>1.</mn><mo>[</mo><mi>h</mi><mi>a</mi><mi>d</mi><mi>o</mi><mi>o</mi><mi>p</mi><mi mathvariant="normal">@</mi><mi>h</mi><mi>a</mi><mi>d</mi><mi>o</mi><mi>o</mi><mi>p</mi><mn>000</mn><mi>s</mi><mi>b</mi><mi>i</mi><mi>n</mi><mo>]</mo></mrow><annotation encoding="application/x-tex">HADOOP_HOME/sbin/start-dfs.sh
	* éªŒè¯:
		1. [hadoop@hadoop000 sbin]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault">A</span><span class="mord mathdefault" style="margin-right:0.02778em;">D</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.13889em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord">/</span><span class="mord mathdefault">s</span><span class="mord mathdefault">t</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.02778em;">r</span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">d</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord mathdefault">s</span><span class="mord">.</span><span class="mord mathdefault">s</span><span class="mord mathdefault">h</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord cjk_fallback">éªŒ</span><span class="mord cjk_fallback">è¯</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mopen">[</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord">@</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">d</span><span class="mord mathdefault">o</span><span class="mord mathdefault">o</span><span class="mord mathdefault">p</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord mathdefault">s</span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mclose">]</span></span></span></span> jps 2. 60002 DataNode 3. 60171 SecondaryNameNode 4. 59870 NameNode 5. http://192.168.199.233:50070 6. å¦‚æœå‘ç° jps okï¼Œä½†æ˜¯æµè§ˆå™¨ä¸ OKï¼Ÿ åæœ‰å…«ä¹æ˜¯é˜²ç«å¢™é—®é¢˜ 7. æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ï¼šsudo firewall-cmd --state 8. å…³é—­é˜²ç«å¢™: sudo systemctl stop firewalld.service 9. è¿›åˆ¶é˜²ç«å¢™å¼€æœºå¯åŠ¨ï¼š</li>
</ul>
</li>
</ul>
<h3 id="hadoop-è½¯ä»¶åŒ…å¸¸è§ç›®å½•è¯´æ˜">hadoop è½¯ä»¶åŒ…å¸¸è§ç›®å½•è¯´æ˜</h3>
<ul>
<li>binï¼šhadoop å®¢æˆ·ç«¯åå•</li>
<li>etc/hadoopï¼šhadoop ç›¸å…³çš„é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•</li>
<li>sbinï¼šå¯åŠ¨ hadoop ç›¸å…³è¿›ç¨‹çš„è„šæœ¬</li>
<li>shareï¼šå¸¸ç”¨ä¾‹å­</li>
</ul>
<h3 id="æ³¨æ„">æ³¨æ„ï¼š</h3>
<ul>
<li>
<p>start/stop-dfs.sh ä¸ hadoop-daemons.sh çš„å…³ç³»</p>
</li>
<li>
<p>start-dfs.sh</p>
<pre><code class="language-shell">hadoop-daemons.sh start namenode
hadoop-daemons.sh start datanode
hadoop-daemons.sh start secondarynamenode
</code></pre>
</li>
<li>
<p>stop-dfs.sh =</p>
</li>
<li>
<p>hadoop å¸¸ç”¨å‘½ä»¤ï¼š</p>
<ol>
<li>hadoop fs -ls /</li>
<li>hadoop fs -put</li>
<li>hadoop fs -copyFromLocal</li>
<li>hadoop fs -moveFromLocal</li>
<li>hadoop fs -cat</li>
<li>hadoop fs -text</li>
<li>hadoop fs -get</li>
<li>hadoop fs -mkdir</li>
<li>hadoop fs -mv ç§»åŠ¨/æ”¹å</li>
<li>hadoop fs -getmerge</li>
<li>hadoop fs -rm</li>
<li>hadoop fs -rmdir</li>
<li>hadoop fs -rm -r</li>
</ol>
</li>
</ul>
<h3 id="hdfs-å­˜å‚¨æ‰©å±•">HDFS å­˜å‚¨æ‰©å±•ï¼š</h3>
<ul>
<li>put: 1file ==&gt; 1...n block ==&gt; å­˜æ”¾åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šçš„</li>
<li>get: å» nn ä¸ŠæŸ¥æ‰¾è¿™ä¸ª file å¯¹åº”çš„å…ƒæ•°æ®ä¿¡æ¯</li>
<li>äº†è§£åº•å±‚çš„å­˜å‚¨æœºåˆ¶è¿™æ‰æ˜¯æˆ‘ä»¬çœŸæ­£è¦å­¦ä¹ çš„ä¸œè¥¿ï¼ŒæŒæ¡ API é‚£æ˜¯æ¯›æ¯›é›¨</li>
</ul>
<h3 id="ä½¿ç”¨-hdfs-api-çš„æ–¹å¼æ¥æ“ä½œ-hdfs-æ–‡ä»¶ç³»ç»Ÿ">ä½¿ç”¨ HDFS API çš„æ–¹å¼æ¥æ“ä½œ HDFS æ–‡ä»¶ç³»ç»Ÿ</h3>
<ul>
<li>IDEA/Eclipse</li>
<li>Java
<ul>
<li>ä½¿ç”¨ Maven æ¥ç®¡ç†é¡¹ç›®</li>
<li>æ‹·è´ jar åŒ…</li>
<li>æˆ‘çš„æ‰€æœ‰è¯¾ç¨‹éƒ½æ˜¯ä½¿ç”¨ maven æ¥è¿›è¡Œç®¡ç†çš„</li>
</ul>
</li>
</ul>
<pre><code class="language-shell">Caused by: org.apache.hadoop.ipc.RemoteException
(org.apache.hadoop.security.AccessControlException):
Permission denied: user=rocky, access=WRITE,
inode=&quot;/&quot;:hadoop:supergroup:drwxr-xr-x
</code></pre>
<h3 id="hdfs-æ“ä½œshell-java-api">HDFS æ“ä½œï¼šshell + Java API</h3>
<ul>
<li>ç»¼åˆæ€§çš„ HDFS å®æˆ˜ï¼šä½¿ç”¨ HDFS Java API æ‰å®Œæˆ HDFS æ–‡ä»¶ç³»ç»Ÿä¸Šçš„æ–‡ä»¶çš„è¯é¢‘ç»Ÿè®¡</li>
<li>è¯é¢‘ç»Ÿè®¡ï¼šwordcount
<ul>
<li>/path/1.txt</li>
<li>hello world hello</li>
<li>/path/2.txt</li>
<li>hello world hello
<ul>
<li>==&gt; (hello,4) (world,2)</li>
</ul>
</li>
</ul>
</li>
<li>å°†ç»Ÿè®¡å®Œçš„ç»“æœè¾“å‡ºåˆ° HDFS ä¸Šå»ã€‚</li>
</ul>
<h3 id="å‡è®¾æœ‰çš„å°ä¼™ä¼´äº†è§£è¿‡-mr-spark-ç­‰ç­‰è§‰å¾—è¿™ä¸ªæ“ä½œå¾ˆç®€å•">å‡è®¾ï¼šæœ‰çš„å°ä¼™ä¼´äº†è§£è¿‡ mrã€spark ç­‰ç­‰ï¼Œè§‰å¾—è¿™ä¸ªæ“ä½œå¾ˆç®€å•</h3>
<h3 id="æœ¬å®æˆ˜çš„è¦æ±‚åªå…è®¸ä½¿ç”¨-hdfs-api-è¿›è¡Œæ“ä½œ">æœ¬å®æˆ˜çš„è¦æ±‚ï¼šåªå…è®¸ä½¿ç”¨ HDFS API è¿›è¡Œæ“ä½œ</h3>
<h3 id="ç›®çš„">ç›®çš„</h3>
<ol>
<li>æŒæ¡ HDFS API çš„æ“ä½œ</li>
<li>é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œè®©ä½ ä»¬å¯¹äºåç»­è¦å­¦ä¹ çš„ mr æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥½çš„è®¤è¯†</li>
</ol>
<h3 id="ç¡¬ç¼–ç -éå¸¸å¿Œè®³çš„">ç¡¬ç¼–ç  ï¼š éå¸¸å¿Œè®³çš„</h3>
<h3 id="å¯é…ç½®">==&gt; å¯é…ç½®</h3>
<h3 id="å¯æ’æ‹”çš„å¼€å‘ç®¡ç†æ–¹å¼-plugin">å¯æ’æ‹”çš„å¼€å‘/ç®¡ç†æ–¹å¼ plugin</h3>
<h3 id="å‰¯æœ¬æ‘†æ”¾ç­–ç•¥">å‰¯æœ¬æ‘†æ”¾ç­–ç•¥</h3>
<ul>
<li>
<p>1-æœ¬ rack çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</p>
</li>
<li>
<p>2-å¦å¤–ä¸€ä¸ª rack çš„èŠ‚ç‚¹ä¸Š</p>
</li>
<li>
<p>3-ä¸ 2 ç›¸åŒçš„ rack çš„å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</p>
</li>
<li>
<p>1-æœ¬ rack çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</p>
</li>
<li>
<p>2-æœ¬ rack çš„å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</p>
</li>
<li>
<p>3-ä¸åŒ rack çš„ä¸€ä¸ªèŠ‚ç‚¹ä¸Š</p>
</li>
</ul>
<h3 id="hdfs-çš„å…ƒæ•°æ®ç®¡ç†">HDFS çš„å…ƒæ•°æ®ç®¡ç†</h3>
<ul>
<li>å…ƒæ•°æ®ï¼šHDFS çš„ç›®å½•ç»“æ„ä»¥åŠæ¯ä¸ªæ–‡ä»¶çš„ BLOCK ä¿¡æ¯(idï¼Œå‰¯æœ¬ç³»æ•°ã€block å­˜æ”¾åœ¨å“ªä¸ª DN ä¸Š)</li>
<li>å­˜åœ¨ä»€ä¹ˆåœ°æ–¹ï¼šå¯¹åº”é…ç½® ${hadoop.tmp.dir}/name/......</li>
<li>å…ƒæ•°æ®å­˜æ”¾åœ¨æ–‡ä»¶ä¸­ï¼š</li>
</ul>
<pre><code class="language-shell">/test1
/test1/a.txt
/test2
/test2/1.txt
/test2/2.txt
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Yarnç³»åˆ—(1)----åŸºç¡€ã€ä»‹ç»ã€æµç¨‹]]></title>
        <id>https://Zu3zz.github.io/post/yarn-1</id>
        <link href="https://Zu3zz.github.io/post/yarn-1">
        </link>
        <updated>2019-09-10T07:31:48.000Z</updated>
        <summary type="html"><![CDATA[<center>ç®€å•ä»‹ç»ä¸€ä¸‹èµ„æºè°ƒåº¦å·¥å…·YARN</center>
<center>Yet Another Resource Negotiator</center>]]></summary>
        <content type="html"><![CDATA[<center>ç®€å•ä»‹ç»ä¸€ä¸‹èµ„æºè°ƒåº¦å·¥å…·YARN</center>
<center>Yet Another Resource Negotiator</center>
<!-- more -->
<h1 id="yarn-äº§ç”ŸèƒŒæ™¯">YARN äº§ç”ŸèƒŒæ™¯</h1>
<ul>
<li>
<p>MapReduce1.x ==&gt; MapReduce2.x</p>
<ul>
<li>master/slave : JobTracker/TaskTracker</li>
<li>JobTrackerï¼šå•ç‚¹ã€å‹åŠ›å¤§</li>
<li>ä»…ä»…åªèƒ½å¤Ÿæ”¯æŒ mapreduce ä½œä¸š</li>
</ul>
</li>
<li>
<p>èµ„æºåˆ©ç”¨ç‡</p>
<ul>
<li>æ‰€æœ‰çš„è®¡ç®—æ¡†æ¶è¿è¡Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œå…±äº«ä¸€ä¸ªé›†ç¾¤çš„èµ„æºï¼ŒæŒ‰éœ€åˆ†é…ï¼</li>
</ul>
</li>
</ul>
<pre><code class="language-txt">master: resource managementï¼šResourceManager (RM)
job scheduling/monitoringï¼šper-application ApplicationMaster (AM)
slave: NodeManager (NM)
</code></pre>
<h2 id="yarn-æ¶æ„">YARN æ¶æ„</h2>
<ul>
<li>Clientã€ResourceManagerã€NodeManagerã€ApplicationMaster</li>
<li>master/slave: RM/NM</li>
</ul>
<h2 id="client-å‘-rm-æäº¤ä»»åŠ¡-æ€æ­»ä»»åŠ¡ç­‰">Client: å‘ RM æäº¤ä»»åŠ¡ã€æ€æ­»ä»»åŠ¡ç­‰</h2>
<ul>
<li>
<p>ApplicationMasterï¼š</p>
<ul>
<li>æ¯ä¸ªåº”ç”¨ç¨‹åºå¯¹åº”ä¸€ä¸ª AM</li>
<li>AM å‘ RM ç”³è¯·èµ„æºç”¨äºåœ¨ NM ä¸Šå¯åŠ¨å¯¹åº”çš„ Task</li>
<li>æ•°æ®åˆ‡åˆ†</li>
<li>ä¸ºæ¯ä¸ª task å‘ RM ç”³è¯·èµ„æºï¼ˆcontainerï¼‰</li>
<li>NodeManager é€šä¿¡</li>
<li>ä»»åŠ¡çš„ç›‘æ§</li>
</ul>
</li>
<li>
<p>NodeManagerï¼š å¤šä¸ª</p>
<ul>
<li>å¹²æ´»</li>
<li>å‘ RM å‘é€å¿ƒè·³ä¿¡æ¯ã€ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ</li>
<li>æ¥æ”¶æ¥è‡ª RM çš„è¯·æ±‚æ¥å¯åŠ¨ä»»åŠ¡</li>
<li>å¤„ç†æ¥è‡ª AM çš„å‘½ä»¤</li>
</ul>
</li>
<li>
<p>ResourceManager:é›†ç¾¤ä¸­åŒä¸€æ—¶åˆ»å¯¹å¤–æä¾›æœåŠ¡çš„åªæœ‰ 1 ä¸ªï¼Œè´Ÿè´£èµ„æºç›¸å…³</p>
<ul>
<li>å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚ï¼šæäº¤ã€æ€æ­»</li>
<li>å¯åŠ¨/ç›‘æ§ AM</li>
<li>ç›‘æ§ NM</li>
<li>èµ„æºç›¸å…³</li>
</ul>
</li>
<li>
<p>containerï¼šä»»åŠ¡çš„è¿è¡ŒæŠ½è±¡</p>
<ul>
<li>memoryã€cpu....</li>
<li>task æ˜¯è¿è¡Œåœ¨ container é‡Œé¢çš„</li>
<li>å¯ä»¥è¿è¡Œ amã€ä¹Ÿå¯ä»¥è¿è¡Œ map/reduce task</li>
</ul>
</li>
</ul>
<h2 id="yarn-æ‰§è¡Œæµç¨‹">yarn æ‰§è¡Œæµç¨‹</h2>
<figure data-type="image" tabindex="1"><img src="https://Zu3zz.github.io/post-images/1568100871914.png" alt="yarnæ‰§è¡Œæµç¨‹"></figure>
<h2 id="æäº¤è‡ªå·±å¼€å‘çš„-mr-ä½œä¸šåˆ°-yarn-ä¸Šè¿è¡Œçš„æ­¥éª¤">æäº¤è‡ªå·±å¼€å‘çš„ MR ä½œä¸šåˆ° YARN ä¸Šè¿è¡Œçš„æ­¥éª¤ï¼š</h2>
<ol>
<li>mvn clean package -DskipTests æ‰“åŒ… jar åŒ…<br>
windows/Mac/Linux ==&gt; Maven</li>
<li>æŠŠç¼–è¯‘å‡ºæ¥çš„ jar åŒ…(é¡¹ç›®æ ¹ç›®å½•/target/...jar)ä»¥åŠæµ‹è¯•æ•°æ®ä¸Šä¼ åˆ°æœåŠ¡å™¨<br>
scp xxxx hadoop@hostname:directory</li>
<li>æŠŠæ•°æ®ä¸Šä¼ åˆ° HDFS<br>
hadoop fs -put xxx hdfspath</li>
<li>æ‰§è¡Œä½œä¸š<br>
hadoop jar xxx.jar å®Œæ•´çš„ç±»å(åŒ…å+ç±»å) args.....</li>
<li>åˆ° YARN UI(8088) ä¸Šå»è§‚å¯Ÿä½œä¸šçš„è¿è¡Œæƒ…å†µ</li>
<li>åˆ°è¾“å‡ºç›®å½•å»æŸ¥çœ‹å¯¹åº”çš„è¾“å‡ºç»“æœ</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hadoopç³»åˆ—(1)----å¤šé›†ç¾¤é…ç½®æµç¨‹]]></title>
        <id>https://Zu3zz.github.io/post/hadoop-1</id>
        <link href="https://Zu3zz.github.io/post/hadoop-1">
        </link>
        <updated>2019-09-09T13:12:27.000Z</updated>
        <summary type="html"><![CDATA[<center>ç»ˆäºåˆ°äº†æ¿€åŠ¨äººå¿ƒçš„ä¼ª(åˆ’æ‰åˆ†å¸ƒå¼ç¯èŠ‚ å¦‚ä½•å°†HDFSé…ç½®åœ¨å¤šæœºå™¨çš„é›†ç¾¤ä¸Š</center>
<center>è¿™ç¯‡æ–‡ç« ä¼šè¯¦ç»†å‘Šè¯‰ä½ ~</center>]]></summary>
        <content type="html"><![CDATA[<center>ç»ˆäºåˆ°äº†æ¿€åŠ¨äººå¿ƒçš„ä¼ª(åˆ’æ‰åˆ†å¸ƒå¼ç¯èŠ‚ å¦‚ä½•å°†HDFSé…ç½®åœ¨å¤šæœºå™¨çš„é›†ç¾¤ä¸Š</center>
<center>è¿™ç¯‡æ–‡ç« ä¼šè¯¦ç»†å‘Šè¯‰ä½ ~</center>
<!-- more -->
<h1 id="hadoop-é›†ç¾¤è§„åˆ’">Hadoop é›†ç¾¤è§„åˆ’</h1>
<ul>
<li>
<p>HDFS: NN DN</p>
</li>
<li>
<p>YARN: RM NM</p>
</li>
<li>
<p>hadoop000 192.168.199.234</p>
<ul>
<li>NN RM</li>
<li>DN NM</li>
</ul>
</li>
<li>
<p>hadoop001 192.168.199.235</p>
<ul>
<li>DN NM</li>
</ul>
</li>
<li>
<p>hadoop002 192.168.199.236</p>
<ul>
<li>DN NM</li>
</ul>
</li>
</ul>
<h2 id="è¯¦ç»†æ­¥éª¤">è¯¦ç»†æ­¥éª¤</h2>
<ul>
<li>
<p>å¯¹æ¯å°æœºå™¨</p>
<ul>
<li>
<p>ä¿®æ”¹ host é…ç½®</p>
<ul>
<li>
<p>åœ¨/etc/hostname ä¸‹ä¿®æ”¹ hostname(hadoop000/hadoop001/hadoop002)</p>
</li>
<li>
<p>åœ¨/etc/hosts ä¸‹ä¿®æ”¹ ip å’Œ hostname çš„æ˜ å°„å…³ç³»</p>
<ol>
<li>192.168.199.234 hadoop000</li>
<li>192.168.199.235 hadoop001</li>
<li>192.168.199.236 hadoop002</li>
<li>192.168.199.23x localhost(è¯•æœºå™¨è€Œå®š)</li>
</ol>
</li>
</ul>
</li>
<li>
<p>å‰ç½®å®‰è£… ssh è¿›è¡Œå…å¯†ç ç™»å½•æ“ä½œ</p>
</li>
</ul>
<pre><code class="language-shell">ssh-keygen -t rsa
</code></pre>
<p>åœ¨æ¯å° hadoop æœºå™¨ä¸Šè¿›è¡Œæ“ä½œ</p>
<pre><code class="language-shell">ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop000
ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop001
ssh-copy-id -i ~/.ssh/id_rsa.pub hadoop002
</code></pre>
<ul>
<li>
<p>å®‰è£… java jkd</p>
<ul>
<li>é¦–å…ˆåœ¨æ¯å° hadoop é›†ç¾¤æœºå™¨ä¸Šéƒ¨ç½² jdk</li>
<li>å°† jkd bin é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡(~/.bash_profile)</li>
<li>å°† jdk ä»¥åŠç¯å¢ƒå˜é‡é…ç½®æ‹·è´åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šå»(start with hadoop000)</li>
</ul>
<pre><code class="language-shell">scp -r jdk1.8.0_91 hadoop@hadoop001:~/app/
scp -r jdk1.8.0_91 hadoop@hadoop002:~/app/

scp ~/.bash_profile hadoop@hadoop001:~/
scp ~/.bash_profile hadoop@hadoop002:~/
</code></pre>
</li>
<li>
<p>Hadoop éƒ¨ç½²</p>
<ul>
<li>hadoop-env.sh é…ç½®: JAVA_HOME</li>
<li>hdfs-site.xml é…ç½®:</li>
</ul>
<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;dfs.namenode.name.dir&lt;/name&gt;
  &lt;value&gt;/home/hadoop/app/tmp/dfs/name&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
  &lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;
  &lt;value&gt;/home/hadoop/app/tmp/dfs/data&lt;/value&gt;
&lt;/property&gt;
</code></pre>
<ul>
<li>yarn-site.xml</li>
</ul>
<pre><code class="language-xml">&lt;!--åªåœ¨hadoop000æœºå™¨ä¸­è¿›è¡Œé…ç½®--&gt;
&lt;property&gt;
  &lt;name&gt;yarn.nodemanager.aux-services&lt;/name&gt;
  &lt;value&gt;mapreduce_shuffle&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
    &lt;name&gt;yarn.resourcemanager.hostname&lt;/name&gt;
    &lt;value&gt;hadoop000&lt;/value&gt;
&lt;/property&gt;
</code></pre>
<ul>
<li>mapred-site.xml: è¿™ä¸ªæ–‡ä»¶åªæœ‰æ¨¡æ¿ éœ€è¦è‡ªå·±åˆ›å»º</li>
</ul>
<pre><code class="language-xml">&lt;property&gt;
  &lt;name&gt;mapreduce.framework.name&lt;/name&gt;
  &lt;value&gt;yarn&lt;/value&gt;
&lt;/property&gt;
</code></pre>
<ul>
<li>é…ç½® slaves</li>
<li>åˆ†å‘ hadoop åˆ°å…¶ä»–æœºå™¨</li>
</ul>
<pre><code class="language-shell">scp -r hadoop-2.6.0-cdh5.15.1 hadoop@hadoop001:~/app/
scp -r hadoop-2.6.0-cdh5.15.1 hadoop@hadoop002:~/app/

scp ~/.bash_profile hadoop@hadoop001:~/
scp ~/.bash_profile hadoop@hadoop002:~/
</code></pre>
<ul>
<li>NN æ ¼å¼åŒ–</li>
</ul>
<pre><code class="language-shell">hadoop namenode -format
</code></pre>
<ul>
<li>åœ¨æ¯ä¸ªæœºå™¨ä¸Šå¯åŠ¨ HDFS</li>
<li>åœ¨æ¯ä¸ªæœºå™¨ä¸Šå¯åŠ¨ YRAN</li>
</ul>
</li>
</ul>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hiveç³»åˆ—(2)----å†…éƒ¨è¡¨ã€å¤–éƒ¨è¡¨ã€å®æˆ˜]]></title>
        <id>https://Zu3zz.github.io/post/hive-2</id>
        <link href="https://Zu3zz.github.io/post/hive-2">
        </link>
        <updated>2019-09-09T07:48:10.000Z</updated>
        <summary type="html"><![CDATA[<center>è¿™èŠ‚å’±ä»¬æ¥ç‚¹çœŸå®çš„</center>
<center>hiveå¦‚ä½•åˆ›å»ºè¡¨ä»¥åŠè¯»å–æ•°æ®</center>]]></summary>
        <content type="html"><![CDATA[<center>è¿™èŠ‚å’±ä»¬æ¥ç‚¹çœŸå®çš„</center>
<center>hiveå¦‚ä½•åˆ›å»ºè¡¨ä»¥åŠè¯»å–æ•°æ®</center>
<!-- more -->
<h1 id="hive-å¤–éƒ¨è¡¨-å†…éƒ¨è¡¨">Hive å¤–éƒ¨è¡¨ã€å†…éƒ¨è¡¨</h1>
<h2 id="å†…éƒ¨è¡¨">å†…éƒ¨è¡¨</h2>
<p>å¯ä»¥é€šè¿‡ formatted æŸ¥çœ‹è¡¨çš„å±æ€§</p>
<pre><code class="language-sql">desc formattede mp2

å¯ä»¥çœ‹åˆ°ä¸€ç³»åˆ—å±æ€§ å…¶ä¸­æœ‰å±æ€§å¦‚ä¸‹

Table Type: MANAGED_TABLE

MANAGED_TABLEå°±ä»£emp2æ˜¯ä¸€ä¸ªå†…éƒ¨è¡¨

åˆ é™¤emp2
drop table emp2;
</code></pre>
<p>åˆ é™¤è¡¨: HDFS ä¸Šçš„æ•°æ®è¢«åˆ é™¤ &amp; Meta ä¹Ÿè¢«åˆ é™¤</p>
<h2 id="å¤–éƒ¨è¡¨">å¤–éƒ¨è¡¨</h2>
<p>åˆ›å»ºå¤–éƒ¨è¡¨</p>
<pre><code class="language-sql">CREATE EXTERNNAL TABLE emp_external(
empno int,
ename string,
job string,
mgr int,
hiredate string,
sal double,
comm double,
deptno int
) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
location '/external/emp/';

æ­¤æ—¶è¡¨æ˜¯ç©ºè¡¨ è¿˜éœ€è¦åŠ è½½æ•°æ®
LOAD DATA LOCAL INPATH '/home/hadoop/data/emp.txt' ONVERWRITE INTO TABLE emp_external

æ­¤æ—¶é€šè¿‡descæŸ¥çœ‹è¡¨çš„å±æ€§
Table Type: EXTERNAL_TABLE
æ˜¯ä¸€ä¸ªå¤–éƒ¨è¡¨

drop table emp_external
</code></pre>
<p>åˆ é™¤è¡¨: HDFS ä¸Šçš„æ•°æ®ä¸è¢«åˆ é™¤ &amp; Meta ä¸Šè¢«åˆ é™¤<br>
å®‰å…¨æ€§æ›´å¥½</p>
<h2 id="åˆ†åŒºè¡¨">åˆ†åŒºè¡¨</h2>
<p>ä½¿ç”¨åˆ†åŒºè¡¨åˆ›å»º</p>
<pre><code class="language-sql">CREATE EXTERNAL TABLE track_info(
ip string,
country string,
province string,
city string,
url string,
time string,
page string
) partitioned by (day string)
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
location '/project/trackinfo/';
</code></pre>
<p>æ­¤æ—¶é€šè¿‡æ‰§è¡Œ jar åŒ…ç”Ÿæˆ ETL æ–‡ä»¶</p>
<p>å°†è¿™ä¸ªæ–‡ä»¶å­˜å‚¨åˆ° hive ä¸­</p>
<pre><code class="language-sql">LOAD DATA INPATH 'hdfs://localhost:8020/project/input/etl'
OVERWRITE INTO TABLE track_info partition(day='2013-07-21');

ç»Ÿè®¡æ€»æ•°
select count(*) from track_info where day='2013-07-21';

ç»Ÿè®¡çœä»½çš„ä¸ªæ•°
select province,count(*) from track_info where day='2013-07-21' group by province;

ä¸ºäº†æ–¹ä¾¿å±•ç¤º åˆ›å»ºä¸€å¼ è¡¨ç”¨æ¥å­˜å‚¨çœä»½çš„ä¿¡æ¯
create table track_info_province_stat(
province string,
cnt bigint
) partitioned by (day string)
row format delimited fields terminated by '\t';

é€šè¿‡sqlè¯­å¥ç›´æ¥å†™å…¥æ•°æ®
insert overwrite table track_info_province_stat partition(day='2013-07-21') select province, count(*) as cnt from track_info where day='2013-07-21' group by province;

ç»Ÿè®¡é¡µé¢è®¿é—®æƒ…å†µ
select page,count(*) from track_info where day = '2013-07-21' group by page;

åˆ›å»ºä¸€å¼ è¡¨ç”¨æ¥å­˜å‚¨é¡µé¢è®¿é—®ä¿¡æ¯
create table track_info_page_stat(
province string,
cnt bigint
) partitioned by (day string)
row format delimited fields terminated by '\t';

å†™å…¥æ•°æ®
insert overwrite table track_info_page_stat partition(day='2013-07-21') select page, count(*) as cnt from track_info where day='2013-07-21' group by page;
</code></pre>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç»Ÿè®¡çš„æ•°æ®å·²ç»åœ¨ Hive è¡¨ track_info_province_stat<br>
è€Œä¸”è¿™ä¸ªè¡¨æ˜¯ä¸€ä¸ªåˆ†åŒºè¡¨ï¼Œåç»­ç»Ÿè®¡æŠ¥è¡¨çš„æ•°æ®å¯ä»¥ç›´æ¥ä»è¿™ä¸ªè¡¨ä¸­æŸ¥è¯¢<br>
ä¹Ÿå¯ä»¥å°† hive è¡¨çš„æ•°æ®å¯¼å‡ºåˆ° RDBMSï¼ˆsqoop<br>
æ€»ç»“ä¸€ä¸‹æ‰€æœ‰çš„æ“ä½œ</p>
<ol>
<li>ETL</li>
<li>æŠŠ ETL è¾“å‡ºçš„æ•°æ®åŠ è½½åˆ° track_info åˆ†åŒºè¡¨é‡Œ</li>
<li>å„ä¸ªç»´åº¦ç»Ÿè®¡ç»“æœçš„æ•°æ®è¾“å‡ºåˆ°å„è‡ªç»´åº¦çš„è¡¨é‡Œ ï¼ˆå¦‚ track_info_province_statï¼‰</li>
<li>å°†æ•°æ®å¯¼å‡º (optional)</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hiveç³»åˆ—(1)----æ¦‚å¿µã€éƒ¨ç½²ã€è¯­æ³•]]></title>
        <id>https://Zu3zz.github.io/post/hive-1</id>
        <link href="https://Zu3zz.github.io/post/hive-1">
        </link>
        <updated>2019-09-07T12:35:32.000Z</updated>
        <summary type="html"><![CDATA[<p>æ…¢æ…¢å­¦ä¹ è·¯ ä¸€æ­¥ä¸€è„šå°<br>
ä»Šå¤©å¸¦æ¥hiveå­¦ä¹ ç¬”è®°ç³»åˆ—çš„ç¬¬ä¸€ç¯‡</p>
]]></summary>
        <content type="html"><![CDATA[<p>æ…¢æ…¢å­¦ä¹ è·¯ ä¸€æ­¥ä¸€è„šå°<br>
ä»Šå¤©å¸¦æ¥hiveå­¦ä¹ ç¬”è®°ç³»åˆ—çš„ç¬¬ä¸€ç¯‡</p>
<!-- more -->
<h1 id="hive-ç¬”è®°">Hive ç¬”è®°</h1>
<h2 id="hive-æ¦‚å¿µ">Hive æ¦‚å¿µ</h2>
<ul>
<li>
<p>ç»Ÿä¸€å…ƒæ•°æ®ç®¡ç†:</p>
<ul>
<li>Hive æ•°æ®æ˜¯å­˜æ”¾åœ¨ HDFS</li>
<li>å…ƒæ•°æ®ä¿¡æ¯(è®°å½•æ•°æ®çš„æ•°æ®)æ˜¯å­˜æ”¾åœ¨ MySQL ä¸­</li>
<li>SQL on Hadoopï¼š Hiveã€Spark SQLã€impala....</li>
</ul>
</li>
<li>
<p>Hive ä½“ç³»æ¶æ„</p>
<ul>
<li>client: shellã€thrift/jdbc(server/jdbc)ã€WebUI(HUE/Zeppelin)</li>
<li>metastoreï¼š==&gt; MySQL<br>
databaseï¼šnameã€locationã€owner....<br>
tableï¼šnameã€locationã€ownerã€column name/type ....</li>
</ul>
</li>
<li>
<p>Hive éƒ¨ç½²</p>
<ol>
<li>ä¸‹è½½ï¼ˆå®˜ç½‘ï¼‰</li>
<li>è§£å‹åˆ°~/app</li>
<li>æ·»åŠ  HIVE_HOME åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡</li>
<li>ä¿®æ”¹é…ç½®<br>
hive-env.sh<br>
hive-site.xml</li>
<li>æ‹·è´ MySQL é©±åŠ¨åŒ… mysql-java-connector.jar åŒ…åˆ°$HIVE_HOME/lib ä¸‹</li>
<li>å‰ææ˜¯è¦å‡†å¤‡å®‰è£…ä¸€ä¸ª MySQL æ•°æ®åº“ï¼Œåˆ©ç”¨ yum install å®‰è£…ä¸€ä¸ª MySQL æ•°æ®åº“ https://www.cnblogs.com/julyme/p/5969626.html</li>
</ol>
<pre><code class="language-xml">&lt;!--hive-site.xmlé…ç½®--&gt;
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;?xml-stylesheet type=&quot;text/xsl&quot; href=&quot;configuration.xsl&quot;?&gt;

&lt;configuration&gt;
&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;
  &lt;value&gt;jdbc:mysql://hadoop000:3306/hadoop_hive?createDatabaseIfNotExist=true&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;
  &lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;
  &lt;value&gt;æˆ‘æ˜¯ç”¨æˆ·å&lt;/value&gt;
&lt;/property&gt;

&lt;property&gt;
  &lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;
  &lt;value&gt;æˆ‘æ˜¯å¯†ç &lt;/value&gt;
&lt;/property&gt;
&lt;/configuration&gt;
</code></pre>
</li>
</ul>
<h2 id="hive-çš„-sql-è¯­è¨€">Hive çš„ sql è¯­è¨€</h2>
<h3 id="ddl">DDL</h3>
<p>Hive Data Definition Language</p>
<pre><code class="language-shell">createã€deleteã€alter...
</code></pre>
<p>Hive æ•°æ®æŠ½è±¡/ç»“æ„:</p>
<pre><code class="language-ASCII">+-- database  HDFSä¸€ä¸ªç›®å½•
|   +-- table HDFSä¸€ä¸ªç›®å½•
    |   +-- data  æ–‡ä»¶
    |   +-- partition åˆ†åŒºè¡¨  HDFSä¸€ä¸ªæ–‡ä»¶
        |   +-- data  æ–‡ä»¶
        |   +-- bucket  åˆ†æ¡¶  HDFSä¸€ä¸ªæ–‡ä»¶
</code></pre>
<p>Hive å…·ä½“ ddl æ“ä½œ</p>
<h3 id="åˆ›å»ºæ•°æ®åº“">åˆ›å»ºæ•°æ®åº“</h3>
<pre><code class="language-sql">CREATE (DATABASE|SCHEMA) [IF NOT EXISTS] database_name
  [COMMENT database_comment]
  [LOCATION hdfs_path]
  [WITH DBPROPERTIES (property_name=property_value, ...)];

CREATE DATABASE IF NOT EXISTS hive;

CREATE DATABASE IF NOT EXISTS hive2 LOCATION '/test/location';

CREATE DATABASE IF NOT EXISTS hive3
WITH DBPROPERTIES('creator'='pk');
</code></pre>
<p>/user/hive/warehouse æ˜¯ Hive é»˜è®¤çš„å­˜å‚¨åœ¨ HDFS ä¸Šçš„è·¯å¾„</p>
<h3 id="åˆ›å»ºè¡¨">åˆ›å»ºè¡¨</h3>
<pre><code class="language-sql">CREATE TABLE emp(
empno int,
ename string,
job string,
mgr int,
hiredate string,
sal double,
comm double,
deptno int
) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';
</code></pre>
<h3 id="è¯»å–æœ¬åœ°æ•°æ®">è¯»å–æœ¬åœ°æ•°æ®</h3>
<pre><code class="language-sql">LOAD DATA [LOCAL] INPATH 'filepath' [OVERWRITE] INTO TABLE tablename [PARTITION (partcol1=val1, partcol2=val2 ...)]

LOAD DATA LOCAL INPATH '/home/hadoop/data/emp.txt' OVERWRITE INTO TABLE emp;
</code></pre>
<p>LOCALï¼šæœ¬åœ°ç³»ç»Ÿï¼Œå¦‚æœæ²¡æœ‰ local é‚£ä¹ˆå°±æ˜¯æŒ‡çš„ HDFS çš„è·¯å¾„<br>
OVERWRITEï¼šæ˜¯å¦æ•°æ®è¦†ç›–ï¼Œå¦‚æœæ²¡æœ‰é‚£ä¹ˆå°±æ˜¯æ•°æ®è¿½åŠ </p>
<pre><code class="language-sql">LOAD DATA LOCAL INPATH '/home/hadoop/data/emp.txt' OVERWRITE INTO TABLE emp;

LOAD DATA INPATH 'hdfs://hadoop000:8020/data/emp.txt' INTO TABLE emp;

INSERT OVERWRITE LOCAL DIRECTORY '/tmp/hive/'
ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t'
select empno,ename,sal,deptno from emp;
</code></pre>
<h3 id="åŸºæœ¬ç»Ÿè®¡">åŸºæœ¬ç»Ÿè®¡</h3>
<pre><code class="language-sql">select * from emp where sal between 800 and 1500 (limit(5));

select * from emp where ename in ('SMITH','KING');

select * from emp where sal is (not) null;
</code></pre>
<h3 id="èšåˆæ“ä½œ">èšåˆæ“ä½œ</h3>
<p>max/min/sum/avg</p>
<pre><code class="language-sql">select count(1) from emp where deptno = 10;

select max(sal),min(sal),sum(sal),avg(sal) from emp;
</code></pre>
<h3 id="åˆ†ç»„å‡½æ•°">åˆ†ç»„å‡½æ•°</h3>
<p>group by</p>
<p>å‡ºç°åœ¨ select ä¸­çš„å­—æ®µï¼Œå¦‚æœæ²¡æœ‰å‡ºç°åœ¨èšåˆå‡½æ•°é‡Œï¼Œé‚£ä¹ˆä¸€å®šè¦å®ç°åœ¨ group by é‡Œ</p>
<pre><code class="language-sql">æ±‚æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„
select deptno, avg(sal) from emp group by deptno;

æ±‚æ¯ä¸ªéƒ¨é—¨ã€å·¥ä½œå²—ä½çš„å¹³å‡å·¥èµ„
select deptno,job,avg(sal) from emp group by deptno, job;

æ±‚æ¯ä¸ªéƒ¨é—¨çš„å¹³å‡å·¥èµ„å¤§äº2000çš„éƒ¨é—¨
select deptno, avg(sal) avg_sal from emp group by deptno where avg_sal &gt; 2000; é”™è¯¯ï¼ï¼ï¼

group by ä¸èƒ½åŒæ—¶å’Œ where ä½¿ç”¨
åº”è¯¥ä½¿ç”¨havingæ›¿ä»£where

select deptno, avg(sal) abg_sal from emp group by deptno having avg_sal &gt; 2000;
</code></pre>
<h3 id="å¤šè¡¨æ“ä½œ">å¤šè¡¨æ“ä½œ</h3>
<p>join</p>
<p>ä¸¤ä¸ªè¡¨:</p>
<ol>
<li>emp</li>
<li>dept</li>
</ol>
<pre><code class="language-sql">åˆ›å»ºè¡¨
CREATE TABLE dept(
deptno int,
dname string,
loc string
) ROW FORMAT DELIMITED FIELDS TERMINATED BY '\t';
åŠ è½½æ•°æ®
LOAD DATA LOCAL INPATH '/home/hadoop/data/dept.txt' OVERWRITE INTO TABLE dept;

select
e.empno,e.ename,e.sal,e.deptno,d.name
from emp e join dept d
on e.deptno=d.deptno
</code></pre>
<h4 id="å…³äº-stage-0-stage-3-stage-4">å…³äº stage-0ã€stage-3ã€stage-4</h4>
<p>ç”±äºjoinæ˜¯ä¸€ä¸ªå¤æ‚æ“ä½œï¼Œæ‰€ä»¥éœ€è¦åˆ†æ­¥éª¤è¿›è¡ŒæŸ¥è¯¢</p>
<pre><code class="language-sql">explain EXTENDED
select
e.empno,e.ename,e.sal,e.deptno,d.dname
from emp e join dept d
on e.deptno=d.deptno;
</code></pre>
<ul>
<li>stage-4 is root stage</li>
<li>stage-3 depends on stage-4</li>
<li>stage-0 depends on stage-3</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[pythonåŸºç¡€æ“ä½œ]]></title>
        <id>https://Zu3zz.github.io/post/python-basic</id>
        <link href="https://Zu3zz.github.io/post/python-basic">
        </link>
        <updated>2019-09-04T13:23:26.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  åˆ†äº«Pythonçš„ä¸€äº›éªšæ“ä½œ</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  åˆ†äº«Pythonçš„ä¸€äº›éªšæ“ä½œ</p>
<!-- more -->
<h2 id="file">file</h2>
<pre><code class="language-python">file1 = read(&quot;test.txt&quot;)
# æ‰¾åˆ°å½“å‰ä½ç½®çš„æŒ‡é’ˆ
file1.tell()
# è®©æ–‡ä»¶çš„æŒ‡ç¤ºæŒ‡é’ˆè¿›è¡Œåç§» ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨åç§»ä½ç½® ç¬¬äºŒä¸ªå‚æ•° 0ä»£è¡¨ä»æ–‡ä»¶å¼€å¤´åç§» 1ä»£è¡¨ä»å½“å‰ä½ç½®è¿›è¡Œåç§» 2ä»£è¡¨ä»æ–‡ä»¶ç»“å°¾è¿›è¡Œåç§»
file1.seek(5,0)
</code></pre>
<h2 id="errorå¤„ç†">errorå¤„ç†</h2>
]]></content>
    </entry>
</feed>