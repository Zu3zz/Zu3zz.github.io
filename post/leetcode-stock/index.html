<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>leetcode-股票买卖问题(121,122,123,188,309,714) | 风袖</title>
<meta name="description" content="烟蛾敛略不胜态，风袖低昂如有情">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zu3zz.github.io/favicon.ico?v=1589731257565">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zu3zz.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zu3zz.github.io">
        <img src="https://zu3zz.github.io/images/avatar.png?v=1589731257565" class="site-logo">
        <h1 class="site-title">风袖</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
        
          <a href="/projects" class="site-nav">
            项目
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/Zu3zz" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      烟蛾敛略不胜态，风袖低昂如有情
    </div>
    <div class="site-footer">
      By 3zz. | <a class="rss" href="https://zu3zz.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">leetcode-股票买卖问题(121,122,123,188,309,714)</h2>
            <div class="post-date">2019-08-18</div>
            
              <div class="feature-container" style="background-image: url('https://zu3zz.github.io/post-images/leetcode-stock.png')">
              </div>
            
            <div class="post-content">
              <p>如何用一个动态规划方程解决leetcode上所有的股票买卖问题，且听我道来</p>
<!-- more -->
<p><strong>直接看题目188</strong></p>
<h2 id="188-买卖股票的最佳时机-iv">188. 买卖股票的最佳时机 IV</h2>
<p>给定一个数组，它的第 i 个元素是一支给定的股票在第 i 天的价格。</p>
<p>设计一个算法来计算你所能获取的最大利润。你最多可以完成 k 笔交易。</p>
<p>注意: 你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>
<p>示例 1:</p>
<pre><code>输入: [2,4,1], k = 2
输出: 2
解释: 在第 1 天 (股票价格 = 2) 的时候买入，在第 2 天 (股票价格 = 4) 的时候卖出，这笔交易所能获得利润 = 4-2 = 2 。
</code></pre>
<p>示例2：</p>
<pre><code>输入: [3,2,6,5,0,3], k = 2
输出: 7
解释: 在第 2 天 (股票价格 = 2) 的时候买入，在第 3 天 (股票价格 = 6) 的时候卖出, 这笔交易所能获得利润 = 6-2 = 4 。
     随后，在第 5 天 (股票价格 = 0) 的时候买入，在第 6 天 (股票价格 = 3) 的时候卖出, 这笔交易所能获得利润 = 3-0 = 3 。
</code></pre>
<p>对于这道题，最麻烦的无异于暴力，复杂度会变成O(2^n)。<br>
使用动态规划(dp)，可以有效的解决</p>
<p>对于一个常见的dp问题来说 通常分两步走</p>
<ol>
<li>定义状态方程</li>
<li>转移公式</li>
</ol>
<p>对于这道题，可以定义一个状态方程max_profit[i]用来记录到第i天的最大利润</p>
<pre><code class="language-c++">mp[i] = mp[i-1] + -a[i](如果买入) + a[i](如果卖出)
</code></pre>
<p>但是股票的买入需要当前手上没有股票买入<br>
同样 股票的卖出需要手上已经持有了一股的股票<br>
单纯的一维数组没有办法记录这些信息 所以需要增加一维度</p>
<pre><code class="language-c++">使用mp[i][j]
j=[0,1] // 0为可以买 1为可以卖
</code></pre>
<p>此时状态方程变为</p>
<pre><code>mp[i][0] = max(mp[i-1][0] //不交易 ,mp[i-1][1] + a[i]// 前一天卖了一股)
mp[i][1] = max(mp[i-1][1] // 不交易, mp[i-1][0] - a[i] //前一天买了一股)
</code></pre>
<p>由于188题有限制条件，即最多只能交易k次，还需要记录交易次数，还需要一维来记录交易了多少次<br>
此时状态方程变成了</p>
<pre><code>mp[i][h][k]
i 表示天数
j 表示是否持有股票
k 表示之前交易了多少次
</code></pre>
<p>此时动态规划的转移方程变成了如下所示:</p>
<pre><code class="language-c++">// 为了方便理解 把k放到了第二维

//前一天 要么不操作 要么卖掉了一股
mp[i][k][0] = max(mp[i-1][k][0], mp[i-1][k-1][1] + a[i])

//  前一天 要么不操作 要么买入了一股
mp[i][k][1] = max(mp[i-1][k][1], mp[i-1][k][0] - a[i)
</code></pre>
<p>想要求出最大的收益 只需要找到<br>
<code>mp[n-1, {0...k},0]</code>的最大值即可</p>
<h2 id="188买卖股票的最佳时机iv">188.买卖股票的最佳时机IV</h2>
<h3 id="python-solution">python solution</h3>
<pre><code class="language-python">class Solution:
    def maxProfit(self, k: int, prices: List[int]) -&gt; int:
        if not prices or not k:
            return 0
        n  = len(prices)
        # 如果k大于数组长度的一半，则可以用贪心解决
        if k &gt; n//2:
            return self.greedy(prices)
        # 动态规划
        dp = [[[0] * 2 for _ in range(k+1)] for _ in range(n)]
        res = []
        # 设置初始状态
        for i in range(k+1):
            dp[0][i][0], dp[0][i][1] = 0, -prices[0]
        # 开始两层循环
        for i in range(1,n):
            for j in range(k+1):
                if not j:
                    dp[i][j][0] = dp[i-1][j][0]
                else:
                    dp[i][j][0] = max(dp[i-1][j][0], dp[i-1][j-1][1] + prices[i])
                dp[i][j][1] = max(dp[i-1][j][1], dp[i-1][j][0] - prices[i])
        # 找到最大值
        for m in range(k+1):
            print(dp[n-1][m][0])
            res.append(dp[n-1][m][0])
        return max(res)
    def greedy(self, prices):
        res = 0
        for i in range(1,len(prices)):
            if prices[i] &gt; prices[i-1]:
                res += prices[i] - prices[i-1]
        return res
</code></pre>
<h2 id="309买卖股票的最佳时机含冻结期">309.买卖股票的最佳时机含冻结期</h2>
<p>对于这道题目 dp状态可以相应减少，因为没有次数的限制了，只需要做一个二维的dp就可以了 一个维度i是用来存储天数，另外一个维度j用来存储当前股票买卖的状态 012分别表示没有买入 买入了 以及处于冻结期</p>
<h3 id="python-solution-2">python solution</h3>
<pre><code class="language-python">class Solution:
    def maxProfit(self, prices: List[int]) -&gt; int:
        if not prices:
            return 0
        n = len(prices)
        dp = [[0] * 3 for _ in range(n)]
        # 0表示今天未持有 1表示今天持有 2表示今天处于冻结状态
        dp[0][0], dp[0][1], dp[0][2] = 0,-prices[0],0
        for i in range(1,n):
            dp[i][0] = max(dp[i-1][0], dp[i-1][2])
            dp[i][1] = max(dp[i-1][1], dp[i-1][0] - prices[i])
            dp[i][2] = dp[i-1][1] + prices[i]
        return max(dp[n-1][0], dp[n-1][2])
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://zu3zz.github.io/tag/lyighyBv5/" class="tag">
                    Algorithm
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/MzVUE1KTI/" class="tag">
                    LeetCode
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/atQXWdwzr/" class="tag">
                    Data Structure
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/jmeIOwq49/" class="tag">
                    Python
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://zu3zz.github.io/post/leetcode-weeklycontest-150/">
                  <h3 class="post-title">
                    Leetcode-weeklyContest-150
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
