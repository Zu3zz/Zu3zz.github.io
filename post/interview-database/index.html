<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>数据库面试考点 | 风袖</title>
<meta name="description" content="烟蛾敛略不胜态，风袖低昂如有情">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zu3zz.github.io/favicon.ico?v=1589731257565">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zu3zz.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zu3zz.github.io">
        <img src="https://zu3zz.github.io/images/avatar.png?v=1589731257565" class="site-logo">
        <h1 class="site-title">风袖</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
        
          <a href="/projects" class="site-nav">
            项目
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/Zu3zz" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      烟蛾敛略不胜态，风袖低昂如有情
    </div>
    <div class="site-footer">
      By 3zz. | <a class="rss" href="https://zu3zz.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">数据库面试考点</h2>
            <div class="post-date">2020-02-12</div>
            
            <div class="post-content">
              <p>🐰详细讲解数据库面试常见问题，包含索引、锁、事务等内容🐰</p>
<!-- more -->
<h1 id="数据库面试总结">数据库面试总结</h1>
<h2 id="1-架构">1. 架构</h2>
<h3 id="1-rdbms">1. RDBMS</h3>
<ol>
<li>程序实例
<ul>
<li>存储管理</li>
<li>缓存机制</li>
<li>SQL解析</li>
<li>日志管理</li>
<li>权限划分</li>
<li><strong>索引管理</strong></li>
<li><strong>锁管理</strong></li>
</ul>
</li>
<li>存储（文件系统）</li>
</ol>
<h2 id="2-索引">2. 索引</h2>
<ol>
<li>为什么要使用索引：避免全表扫描/快速查询数据</li>
<li>什么样的信息能成为索引：主键、唯一键</li>
<li>索引的数据结构
<ul>
<li>建立二叉查找树进行二分查找</li>
<li>建立B-Tree结构进行查找</li>
<li>建立B+-Tree结构进行查找</li>
<li>建立Hash结构进行查找</li>
</ul>
</li>
</ol>
<hr>
<h3 id="1-优化索引">1. 优化索引</h3>
<ol>
<li>
<p>二叉查找树</p>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1581850416812.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>B-Tree（logn）</p>
<ol>
<li>根节点至少包括两个孩子</li>
<li>树中每个节点最多含有m个孩子（m&gt;=2）</li>
<li>除根节点和叶节点外，其他每个节点至少有ceil（m/2）个孩子</li>
<li>所有叶子节点都位于同一层</li>
</ol>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1581850429749.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>B+树</p>
<ol>
<li>定义基本与B树相同</li>
<li>除了非叶子节点的指针必须与叶子结点数相同</li>
<li>非叶子节点的子树指针P[i]，指向关键字符[K[i]，K[i+1]]的子树</li>
<li>非叶子节点仅用来索引，数据都保存在叶子结点中</li>
<li>所有叶子节点均有一个链指针指向下一个叶子结点</li>
</ol>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1581850440775.png" alt="" loading="lazy"></figure>
</li>
<li>
<p>为什么B+树更适合用来做存储索引</p>
<ul>
<li>B+树的磁盘读写代价更低</li>
<li>B+树的查询效率更加稳定</li>
<li>B+树更有利于对数据库的扫描</li>
</ul>
</li>
</ol>
<hr>
<h3 id="2-hash索引">2. Hash索引</h3>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1581850457121.png" alt="" loading="lazy"></figure>
<h4 id="缺点">缺点：</h4>
<ol>
<li>仅仅能满足“=”，“IN&quot;，不能使用范围查询</li>
<li>无法被用来避免数据的排序操作</li>
<li>不能利用部分索引键查询</li>
<li>不能避免表扫描</li>
<li>遇到大量Hash值相等的情况后性能并不一定就会比B-Tree索引高</li>
</ol>
<hr>
<h3 id="3-bitmap索引了解">3. BitMap索引（了解）</h3>
<ul>
<li>位图索引</li>
</ul>
<hr>
<h3 id="4-密集索引与稀疏索引的区别">4. 密集索引与稀疏索引的区别</h3>
<ul>
<li>密集索引文件中的每个搜索码值都对应一个索引值</li>
<li>系数索引文件只为索引码的某些值建立索引项</li>
</ul>
<ol>
<li>对于InnoDB
<ol>
<li>若一个主键被定义，则该主键作为密集索引</li>
<li>若没有主键被定义，该表的第一个唯一非空索引则作为密集索引</li>
<li>若没有，innodb内部会生成一个隐藏主键（密集索引）</li>
<li>非主键索引存储相关键位和其对应的主键值，包含两次查找</li>
<li>索引和数据是存在一起的</li>
</ol>
</li>
<li>对于MyISAM
<ol>
<li>都是稀疏索引</li>
<li>索引和数据是分开的</li>
</ol>
</li>
</ol>
<hr>
<h3 id="5-问题回顾与总结">5. 问题回顾与总结</h3>
<ol>
<li>为什么要使用索引</li>
<li>什么样的信息能成为索引</li>
<li>索引的数据结构</li>
<li>密集索引和系数索引的区别</li>
</ol>
<hr>
<h3 id="6-一些衍生问题">6. 一些衍生问题</h3>
<h4 id="61-如何定位并优化慢查询sql">6.1 如何定位并优化慢查询Sql</h4>
<ol>
<li>根据慢日志定位慢查询sql</li>
<li>使用explain等工具分析sql
<ul>
<li>using filesort：文件排序 不能使用索引</li>
<li>using temporary：使用临时表</li>
</ul>
</li>
<li>修改sql或者尽量让sql走索引</li>
</ol>
<h4 id="62-联合索引的最左匹配原则的成因">6.2 联合索引的最左匹配原则的成因</h4>
<ul>
<li>MySQL会一直向右匹配到范围查询（&gt;、&lt;、between、like）就停止匹配</li>
</ul>
<pre><code class="language-sql"> a = 1 and b = 2 and c &gt; 3 and d = 4 
 如果遇到（a,b,c,d)这样的，到c就停止了
</code></pre>
<h4 id="63-索引是建立的越多越好吗">6.3 索引是建立的越多越好吗</h4>
<ul>
<li>否。数据量小的表不需要建立索引，建立或增加额外的索引开销</li>
<li>数据变更需要维护索引，因此更多的索引意味着更多的维护成本</li>
<li>更多的索引意味着也需要更多的空间</li>
</ul>
<h2 id="3-锁">3. 锁</h2>
<h3 id="31-常见问题">3.1 常见问题</h3>
<ol>
<li>MyISAM与InnoDB关于锁方面的区别是什么</li>
<li>数据库事务的四大特性</li>
<li>事务隔离级别以及各2级别下的并发访问问题</li>
<li>InnoDB可重复读隔离级别下如何避免幻读</li>
<li>RC、RR级别下的InnoDB的非阻塞读如何实现</li>
</ol>
<hr>
<h4 id="1-myisam与innodb关于锁方面的区别是什么">1. MyISAM与InnoDB关于锁方面的区别是什么</h4>
<ol>
<li>MyISAM默认用的是表级锁，不支持行级锁</li>
<li>InnoDB默认用的是行级锁，也支持表级锁</li>
<li>写锁 又叫 排它锁</li>
<li>读锁 又叫 共享锁</li>
<li>先读再写不会被锁</li>
<li>先写再读会被锁</li>
</ol>
<figure data-type="image" tabindex="5"><img src="https://zu3zz.github.io/post-images/1581850500524.png" alt="" loading="lazy"></figure>
<h4 id="2-myisam适合的场景">2. MyISAM适合的场景</h4>
<ol>
<li>频繁执行全表count语句</li>
<li>对数据进行增删改的频率不搞，查询非常频繁</li>
<li>没有事务</li>
</ol>
<h4 id="3-innodb适合的场景">3. InnoDB适合的场景</h4>
<ol>
<li>数据增删改查都相当频繁</li>
<li>可靠性要求比较高，要求支持事务</li>
</ol>
<h3 id="32-数据库锁的分类">3.2 数据库锁的分类</h3>
<ul>
<li>按锁的粒度分化，可分为表级锁、行级锁、页级锁</li>
<li>按锁的级别划分，可分为共享锁、排它锁</li>
<li>按枷锁方式划分，课分为自动锁、显式锁</li>
<li>按操作划分，可分为DML锁、DDL锁</li>
<li>按使用方式划分，可分为乐观锁、悲观锁</li>
</ul>
<h4 id="1-乐观锁的实现方式">1. 乐观锁的实现方式</h4>
<ul>
<li>基于时间戳</li>
<li>基于版本号（写SQL语句的时候先检查version）</li>
</ul>
<h3 id="33-数据库事务的四大特性">3.3 数据库事务的四大特性</h3>
<ol>
<li>原子性（Atomic）：发生错误回滚</li>
<li>一致性（Consistency）</li>
<li>隔离性（Isolation）：一个事务的执行不应该影响到其他事务</li>
<li>持久性（Durability）：redo log</li>
</ol>
<h3 id="34-事务隔离级别以及各级别下的并发访问问题">3.4 事务隔离级别以及各级别下的并发访问问题</h3>
<ol>
<li>更新丢失：mysql所有事务隔离级别在数据库层面上均可避免</li>
<li>脏读：一个事务读到另外一个事务未提交的数据：READ——COMMITTED事务隔离级别以上可避免（MyISAM默认）
<ul>
<li>只能读到其他事务提交的级别，就不会造成问题了</li>
</ul>
</li>
<li>不可重复读：REPEATABLE-READ事务隔离级别以上可避免（InnoDB默认）</li>
<li>幻读：另外一个事务对同一个数据库进行了插入或者删除操作：SERIALIZABLE事务隔离级别可避免</li>
</ol>
<figure data-type="image" tabindex="6"><img src="https://zu3zz.github.io/post-images/1581850513584.png" alt="" loading="lazy"></figure>
<h3 id="35-innodb课重复读隔离级别下如何避免幻读">3.5 InnoDB课重复读隔离级别下如何避免幻读</h3>
<ol>
<li>表象：快照读（非阻塞读）——伪MVCC
<ul>
<li>当前读：update、delete、insert、select...lock in share mode</li>
<li>快照读：不加锁的非阻塞读、select</li>
<li>再次调用快照读会出问题</li>
</ul>
</li>
<li>内在：next-key锁（行锁+gap锁）（搞不懂）
<ul>
<li>在Serializable下 是用的这个</li>
</ul>
</li>
</ol>
<h3 id="36-rc-rr级别下的innodb的非阻塞读如何实现">3.6 RC、RR级别下的InnoDB的非阻塞读如何实现</h3>
<ol>
<li>数据行里的DB_TRX_ID、DB_ROLL_PTR、DB_ROW_ID字段</li>
<li>从 undo日志 里恢复</li>
<li>read view</li>
</ol>
<h2 id="4-语法">4. 语法</h2>
<ol>
<li>GROUP BY</li>
<li>HAVING</li>
<li>统计相关：COUNT、SUM、MAX、MIN、AVG</li>
</ol>
<h3 id="1-group-by分组">1. GROUP BY（分组）</h3>
<ul>
<li>满足 “select字句中的列名必须为分组列或者列函数”</li>
<li>列函数对于group by字句定义的每个组各返回一个结果</li>
<li>如果用group by，那么你的Select语句中选出的列要么是你group by里用到的列，要么就是带有之前我们说的如sum min等列函数的列，如果带上其他的，会报错。</li>
</ul>
<h3 id="2-having过滤">2. HAVING（过滤）</h3>
<ul>
<li>通常与GROUP BY字句一起使用</li>
<li>WHERE过滤行，HAVING过滤组</li>
<li>出现在同一行sql的顺序：WHERE&gt;GROUP BY&gt;HAVING</li>
</ul>
<h3 id="3自己多练">3.自己多练</h3>
<h2 id="5-myisam与innodb区别">5 MyISAM与InnoDB区别</h2>
<ol>
<li>InnoDB支持事务，MyISAM不支持，对于InnoDB每一条SQL语言都默认封装成事务，自动提交，这样会影响速度，所以最好把多条SQL语言放在begin和commit之间，组成一个事务；</li>
<li>InnoDB支持外键，而MyISAM不支持。对一个包含外键的InnoDB表转为MYISAM会失败；</li>
<li>InnoDB是聚集索引，使用B+Tree作为索引结构，数据文件是和（主键）索引绑在一起的（表数据文件本身就是按B+Tree组织的一个索引结构），必须要有主键，通过主键索引效率很高。但是辅助索引需要两次查询，先查询到主键，然后再通过主键查询到数据。因此，主键不应该过大，因为主键太大，其他索引也都会很大。</li>
<li>InnoDB不保存表的具体行数，执行select count(*) from table时需要全表扫描。而MyISAM用一个变量保存了整个表的行数，执行上述语句时只需要读出该变量即可，速度很快（注意不能加有任何WHERE条件）</li>
<li>Innodb不支持全文索引，而MyISAM支持全文索引，在涉及全文索引领域的查询效率上MyISAM速度更快高；PS：5.7以后的InnoDB支持全文索引了</li>
<li>MyISAM表格可以被压缩后进行查询操作</li>
<li>InnoDB支持表、行(默认)级锁，而MyISAM支持表级锁</li>
<li>InnoDB表必须有主键（用户没有指定的话会自己找或生产一个主键），而Myisam可以没有</li>
<li>Innodb存储文件有frm、ibd，而Myisam是frm、MYD、MYI
<ul>
<li>Innodb：frm是表定义文件，ibd是数据文件</li>
<li>Myisam：frm是表定义文件，myd是数据文件，myi是索引文件</li>
</ul>
</li>
</ol>
<h2 id="6-sql语句的优化">6. SQL语句的优化</h2>
<h4 id="1-定位慢sql语句">1. 定位慢SQL语句</h4>
<ul>
<li>
<p>好慢询可以帮我们找到执行慢的 SQL，在使用前，我们需要先看下慢查询是否已经开启，使用下面这条命令即可：</p>
<pre><code class="language-sql">mysql &gt; show variables like '%slow_query_log';
</code></pre>
</li>
<li>
<p>我们能看到 slow_query_log=OFF，也就是说慢查询日志此时是关上的。我们可以把慢查询日志打开，注意设置变量值的时候需要使用 global，否则会报错</p>
<pre><code class="language-sql">mysql &gt; set global slow_query_log='ON';
mysql &gt; set global long_query_time = 3;
</code></pre>
</li>
</ul>
<h4 id="2-使用explain">2. 使用EXPLAIN</h4>
<p>EXPLAIN 可以帮助我们了解数据表的读取顺序、SELECT 子句的类型、数据表的访问类型、可使用的索引、实际使用的索引、使用的索引长度、上一个表的连接匹配条件、被优化器查询的行的数量以及额外的信息（比如是否使用了外部排序，是否使用了临时表等）等。</p>
<pre><code class="language-sql">EXPLAIN SELECT comment_id, comment_text, user_id FROM product_comment WHERE comment_id = 500000;
</code></pre>
<h4 id="3-使用profile">3. 使用PROFILE</h4>
<ul>
<li>SHOW PROFILE 相比 EXPLAIN 能看到更进一步的执行解析，包括 SQL 都做了什么、所花费的时间等。默认情况下，profiling 是关闭的，我们可以在会话级别开启这个功能。</li>
</ul>
<pre><code class="language-sql">mysql &gt; set profiling = 'ON';
mysql &gt; show profiles;
</code></pre>
<ul>
<li>不过 SHOW PROFILE 命令将被弃用，我们可以从 information_schema 中的 profiling 数据表进行查看。</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://zu3zz.github.io/tag/uhv6L1Wqc/" class="tag">
                    Database
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/r3gGxAQVM/" class="tag">
                    Interview
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/U3FdeW1UW/" class="tag">
                    NoSQL
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/7acBApeyq/" class="tag">
                    MySQL
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://zu3zz.github.io/post/interview-network/">
                  <h3 class="post-title">
                    计算机网络面试考点总结
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
