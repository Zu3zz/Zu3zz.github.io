<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é£è¢–</title>
<meta name="description" content="çƒŸè›¾æ•›ç•¥ä¸èƒœæ€ï¼Œé£è¢–ä½æ˜‚å¦‚æœ‰æƒ…" />
<link rel="shortcut icon" href="https://zu3zz.github.io/favicon.ico?v=1589731629533">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.remixicon.com/releases/v1.3.1/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://zu3zz.github.io/styles/main.css">
<link rel="alternate" type="application/atom+xml" title="é£è¢– - Atom Feed" href="https://zu3zz.github.io/atom.xml">



  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="remixicon-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://zu3zz.github.io">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://zu3zz.github.io/images/avatar.png?v=1589731629533" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">é£è¢–</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            æ–‡ç« ç›®å½•
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#springcloud-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BC%98%E6%83%A0%E5%88%B81-springboot%E7%9B%B8%E5%85%B3">SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³</a>
<ul>
<li><a href="#1-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86">1. è‡ªåŠ¨è£…é…åŸç†</a></li>
<li><a href="#2-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2. é…ç½®æ–‡ä»¶</a></li>
<li><a href="#3-%E9%85%8D%E7%BD%AE%E6%B3%A8%E5%85%A5">3. é…ç½®æ³¨å…¥</a></li>
<li><a href="#4-%E5%AE%9A%E6%97%B6%E5%BA%94%E7%94%A8">4. å®šæ—¶åº”ç”¨</a></li>
<li><a href="#5-%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1">5. å¼‚æ­¥ä»»åŠ¡</a>
<ul>
<li><a href="#1-%E5%BC%82%E6%AD%A5%E6%96%B9%E6%B3%95">1. å¼‚æ­¥æ–¹æ³•</a></li>
<li><a href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E6%AD%A5%E7%BA%BF%E7%A8%8B%E6%B1%A0">2. è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± </a></li>
</ul>
</li>
<li><a href="#6-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95">6. å•å…ƒæµ‹è¯•</a></li>
<li><a href="#7-%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E4%BB%BB%E5%8A%A1">7. å¼€æœºå¯åŠ¨ä»»åŠ¡</a></li>
<li><a href="#8-jackson%E7%9A%84%E4%BD%BF%E7%94%A8">8. Jacksonçš„ä½¿ç”¨</a></li>
<li><a href="#9-acutator%E7%9B%91%E6%8E%A7">9. Acutatorç›‘æ§</a>
<ul>
<li><a href="#1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8">1. åŸºæœ¬ä½¿ç”¨</a></li>
<li><a href="#2-%E5%B8%B8%E7%94%A8%E9%80%89%E9%A1%B9%E5%92%8C%E9%85%8D%E7%BD%AE">2. å¸¸ç”¨é€‰é¡¹å’Œé…ç½®</a></li>
<li><a href="#3-%E7%AB%AF%E7%82%B9%E4%BD%BF%E7%94%A8">3. ç«¯ç‚¹ä½¿ç”¨</a></li>
</ul>
</li>
<li><a href="#10-%E8%87%AA%E5%AE%9A%E4%B9%89starter">10. è‡ªå®šä¹‰starter</a>
<ul>
<li><a href="#1-%E8%87%AA%E5%AE%9A%E4%B9%89starter%E9%A1%B9%E7%9B%AE%E5%87%86%E5%A4%87">1. è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡</a></li>
</ul>
</li>
<li><a href="#11-%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC%E7%AE%A1%E7%90%86springboot%E9%A1%B9%E7%9B%AE">11. ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="remixicon-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu" style="animation-delay: 0.6000000000000001s">
          å…³äº
        </a>
      
    
      
        <a href="/projects" class="menu" style="animation-delay: 0.8s">
          é¡¹ç›®
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700">By 3zz.</div>
    <a class="rss" href="https://zu3zz.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2020-05-12 / 13 min read
        </div>
        
        <div class="post-content yue">
          <p>ğŸ¥•SpringCloudå®æˆ˜åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²è§£SpringBootä¸­çš„ä¸€äº›é«˜çº§ç‰¹æ€§ğŸ¥•</p>
<!-- more -->
<h2 id="springcloud-åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸1-springbootç›¸å…³">SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³</h2>
<h3 id="1-è‡ªåŠ¨è£…é…åŸç†">1. è‡ªåŠ¨è£…é…åŸç†</h3>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1589274133972.png" alt="" loading="lazy"></figure>
<h3 id="2-é…ç½®æ–‡ä»¶">2. é…ç½®æ–‡ä»¶</h3>
<ul>
<li>åŒä¸€ç›®å½•ä¸‹çš„applicationå’Œbootstrap
<ol>
<li>bootstrapä¼˜å…ˆçº§é«˜äºapplicationï¼Œä¼˜å…ˆè¢«åŠ è½½</li>
<li>bootstrapç”¨äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µï¼Œç”±çˆ¶ApplicationContextåŠ è½½</li>
<li>bootstrapæ˜¯ç³»ç»Ÿçº§åˆ«çš„é…ç½®ï¼ˆä¸å˜çš„å‚æ•°ï¼‰ï¼Œapplicationæ˜¯åº”ç”¨çº§åˆ«çš„é…ç½®</li>
</ol>
</li>
<li>ä¸åŒä½ç½®çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼ˆä¼˜å…ˆçº§ï¼‰
<ul>
<li><code>file: ./config/</code> - ä¼˜å…ˆçº§æœ€é«˜ï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹çš„configï¼‰</li>
<li><code>file: ./</code> - ä¼˜å…ˆçº§ç¬¬äºŒï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹ï¼‰</li>
<li><code>classpath: /config/</code> - ä¼˜å…ˆçº§ç¬¬ä¸‰ ï¼ˆé¡¹ç›®resources/configä¸‹ï¼‰</li>
<li><code>classpath: /</code> - ä¼˜å…ˆçº§ç¬¬å››ï¼ˆé¡¹ç›®resourcesç›®å½•ä¸‹ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="3-é…ç½®æ³¨å…¥">3. é…ç½®æ³¨å…¥</h3>
<ol>
<li>
<p>ç›´æ¥ä½¿ç”¨<code>@Value</code>çš„å½¢å¼</p>
<pre><code class="language-java">@Value(&quot;${zth.springboot.version}&quot;)
private String version
</code></pre>
</li>
<li>
<p>éœ€è¦åœ¨pom.xmlä¸­é¦–å…ˆé…ç½®ç”¨äºæ•°æ®ç»‘å®šçš„ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
  &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</code></pre>
<p>applicaiton.ymlé…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<pre><code class="language-yml"># application.yml
zth:
	springboot:
		version: 2.3.1
		name: study
</code></pre>
<p>æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é…ç½®ç±»ä¸­çš„å€¼éœ€è¦å’Œapplicaiton.ymlæ–‡ä»¶ä¸­ä¸€è‡´</p>
<pre><code class="language-java">@Data
@Component
@ConfigurationProperties(prefix = &quot;zth.springboot&quot;)
public class SpringBootConfig {
  private String version;
	private String name;
}
</code></pre>
<p>ä½¿ç”¨<code>@Autowired</code>å°±å¯ä»¥æ³¨å…¥<code>SpringBootConfig</code>äº†</p>
</li>
</ol>
<h3 id="4-å®šæ—¶åº”ç”¨">4. å®šæ—¶åº”ç”¨</h3>
<ol>
<li>
<p>éœ€è¦åœ¨ä¸»é…ç½®ä¸Šå¼€å¯å…è®¸å®šæ—¶ä»»åŠ¡çš„æ³¨è§£<code>@EnableScheduling</code></p>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç±»</p>
<pre><code class="language-java">@Slf4j
@Component
public class BootSchedule {
  private final DateTimeFormatter fmt = DateTimeFormatter.ofPattern(
  	&quot;HH:mm:ss&quot;
  );
  // ä¸Šä¸€æ¬¡å¼€å§‹æ‰§è¡Œæ—¶é—´ç‚¹ä¹‹å3ç§’å†æ‰§è¡Œ
  @Scheduled(fixedRate = 3000)
  public void schedule01(){
    log.info(&quot;schedule01 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
  // ç¬¬ä¸€æ¬¡å»¶è¿Ÿ2sä¹‹åæ‰§è¡Œ
  // ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œæ¯•æ—¶é—´ç‚¹ä¹‹å3ç§’å†æ‰§è¡Œ
  @Scheduled(initialDelay = 2000, fixedDelay = 3000)
  public void schedule02(){
    log.info(&quot;schedule02 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
  
  // æ¯3sæ‰§è¡Œä¸€æ¬¡
  // ä½¿ç”¨cronè¡¨è¾¾å¼çš„å½¢å¼
  @Scheduled(cron = &quot;*/3 * * * * ?&quot;)
  public void schedule04(){
    log.info(&quot;schedule02 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
}
</code></pre>
</li>
</ol>
<h3 id="5-å¼‚æ­¥ä»»åŠ¡">5. å¼‚æ­¥ä»»åŠ¡</h3>
<h4 id="1-å¼‚æ­¥æ–¹æ³•">1. å¼‚æ­¥æ–¹æ³•</h4>
<ol>
<li>
<p>é¦–å…ˆéœ€è¦åœ¨pom.xmlä¸­æ·»åŠ springbootçš„webä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>åœ¨å¯åŠ¨ç±»ä¸­å¼€å¯å¼‚æ­¥çš„æ³¨é‡Š<code>@EnableAsync</code></p>
<pre><code class="language-java">@EnableAsync
@EnableScheduling
@SpringBootApplication
public class SpringBootStudyApplication{
  public static void main(String[] args){
    // ...
  }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªå¼‚æ­¥å¤„ç†æœåŠ¡<code>asyncService</code></p>
<pre><code class="language-java">@Slf4j
@Service
public class AsyncService {
  @Async(&quot;getAsyncExecutor&quot;)
  public void asyncProcess() throws InterruptedException {
    log.info(&quot;async process task, current thread name -&gt; {}&quot;,
            Thread.currentThread().getName());
    TimeUnit.SECONDS.sleep(2);
  }
  @Async(&quot;getAsyncExecutor&quot;)
  public Future&lt;Integer&gt; asyncProcessHasReturn() throws InterruptedException {
    log.info(&quot;async process task(has return), current thread name -&gt; {}&quot;,
            Thread.currentThread().getName());
    TimeUnit.SECONDS.sleep(2);
    return new AsyncResult&lt;&gt;(100);
  }
}
</code></pre>
</li>
</ol>
<h4 id="2-è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± ">2. è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± </h4>
<ol>
<li>
<p><code>SpringBoot</code>ä¸­è‡ªå¸¦çš„å¼‚æ­¥çº¿ç¨‹æ± ä¸­æœ‰é—®é¢˜</p>
</li>
<li>
<p>åœ¨<code>config</code>ç›®å½•ä¸­å®šä¹‰ä¸€ä¸ª<code>AsyncPoolConfig</code></p>
<pre><code class="language-java">@Slf4j
@Configuration
public class AsyncPoolConfig implements AsyncConfigurer {
  @Bean
  @Override
  public Excutor getAsyncExecutor() {
    ThreadPoolTaskExcutor excutor = new ThreadPoolTaskExecutor();
    excutor.setCorePoolSize(10);
    excutor.setMaxPoolSize(20);
    excutor.setQueueCapacity(20);
    excutor.setKeepAliveSeconds(60);
    excutor.setThreadNamePrefix(&quot;ZthAsync_&quot;);
    excutor.setWaitForTasksToCompleteOnShutDown(true);
    excutor.setAwaitTerminationSeconds(60);
    // æ‹’ç»ç­–ç•¥
    excutor.setRejectedExecutionHandler(
    	new ThreadPoolExcutor.CallerRunsPolicy()
    );
    excutor.initialize();
    return excutor;
  }
  // å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„å¼‚å¸¸å¤„ç†ç±»
  @Override
  public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
    return new AsyncExceptionHandler();
  }
  class AsyncExceptionHandler implements AsyncUncaughtExceptionHandler {
    @Override
    public void handleUncaughtException(Throwable throwable,
                                       Method method, Object... objects){
      log.info(&quot;AsyncError: {}, Method: {}, Param: {}&quot;,
              throwable.getMessage(),
              method.getName(),
              JSON.toJSONString(objects));
      throwable.printStackTrace();
      // TODO å‘é€æç¤ºï¼ˆé‚®ä»¶orçŸ­ä¿¡ï¼‰
    }
  }
}
</code></pre>
</li>
</ol>
<h3 id="6-å•å…ƒæµ‹è¯•">6. å•å…ƒæµ‹è¯•</h3>
<ol>
<li>
<p>é¦–å…ˆå¼•å…¥å•å…ƒæµ‹è¯•çš„<code>pom.xml</code>é…ç½®</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>æ–°å»ºåŒåç±»è·¯å¾„ï¼Œæ–°å»ºåŸºç¡€æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@SpringBootTest
@RunWith(SpringRunner.class)
public class SpringBootStudyTests {
  @Test
  public void contextLoad(){
  }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºä¸Šè¿°å¼‚æ­¥ä»»åŠ¡æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@Slf4j
@SpringBootTest
@RunWith(SpringRunner.class)
public class AsyncServiceTest {
    @Autowired
    private AsyncService asyncService;
    @Test
    public void testAsyncProcess() throws InterruptedException {
        asyncService.asyncProcess();
        log.info(&quot;coming in testAsyncProcess...&quot;);
    }
    @Test
    public void testAsyncProcessHasReturn() throws Exception {
        long start = System.currentTimeMillis();
        Future&lt;Integer&gt; result = asyncService.asyncProcessHasReturn();
//        log.info(&quot;get async task value: {}&quot;, result.get());
        log.info(&quot;get async task value: {}&quot;,
                result.get(1, TimeUnit.SECONDS));
        log.info(&quot;time elapse for async task: {}ms&quot;,
                System.currentTimeMillis() - start);
    }
}
</code></pre>
</li>
</ol>
<h3 id="7-å¼€æœºå¯åŠ¨ä»»åŠ¡">7. å¼€æœºå¯åŠ¨ä»»åŠ¡</h3>
<ol>
<li>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š<code>ApplicationRunner</code></p>
<pre><code class="language-java">@Order(2)
@Slf4j
@Component
public class BootApplicationRunner implements ApplicationRunner {
    @Override
    public void run(ApplicationArguments args) throws Exception {
        log.info(&quot;This is BootApplicationRunner...&quot;);
    }
}
</code></pre>
</li>
<li>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š<code>CommandLineRunner</code></p>
<pre><code class="language-java">@Order(1)
@Slf4j
@Component
public class BootCommandLineRunner implements CommandLineRunner {
    @Override
    public void run(String... args) throws Exception {
        log.info(&quot;This is BootCommandLineRunner...&quot;);
    }
}
</code></pre>
</li>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹<code>ApplicationRunner</code>é«˜äº<code>CommandLIineRunner</code></p>
</li>
</ol>
<h3 id="8-jacksonçš„ä½¿ç”¨">8. Jacksonçš„ä½¿ç”¨</h3>
<ol>
<li>
<p>æ–°å»ºä¸€ä¸ªç®€å•VOç±»<code>Coder</code></p>
<pre><code class="language-java">// Coder.java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@JsonIgnoreProperties({ &quot;address&quot; })
public class Coder {
    private String name;
    private int age;
    // @JsonIgnore -&gt; ä½¿ç”¨æ‰“åœ¨ç±»ä¸Šé¢çš„JsonIgnore
    private String address;
    @JsonProperty(&quot;rt&quot;)
    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)
    private Date registerTime;
}
</code></pre>
</li>
<li>
<p>å¯ä»¥åœ¨<code>config</code>ç›®å½•ä¸‹å®šä¹‰ä¸€ä¸ª<code>JacksonConfig</code>ç±»ï¼Œç”¨äºå¯¹æ—¶é—´å­—æ®µçš„åºåˆ—åŒ–ä¿®é¥°</p>
<pre><code class="language-java">@Configuration
public class JacksonConfig {
    @Bean
    public ObjectMapper getObjectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        // ä¸åºåˆ—åŒ–åŒ…å«nullçš„å­—æ®µ
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        // formatå¯¹è±¡
        mapper.setDateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;));
        return mapper;
    }
}
</code></pre>
</li>
<li>
<p>åœ¨controllerä¸­æ–°å»ºä¸€ä¸ªæ–¹æ³•ç”¨æ¥æµ‹è¯•Jackson</p>
<pre><code class="language-java">// Controller.java
/**
* 127.0.0.1:8000/zth/springboot/jackson
**/
@GetMapping(&quot;/jackson&quot;)
public Imoocer jackson() throws Exception {
  Imoocer imoocer = Imoocer.builder()
    .name(&quot;zth&quot;)
    .age(19)
    .address(&quot;shanghai&quot;)
    .registerTime(new Date())
    .build();
  // åºåˆ—åŒ–
  String jsonImoocer = mapper.writeValueAsString(imoocer);
  log.info(&quot;imoocer jackson: {}&quot;, jsonImoocer);
  return mapper.readValue(jsonImoocer, Imoocer.class);
}
// è¿”å›ç»“æœ
{
  &quot;name&quot;: &quot;qinyi&quot;,
  &quot;age&quot;: 23,
  &quot;rt&quot;: &quot;2020-05-12&quot;
}
</code></pre>
</li>
</ol>
<h3 id="9-acutatorç›‘æ§">9. Acutatorç›‘æ§</h3>
<h4 id="1-åŸºæœ¬ä½¿ç”¨">1. åŸºæœ¬ä½¿ç”¨</h4>
<ol>
<li>
<p>Actuatoræ˜¯ä»€ä¹ˆï¼Œèƒ½åšä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æ˜¯ä»€ä¹ˆï¼šæ˜¯SpringBootæä¾›çš„å¯¹åº”ç”¨ç³»ç»Ÿçš„è‡ªçœå’Œç›‘æ§çš„é›†æˆåŠŸèƒ½</li>
<li>èƒ½åšä»€ä¹ˆï¼šæŸ¥çœ‹åº”ç”¨ï¼ˆé…ç½®ï¼‰ä¿¡æ¯ã€ç¯å¢ƒä¿¡æ¯ä»¥åŠå¯¹åº”ç”¨è¿›è¡Œç›‘æ§</li>
</ul>
</li>
<li>
<p>Actuatorç›‘æ§åˆ†ç±»ï¼š</p>
<ul>
<li>åŸç”Ÿç«¯ç‚¹
<ul>
<li>åº”ç”¨é…ç½®ç±»ï¼ˆè¿è¡Œæ—¶ä¿¡æ¯ï¼‰</li>
<li>åº¦é‡æŒ‡æ ‡ç±»ï¼ˆè¿è¡ŒæœŸçš„ä¿¡æ¯ï¼‰</li>
<li>æ“ä½œæ§åˆ¶ç±»ï¼ˆshutdown é»˜è®¤ä¸å¼€å¯ï¼‰</li>
</ul>
</li>
<li>è‡ªå®šä¹‰ç«¯ç‚¹</li>
</ul>
</li>
<li>
<p>æ·»åŠ pom.xmlä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>åœ¨application.ymlä¸­é…ç½®ç«¯ç‚¹å¼€å¯çŠ¶å†µ</p>
<pre><code class="language-yaml">management:
  endpoint:
    shutdown:
      enabled: true # æœ€ç‰¹æ®Šçš„ç›‘æ§ç«¯ç‚¹ ä¸€èˆ¬ä¸å¼€å¯
  endpoints:
    web:
      exposure:
        include: &quot;*&quot; # æ‰“å¼€æ‰€æœ‰çš„ç›‘æ§ç‚¹ []å¯ä»¥é€‰æ‹©è¦æ‰“å¼€å“ªäº›
</code></pre>
</li>
<li>
<p>è¯·æ±‚<code>localhost:8000/zth/acuator/health</code>ç«¯å£</p>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre>
</li>
<li>
<p>åœ¨application.ymlä¸­é…ç½®infoä¿¡æ¯</p>
<pre><code class="language-yaml">info:
  app:
    name: zth-springboot-study
    groupId: com.zth.springboot.study
    version: 1.0-SNAPSHOT
</code></pre>
<p>è¯·æ±‚<code>localhost:8000/zth/acuator/info</code>ç«¯å£ï¼Œæ­¤æ—¶è¿”å›ä¿¡æ¯å¦‚ä¸‹</p>
<pre><code class="language-json">{
  &quot;app&quot;: {
    &quot;name&quot;: &quot;zth-springboot-study&quot;,
    &quot;groupId&quot;: &quot;com.zth.springboot.study&quot;,
    &quot;version&quot;: &quot;1.0-SNAPSHOT&quot;
  }
}
</code></pre>
</li>
</ol>
<h4 id="2-å¸¸ç”¨é€‰é¡¹å’Œé…ç½®">2. å¸¸ç”¨é€‰é¡¹å’Œé…ç½®</h4>
<ol>
<li>
<p>åº”ç”¨é…ç½®ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>è‡ªå·±é…ç½®çš„infoä¿¡æ¯ï¼š/actuator/info</li>
<li>åº”ç”¨ä¸­beançš„ä¿¡æ¯ï¼š/actuator/beans</li>
<li>åº”ç”¨ä¸­URIè·¯å¾„ä¿¡æ¯ï¼š/actuator/mappings</li>
</ul>
</li>
<li>
<p>åº¦é‡æŒ‡æ ‡ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>æ£€æŸ¥åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼š/actuator/health</li>
<li>å½“å‰çº¿ç¨‹æ´»åŠ¨å¿«ç…§ï¼š/actuator/threaddump</li>
</ul>
</li>
<li>
<p>æ“ä½œæ§åˆ¶ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>
<p>å…³é—­åº”ç”¨ï¼ˆPOSTï¼‰ï¼š/actuator/shutdown</p>
<pre><code class="language-shell">curl -x post &quot;http://loccalhost:8000/actuator/shutdown&quot;
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="3-ç«¯ç‚¹ä½¿ç”¨">3. ç«¯ç‚¹ä½¿ç”¨</h4>
<ol>
<li>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹endpointï¼Œæ–°å»ºDateTimeEndPointç±»</p>
<pre><code class="language-java">// DateTimeEndPoint.java
/**
 * &lt;h1&gt;è‡ªå®šä¹‰äº‹ä»¶ç«¯ç‚¹&lt;/h1&gt;
 */
@Endpoint(id = &quot;datetime&quot;)
public class DateTimeEndPoint {
    private String format = &quot;yyyy-MM-dd HH:mm:ss&quot;;
    // ç”¨æ¥æ˜¾ç¤ºç›‘æ§æŒ‡æ ‡
    // zth/actuator/datetime
    @ReadOperation
    public Map&lt;String, Object&gt; info() {
        Map&lt;String, Object&gt; info = new HashMap&lt;&gt;();
        info.put(&quot;name&quot;, &quot;zth&quot;);
        info.put(&quot;age&quot;, &quot;23&quot;);
        info.put(&quot;datetime&quot;, new SimpleDateFormat(format).format(new Date()));
        return info;
    }

    // åŠ¨æ€æ›´æ”¹ç›‘æ§æŒ‡æ ‡
    @WriteOperation
    public void setFormat(String format) {
        this.format = format;
    }
}
</code></pre>
</li>
<li>
<p>åœ¨endpointæ–‡ä»¶å¤¹ä¸‹æ–°å»ºè‡ªå®šä¹‰ç«¯ç‚¹é…ç½®ç±»DateTimeEndpointConfig</p>
<pre><code class="language-java">// DateTimeEndpointConfig.java
// è‡ªå®šä¹‰ç«¯ç‚¹é…ç½®ç±»
@Configuration
public class DateTimeEndpointConfig {
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnEnabledEndpoint
    public DateTimeEndPoint dateTimeEndPoint() {
        return new DateTimeEndPoint();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨postmanä¸­ä½¿ç”¨GETè¯·æ±‚<code>localhost:8000/zth/actuator/datetime</code></p>
<pre><code class="language-json">{
  &quot;datetime&quot;: &quot;2020-05-12 08:08:08&quot;,
  &quot;name&quot;: &quot;zth&quot;,
  &quot;age&quot;: &quot;23&quot;
}
</code></pre>
<p>å½“ä½¿ç”¨POSTè¯·æ±‚<code>localhost:8000/zth/actuator/datetime</code>æ—¶å¸¦å¦‚ä¸‹è¯·æ±‚ä½“æ—¶</p>
<pre><code class="language-json">{
  &quot;format&quot;: &quot;yyyy-MM-dd&quot;
}
</code></pre>
<p>æ— è¿”å›ç»“æœï¼Œå†æ¬¡ä½¿ç”¨GETè¯·æ±‚è®¿é—®<code>localhost:8000/zth/actuator/datetime</code>ï¼Œè¿”å›ç»“æœå¦‚ä¸‹</p>
<pre><code class="language-json">{
  &quot;datetime&quot;: &quot;2020-05-12&quot;,
  &quot;name&quot;: &quot;zth&quot;,
  &quot;age&quot;: &quot;23&quot;
}
</code></pre>
</li>
</ol>
<h3 id="10-è‡ªå®šä¹‰starter">10. è‡ªå®šä¹‰starter</h3>
<h4 id="1-è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡">1. è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡</h4>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ª<code>springboot</code>é¡¹ç›®ï¼Œ<code>groupId</code>æŒ‰ç…§<code>xxxx-spring-boot-starter</code>çš„æ ¼å¼å‘½å</p>
</li>
<li>
<p>æ·»åŠ pom.xmlæ–‡ä»¶ä¾èµ–</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.zth.springboot&lt;/groupId&gt;
    &lt;artifactId&gt;split-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt;
        &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;
    &lt;/parent&gt;
    &lt;properties&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
</li>
<li>
<p>æ–°å»ºserviceç›®å½•ï¼Œserviceæ–¹æ³•è¿˜æœ‰å¯¹åº”çš„å®ç°ç±»</p>
<pre><code class="language-java">// ISplitService.java
// å­—ç¬¦ä¸²åˆ†å‰²æœåŠ¡æ¥å£å®šä¹‰
public interface ISplitService {
    List&lt;String&gt; split(String value);
}
</code></pre>
<p>å¯¹åº”çš„å®ç°ç±»</p>
<pre><code class="language-java">// SplitServiceImpl.java
public class SplitServiceImpl implements ISplitService {
    @SuppressWarnings(&quot;all&quot;)
    @Override
    public List&lt;String&gt; split(String value) {
        // jdk1.8ä¸­çš„streamæµ
        return Stream.of(StringUtils.split(value, &quot;,&quot;))
                .collect(Collectors.toList());
    }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºconfigureç›®å½•ï¼Œæ–°å»ºè‡ªåŠ¨é…ç½®ç±»</p>
<pre><code class="language-java">@Configuration
@ConditionalOnClass(value = { ISplitService.class, SplitServiceImpl.class})
public class SplitAutoConfigure {
    @Bean
    @ConditionalOnMissingBean
    ISplitService starterService() {
        return new SplitServiceImpl();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºMETA-INFæ–‡ä»¶å¤¹ï¼Œæ·»åŠ é…ç½®ç±»<code>spring.factories</code></p>
<pre><code class="language-shell"># ç±»ä¼¼key = valueçš„é”®å€¼å¯¹å½¢å¼
org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.imooc.springboot.configure.SplitAutoConfigure
</code></pre>
</li>
<li>
<p>åœ¨terminalä¸­ï¼Œè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤å®ç°ç¼–è¯‘æ‰“åŒ…</p>
<pre><code class="language-shell">$ mvn clean install -Dmaven.test.skip=true
</code></pre>
</li>
</ol>
<h3 id="11-ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®">11. ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®</h3>
<ol>
<li>
<p>åœ¨resourcesä¸‹æ–°å»ºstart.shæ–‡ä»¶</p>
<pre><code class="language-sh">#!/user/bin/env bash
nohup java -jar zth-spring-boot-study.jar &amp;
</code></pre>
</li>
<li>
<p>å…³é—­åº”ç”¨è„šæœ¬ stop.sh</p>
<pre><code class="language-sh">#!/user/bin/env bash
pid = `ps -ef | grep zth-spring-boot-study.jar | grep -v grep | awk '{print $2}'` 
if [[ -z &quot;${pid}&quot; ]]
then
	echo application is already stopped
else
	echo kill ${pid}
	kill -9 ${pid}
fi
</code></pre>
</li>
</ol>

        </div>

        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://zu3zz.github.io/tag/rAV1Yp-Gr/">
            <span class="flex-auto">SpringCloud</span>
          </a>
        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://zu3zz.github.io/tag/VaOfOOWC5/">
            <span class="flex-auto">SpringBoot</span>
          </a>
        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://zu3zz.github.io/tag/tqQSAbU7V/">
            <span class="flex-auto">BackEnd</span>
          </a>
        


        <div class="flex justify-between py-8">
          

          
            <div class="next-post">
              <a href="https://zu3zz.github.io/post/java-2/">
                <h3 class="post-title">
                  Javaé¢è¯•æ€»ç»“(2) -- çº¿ç¨‹ç¯‡
                  <i class="remixicon-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        

      </div>
    </div>

    <script src="https://zu3zz.github.io/media/prism.js"></script>  
<script>

Prism.highlightAll()

let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
