<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³ | é£è¢–</title>
<meta name="description" content="çƒŸè›¾æ•›ç•¥ä¸èƒœæ€ï¼Œé£è¢–ä½æ˜‚å¦‚æœ‰æƒ…">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zu3zz.github.io/favicon.ico?v=1589731493762">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zu3zz.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zu3zz.github.io">
        <img src="https://zu3zz.github.io/images/avatar.png?v=1589731493762" class="site-logo">
        <h1 class="site-title">é£è¢–</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
        
          <a href="/projects" class="site-nav">
            é¡¹ç›®
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/Zu3zz" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      çƒŸè›¾æ•›ç•¥ä¸èƒœæ€ï¼Œé£è¢–ä½æ˜‚å¦‚æœ‰æƒ…
    </div>
    <div class="site-footer">
      By 3zz. | <a class="rss" href="https://zu3zz.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³</h2>
            <div class="post-date">2020-05-12</div>
            
            <div class="post-content">
              <p>ğŸ¥•SpringCloudå®æˆ˜åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²è§£SpringBootä¸­çš„ä¸€äº›é«˜çº§ç‰¹æ€§ğŸ¥•</p>
<!-- more -->
<h2 id="springcloud-åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸1-springbootç›¸å…³">SpringCloud åˆ†å¸ƒå¼ä¼˜æƒ åˆ¸(1)---SpringBootç›¸å…³</h2>
<h3 id="1-è‡ªåŠ¨è£…é…åŸç†">1. è‡ªåŠ¨è£…é…åŸç†</h3>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1589274133972.png" alt="" loading="lazy"></figure>
<h3 id="2-é…ç½®æ–‡ä»¶">2. é…ç½®æ–‡ä»¶</h3>
<ul>
<li>åŒä¸€ç›®å½•ä¸‹çš„applicationå’Œbootstrap
<ol>
<li>bootstrapä¼˜å…ˆçº§é«˜äºapplicationï¼Œä¼˜å…ˆè¢«åŠ è½½</li>
<li>bootstrapç”¨äºåº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡çš„å¼•å¯¼é˜¶æ®µï¼Œç”±çˆ¶ApplicationContextåŠ è½½</li>
<li>bootstrapæ˜¯ç³»ç»Ÿçº§åˆ«çš„é…ç½®ï¼ˆä¸å˜çš„å‚æ•°ï¼‰ï¼Œapplicationæ˜¯åº”ç”¨çº§åˆ«çš„é…ç½®</li>
</ol>
</li>
<li>ä¸åŒä½ç½®çš„é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼ˆä¼˜å…ˆçº§ï¼‰
<ul>
<li><code>file: ./config/</code> - ä¼˜å…ˆçº§æœ€é«˜ï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹çš„configï¼‰</li>
<li><code>file: ./</code> - ä¼˜å…ˆçº§ç¬¬äºŒï¼ˆé¡¹ç›®æ ¹è·¯å¾„ä¸‹ï¼‰</li>
<li><code>classpath: /config/</code> - ä¼˜å…ˆçº§ç¬¬ä¸‰ ï¼ˆé¡¹ç›®resources/configä¸‹ï¼‰</li>
<li><code>classpath: /</code> - ä¼˜å…ˆçº§ç¬¬å››ï¼ˆé¡¹ç›®resourcesç›®å½•ä¸‹ï¼‰</li>
</ul>
</li>
</ul>
<h3 id="3-é…ç½®æ³¨å…¥">3. é…ç½®æ³¨å…¥</h3>
<ol>
<li>
<p>ç›´æ¥ä½¿ç”¨<code>@Value</code>çš„å½¢å¼</p>
<pre><code class="language-java">@Value(&quot;${zth.springboot.version}&quot;)
private String version
</code></pre>
</li>
<li>
<p>éœ€è¦åœ¨pom.xmlä¸­é¦–å…ˆé…ç½®ç”¨äºæ•°æ®ç»‘å®šçš„ä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
  &lt;optional&gt;true&lt;/optional&gt;
&lt;/dependency&gt;
</code></pre>
<p>applicaiton.ymlé…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<pre><code class="language-yml"># application.yml
zth:
	springboot:
		version: 2.3.1
		name: study
</code></pre>
<p>æ–°å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é…ç½®ç±»ä¸­çš„å€¼éœ€è¦å’Œapplicaiton.ymlæ–‡ä»¶ä¸­ä¸€è‡´</p>
<pre><code class="language-java">@Data
@Component
@ConfigurationProperties(prefix = &quot;zth.springboot&quot;)
public class SpringBootConfig {
  private String version;
	private String name;
}
</code></pre>
<p>ä½¿ç”¨<code>@Autowired</code>å°±å¯ä»¥æ³¨å…¥<code>SpringBootConfig</code>äº†</p>
</li>
</ol>
<h3 id="4-å®šæ—¶åº”ç”¨">4. å®šæ—¶åº”ç”¨</h3>
<ol>
<li>
<p>éœ€è¦åœ¨ä¸»é…ç½®ä¸Šå¼€å¯å…è®¸å®šæ—¶ä»»åŠ¡çš„æ³¨è§£<code>@EnableScheduling</code></p>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç±»</p>
<pre><code class="language-java">@Slf4j
@Component
public class BootSchedule {
  private final DateTimeFormatter fmt = DateTimeFormatter.ofPattern(
  	&quot;HH:mm:ss&quot;
  );
  // ä¸Šä¸€æ¬¡å¼€å§‹æ‰§è¡Œæ—¶é—´ç‚¹ä¹‹å3ç§’å†æ‰§è¡Œ
  @Scheduled(fixedRate = 3000)
  public void schedule01(){
    log.info(&quot;schedule01 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
  // ç¬¬ä¸€æ¬¡å»¶è¿Ÿ2sä¹‹åæ‰§è¡Œ
  // ä¸Šä¸€æ¬¡æ‰§è¡Œå®Œæ¯•æ—¶é—´ç‚¹ä¹‹å3ç§’å†æ‰§è¡Œ
  @Scheduled(initialDelay = 2000, fixedDelay = 3000)
  public void schedule02(){
    log.info(&quot;schedule02 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
  
  // æ¯3sæ‰§è¡Œä¸€æ¬¡
  // ä½¿ç”¨cronè¡¨è¾¾å¼çš„å½¢å¼
  @Scheduled(cron = &quot;*/3 * * * * ?&quot;)
  public void schedule04(){
    log.info(&quot;schedule02 -&gt; {}&quot;, LocalDateTime.now().format(fmt));
  }
}
</code></pre>
</li>
</ol>
<h3 id="5-å¼‚æ­¥ä»»åŠ¡">5. å¼‚æ­¥ä»»åŠ¡</h3>
<h4 id="1-å¼‚æ­¥æ–¹æ³•">1. å¼‚æ­¥æ–¹æ³•</h4>
<ol>
<li>
<p>é¦–å…ˆéœ€è¦åœ¨pom.xmlä¸­æ·»åŠ springbootçš„webä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
<p>åœ¨å¯åŠ¨ç±»ä¸­å¼€å¯å¼‚æ­¥çš„æ³¨é‡Š<code>@EnableAsync</code></p>
<pre><code class="language-java">@EnableAsync
@EnableScheduling
@SpringBootApplication
public class SpringBootStudyApplication{
  public static void main(String[] args){
    // ...
  }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºä¸€ä¸ªå¼‚æ­¥å¤„ç†æœåŠ¡<code>asyncService</code></p>
<pre><code class="language-java">@Slf4j
@Service
public class AsyncService {
  @Async(&quot;getAsyncExecutor&quot;)
  public void asyncProcess() throws InterruptedException {
    log.info(&quot;async process task, current thread name -&gt; {}&quot;,
            Thread.currentThread().getName());
    TimeUnit.SECONDS.sleep(2);
  }
  @Async(&quot;getAsyncExecutor&quot;)
  public Future&lt;Integer&gt; asyncProcessHasReturn() throws InterruptedException {
    log.info(&quot;async process task(has return), current thread name -&gt; {}&quot;,
            Thread.currentThread().getName());
    TimeUnit.SECONDS.sleep(2);
    return new AsyncResult&lt;&gt;(100);
  }
}
</code></pre>
</li>
</ol>
<h4 id="2-è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± ">2. è‡ªå®šä¹‰å¼‚æ­¥çº¿ç¨‹æ± </h4>
<ol>
<li>
<p><code>SpringBoot</code>ä¸­è‡ªå¸¦çš„å¼‚æ­¥çº¿ç¨‹æ± ä¸­æœ‰é—®é¢˜</p>
</li>
<li>
<p>åœ¨<code>config</code>ç›®å½•ä¸­å®šä¹‰ä¸€ä¸ª<code>AsyncPoolConfig</code></p>
<pre><code class="language-java">@Slf4j
@Configuration
public class AsyncPoolConfig implements AsyncConfigurer {
  @Bean
  @Override
  public Excutor getAsyncExecutor() {
    ThreadPoolTaskExcutor excutor = new ThreadPoolTaskExecutor();
    excutor.setCorePoolSize(10);
    excutor.setMaxPoolSize(20);
    excutor.setQueueCapacity(20);
    excutor.setKeepAliveSeconds(60);
    excutor.setThreadNamePrefix(&quot;ZthAsync_&quot;);
    excutor.setWaitForTasksToCompleteOnShutDown(true);
    excutor.setAwaitTerminationSeconds(60);
    // æ‹’ç»ç­–ç•¥
    excutor.setRejectedExecutionHandler(
    	new ThreadPoolExcutor.CallerRunsPolicy()
    );
    excutor.initialize();
    return excutor;
  }
  // å®šä¹‰å¼‚æ­¥ä»»åŠ¡çš„å¼‚å¸¸å¤„ç†ç±»
  @Override
  public AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() {
    return new AsyncExceptionHandler();
  }
  class AsyncExceptionHandler implements AsyncUncaughtExceptionHandler {
    @Override
    public void handleUncaughtException(Throwable throwable,
                                       Method method, Object... objects){
      log.info(&quot;AsyncError: {}, Method: {}, Param: {}&quot;,
              throwable.getMessage(),
              method.getName(),
              JSON.toJSONString(objects));
      throwable.printStackTrace();
      // TODO å‘é€æç¤ºï¼ˆé‚®ä»¶orçŸ­ä¿¡ï¼‰
    }
  }
}
</code></pre>
</li>
</ol>
<h3 id="6-å•å…ƒæµ‹è¯•">6. å•å…ƒæµ‹è¯•</h3>
<ol>
<li>
<p>é¦–å…ˆå¼•å…¥å•å…ƒæµ‹è¯•çš„<code>pom.xml</code>é…ç½®</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
  &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
  &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>æ–°å»ºåŒåç±»è·¯å¾„ï¼Œæ–°å»ºåŸºç¡€æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@SpringBootTest
@RunWith(SpringRunner.class)
public class SpringBootStudyTests {
  @Test
  public void contextLoad(){
  }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºä¸Šè¿°å¼‚æ­¥ä»»åŠ¡æµ‹è¯•ç”¨ä¾‹</p>
<pre><code class="language-java">@Slf4j
@SpringBootTest
@RunWith(SpringRunner.class)
public class AsyncServiceTest {
    @Autowired
    private AsyncService asyncService;
    @Test
    public void testAsyncProcess() throws InterruptedException {
        asyncService.asyncProcess();
        log.info(&quot;coming in testAsyncProcess...&quot;);
    }
    @Test
    public void testAsyncProcessHasReturn() throws Exception {
        long start = System.currentTimeMillis();
        Future&lt;Integer&gt; result = asyncService.asyncProcessHasReturn();
//        log.info(&quot;get async task value: {}&quot;, result.get());
        log.info(&quot;get async task value: {}&quot;,
                result.get(1, TimeUnit.SECONDS));
        log.info(&quot;time elapse for async task: {}ms&quot;,
                System.currentTimeMillis() - start);
    }
}
</code></pre>
</li>
</ol>
<h3 id="7-å¼€æœºå¯åŠ¨ä»»åŠ¡">7. å¼€æœºå¯åŠ¨ä»»åŠ¡</h3>
<ol>
<li>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š<code>ApplicationRunner</code></p>
<pre><code class="language-java">@Order(2)
@Slf4j
@Component
public class BootApplicationRunner implements ApplicationRunner {
    @Override
    public void run(ApplicationArguments args) throws Exception {
        log.info(&quot;This is BootApplicationRunner...&quot;);
    }
}
</code></pre>
</li>
<li>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š<code>CommandLineRunner</code></p>
<pre><code class="language-java">@Order(1)
@Slf4j
@Component
public class BootCommandLineRunner implements CommandLineRunner {
    @Override
    public void run(String... args) throws Exception {
        log.info(&quot;This is BootCommandLineRunner...&quot;);
    }
}
</code></pre>
</li>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹<code>ApplicationRunner</code>é«˜äº<code>CommandLIineRunner</code></p>
</li>
</ol>
<h3 id="8-jacksonçš„ä½¿ç”¨">8. Jacksonçš„ä½¿ç”¨</h3>
<ol>
<li>
<p>æ–°å»ºä¸€ä¸ªç®€å•VOç±»<code>Coder</code></p>
<pre><code class="language-java">// Coder.java
@Data
@NoArgsConstructor
@AllArgsConstructor
@Builder
@JsonIgnoreProperties({ &quot;address&quot; })
public class Coder {
    private String name;
    private int age;
    // @JsonIgnore -&gt; ä½¿ç”¨æ‰“åœ¨ç±»ä¸Šé¢çš„JsonIgnore
    private String address;
    @JsonProperty(&quot;rt&quot;)
    @JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)
    private Date registerTime;
}
</code></pre>
</li>
<li>
<p>å¯ä»¥åœ¨<code>config</code>ç›®å½•ä¸‹å®šä¹‰ä¸€ä¸ª<code>JacksonConfig</code>ç±»ï¼Œç”¨äºå¯¹æ—¶é—´å­—æ®µçš„åºåˆ—åŒ–ä¿®é¥°</p>
<pre><code class="language-java">@Configuration
public class JacksonConfig {
    @Bean
    public ObjectMapper getObjectMapper() {
        ObjectMapper mapper = new ObjectMapper();
        // ä¸åºåˆ—åŒ–åŒ…å«nullçš„å­—æ®µ
        mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
        // formatå¯¹è±¡
        mapper.setDateFormat(new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm:ss&quot;));
        return mapper;
    }
}
</code></pre>
</li>
<li>
<p>åœ¨controllerä¸­æ–°å»ºä¸€ä¸ªæ–¹æ³•ç”¨æ¥æµ‹è¯•Jackson</p>
<pre><code class="language-java">// Controller.java
/**
* 127.0.0.1:8000/zth/springboot/jackson
**/
@GetMapping(&quot;/jackson&quot;)
public Imoocer jackson() throws Exception {
  Imoocer imoocer = Imoocer.builder()
    .name(&quot;zth&quot;)
    .age(19)
    .address(&quot;shanghai&quot;)
    .registerTime(new Date())
    .build();
  // åºåˆ—åŒ–
  String jsonImoocer = mapper.writeValueAsString(imoocer);
  log.info(&quot;imoocer jackson: {}&quot;, jsonImoocer);
  return mapper.readValue(jsonImoocer, Imoocer.class);
}
// è¿”å›ç»“æœ
{
  &quot;name&quot;: &quot;qinyi&quot;,
  &quot;age&quot;: 23,
  &quot;rt&quot;: &quot;2020-05-12&quot;
}
</code></pre>
</li>
</ol>
<h3 id="9-acutatorç›‘æ§">9. Acutatorç›‘æ§</h3>
<h4 id="1-åŸºæœ¬ä½¿ç”¨">1. åŸºæœ¬ä½¿ç”¨</h4>
<ol>
<li>
<p>Actuatoræ˜¯ä»€ä¹ˆï¼Œèƒ½åšä»€ä¹ˆï¼Ÿ</p>
<ul>
<li>æ˜¯ä»€ä¹ˆï¼šæ˜¯SpringBootæä¾›çš„å¯¹åº”ç”¨ç³»ç»Ÿçš„è‡ªçœå’Œç›‘æ§çš„é›†æˆåŠŸèƒ½</li>
<li>èƒ½åšä»€ä¹ˆï¼šæŸ¥çœ‹åº”ç”¨ï¼ˆé…ç½®ï¼‰ä¿¡æ¯ã€ç¯å¢ƒä¿¡æ¯ä»¥åŠå¯¹åº”ç”¨è¿›è¡Œç›‘æ§</li>
</ul>
</li>
<li>
<p>Actuatorç›‘æ§åˆ†ç±»ï¼š</p>
<ul>
<li>åŸç”Ÿç«¯ç‚¹
<ul>
<li>åº”ç”¨é…ç½®ç±»ï¼ˆè¿è¡Œæ—¶ä¿¡æ¯ï¼‰</li>
<li>åº¦é‡æŒ‡æ ‡ç±»ï¼ˆè¿è¡ŒæœŸçš„ä¿¡æ¯ï¼‰</li>
<li>æ“ä½œæ§åˆ¶ç±»ï¼ˆshutdown é»˜è®¤ä¸å¼€å¯ï¼‰</li>
</ul>
</li>
<li>è‡ªå®šä¹‰ç«¯ç‚¹</li>
</ul>
</li>
<li>
<p>æ·»åŠ pom.xmlä¾èµ–</p>
<pre><code class="language-xml">&lt;dependency&gt;
	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
	&lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>åœ¨application.ymlä¸­é…ç½®ç«¯ç‚¹å¼€å¯çŠ¶å†µ</p>
<pre><code class="language-yaml">management:
  endpoint:
    shutdown:
      enabled: true # æœ€ç‰¹æ®Šçš„ç›‘æ§ç«¯ç‚¹ ä¸€èˆ¬ä¸å¼€å¯
  endpoints:
    web:
      exposure:
        include: &quot;*&quot; # æ‰“å¼€æ‰€æœ‰çš„ç›‘æ§ç‚¹ []å¯ä»¥é€‰æ‹©è¦æ‰“å¼€å“ªäº›
</code></pre>
</li>
<li>
<p>è¯·æ±‚<code>localhost:8000/zth/acuator/health</code>ç«¯å£</p>
<pre><code class="language-json">{
  &quot;status&quot;: &quot;UP&quot;
}
</code></pre>
</li>
<li>
<p>åœ¨application.ymlä¸­é…ç½®infoä¿¡æ¯</p>
<pre><code class="language-yaml">info:
  app:
    name: zth-springboot-study
    groupId: com.zth.springboot.study
    version: 1.0-SNAPSHOT
</code></pre>
<p>è¯·æ±‚<code>localhost:8000/zth/acuator/info</code>ç«¯å£ï¼Œæ­¤æ—¶è¿”å›ä¿¡æ¯å¦‚ä¸‹</p>
<pre><code class="language-json">{
  &quot;app&quot;: {
    &quot;name&quot;: &quot;zth-springboot-study&quot;,
    &quot;groupId&quot;: &quot;com.zth.springboot.study&quot;,
    &quot;version&quot;: &quot;1.0-SNAPSHOT&quot;
  }
}
</code></pre>
</li>
</ol>
<h4 id="2-å¸¸ç”¨é€‰é¡¹å’Œé…ç½®">2. å¸¸ç”¨é€‰é¡¹å’Œé…ç½®</h4>
<ol>
<li>
<p>åº”ç”¨é…ç½®ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>è‡ªå·±é…ç½®çš„infoä¿¡æ¯ï¼š/actuator/info</li>
<li>åº”ç”¨ä¸­beançš„ä¿¡æ¯ï¼š/actuator/beans</li>
<li>åº”ç”¨ä¸­URIè·¯å¾„ä¿¡æ¯ï¼š/actuator/mappings</li>
</ul>
</li>
<li>
<p>åº¦é‡æŒ‡æ ‡ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>æ£€æŸ¥åº”ç”¨çš„è¿è¡ŒçŠ¶æ€ï¼š/actuator/health</li>
<li>å½“å‰çº¿ç¨‹æ´»åŠ¨å¿«ç…§ï¼š/actuator/threaddump</li>
</ul>
</li>
<li>
<p>æ“ä½œæ§åˆ¶ç±»å¸¸ç”¨ç›‘æ§</p>
<ul>
<li>
<p>å…³é—­åº”ç”¨ï¼ˆPOSTï¼‰ï¼š/actuator/shutdown</p>
<pre><code class="language-shell">curl -x post &quot;http://loccalhost:8000/actuator/shutdown&quot;
</code></pre>
</li>
</ul>
</li>
</ol>
<h4 id="3-ç«¯ç‚¹ä½¿ç”¨">3. ç«¯ç‚¹ä½¿ç”¨</h4>
<ol>
<li>
<p>æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹endpointï¼Œæ–°å»ºDateTimeEndPointç±»</p>
<pre><code class="language-java">// DateTimeEndPoint.java
/**
 * &lt;h1&gt;è‡ªå®šä¹‰äº‹ä»¶ç«¯ç‚¹&lt;/h1&gt;
 */
@Endpoint(id = &quot;datetime&quot;)
public class DateTimeEndPoint {
    private String format = &quot;yyyy-MM-dd HH:mm:ss&quot;;
    // ç”¨æ¥æ˜¾ç¤ºç›‘æ§æŒ‡æ ‡
    // zth/actuator/datetime
    @ReadOperation
    public Map&lt;String, Object&gt; info() {
        Map&lt;String, Object&gt; info = new HashMap&lt;&gt;();
        info.put(&quot;name&quot;, &quot;zth&quot;);
        info.put(&quot;age&quot;, &quot;23&quot;);
        info.put(&quot;datetime&quot;, new SimpleDateFormat(format).format(new Date()));
        return info;
    }

    // åŠ¨æ€æ›´æ”¹ç›‘æ§æŒ‡æ ‡
    @WriteOperation
    public void setFormat(String format) {
        this.format = format;
    }
}
</code></pre>
</li>
<li>
<p>åœ¨endpointæ–‡ä»¶å¤¹ä¸‹æ–°å»ºè‡ªå®šä¹‰ç«¯ç‚¹é…ç½®ç±»DateTimeEndpointConfig</p>
<pre><code class="language-java">// DateTimeEndpointConfig.java
// è‡ªå®šä¹‰ç«¯ç‚¹é…ç½®ç±»
@Configuration
public class DateTimeEndpointConfig {
    @Bean
    @ConditionalOnMissingBean
    @ConditionalOnEnabledEndpoint
    public DateTimeEndPoint dateTimeEndPoint() {
        return new DateTimeEndPoint();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨postmanä¸­ä½¿ç”¨GETè¯·æ±‚<code>localhost:8000/zth/actuator/datetime</code></p>
<pre><code class="language-json">{
  &quot;datetime&quot;: &quot;2020-05-12 08:08:08&quot;,
  &quot;name&quot;: &quot;zth&quot;,
  &quot;age&quot;: &quot;23&quot;
}
</code></pre>
<p>å½“ä½¿ç”¨POSTè¯·æ±‚<code>localhost:8000/zth/actuator/datetime</code>æ—¶å¸¦å¦‚ä¸‹è¯·æ±‚ä½“æ—¶</p>
<pre><code class="language-json">{
  &quot;format&quot;: &quot;yyyy-MM-dd&quot;
}
</code></pre>
<p>æ— è¿”å›ç»“æœï¼Œå†æ¬¡ä½¿ç”¨GETè¯·æ±‚è®¿é—®<code>localhost:8000/zth/actuator/datetime</code>ï¼Œè¿”å›ç»“æœå¦‚ä¸‹</p>
<pre><code class="language-json">{
  &quot;datetime&quot;: &quot;2020-05-12&quot;,
  &quot;name&quot;: &quot;zth&quot;,
  &quot;age&quot;: &quot;23&quot;
}
</code></pre>
</li>
</ol>
<h3 id="10-è‡ªå®šä¹‰starter">10. è‡ªå®šä¹‰starter</h3>
<h4 id="1-è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡">1. è‡ªå®šä¹‰starteré¡¹ç›®å‡†å¤‡</h4>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ª<code>springboot</code>é¡¹ç›®ï¼Œ<code>groupId</code>æŒ‰ç…§<code>xxxx-spring-boot-starter</code>çš„æ ¼å¼å‘½å</p>
</li>
<li>
<p>æ·»åŠ pom.xmlæ–‡ä»¶ä¾èµ–</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;groupId&gt;com.zth.springboot&lt;/groupId&gt;
    &lt;artifactId&gt;split-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starters&lt;/artifactId&gt;
        &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;
    &lt;/parent&gt;
    &lt;properties&gt;
        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-configuration-processor&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
&lt;/project&gt;
</code></pre>
</li>
<li>
<p>æ–°å»ºserviceç›®å½•ï¼Œserviceæ–¹æ³•è¿˜æœ‰å¯¹åº”çš„å®ç°ç±»</p>
<pre><code class="language-java">// ISplitService.java
// å­—ç¬¦ä¸²åˆ†å‰²æœåŠ¡æ¥å£å®šä¹‰
public interface ISplitService {
    List&lt;String&gt; split(String value);
}
</code></pre>
<p>å¯¹åº”çš„å®ç°ç±»</p>
<pre><code class="language-java">// SplitServiceImpl.java
public class SplitServiceImpl implements ISplitService {
    @SuppressWarnings(&quot;all&quot;)
    @Override
    public List&lt;String&gt; split(String value) {
        // jdk1.8ä¸­çš„streamæµ
        return Stream.of(StringUtils.split(value, &quot;,&quot;))
                .collect(Collectors.toList());
    }
}
</code></pre>
</li>
<li>
<p>æ–°å»ºconfigureç›®å½•ï¼Œæ–°å»ºè‡ªåŠ¨é…ç½®ç±»</p>
<pre><code class="language-java">@Configuration
@ConditionalOnClass(value = { ISplitService.class, SplitServiceImpl.class})
public class SplitAutoConfigure {
    @Bean
    @ConditionalOnMissingBean
    ISplitService starterService() {
        return new SplitServiceImpl();
    }
}
</code></pre>
</li>
<li>
<p>åœ¨resourcesæ–‡ä»¶å¤¹ä¸‹ï¼Œæ–°å»ºMETA-INFæ–‡ä»¶å¤¹ï¼Œæ·»åŠ é…ç½®ç±»<code>spring.factories</code></p>
<pre><code class="language-shell"># ç±»ä¼¼key = valueçš„é”®å€¼å¯¹å½¢å¼
org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.imooc.springboot.configure.SplitAutoConfigure
</code></pre>
</li>
<li>
<p>åœ¨terminalä¸­ï¼Œè¾“å…¥å¦‚ä¸‹æŒ‡ä»¤å®ç°ç¼–è¯‘æ‰“åŒ…</p>
<pre><code class="language-shell">$ mvn clean install -Dmaven.test.skip=true
</code></pre>
</li>
</ol>
<h3 id="11-ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®">11. ä½¿ç”¨è„šæœ¬ç®¡ç†springbooté¡¹ç›®</h3>
<ol>
<li>
<p>åœ¨resourcesä¸‹æ–°å»ºstart.shæ–‡ä»¶</p>
<pre><code class="language-sh">#!/user/bin/env bash
nohup java -jar zth-spring-boot-study.jar &amp;
</code></pre>
</li>
<li>
<p>å…³é—­åº”ç”¨è„šæœ¬ stop.sh</p>
<pre><code class="language-sh">#!/user/bin/env bash
pid = `ps -ef | grep zth-spring-boot-study.jar | grep -v grep | awk '{print $2}'` 
if [[ -z &quot;${pid}&quot; ]]
then
	echo application is already stopped
else
	echo kill ${pid}
	kill -9 ${pid}
fi
</code></pre>
</li>
</ol>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://zu3zz.github.io/tag/rAV1Yp-Gr/" class="tag">
                    SpringCloud
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/VaOfOOWC5/" class="tag">
                    SpringBoot
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/tqQSAbU7V/" class="tag">
                    BackEnd
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://zu3zz.github.io/post/java-2/">
                  <h3 class="post-title">
                    Javaé¢è¯•æ€»ç»“(2) -- çº¿ç¨‹ç¯‡
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
