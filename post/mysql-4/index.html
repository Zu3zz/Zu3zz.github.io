<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>深入浅出MySQL(4) ---- 常见数据操作 | 风袖</title>
<meta name="description" content="烟蛾敛略不胜态，风袖低昂如有情">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zu3zz.github.io/favicon.ico?v=1589731493762">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zu3zz.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zu3zz.github.io">
        <img src="https://zu3zz.github.io/images/avatar.png?v=1589731493762" class="site-logo">
        <h1 class="site-title">风袖</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            首页
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            归档
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            标签
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            关于
          </a>
        
      
        
          <a href="/projects" class="site-nav">
            项目
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/Zu3zz" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      烟蛾敛略不胜态，风袖低昂如有情
    </div>
    <div class="site-footer">
      By 3zz. | <a class="rss" href="https://zu3zz.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">深入浅出MySQL(4) ---- 常见数据操作</h2>
            <div class="post-date">2019-11-01</div>
            
            <div class="post-content">
              <h1 id="深入浅出mysql4-常见数据操作">深入浅出MySQL(4)-----常见数据操作</h1>
<h2 id="1-添加记录">1. 添加记录</h2>
<ol>
<li>指定字段名称</li>
</ol>
<pre><code class="language-sql">INSERT [INTO] tbl_name [(col_name1,col_name2,...)] {VALUE|VALUES}(VALUES...);
</code></pre>
<ol start="2">
<li>不指定字段名称</li>
</ol>
<pre><code class="language-sql">INSERT tbl_name VALUE(value1,value2,...);
</code></pre>
<p>需要按照建表时的字段顺序给每一个字段赋值</p>
<ol start="3">
<li>列出指定字段</li>
</ol>
<pre><code class="language-sql">INSERT tbl_name(字段名称1,字段名称2,...) VALUES(值1,值2,...);
</code></pre>
<ol start="4">
<li>INSERT ... SET的形式</li>
</ol>
<pre><code class="language-sql">INSERT tbl_name SET 字段名称1=值1,字段名称2=值2,...;
</code></pre>
<ol start="5">
<li>INSERT ... SELECT</li>
</ol>
<pre><code class="language-sql">INSERT tbl_name[(字段名称...)] SELECT 字段名称1,字段名称2,... FROM tbl_name [WHERE 条件];
</code></pre>
<ol start="6">
<li>一次添加多条记录</li>
</ol>
<pre><code class="language-sql">INSERT tbl_name[(字段名称...)] VALUES(值1,值2,...),
(值1,值2,...),
(值1,值2,...)
</code></pre>
<h2 id="2-修改记录">2. 修改记录</h2>
<pre><code class="language-sql">UPDATE tbl_name SET 字段名称1=值1,字段名称2=值2 [WHERE 条件];
</code></pre>
<p>如果不加条件，整个表中的记录都会被更新</p>
<h2 id="3-删除记录">3. 删除记录</h2>
<ol>
<li>
<p>普通删除</p>
<pre><code class="language-sql">DELETE FROM tbl_name [WHERE 条件];
</code></pre>
</li>
<li>
<p>如果不添加条件，表中所有记录都会被删除</p>
</li>
<li>
<p>DELETE清空数据表的时候不会重置AUTO_INCREMENT的值，但是可以通过ALTER语句将其置为1</p>
<pre><code class="language-sql">ALTER TABLE tbl_name AUTO_INCREMENT = 值x;
</code></pre>
</li>
<li>
<p>彻底清空数据表</p>
<pre><code class="language-sql">TRUNCATE [TABLE] tbl_name;
</code></pre>
<ul>
<li>清空表中所有记录</li>
<li>会重置AUTO_INCREMENT的值</li>
</ul>
</li>
</ol>
<h2 id="4查询记录">4.查询记录</h2>
<pre><code class="language-sql">SELECT select_expr,... FROM tbl_name
[WHERE 条件]
[GROUP BY {col_name|position} HAVING 二次筛选]
[ORDER BY {col_name|position|expr} [ASC|DESC]]
[LIMIT 限制结果集的显示条数]
</code></pre>
<ol>
<li>
<p>查询表中所有记录</p>
<pre><code class="language-sql">SELECT * FROM tbl_name;
</code></pre>
<p>*<strong>表示所有字段</strong></p>
</li>
<li>
<p>指定字段的信息</p>
<pre><code class="language-sql">SELECT 字段名称1,字段名称2,... FROM tbl_name;
</code></pre>
</li>
<li>
<p>使用库名.表名的形式，不用打开此数据库</p>
<pre><code class="language-sql">SELECT 字段名称1,字段名称2,... FROM db_name.tbl_name;
</code></pre>
</li>
<li>
<p>给字段起别名，建议写上 AS</p>
<pre><code class="language-sql">SELECT 字段名称 [AS] 别名名称,... FROM db_name.tbl_name;
</code></pre>
</li>
<li>
<p>给数据表起别名</p>
<pre><code class="language-sql">SELECT 字段名称1,字段名称2,... FROM tbl_name [AS] 别名;
</code></pre>
</li>
<li>
<p>表名.字段名的形式</p>
<pre><code class="language-sql">SELECT tbl_name.col_name,... FROM tbl_name;
</code></pre>
</li>
<li>
<p>WHERE 条件</p>
<p>会筛选出所有符合条件的记录</p>
<ul>
<li>
<p>比较运算符：</p>
<pre><code class="language-txt">&gt; &gt;= &lt;= != &lt;&gt; &lt;=&gt;
注意 &lt;=&gt; 和 = 的区别
&lt;=&gt; 可以检测出NULL值
</code></pre>
</li>
<li>
<p>IS [NOT] NULL：检测值是否为NULL 或者 NOT NULL</p>
</li>
<li>
<p>指定范围</p>
<pre><code class="language-sql">[NOT] BETWEEN ... AND
</code></pre>
</li>
<li>
<p>指定集合</p>
<pre><code class="language-sql">[NOT] IN (值1,值2,...)
</code></pre>
</li>
<li>
<p>逻辑运算符</p>
<pre><code class="language-shell">AND 逻辑与
OR  逻辑或
</code></pre>
</li>
<li>
<p>匹配字符</p>
<pre><code class="language-sql">[NOT] LIKE
% 任意长度的字符串
_ 任意一个字符
</code></pre>
<pre><code class="language-sql">SELECT id,username,age FROM user1
WHERE username like '%in%';
id|username|age
1 |king    |23
</code></pre>
<p>查询出叫张xx的人，使用'_'</p>
<pre><code class="language-sql">SELECT id,username,age FROM user1
WHERE username like '张__';
id|username|age
1 |张三丰   |23
</code></pre>
</li>
</ul>
</li>
<li>
<p>GROUP BY 分组</p>
<ol>
<li>
<p>把值相同放到一个组中，最终查询出的结果只会显示组中一条记录</p>
</li>
<li>
<p>分组配合GROUP_CONCAT()查看组中某个字段的详细信息</p>
<pre><code class="language-sql">SELECT GROUP_CONCAT(username),age,sex FROM user1 GROUP BY sex;
GROUP_CONCAAT(username)|age|sex
吴亦凡,张三,张四,王五,赵六 |23 |男
章子怡,刘嘉玲,奶茶妹      |18 |女
</code></pre>
</li>
<li>
<p>配合聚合函数使用</p>
<table>
<thead>
<tr>
<th>聚合函数名</th>
<th>统计记录总数</th>
</tr>
</thead>
<tbody>
<tr>
<td>COUNT()</td>
<td>统计记录总数</td>
</tr>
<tr>
<td>COUNT(字段名称)</td>
<td>字段中为NULL的值，不会被统计进来</td>
</tr>
<tr>
<td>COUNT（*）</td>
<td>会同时统计NULL值</td>
</tr>
<tr>
<td>SUM（）</td>
<td>求和</td>
</tr>
<tr>
<td>MAX（）</td>
<td>求最大值</td>
</tr>
<tr>
<td>MIN（）</td>
<td>求最小值</td>
</tr>
<tr>
<td>AVG（）</td>
<td>求平均值</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>配合WITH ROLLUP 关键词使用：会在记录末尾添加一条记录，是上面所有记录的总和</p>
</li>
<li>
<p>HAVING字句对分组结果进行二次筛选（WHERE是一次筛选）</p>
</li>
</ol>
</li>
<li>
<p>ORDER BY 排序：ORDER BY 字段名称 ASC|DESC / ORDER BY rand() 随机排序</p>
<pre><code class="language-sql">按照多个字段排序
SELECT id,username,age
FROM user1
ORDER BY age ASC, id ASC;
</code></pre>
</li>
<li>
<p>LIMIT 限制结果集合显示条数</p>
<ol>
<li>LIMIT值：显示结果集的前几条记录</li>
<li>LIMIT offset,row_count：从offset开始，显示几条记录，offset从0开始。</li>
</ol>
</li>
</ol>
<h2 id="5-多表查询">5. 多表查询</h2>
<ol>
<li>
<p>笛卡尔积的形式</p>
<p>表1：4条 / 表2：6条 / total：24条</p>
</li>
<li>
<p>内连接的形式：用的比较多</p>
<ul>
<li>
<p>相当于两个集合取交集，只取都符合条件的</p>
</li>
<li>
<p>查询两个表中符合连接条件的记录</p>
<pre><code class="language-sql">SELECT 字段名称1,... FROM tbl_name1
INNER JOIN tbl_name2
ON 条件
</code></pre>
</li>
</ul>
</li>
<li>
<p>外连接</p>
<ul>
<li>
<p>左外连接：以左表为主</p>
<pre><code class="language-sql">SELECT 字段名称1,... FROM tbl_name1
LEFT [OUTER] JOIN tbl_name2
ON 条件;
</code></pre>
<p><strong>先显示左表中的全部记录，再去右表中查询符合条件的记录，不符合的以NULL代替</strong></p>
</li>
<li>
<p>右外连接：以右表为主</p>
<pre><code class="language-sql">SELECT 字段名称1,... FROM tbl_name1
RIGHT [OUTER] JOIN tbl_name2
ON 条件;
</code></pre>
<p><strong>先显示右表中的全部记录，再去左表中查询复合条件的记录，不符合的以NULL代替</strong></p>
</li>
<li>
<p>全外连接：full outer join 全部都取出来</p>
</li>
</ul>
</li>
</ol>
<h2 id="6-外键约束">6. 外键约束</h2>
<p><strong>只有InnoDB存储引擎支持外键</strong></p>
<ol>
<li>创建外键</li>
</ol>
<ul>
<li>
<p>建表时候指定外键</p>
<pre><code class="language-sql">[CONSTRAINT 外键名称]FOREIGN KEY(字段名称) REFERENCES 主表(字段名称)
</code></pre>
<ul>
<li>子表的外键字段和主表的外键字段类型要相似;
<ul>
<li>如果是数值型要求一致,并且无符号也要一致</li>
<li>如果是字符型，要求类型一致，长度可以不同</li>
</ul>
</li>
<li>如果外键字段没有创建索引，MySQL会自动帮我们添加索引</li>
<li>子表的外键关联的必须是父表的主键</li>
<li>外键约束的参照操作
<ol>
<li><code>CASCADE</code>：从附表删除或更新，子表也跟着删除或者更新，级联的操作</li>
<li><code>SET NULL</code>：从附表删除或者更新记录，并且设置子表的外键列为NULL</li>
<li><code>NO ACTION | RESTRICT</code>：拒绝对父表做更新或者删除操作</li>
</ol>
</li>
</ul>
</li>
<li>
<p>动态添加外键</p>
<ul>
<li>
<p>动态添加外键</p>
<pre><code class="language-sql">ALTER TABLE tbl_name
ADD [CONSTRAINT 外键名称] FOREIGN KEY(外键字段) REFERENCES 主表(主键字段);
</code></pre>
<ul>
<li>动态添加外键之前表中的记录一定都是合法的记录，没有脏值，否则外键添加不成功</li>
</ul>
</li>
<li>
<p>动态删除外键</p>
<pre><code class="language-sql">ALTER TABLE tbl_name
DROP FOREIGN KEY fk_name;
</code></pre>
</li>
</ul>
</li>
</ul>
<h2 id="7-特殊形式的查询">7. 特殊形式的查询</h2>
<ol>
<li>
<p>子查询</p>
<ul>
<li>
<p>通过<code>SELECT</code>字段</p>
<pre><code class="language-sql">SELECT 字段名称 FROM tbl_name WHERE col_name = (SELECT col_name FROM tbl_name);
</code></pre>
</li>
<li>
<p>内层语句查询的结果可以作为外层语句查询的条件</p>
</li>
<li>
<p>由<code>IN</code>引发的子查询</p>
<pre><code class="language-sql">SELECT * FROM emp
WHERE depId IN (SELECT id FROM dep);
</code></pre>
</li>
<li>
<p>由比较运算符引出子查询</p>
<pre><code class="language-sql">-- 查询出成绩最优
SELECT id,username,score FROM stu
WHERE score &gt;= (SELECT score FROM level where id = 1);
</code></pre>
</li>
<li>
<p>由<code>EXIST</code>引发的子查询:返回<code>bool</code>类型的结果,子查询为<code>true</code>才执行前面的语句</p>
<pre><code class="language-sql">SELECT depName from del
WHERE EXISTS (SELECT depName FROM dep WHERE id=10);
</code></pre>
</li>
<li>
<p>三个关键字<code>ANY</code> <code>SOME</code> <code>ALL</code></p>
<table>
<thead>
<tr>
<th>运算符\关键字</th>
<th>ANY</th>
<th>SOME</th>
<th>ALL</th>
</tr>
</thead>
<tbody>
<tr>
<td>&gt;、&gt;=</td>
<td>最小值</td>
<td>最小值</td>
<td>最大值</td>
</tr>
<tr>
<td>&lt;、&lt;=</td>
<td>最大值</td>
<td>最大值</td>
<td>最小值</td>
</tr>
<tr>
<td>=</td>
<td>任意值</td>
<td>任意值</td>
<td></td>
</tr>
<tr>
<td>&lt;&gt;、!=</td>
<td></td>
<td></td>
<td>任意值</td>
</tr>
</tbody>
</table>
<pre><code class="language-sql">SELECT * FROM stu
WHERE score &gt;= ANY(SELECT score FROM level);
or
WHERE score &gt;= SOME(SELECT score FROM level);
or
WHERE score &gt;= ALL(SELECT score FROM level);
</code></pre>
</li>
<li>
<p><code>INSERT ... SELECT</code> 的形式</p>
<pre><code class="language-sql">INSERT user2 SELECT id,username FROM user1;
</code></pre>
</li>
<li>
<p><code>CREATE ... SELECT</code> 的形式</p>
<pre><code class="language-sql">CREATE TABLE user1(
	id int UNSIGNED AUTO_INCREMENT KEY,
  username VARCHAR(20)
)SELECT id,username FROM emp;
</code></pre>
</li>
<li>
<p><code>CREATE TABLE tbl_name LIKE tbl_name</code> 的形式创建一个表(新表中没有数据)</p>
</li>
</ul>
</li>
<li>
<p>联合查询</p>
<ul>
<li>
<p><code>UNION</code></p>
<pre><code class="language-sql">SELECT 字段名称1,字段名称2... FROM tbl_name1
UNION
SELECT 字段名称3,字段名称4... FROM tbl_name2;
</code></pre>
</li>
<li>
<p><code>UNION ALL</code></p>
<pre><code class="language-sql">SELECT 字段名称1,字段名称2... FROM tbl_name1 
UNION ALL
SELECT 字段名称3,字段名称4... FROM tbl_name2;
</code></pre>
</li>
<li>
<p><code>UNION ALL</code> 是简单的合并，<code>UNION</code> 会去掉表中重复记录</p>
</li>
</ul>
</li>
<li>
<p>自身连接查询</p>
<ul>
<li><strong>无限级分类的实现形式</strong></li>
</ul>
</li>
</ol>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://zu3zz.github.io/tag/tqQSAbU7V/" class="tag">
                    BackEnd
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/7acBApeyq/" class="tag">
                    MySQL
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">下一篇</div>
                <a href="https://zu3zz.github.io/post/mysql-3/">
                  <h3 class="post-title">
                    深入浅出MySQL(3) ---- 存储引擎
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
