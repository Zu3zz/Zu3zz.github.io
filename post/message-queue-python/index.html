<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Pythonä¸å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ | é£è¢–</title>
<meta name="description" content="çƒŸè›¾æ•›ç•¥ä¸èƒœæ€ï¼Œé£è¢–ä½æ˜‚å¦‚æœ‰æƒ…">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://zu3zz.github.io/favicon.ico?v=1589731257565">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://zu3zz.github.io/styles/main.css">



<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://zu3zz.github.io">
        <img src="https://zu3zz.github.io/images/avatar.png?v=1589731257565" class="site-logo">
        <h1 class="site-title">é£è¢–</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
        
          <a href="/projects" class="site-nav">
            é¡¹ç›®
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/Zu3zz" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      çƒŸè›¾æ•›ç•¥ä¸èƒœæ€ï¼Œé£è¢–ä½æ˜‚å¦‚æœ‰æƒ…
    </div>
    <div class="site-footer">
      By 3zz. | <a class="rss" href="https://zu3zz.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Pythonä¸å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶</h2>
            <div class="post-date">2019-10-18</div>
            
              <div class="feature-container" style="background-image: url('https://zu3zz.github.io/post-images/message-queue-python.png')">
              </div>
            
            <div class="post-content">
              <p>ğŸŒˆæœ€è¿‘åœ¨å­¦ä¹ æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œç”±äºå¤§æ•°æ®ç«¯å¤©ç”Ÿé è¿‘æ•°æ®ï¼Œæ‰€ä»¥åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦å¯¹æ—¥å¿—ç­‰æ–‡ä»¶è¿›è¡Œåˆ†æ<br>
ğŸŠé‚£ä¹ˆè¿™ä¸€ç³»åˆ—ï¼Œæˆ‘ä»¬ä½¿ç”¨Pythonè¯­è¨€å¯¹å¸¸ç”¨çš„æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¸€æ¬¡æ•´åˆ<br>
ğŸ‰çœ‹çœ‹å¦‚ä½•å°†nginxã€kafkaã€zookeeperã€redisã€logstashä¸€èµ·ï¼Œä½¿ç”¨pythonè¯­è¨€æ­å»ºä¸€ä¸ªæ—¥å¿—æŠ¥è­¦ç³»ç»Ÿå§</p>
<!-- more -->
<h2 id="1-å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¯”è¾ƒ">1. å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶æ¯”è¾ƒ</h2>
<h3 id="11-å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»">1.1 å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ä»‹ç»</h3>
<ul>
<li>Redis</li>
<li>RabbitMQ</li>
<li>RocketMQ</li>
<li>ZeroMQ</li>
<li>Kafka</li>
</ul>
<h3 id="12-å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å¯¹æ¯”">1.2 å¸¸ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å¯¹æ¯”</h3>
<ul>
<li>å®ç°è¯­è¨€</li>
<li>å¯¹å¤–æ¥å£</li>
<li>æŒä¹…åŒ–ç­–ç•¥</li>
<li>æ¶ˆæ¯å¤„ç†æ¨¡å¼</li>
<li>æ—¶åºä¿è¯</li>
</ul>
<table>
<thead>
<tr>
<th>æ¶ˆæ¯ä¸­é—´ä»¶</th>
<th>å®ç°è¯­è¨€</th>
<th>æŒä¹…åŒ–</th>
<th>æ¶ˆæ¯å¤„ç†æ¨¡å¼</th>
<th>æ—¶åºä¿è¯</th>
</tr>
</thead>
<tbody>
<tr>
<td>Redis</td>
<td>C</td>
<td>æ”¯æŒç£ç›˜</td>
<td>Push-Pull Pub-Sub</td>
<td>æœ‰åº</td>
</tr>
<tr>
<td>RabbitMQ</td>
<td>Erlang</td>
<td>ç£ç›˜</td>
<td>Push</td>
<td>å•æ¶ˆè´¹è€…æœ‰åº</td>
</tr>
<tr>
<td>RocketMQ</td>
<td>Java</td>
<td>ç£ç›˜</td>
<td>Puch-Pull</td>
<td>åŒé˜Ÿåˆ—æœ‰åº</td>
</tr>
<tr>
<td>Kafka</td>
<td>Scala</td>
<td>ç£ç›˜</td>
<td>Pull</td>
<td>å•Parititionæœ‰åº</td>
</tr>
</tbody>
</table>
<h2 id="2-æ¶ˆæ¯ä¸­é—´ä»¶å¸¸è§æ¦‚å¿µ">2. æ¶ˆæ¯ä¸­é—´ä»¶å¸¸è§æ¦‚å¿µ</h2>
<h3 id="21-æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„å„ç§æ¦‚å¿µå’Œè§’è‰²">2.1 æ¶ˆæ¯ä¸­é—´ä»¶ä¸­çš„å„ç§æ¦‚å¿µå’Œè§’è‰²</h3>
<ul>
<li>Producer/borker/cunsumer</li>
<li>Queue/channel/topic</li>
<li>Partition</li>
<li>Publish/subscribe</li>
<li>Acknowledge</li>
</ul>
<h3 id="22-ç”Ÿäº§è€…">2.2 ç”Ÿäº§è€…</h3>
<figure data-type="image" tabindex="1"><img src="https://zu3zz.github.io/post-images/1571396146907.png" alt="producer" loading="lazy"></figure>
<h3 id="23-partition">2.3 Partition</h3>
<ul>
<li>ä¸€ä¸ªtopicå¯ä»¥åˆ†ä¸ºå¤šä¸ªpartition</li>
</ul>
<figure data-type="image" tabindex="2"><img src="https://zu3zz.github.io/post-images/1571396164758.png" alt="" loading="lazy"></figure>
<h3 id="24-è®¢é˜…">2.4 è®¢é˜…</h3>
<figure data-type="image" tabindex="3"><img src="https://zu3zz.github.io/post-images/1571396178821.png" alt="" loading="lazy"></figure>
<h3 id="25-æ¶ˆæ¯ç¡®è®¤æœºåˆ¶">2.5 æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</h3>
<ul>
<li>åªæœ‰ç»è¿‡ç”¨æˆ·ç¡®è®¤çš„æ¶ˆæ¯æ‰ä¼šä»queueä¸­å»é™¤</li>
</ul>
<figure data-type="image" tabindex="4"><img src="https://zu3zz.github.io/post-images/1571396204405.png" alt="" loading="lazy"></figure>
<h2 id="3-redis">3. Redis</h2>
<h3 id="31-redisç®€ä»‹">3.1 Redisç®€ä»‹</h3>
<p><strong>Rediså…³é”®è¯</strong></p>
<ul>
<li>Key-value</li>
<li>é«˜æ€§èƒ½</li>
<li>ç¼“å­˜</li>
<li>Cå¼€å‘</li>
<li>äº”å¤§æ•°æ®ç»“æ„</li>
<li>luaæ‰©å±•</li>
</ul>
<h3 id="32-rediså¸¸è§åº”ç”¨åœºæ™¯">3.2 Rediså¸¸è§åº”ç”¨åœºæ™¯</h3>
<ol>
<li>
<p>String</p>
<ul>
<li>ç¼“å­˜äºŒè¿›åˆ¶å¯¹è±¡ï¼Œæ¯”å¦‚å›¾ç‰‡ã€åºåˆ—åŒ–å¯¹è±¡ç­‰</li>
<li>è®¡æ•°å™¨ï¼Œæ¯”å¦‚æ–‡ç« è®¿é—®é‡ç»Ÿè®¡</li>
<li>ä½è¿ç®—ï¼ŒèŠ‚çº¦å†…å­˜</li>
</ul>
</li>
<li>
<p>List</p>
<ul>
<li>è·å–æœ€æ–°çš„Næ¡æ•°æ®</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>å®æ—¶åˆ†æç³»ç»Ÿï¼Œæ¯”å¦‚æœåŠ¡å™¨ç›‘æ§ç¨‹åº</li>
</ul>
</li>
<li>
<p>Hash</p>
<ul>
<li>
<p>ç±»ä¼¼Pythonä¸­çš„Dict</p>
</li>
<li>
<p>å­˜å‚¨å…·æœ‰å¤šä¸ªå±æ€§çš„å¯¹è±¡</p>
</li>
<li>
<p>æ¯”å¦‚ç”¨æˆ·çš„å¹´é¾„ã€å§“åã€æ€§åˆ«ã€ç§¯åˆ†</p>
</li>
</ul>
</li>
<li>
<p>Set</p>
<ul>
<li>é›†åˆæ“ä½œï¼Œæ¯”å¦‚é€šè¿‡äº¤é›†å®ç°å…±åŒå…³æ³¨ï¼Œå…±åŒå¥½å‹</li>
<li>å­˜å‚¨æ— åºä¸é‡å¤æ•°æ®ï¼Œæ¯”å¦‚å­˜å‚¨æ–‡ç« æ ‡ç­¾</li>
</ul>
</li>
<li>
<p>Sorted Set</p>
<ul>
<li>TopNæ’åºï¼Œæ¯”å¦‚æ’è¡Œæ¦œ</li>
<li>èŒƒå›´æŸ¥æ‰¾ï¼Œæ¯”å¦‚åˆ¤æ–­ipåœ°å€æ‰€åœ¨åœ°</li>
<li>ä¼˜å…ˆçº§é˜Ÿåˆ—</li>
<li>è¿‡æœŸé¡¹ç›®å¤„ç†</li>
</ul>
</li>
<li>
<p>Pub Sub</p>
<ul>
<li>å®æ—¶æ¶ˆæ¯ç³»ç»Ÿ</li>
<li>æ¯”å¦‚å³æ—¶èŠå¤©ï¼Œç¾¤èŠ</li>
</ul>
</li>
</ol>
<h3 id="33-rediså®‰è£…ä¸é»˜è®¤é…ç½®">3.3 Rediså®‰è£…ä¸é»˜è®¤é…ç½®</h3>
<h4 id="331redisæœåŠ¡å™¨é»˜è®¤é…ç½®">3.3.1RedisæœåŠ¡å™¨é»˜è®¤é…ç½®</h4>
<ul>
<li>ç«¯å£å·ï¼šport=6379</li>
<li>IPåœ°å€ bind=0.0.0.0</li>
<li>æ•°æ®åº“å­˜æ”¾ä½ç½® dir=./</li>
<li>æ•°æ®åº“åå­— dbfilename=dump.rdb</li>
<li>å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ daemonize=no</li>
</ul>
<h4 id="332-redisæœåŠ¡å™¨é…ç½®æ–‡ä»¶">3.3.2 RedisæœåŠ¡å™¨é…ç½®æ–‡ä»¶</h4>
<ul>
<li>
<p>RedisæœåŠ¡å™¨å¯ç”¨é…ç½®æ–‡ä»¶ï¼šè¿è¡Œ</p>
<pre><code class="language-shell">redis-server name.conf
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹redisæœåŠ¡å™¨æ‰€æœ‰é€‰é¡¹é…ç½®ï¼šè¿è¡Œ</p>
<pre><code class="language-shell">redis-cli config get '*'
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹redisæœåŠ¡å™¨æŸä¸ªé…ç½®é€‰é¡¹ï¼šè¿è¡Œ</p>
<pre><code class="language-shell">redis-cli config get xxx(e.g: bind)
</code></pre>
</li>
</ul>
<h4 id="333-å¸¸è§å‚æ•°">3.3.3 å¸¸è§å‚æ•°</h4>
<ol>
<li>--daemonize
<ul>
<li>å«ä¹‰ï¼šæ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„å½¢å¼å¯åŠ¨(åå°å¯åŠ¨)</li>
<li>ç”¨æ³•ï¼šdaemonize yes|no</li>
<li>é»˜è®¤å€¼ï¼šno</li>
<li>å®ä¾‹ï¼šdaemonize yes</li>
</ul>
</li>
<li>--bind
<ul>
<li>å«ä¹‰ï¼šredisç›‘å¬çš„ipåœ°å€</li>
<li>ç”¨æ³•ï¼šbind ipåœ°å€</li>
<li>é»˜è®¤å€¼ï¼š127.0.0.1</li>
<li>å®ä¾‹ï¼šbind 0.0.0.0(ç›‘å¬æ‰€æœ‰)</li>
</ul>
</li>
<li>--port(ä¸€èˆ¬ä¸æ”¹)
<ul>
<li>å«ä¹‰ï¼šredisç›‘å¬çš„ç«¯å£å·</li>
<li>ç”¨æ³•ï¼šport ç«¯å£å·</li>
<li>é»˜è®¤å€¼ï¼š6379</li>
<li>å®ä¾‹ï¼šport 6380</li>
</ul>
</li>
<li>--dir
<ul>
<li>å«ä¹‰ï¼šredisæŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ç›®å½•</li>
<li>ç”¨æ³•ï¼šdir æ–‡ä»¶è·¯å¾„</li>
<li>é»˜è®¤å€¼ï¼š./</li>
<li>å®ä¾‹ï¼šdir /mnt/redis/data/</li>
</ul>
</li>
<li>--dbfilename
<ul>
<li>å«ä¹‰ï¼šredisæŒä¹…åŒ–æ–‡ä»¶æ–‡ä»¶å</li>
<li>ç”¨æ³•ï¼šdbfilename æ–‡ä»¶å</li>
<li>é»˜è®¤å€¼ï¼šdump.rdb</li>
<li>å®ä¾‹ï¼šdbfilename xxxx.rdb(e.g. user.rdb)</li>
</ul>
</li>
<li>--unixsocket(æ•ˆç‡é«˜äºsocketå¥—æ¥å­—)
<ul>
<li>å«ä¹‰ï¼šredisç›‘å¬çš„unixå¥—æ¥å­—åœ°å€</li>
<li>ç”¨æ³•ï¼šunixsocketæ–‡ä»¶åœ°å€</li>
<li>é»˜è®¤å€¼ï¼šç©º</li>
<li>å®ä¾‹ï¼šunixsocket /tmp/redis.sock</li>
</ul>
</li>
</ol>
<h3 id="34-rediså¸¸è§æ“ä½œå’Œå‘½ä»¤">3.4 Rediså¸¸è§æ“ä½œå’Œå‘½ä»¤</h3>
<p><strong>é¦–å…ˆä½¿ç”¨redis-serverå¯åŠ¨redisæœåŠ¡ï¼Œç„¶åä½¿ç”¨redis-cliè¿›å…¥å‘½ä»¤è¡Œç•Œé¢</strong></p>
<h4 id="341-rediså¸¸ç”¨å‘½ä»¤è®²è§£">3.4.1 Rediså¸¸ç”¨å‘½ä»¤è®²è§£</h4>
<ul>
<li>æµ‹è¯•å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨è¿æ¥æ˜¯å¦æ­£å¸¸ï¼šPING</li>
<li>è·å¾—ç¬¦åˆè§„åˆ™çš„é”®ååˆ—è¡¨ï¼šKEYS pattern</li>
<li>åˆ¤æ–­ä¸€ä¸ªé”®æ˜¯å¦å­˜åœ¨ï¼šEXISTS key</li>
<li>åˆ é™¤ä¸€ä¸ªé”®ï¼šDEL key</li>
<li>è·å–é”®çš„ç±»å‹ï¼šTYPE key</li>
<li>æ¸…ç©ºå½“å‰æ•°æ®åº“æ‰€æœ‰æ•°æ®ï¼šFLUSHDB</li>
<li>è®¾ç½®ä¸€ä¸ªé”®çš„ç”Ÿè‚²ç”Ÿå­˜æ—¶é—´ï¼šEXPIRE key seconds</li>
<li>è¿”å›ä¸€ä¸ªé”®çš„ç”Ÿè‚²ç”Ÿå­˜æ—¶é—´ï¼šTTL key</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; ping
PONG
127.0.0.1:6379&gt; keys *
 1) &quot;1558695101775_0.7258740928094547&quot;
 2) &quot;1558693978601_0.21519364815403463&quot;
 3) &quot;1558695158141_0.8666190807031027&quot;
127.0.0.1:6379&gt; flushdb
OK
127.0.0.1:6379&gt; keys *
(empty list or set)
127.0.0.1:6379&gt; set foo bar
OK
127.0.0.1:6379&gt; keys foo
1) &quot;foo&quot;
127.0.0.1:6379&gt; type foo
string
127.0.0.1:6379&gt; exists foo
(integer) 1
127.0.0.1:6379&gt; del foo
(integer) 1
127.0.0.1:6379&gt; keys *
(empty list or set)
127.0.0.1:6379&gt; set foo bar
OK
127.0.0.1:6379&gt; expire foo 60
(integer) 1
127.0.0.1:6379&gt; ttl foo
(integer) 58
127.0.0.1:6379&gt; ttl foo
(integer) -2
</code></pre>
<h4 id="342-rediså¸¸ç”¨å‘½ä»¤ä¹‹string">3.4.2 Rediså¸¸ç”¨å‘½ä»¤ä¹‹String</h4>
<ul>
<li>SET</li>
<li>GET</li>
<li>INCR(é€’å¢ä¸€ä¸ªå€¼ä¸ºæ•´æ•°çš„string)</li>
<li>MSET(æ‰¹é‡è®¾ç½®)</li>
<li>MGET(æ‰¹é‡è·å–)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; set foo barstring
OK
127.0.0.1:6379&gt; get foo
&quot;barstring&quot;
127.0.0.1:6379&gt; get ffo
(nil)
127.0.0.1:6379&gt; mset foo1 bar1 foo2 bar2 foo3 bar3
OK
127.0.0.1:6379&gt; mget foo1 foo2 foo3
1) &quot;bar1&quot;
2) &quot;bar2&quot;
3) &quot;bar3&quot;
127.0.0.1:6379&gt; set num 1
OK
127.0.0.1:6379&gt; incr num
(integer) 2
127.0.0.1:6379&gt; get num
&quot;2&quot;
</code></pre>
<h4 id="343-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹hash">3.4.3 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹Hash</h4>
<ul>
<li>HSET</li>
<li>HGET</li>
<li>HMSET</li>
<li>HMGET</li>
<li>HGETALL</li>
<li>HDEL</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; hset user name 3zz
(integer) 1
127.0.0.1:6379&gt; hset user sex man
(integer) 1
127.0.0.1:6379&gt; hget user name
&quot;3zz&quot;
127.0.0.1:6379&gt; hgetall user
1) &quot;name&quot;
2) &quot;3zz&quot;
3) &quot;sex&quot;
4) &quot;man&quot;
127.0.0.1:6379&gt; hdel user name
(integer) 1
127.0.0.1:6379&gt; hgetall user
1) &quot;sex&quot;
2) &quot;man&quot;
127.0.0.1:6379&gt; del user
(integer) 1
127.0.0.1:6379&gt; exists user
(integer) 0
</code></pre>
<h4 id="344-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹list">3.4.4 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹List</h4>
<ul>
<li>LPUSH(ä»å·¦ä¾§æ”¾å…¥)</li>
<li>RPUSH(ä»å³ä¾§æ”¾å…¥)</li>
<li>LPOP(ä»å·¦ä¾§æ‹¿å‡º)</li>
<li>RPOP(ä»å³ä¾§æ‹¿å‡º)</li>
<li>BRPOP(æœ‰æ•°æ®åˆ™è¿”å›ï¼Œæ²¡æœ‰å°±ä¸€ç›´ç­‰å¾…ç›´åˆ°æœ‰æ•°æ®)</li>
<li>LLEN(è¿”å›é•¿åº¦)</li>
<li>LRANGE(è¿”å›ä»ç´¢å¼•startåˆ°endä¸¤ç«¯çš„å…ƒç´ ï¼Œå·¦å³éƒ½é—­)</li>
<li>RPOPLPUSH(å…ˆå³æ‹¿å‡º å·¦æ”¾å…¥)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; lpush list0 a
(integer) 1
127.0.0.1:6379&gt; lpush list0 b c 
(integer) 4
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;
127.0.0.1:6379&gt; rpush list0 d e
(integer) 5
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;
4) &quot;d&quot;
5) &quot;e&quot;
127.0.0.1:6379&gt; llen list0
(integer) 5
127.0.0.1:6379&gt; rpoplpush list0 list1
&quot;e&quot;
127.0.0.1:6379&gt; lrange list1 0 -1
1) &quot;e&quot;
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;c&quot;
2) &quot;b&quot;
3) &quot;a&quot;
4) &quot;d&quot;
127.0.0.1:6379&gt; rpoplpush list0 list0 
&quot;d&quot;
127.0.0.1:6379&gt; lrange list0 0 -1
1) &quot;d&quot;
2) &quot;c&quot;
3) &quot;b&quot;
4) &quot;a&quot;
127.0.0.1:6379&gt; llen list0
(integer) 4
</code></pre>
<h4 id="345-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹set">3.4.5 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹Set</h4>
<ul>
<li>SADD</li>
<li>SREM</li>
<li>SMEMBERS</li>
<li>SISMEMBER</li>
<li>SDIFF(å·®é›†)</li>
<li>SINTER(å¹¶é›†)</li>
<li>SUNION(äº¤é›†)</li>
<li>SCARD(å…ƒç´ ä¸ªæ•°)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; sadd letters a b
(integer) 2
127.0.0.1:6379&gt; SMEMBERS letters
1) &quot;b&quot;
2) &quot;a&quot;
127.0.0.1:6379&gt; SISMEMBER letters a
(integer) 1
127.0.0.1:6379&gt; sadd setA 1 2 3
(integer) 3
127.0.0.1:6379&gt; sadd setB 2 3 4
(integer) 3
127.0.0.1:6379&gt; sdiff setA setB
1) &quot;1&quot;
127.0.0.1:6379&gt; SINTER seta setb
(empty list or set)
127.0.0.1:6379&gt; SINTER setA setB
1) &quot;2&quot;
2) &quot;3&quot;
127.0.0.1:6379&gt; SUNION setA setB
1) &quot;1&quot;
2) &quot;2&quot;
3) &quot;3&quot;
4) &quot;4&quot;
127.0.0.1:6379&gt; scard setA
(integer) 3
</code></pre>
<h4 id="346-rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹sorted-set">3.4.6 Rediså¸¸ç”¨å‘½ä»¤è®²è§£ä¹‹Sorted Set</h4>
<ul>
<li>ZADD(æ·»åŠ å…ƒç´ )</li>
<li>ZSCORE(è·å¾—æŸä¸ªå…ƒç´ )</li>
<li>ZRANGE(æŒ‰ç…§æ¬¡åºç»™å‡ºå­˜åœ¨çš„å…ƒç´ )</li>
<li>ZRANGEBYSCORE(ç»™å‡ºç»™å®šrangeé‡Œçš„æ‰€æœ‰å…ƒç´ ï¼Œå·¦å³éƒ½é—­)</li>
<li>ZINCRBY(å¢åŠ ä¸€ä¸ªå…ƒç´ åˆ†æ•°)</li>
</ul>
<pre><code class="language-shell">127.0.0.1:6379&gt; ZADD scoreboard 10 x 20 y 30 z 15 a
(integer) 4
127.0.0.1:6379&gt; zscore scoreboard y
&quot;20&quot;
127.0.0.1:6379&gt; zrange scoreboard 2 3
1) &quot;y&quot;
2) &quot;z&quot;
127.0.0.1:6379&gt; ZRANGEBYSCORE scoreboard 15 25
1) &quot;a&quot;
2) &quot;y&quot;
127.0.0.1:6379&gt; ZINCRBY scoreboard 30 x
&quot;40&quot;
</code></pre>
<h2 id="4-pythonä¸redis">4. Pythonä¸Redis</h2>
<h3 id="41-redis-pythonå®¢æˆ·ç«¯ä»‹ç»">4.1 Redis Pythonå®¢æˆ·ç«¯ä»‹ç»</h3>
<blockquote>
<p><strong>æ¨èä½¿ç”¨redis-py</strong></p>
</blockquote>
<ul>
<li>
<p>Getting Started</p>
<pre><code class="language-shell">&gt;&gt;&gt; import redis
&gt;&gt;&gt; r = redis.StrictRedis(host=&quot;localhost&quot;, port=6379,db=0)
&gt;&gt;&gt; r.set('foo','bar')
True
&gt;&gt;&gt; r.get('foo')
'bar'
</code></pre>
</li>
</ul>
<h3 id="42-æ¶ˆæ¯é˜Ÿåˆ—çš„æ’å…¥ä¸å–å‡º">4.2 æ¶ˆæ¯é˜Ÿåˆ—çš„æ’å…¥ä¸å–å‡º</h3>
<h4 id="421-åŸºäº-redis-py-ç”Ÿäº§è€…å¼€å‘">4.2.1 åŸºäº redis-py ç”Ÿäº§è€…å¼€å‘</h4>
<ul>
<li>
<p>æ¯2ç§’éšæœºç”Ÿæˆä¸€ä¸ªç”¨æˆ·åæ’å…¥åˆ°é˜Ÿåˆ—ä¸­</p>
</li>
<li>
<p>LPUSH</p>
<pre><code class="language-python"># producer1.py
import redis 
import names
import time

r = redis.StrictRedis(host='localhost', port=6379, db=0)

while True:
  time.sleep(2)
  name = names.get_full_name()
  x = r.lpush('names',name)
  print(x,name)
</code></pre>
</li>
</ul>
<h4 id="422-åŸºäº-redis-py-æ¶ˆè´¹è€…å¼€å‘">4.2.2 åŸºäº redis-py æ¶ˆè´¹è€…å¼€å‘</h4>
<ul>
<li>
<p>å°†é˜Ÿåˆ—ä¸­çš„ç”¨æˆ·åæŒ‰ç…§æ’å…¥é¡ºåºå–å‡ºå¹¶æ‰“å°åˆ°å±å¹•ä¸Š</p>
</li>
<li>
<p>BRPOP</p>
<pre><code class="language-python"># consumer1.py
import redis

r = redis.StrictRedis(host='localhost', port=6379, db=0)

def consume(key):
  while(True):
    value = r.brpop(key)
    yield value

for v in consume('names'):
  print(v)
</code></pre>
</li>
</ul>
<h3 id="43-åŸºäºé¢‘é“çš„å‘å¸ƒä¸è®¢é˜…">4.3 åŸºäºé¢‘é“çš„å‘å¸ƒä¸è®¢é˜…</h3>
<h4 id="431-åŸºäº-redis-py-ç”Ÿäº§è€…å¼€å‘">4.3.1 åŸºäº redis-py ç”Ÿäº§è€…å¼€å‘</h4>
<ul>
<li>
<p>æ¯2ç§’éšæœºç”Ÿæˆä¸€ä¸ªç”¨æˆ·åå‘å¸ƒåˆ°é¢‘é“ä¸­</p>
</li>
<li>
<p>PUBLISH</p>
<pre><code class="language-python"># producer2.py
import redis 
import names
import time

r = redis.StrictRedis(host='localhost', port=6379, db=0)

while True:
  time.sleep(2)
  name = names.get_full_name()
  x = r.publish('names',name)
  print(x,name)
</code></pre>
</li>
</ul>
<h4 id="432-åŸºäº-redis-py-æ¶ˆè´¹è€…å¼€å‘">4.3.2 åŸºäº redis-py æ¶ˆè´¹è€…å¼€å‘</h4>
<ul>
<li>
<p>è®¢é˜…å‘å¸ƒç”¨æˆ·åçš„é¢‘é“ï¼Œæœ‰æ–°çš„æ¶ˆæ¯æ—¶æ‰“å°åˆ°å±å¹•ä¸Š</p>
</li>
<li>
<p>SUBSCRIBE</p>
<pre><code class="language-python"># consumer2.py
import redis

r = redis.StrictRedis(host='localhost', port=6379, db=0)

ps = r.pubsub()
ps.subscribe('names')

for item in ps.listen():
  print(item)
</code></pre>
</li>
</ul>
<h2 id="5-kafka">5. Kafka</h2>
<h3 id="51-kafkaç®€ä»‹ä¸åº”ç”¨åœºæ™¯">5.1 Kafkaç®€ä»‹ä¸åº”ç”¨åœºæ™¯</h3>
<ol>
<li>
<p>Kafkaç®€ä»‹-å…³é”®è¯</p>
<ul>
<li>ç£ç›˜æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>é«˜æ€§èƒ½</li>
<li>åˆ†å¸ƒå¼</li>
<li>Zookeeper</li>
<li>å®æ—¶æµå¤„ç†</li>
<li>é‡å¤æ¶ˆè´¹</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--API</p>
<ul>
<li>ç”Ÿäº§è€…API</li>
<li>æ¶ˆè´¹è€…API</li>
<li>æµå¤„ç†å™¨API</li>
<li>è¿æ¥å™¨API</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--ç”Ÿäº§è€…</p>
<ul>
<li>å¼‚æ­¥é€šä¿¡ï¼Œæ‰€æœ‰ç½‘è·¯è¯·æ±‚å¼‚æ­¥å‘é€</li>
<li>æ‰¹é‡å‘é€ï¼Œé€šè¿‡è®¾ç½®batch sizeæˆ–è€…timeoutä¸€æ¬¡å‘é€å¤šä¸ªæ¶ˆæ¯</li>
<li>çº¿ç¨‹å®‰å…¨ï¼Œå¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯ä»¥å…±äº«å•ä¸ªç”Ÿäº§è€…å®ä¾‹</li>
<li>è´Ÿè½½å‡è¡¡ï¼Œé‡‡ç”¨å†…éƒ¨é»˜è®¤æœºåˆ¶æˆ–è€…è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥</li>
<li>è¿”å›ç»“æœï¼Œè¿”å›æ¶ˆæ¯çš„topicï¼Œoffsetç­‰å…ƒæ•°æ®</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--æ¶ˆè´¹è€…</p>
<ul>
<li>ç»Ÿä¸€APIï¼Œä¸åœ¨åŒºåˆ†high-level consumer APIå’Œlow-level consumer API</li>
<li>å¤šæ¬¡æ¶ˆè´¹ï¼Œä¸ä¼šåˆ é™¤å·²æ¶ˆè´¹çš„ä¿¡æ¯ï¼Œå…è®¸é‡å¤æ¶ˆè´¹</li>
<li>è´Ÿè½½å‡è¡¡ï¼ŒåŸºäºpartitionå’Œconsumer groupè‡ªåŠ¨è´Ÿè½½å‡è¡¡</li>
<li>æµé‡æ§åˆ¶ï¼Œå…è®¸å¼€å‘è€…æ§åˆ¶æ¯æ¬¡è¯·æ±‚è¿”å›æ¶ˆæ¯çš„æ¡æ•°</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--å®‰å…¨</p>
<ul>
<li>è¿æ¥è®¤è¯ï¼Œè¿æ¥åˆ°æœåŠ¡å™¨çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯ä½¿ç”¨SSLæˆ–è€…SASLè¿›è¡ŒéªŒè¯</li>
<li>æƒé™ç®¡ç†ï¼Œbrokerè¿æ¥Zookeeperè¿›è¡Œæƒé™ç®¡ç†</li>
<li>åŠ å¯†ä¼ è¾“ï¼Œæ•°æ®ä¼ è¾“è¿›è¡ŒåŠ å¯†</li>
<li>æˆæƒç®¡ç†ï¼Œå®¢æˆ·ç«¯è¯»ã€å†™æ“ä½œå¯ä»¥è¿›è¡Œæˆæƒç®¡ç†</li>
</ul>
</li>
<li>
<p>Kafkaç®€ä»‹--è¿æ¥å™¨<br>
<img src="https://zu3zz.github.io/post-images/1571396233737.jpeg" alt="" loading="lazy"></p>
</li>
</ol>
<h3 id="52-kafkaå¸¸è§åº”ç”¨åœºæ™¯">5.2 Kafkaå¸¸è§åº”ç”¨åœºæ™¯</h3>
<ul>
<li>æ¶ˆæ¯æœåŠ¡å™¨</li>
<li>ç½‘ç«™æ´»åŠ¨è·Ÿè¸ª</li>
<li>å®æ—¶æ•°æ®æµèšåˆ</li>
<li>æ—¥å¿—èšåˆ</li>
</ul>
<h3 id="53-kafkaå®‰è£…ä¸ç®€å•ç”¨ä¾‹">5.3 Kafkaå®‰è£…ä¸ç®€å•ç”¨ä¾‹</h3>
<h4 id="531-å®‰è£…">5.3.1 å®‰è£…</h4>
<ol>
<li>
<p>ä¸‹è½½å¹¶ä¸”è§£å‹ç¼©kafkaå®‰è£…åŒ… è¿™é‡Œé€‰æ‹©å½“å‰æœ€è¿‘çš„2.3.0ç‰ˆæœ¬</p>
<pre><code class="language-shell">$ wget http://apache.website-solution.net/kafka/2.3.0/kafka-2.3.0-src.tgz
$ tar -xzf kafka_2.12-2.3.0.tgz
$ cd kafka_2.12-2.3.0
</code></pre>
</li>
<li>
<p>å®‰è£…Gradleå’ŒZookeeperï¼Œä¸ºäº†æ–¹ä¾¿ç®¡ç† è¿™é‡Œç»Ÿä¸€ä½¿ç”¨</p>
<pre><code class="language-shell">$ brew install gradle
$ brew install zookeeper
</code></pre>
</li>
</ol>
<h4 id="532-å¯åŠ¨æœåŠ¡">5.3.2 å¯åŠ¨æœåŠ¡</h4>
<ol>
<li>
<p>å¯åŠ¨Zookeeper</p>
<pre><code class="language-shell">$ bin/zookeeper-server-start.sh config/zookeeper.properties
å¦‚æœæ˜¯ä½¿ç”¨homebrew ç›´æ¥ä½¿ç”¨ä¸‹é¢ä¸¤æ¡å‘½ä»¤å³å¯
$ zkServer
$ zkCli
</code></pre>
</li>
<li>
<p>å¯åŠ¨kafka</p>
<pre><code class="language-bash">$ bin/kafka-server-start.sh config/server.properties
</code></pre>
</li>
</ol>
<h4 id="533-åˆ›å»ºä¸€ä¸ªtopic">5.3.3 åˆ›å»ºä¸€ä¸ªTopic</h4>
<ol>
<li>
<p>åˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨Topic</p>
<pre><code class="language-shell">$ bin/kafka-topics.sh --create --bootstrap-server localhost:9092 --replication-factor 1 --partitions 1 --topic test
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹å½“å‰å·²ç»åˆ›å»ºçš„æµ‹è¯•Topic</p>
<pre><code class="language-shell">$ bin/kafka-topics.sh --list --bootstrap-server localhost:9092
test1
</code></pre>
<p>è¾“å‡ºtest1 è¯´æ˜åˆ›å»ºæˆåŠŸ</p>
</li>
</ol>
<h4 id="534-æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹">5.3.4 æ¶ˆæ¯çš„ç”Ÿäº§ä¸æ¶ˆè´¹</h4>
<ol>
<li>
<p>é€šè¿‡produceräº§ç”Ÿæ¶ˆæ¯</p>
<pre><code class="language-shell">$ bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
&gt;this is message one
&gt;this is message two
</code></pre>
</li>
<li>
<p>é€šè¿‡comsumeræ‹¿åˆ°æ‰€æœ‰å½“å‰æ¶ˆæ¯</p>
<pre><code class="language-shell">$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning
this is message one
this is message two
</code></pre>
<p>æˆåŠŸè¾“å‡ºè¾“å…¥çš„æ¶ˆæ¯</p>
</li>
</ol>
<h3 id="54-kafkaçš„é…ç½®">5.4 Kafkaçš„é…ç½®</h3>
<h4 id="541-kafkaæœåŠ¡å™¨é…ç½®æ–‡ä»¶">5.4.1 KafkaæœåŠ¡å™¨é…ç½®æ–‡ä»¶</h4>
<ul>
<li>
<p>é…ç½®æ–‡ä»¶ä½äºconfig/server.propertiesä¸‹</p>
</li>
<li>
<p>é€šè¿‡å¦‚ä¸‹å‘½ä»¤å°†é…ç½®æ–‡ä»¶å¯¼å‡ºè‡³broker.propertiesä¸­</p>
<pre><code class="language-shell">$ grep '^[^#]' server.properties &gt; broker.properties
</code></pre>
</li>
<li>
<p>æŸ¥çœ‹broker.propertiesä¸­å»é™¤äº†æ³¨é‡Šçš„å†…å®¹</p>
<pre><code class="language-shell">broker.id=0
num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/tmp/kafka-logs
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
log.retention.hours=168
log.segment.bytes=1073741824
log.retention.check.interval.ms=300000
zookeeper.connect=localhost:2181
zookeeper.connection.timeout.ms=6000
group.initial.rebalance.delay.ms=0
</code></pre>
</li>
</ul>
<h4 id="542-kafkaé»˜è®¤é…ç½®é¡¹">5.4.2 Kafkaé»˜è®¤é…ç½®é¡¹</h4>
<blockquote>
<p>åŠ ç²—çš„ä¸ºé‡è¦é…ç½®</p>
</blockquote>
<ol>
<li>
<p>Disk IO</p>
<ul>
<li>num.io.threads = 8 è®¾ç½®brokerå¤„ç†ç£ç›˜IOçš„çº¿ç¨‹æ•°</li>
<li>num.partitions = 1 è®¾ç½®æ¯ä¸ªtopicçš„åˆ†åŒºä¸ªæ•°</li>
<li>num.recovery.threads.per.data.dir = 1 é…ç½®æ¯ä¸ªæ•°æ®æ¢å¤æ—¶çš„çº¿ç¨‹æ•°</li>
<li><strong>log.dirs = /tmp/kafka-logs kafkaæ•°æ®çš„å­˜æ”¾ç›®å½•</strong></li>
<li>log.retention.hours = 168 æ¶ˆæ¯çš„å­˜å‚¨æ—¶é—´ å•ä½æ˜¯å°æ—¶</li>
<li>log.segment.bytes = 1073741824 topicçš„partitionæ˜¯ä»¥segmentçš„å½¢å¼å­˜å‚¨çš„</li>
<li>log.retention.check.interval.ms=300000 å®šæ—¶æ£€æŸ¥æ–‡ä»¶å¤§å°</li>
</ul>
</li>
<li>
<p>Network</p>
<ul>
<li>num.network.threads = 3 è®¾ç½®brokerå¤„ç†ç½‘ç»œè¯·æ±‚çš„æœ€å¤§çº¿ç¨‹æ•° ä¸€èˆ¬å¯è®¾ç½®ä¸ºCPUçš„æ ¸æ•°</li>
<li>socket.send.buffer.bytes=102400 socketå‘é€ç¼“å†²åŒºçš„å¤§å°ï¼›-1å³ä¸ºæ“ä½œç³»ç»Ÿé»˜è®¤å€¼</li>
<li>socket.receive.buffer.bytes=102400 æ¥å—ç¼“å†²åŒºï¼›-1ä¸ºé»˜è®¤å€¼</li>
<li>socket.request.max.bytes=104857600 æ¯ä¸€ä¸ªsocketçš„æœ€å¤§å­—èŠ‚æ•°</li>
</ul>
</li>
<li>
<p>Cluster</p>
<ul>
<li>
<p>zookeeper.connect=localhost:2181 zookeeperçš„é›†ç¾¤åœ°å€ï¼›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œä¸­é—´ç”¨é€—å·åˆ†éš”</p>
</li>
<li>
<p>zookeeper.connection.timeout.ms=6000 è¿æ¥çš„è¶…æ—¶æ—¶é—´</p>
</li>
<li>
<p><strong>broker.id=0 brokeråœ¨é›†ç¾¤ä¸­çš„å”¯ä¸€æ ‡è¯†ï¼›å¦‚æœæ²¡æœ‰ï¼Œzookeeperä»1001å¼€å§‹é€’å¢</strong></p>
</li>
</ul>
</li>
</ol>
<h3 id="55-kafkaç›¸å…³æ¦‚å¿µ">5.5 Kafkaç›¸å…³æ¦‚å¿µ</h3>
<h4 id="551-å¸¸è§æ¦‚å¿µ-é›†ç¾¤">5.5.1 å¸¸è§æ¦‚å¿µ--é›†ç¾¤</h4>
<ul>
<li>Clusterï¼šé›†ç¾¤</li>
<li>Brokerï¼šæ¯ä¸ªæœåŠ¡å™¨éƒ½æ˜¯ä¸€ä¸ªBroker</li>
<li>Producerï¼šç”Ÿäº§è€…</li>
<li>Consumerï¼šæ¶ˆè´¹è€…</li>
<li>Consumer Groupï¼šå®ç°topicå¹¿æ’­çš„æ‰‹æ®µ</li>
</ul>
<h4 id="552-å¸¸è§æ¦‚å¿µ-æ¶ˆæ¯">5.5.2 å¸¸è§æ¦‚å¿µ--æ¶ˆæ¯</h4>
<ul>
<li>Recordï¼šæ¯ä¸€æ¡æ¶ˆæ¯</li>
<li>Topicï¼šæ¯ä¸€ä¸ªæ¶ˆæ¯éƒ½ä¼šæœ‰ä¸€ä¸ªTopic</li>
<li>Partitionï¼šæ¯ä¸ªTopicåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªPartition</li>
<li>Segmentï¼šæ¯ä¸ªPartitionåŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªSegment</li>
<li>Offsetï¼šPartitionä¸­æ¯ä¸ªæ¶ˆæ¯éƒ½æœ‰çš„åºåˆ—å·ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†ä¸€æ¡æ¶ˆæ¯</li>
<li>Replicationï¼šå‰¯æœ¬ï¼›kafkaæ”¯æŒä»¥Partitionä¸ºå•ä½å¯¹æ¶ˆæ¯è¿›è¡Œå¤‡ä»½</li>
<li>Leaderï¼šæ‰€æœ‰è¯»å†™è¯·æ±‚éƒ½ç”±Leaderæ¥å¤„ç†</li>
</ul>
<h4 id="553-å¸¸è§æ¦‚å¿µ-topic">5.5.3 å¸¸è§æ¦‚å¿µ--Topic</h4>
<ul>
<li>
<p>Topicå¯ä»¥è¢«çœ‹åšæ˜¯ä¸€ä¸ªé˜Ÿåˆ—</p>
<figure data-type="image" tabindex="5"><img src="https://zu3zz.github.io/post-images/1571396270203.png" alt="topic" loading="lazy"></figure>
</li>
</ul>
<h4 id="554-å¸¸è§æ¦‚å¿µ-partition">5.5.4 å¸¸è§æ¦‚å¿µ--Partition</h4>
<figure data-type="image" tabindex="6"><img src="https://zu3zz.github.io/post-images/1571396287204.png" alt="partition" loading="lazy"></figure>
<h4 id="555-å¸¸è§æ¦‚å¿µ-segment">5.5.5 å¸¸è§æ¦‚å¿µ--Segment</h4>
<figure data-type="image" tabindex="7"><img src="https://zu3zz.github.io/post-images/1571396308603.png" alt="segment" loading="lazy"></figure>
<h4 id="556-å¸¸è§æ¦‚å¿µ-é›†ç¾¤">5.5.6 å¸¸è§æ¦‚å¿µ--é›†ç¾¤</h4>
<figure data-type="image" tabindex="8"><img src="https://zu3zz.github.io/post-images/1571396330337.png" alt="é›†ç¾¤" loading="lazy"></figure>
<h2 id="6-pythonä¸kafka">6. Pythonä¸Kafka</h2>
<ul>
<li>ç”±äºæœ‰å¾ˆå¤špythonåº“éƒ½å¯ä»¥ä½¿ç”¨kafka</li>
<li>çŸ¥åçš„æœ‰kafka-pythonï¼›pykafkaï¼›faustï¼›è¿™é‡Œä½¿ç”¨kafka-python</li>
</ul>
<blockquote>
<p>ä½¿ç”¨pipå®‰è£…</p>
<p>pip install kafka-python</p>
</blockquote>
<ol>
<li>
<p>åˆ›å»ºkafkaProducer.py</p>
<pre><code class="language-python">from kafka import KafkaProducer
import names

producer = KafkaProducer()

for _ in range(10):
    name = names.get_full_name()
    future = producer.send('test', bytes(name,'utf-8'))
    result = future.get(60)
    print(result)
</code></pre>
</li>
<li>
<p>åˆ›å»ºkafkaConsumer.py</p>
<pre><code class="language-python">from kafka import KafkaConsumer

consumer = KafkaConsumer('test',group_id='test01')

for msg in consumer:
    print(msg)
</code></pre>
</li>
<li>
<p>è¿›è¡Œæ•°æ®çš„äº§ç”Ÿä¸æ¶ˆè´¹</p>
<pre><code class="language-shell">$ python kafkaProducer.py 
RecordMetadata(topic='test', partition=0, topic_partition=TopicPartition(topic='test', partition=0), offset=14, timestamp=1571317704074, checksum=None, serialized_key_size=-1, serialized_value_size=15, serialized_header_size=-1)
RecordMetadata(topic='test', partition=0, topic_partition=TopicPartition(topic='test', partition=0), offset=15, timestamp=1571317704182, checksum=None, serialized_key_size=-1, serialized_value_size=12, serialized_header_size=-1)
...
</code></pre>
<pre><code class="language-shell">$ python kafkaConsumer.py 
ConsumerRecord(topic='test', partition=0, offset=14, timestamp=1571317704074, timestamp_type=0, key=None, value=b'Margaret Medina', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=15, serialized_header_size=-1)
ConsumerRecord(topic='test', partition=0, offset=15, timestamp=1571317704182, timestamp_type=0, key=None, value=b'Mark Mccarty', headers=[], checksum=None, serialized_key_size=-1, serialized_value_size=12, serialized_header_size=-1)
...
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡Produceräº§ç”Ÿçš„æ•°æ®å·²ç»è¢«ConsumeræˆåŠŸæ‹¿åˆ°ã€‚</p>
</li>
</ol>
<h2 id="7-æ¡†æ¶æ•´åˆ">7. æ¡†æ¶æ•´åˆ</h2>
<h3 id="71-é‡‡é›†æ—¥å¿—">7.1 é‡‡é›†æ—¥å¿—</h3>
<h4 id="711-æ—¥å¿—é‡‡é›†æ–¹æ¡ˆä»‹ç»">7.1.1 æ—¥å¿—é‡‡é›†æ–¹æ¡ˆä»‹ç»</h4>
<ul>
<li>flume</li>
<li>rsyslog</li>
<li>heka</li>
<li>logstash</li>
</ul>
<h4 id="712-nginxè®¿é—®æ—¥å¿—æ ¼å¼é…ç½®">7.1.2 nginxè®¿é—®æ—¥å¿—æ ¼å¼é…ç½®</h4>
<ul>
<li>
<p>è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼</p>
</li>
<li>
<p>ç›´æ¥è¾“å‡ºjson</p>
<pre><code class="language-shell">log_format json '{&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,'
								'&quot;host&quot;:&quot;$server_addr&quot;,'
								'&quot;clientip&quot;:&quot;$remote_addr&quot;,'
								'&quot;size&quot;:$body_bytes_sent,'
								'&quot;responsetime&quot;:$request_time,'
								'&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,'
								'&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,'
								'&quot;http_host&quot;:&quot;$host&quot;,'
								'&quot;url&quot;:&quot;$url&quot;,'
								'&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,'
								'&quot;refer&quot;:&quot;$http_referer&quot;,'
								'&quot;agent&quot;:&quot;$http_user_agent&quot;,'
								'&quot;status&quot;:&quot;$status&quot;}';
asscess_log /tmp/nginx/access.log json;
</code></pre>
</li>
<li>
<p>å¯ä»¥çœ‹åˆ°nginxçš„accessæ—¥å¿—å°±æ˜¯jsonæ ¼å¼çš„äº†</p>
</li>
</ul>
<h3 id="72-logstashé…ç½®">7.2 logstashé…ç½®</h3>
<ul>
<li>logstashé…ç½®ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†
<ol>
<li>input</li>
<li>filter</li>
<li>output</li>
</ol>
</li>
</ul>
<h4 id="721-kafkaæ’ä»¶">7.2.1 kafkaæ’ä»¶</h4>
<ul>
<li>
<p>é…ç½®logstash output kafkaæ’ä»¶</p>
<pre><code class="language-shell">input {
    file {
        path =&gt; &quot;/pot/openresty/nginx/logs/access.log&quot;
        codec =&gt; json
    }
}
filter {
    # å¯¹useragentè¿›è¡Œé¢„å¤„ç†
    useragent {
        source =&gt; &quot;agent&quot;
        target =&gt; &quot;user_agent&quot;
        remove_field =&gt; &quot;agent&quot;
    }
    # å¯¹ipåœ°å€çš„åœ°åŒºè¿›è¡Œé¢„å¤„ç†
    geoip {
        source =&gt; &quot;clientip&quot;
        target =&gt; &quot;geoip&quot;
    }
}
output {
    # debugç”¨
    stdout {
        codec =&gt; rubydebug
    }
    # logstash output kafkaæ’ä»¶
    kafka {
        codec =&gt; json
        topic_id =&gt; &quot;nginx&quot;
        # kafkaå¯¹å¤–åœ°å€
        bootstrap_servers =&gt; &quot;localhost:9092&quot;
    }
}
</code></pre>
</li>
</ul>
<h3 id="73-å¯åŠ¨æ—¥å¿—">7.3 å¯åŠ¨æ—¥å¿—</h3>
<p><strong>ä¾æ¬¡è¿è¡Œä¸€ä¸‹åº”ç”¨</strong></p>
<ul>
<li>nginx</li>
<li>logstash</li>
<li>kafka</li>
<li>Zookeeper</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://zu3zz.github.io/tag/ITpFJisjB/" class="tag">
                    Nginx
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/gkOi3b2wx/" class="tag">
                    Zookeeper
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/jmeIOwq49/" class="tag">
                    Python
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/tqQSAbU7V/" class="tag">
                    BackEnd
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/VQJGfklWj/" class="tag">
                    Kafka
                  </a>
                
                  <a href="https://zu3zz.github.io/tag/FlCGh236W/" class="tag">
                    Redis
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://zu3zz.github.io/post/springboot-3/">
                  <h3 class="post-title">
                    SpringBootç³»åˆ—(3) ---- æ—¥å¿—
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>




  </body>
</html>
